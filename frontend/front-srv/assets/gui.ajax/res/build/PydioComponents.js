(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.PydioComponents = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.ScrollArea=t(require("react")):e.ScrollArea=t(e.React)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),n(31);var r=n(13),i=o(r);t.default=i.default},function(t,n){t.exports=e},function(e,t,n){e.exports=n(19)()},function(e,t){"use strict";function n(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]="number"==typeof e[n]?e[n]:e[n].val);return t}t.__esModule=!0,t.default=n,e.exports=t.default},function(e,t,n){(function(t){(function(){var n,o,r;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof t&&null!==t&&t.hrtime?(e.exports=function(){return(n()-r)/1e6},o=t.hrtime,n=function(){var e;return e=o(),1e9*e[0]+e[1]},r=n()):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(t,n(10))},function(e,t,n){(function(t){for(var o=n(23),r="undefined"==typeof window?t:window,i=["moz","webkit"],a="AnimationFrame",l=r["request"+a],s=r["cancel"+a]||r["cancelRequest"+a],u=0;!l&&u<i.length;u++)l=r[i[u]+"Request"+a],s=r[i[u]+"Cancel"+a]||r[i[u]+"CancelRequest"+a];if(!l||!s){var c=0,f=0,p=[],d=1e3/60;l=function(e){if(0===p.length){var t=o(),n=Math.max(0,d-(t-c));c=n+t,setTimeout(function(){var e=p.slice(0);p.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout(function(){throw e},0)}},Math.round(n))}return p.push({handle:++f,callback:e,cancelled:!1}),f},s=function(e){for(var t=0;t<p.length;t++)p[t].handle===e&&(p[t].cancelled=!0)}}e.exports=function(e){return l.call(r,e)},e.exports.cancel=function(){s.apply(r,arguments)},e.exports.polyfill=function(e){e||(e=r),e.requestAnimationFrame=l,e.cancelAnimationFrame=s}}).call(t,function(){return this}())},function(e,t){"use strict";function n(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=0);return t}t.__esModule=!0,t.default=n,e.exports=t.default},function(e,t){"use strict";function n(e,t,n){for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(0!==n[o])return!1;var r="number"==typeof t[o]?t[o]:t[o].val;if(e[o]!==r)return!1}return!0}t.__esModule=!0,t.default=n,e.exports=t.default},function(e,t){"use strict";function n(e,t,n,r,i,a,l){var s=-i*(t-r),u=-a*n,c=s+u,f=n+c*e,p=t+f*e;return Math.abs(f)<l&&Math.abs(p-r)<l?(o[0]=r,o[1]=0,o):(o[0]=p,o[1]=f,o)}t.__esModule=!0,t.default=n;var o=[0,0];e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){return p?f.default.findDOMNode(e):e}function i(){d||p||(d=!0,console.error("With React 0.14 and later versions, you no longer need to wrap <ScrollArea> child into a function."))}function a(){!d&&p&&(d=!0,console.error("With React 0.13, you need to wrap <ScrollArea> child into a function."))}function l(e){return e<0?0:e}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}function u(e){var t=e.version;if("string"!=typeof t)return!0;var n=t.split("."),o=parseInt(n[0],10),r=parseInt(n[1],10);return 0===o&&13===r}Object.defineProperty(t,"__esModule",{value:!0}),t.findDOMNode=r,t.warnAboutFunctionChild=i,t.warnAboutElementChild=a,t.positiveOrZero=l,t.modifyObjValues=s,t.isReact13=u;var c=n(1),f=o(c),p=u(f.default),d=!1},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){y&&d&&(y=!1,d.length?h=d.concat(h):v=-1,h.length&&l())}function l(){if(!y){var e=r(a);y=!0;for(var t=h.length;t;){for(d=h,h=[];++v<t;)d&&d[v].run();v=-1,t=h.length}d=null,y=!1,i(e)}}function s(e,t){this.fun=e,this.array=t}function u(){}var c,f,p=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var d,h=[],y=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new s(e,t)),1!==h.length||y||r(l)},s.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){"use strict";t.__esModule=!0,t.default={noWobble:{stiffness:170,damping:26},gentle:{stiffness:120,damping:14},wobbly:{stiffness:180,damping:12},stiff:{stiffness:210,damping:20}},e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e.default:e}t.__esModule=!0;var r=n(24);t.Motion=o(r);var i=n(25);t.StaggeredMotion=o(i);var a=n(26);t.TransitionMotion=o(a);var l=n(29);t.spring=o(l);var s=n(11);t.presets=o(s);var u=n(3);t.stripStyle=o(u);var c=n(28);t.reorderKeys=o(c)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(1),f=o(c),p=n(2),d=o(p),h=n(18),y=o(h),v=n(12),m=n(9),b=n(14),S=o(b),g={wheel:"wheel",api:"api",touch:"touch",touchEnd:"touchEnd",mousemove:"mousemove",keyPress:"keypress"},w=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={topPosition:0,leftPosition:0,realHeight:0,containerHeight:0,realWidth:0,containerWidth:0},n.scrollArea={refresh:function(){n.setSizesToState()},scrollTop:function(){n.scrollTop()},scrollBottom:function(){n.scrollBottom()},scrollYTo:function(e){n.scrollYTo(e)},scrollLeft:function(){n.scrollLeft()},scrollRight:function(){n.scrollRight()},scrollXTo:function(e){n.scrollXTo(e)}},n.evntsPreviousValues={clientX:0,clientY:0,deltaX:0,deltaY:0},n.bindedHandleWindowResize=n.handleWindowResize.bind(n),n}return a(t,e),u(t,[{key:"getChildContext",value:function(){return{scrollArea:this.scrollArea}}},{key:"componentDidMount",value:function(){this.props.contentWindow&&this.props.contentWindow.addEventListener("resize",this.bindedHandleWindowResize),this.lineHeightPx=(0,y.default)((0,m.findDOMNode)(this.content)),this.setSizesToState()}},{key:"componentWillUnmount",value:function(){this.props.contentWindow&&this.props.contentWindow.removeEventListener("resize",this.bindedHandleWindowResize)}},{key:"componentDidUpdate",value:function(){this.setSizesToState()}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,o=t.className,r=t.contentClassName,i=t.ownerDocument,a=this.props.smoothScrolling&&(this.state.eventType===g.wheel||this.state.eventType===g.api||this.state.eventType===g.touchEnd||this.state.eventType===g.keyPress),l=this.canScrollY()?f.default.createElement(S.default,{ownerDocument:i,realSize:this.state.realHeight,containerSize:this.state.containerHeight,position:this.state.topPosition,onMove:this.handleScrollbarMove.bind(this),onPositionChange:this.handleScrollbarYPositionChange.bind(this),containerStyle:this.props.verticalContainerStyle,scrollbarStyle:this.props.verticalScrollbarStyle,smoothScrolling:a,minScrollSize:this.props.minScrollSize,onFocus:this.focusContent.bind(this),type:"vertical"}):null,u=this.canScrollX()?f.default.createElement(S.default,{ownerDocument:i,realSize:this.state.realWidth,containerSize:this.state.containerWidth,position:this.state.leftPosition,onMove:this.handleScrollbarMove.bind(this),onPositionChange:this.handleScrollbarXPositionChange.bind(this),containerStyle:this.props.horizontalContainerStyle,scrollbarStyle:this.props.horizontalScrollbarStyle,smoothScrolling:a,minScrollSize:this.props.minScrollSize,onFocus:this.focusContent.bind(this),type:"horizontal"}):null;"function"==typeof n?((0,m.warnAboutFunctionChild)(),n=n()):(0,m.warnAboutElementChild)();var c="scrollarea "+(o||""),p="scrollarea-content "+(r||""),d={marginTop:-this.state.topPosition,marginLeft:-this.state.leftPosition},h=a?(0,m.modifyObjValues)(d,function(e){return(0,v.spring)(e)}):d;return f.default.createElement(v.Motion,{style:h},function(t){return f.default.createElement("div",{ref:function(t){return e.wrapper=t},className:c,style:e.props.style,onWheel:e.handleWheel.bind(e)},f.default.createElement("div",{ref:function(t){return e.content=t},style:s({},e.props.contentStyle,t),className:p,onTouchStart:e.handleTouchStart.bind(e),onTouchMove:e.handleTouchMove.bind(e),onTouchEnd:e.handleTouchEnd.bind(e),onKeyDown:e.handleKeyDown.bind(e),tabIndex:e.props.focusableTabIndex},n),l,u)})}},{key:"setStateFromEvent",value:function(e,t){this.props.onScroll&&this.props.onScroll(e),this.setState(s({},e,{eventType:t}))}},{key:"handleTouchStart",value:function(e){var t=e.touches;if(1===t.length){var n=t[0],o=n.clientX,r=n.clientY;this.eventPreviousValues=s({},this.eventPreviousValues,{clientY:r,clientX:o,timestamp:Date.now()})}}},{key:"handleTouchMove",value:function(e){this.canScroll()&&(e.preventDefault(),e.stopPropagation());var t=e.touches;if(1===t.length){var n=t[0],o=n.clientX,r=n.clientY,i=this.eventPreviousValues.clientY-r,a=this.eventPreviousValues.clientX-o;this.eventPreviousValues=s({},this.eventPreviousValues,{deltaY:i,deltaX:a,clientY:r,clientX:o,timestamp:Date.now()}),this.setStateFromEvent(this.composeNewState(-a,-i))}}},{key:"handleTouchEnd",value:function(e){var t=this.eventPreviousValues,n=t.deltaX,o=t.deltaY,r=t.timestamp;"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),Date.now()-r<200&&this.setStateFromEvent(this.composeNewState(10*-n,10*-o),g.touchEnd),this.eventPreviousValues=s({},this.eventPreviousValues,{deltaY:0,deltaX:0})}},{key:"handleScrollbarMove",value:function(e,t){this.setStateFromEvent(this.composeNewState(t,e))}},{key:"handleScrollbarXPositionChange",value:function(e){this.scrollXTo(e)}},{key:"handleScrollbarYPositionChange",value:function(e){this.scrollYTo(e)}},{key:"handleWheel",value:function(e){var t=e.deltaY,n=e.deltaX;if(this.props.swapWheelAxes){var o=[n,t];t=o[0],n=o[1]}1===e.deltaMode&&(t*=this.lineHeightPx,n*=this.lineHeightPx),t*=this.props.speed,n*=this.props.speed;var r=this.composeNewState(-n,-t);(r.topPosition&&this.state.topPosition!==r.topPosition||r.leftPosition&&this.state.leftPosition!==r.leftPosition||this.props.stopScrollPropagation)&&(e.preventDefault(),e.stopPropagation()),this.setStateFromEvent(r,g.wheel),this.focusContent()}},{key:"handleKeyDown",value:function(e){if("input"!==e.target.tagName.toLowerCase()&&"textarea"!==e.target.tagName.toLowerCase()&&!e.target.isContentEditable){var t=0,n=0,o=this.lineHeightPx?this.lineHeightPx:10;switch(e.keyCode){case 33:t=this.state.containerHeight-o;break;case 34:t=-this.state.containerHeight+o;break;case 37:n=o;break;case 38:t=o;break;case 39:n=-o;break;case 40:t=-o}if(0!==t||0!==n){var r=this.composeNewState(n,t);e.preventDefault(),e.stopPropagation(),this.setStateFromEvent(r,g.keyPress)}}}},{key:"handleWindowResize",value:function(){var e=this.computeSizes();e=this.getModifiedPositionsIfNeeded(e),this.setStateFromEvent(e)}},{key:"composeNewState",value:function(e,t){var n=this.computeSizes();return this.canScrollY(n)?n.topPosition=this.computeTopPosition(t,n):n.topPosition=0,this.canScrollX(n)&&(n.leftPosition=this.computeLeftPosition(e,n)),n}},{key:"computeTopPosition",value:function(e,t){var n=this.state.topPosition-e;return this.normalizeTopPosition(n,t)}},{key:"computeLeftPosition",value:function(e,t){var n=this.state.leftPosition-e;return this.normalizeLeftPosition(n,t)}},{key:"normalizeTopPosition",value:function(e,t){return e>t.realHeight-t.containerHeight&&(e=t.realHeight-t.containerHeight),e<0&&(e=0),e}},{key:"normalizeLeftPosition",value:function(e,t){return e>t.realWidth-t.containerWidth?e=t.realWidth-t.containerWidth:e<0&&(e=0),e}},{key:"computeSizes",value:function(){var e=this.content.offsetHeight,t=this.wrapper.offsetHeight,n=this.content.offsetWidth,o=this.wrapper.offsetWidth;return{realHeight:e,containerHeight:t,realWidth:n,containerWidth:o}}},{key:"setSizesToState",value:function(){var e=this.computeSizes();e.realHeight===this.state.realHeight&&e.realWidth===this.state.realWidth||this.setStateFromEvent(this.getModifiedPositionsIfNeeded(e))}},{key:"scrollTop",value:function(){this.scrollYTo(0)}},{key:"scrollBottom",value:function(){this.scrollYTo(this.state.realHeight-this.state.containerHeight)}},{key:"scrollLeft",value:function(){this.scrollXTo(0)}},{key:"scrollRight",value:function(){this.scrollXTo(this.state.realWidth-this.state.containerWidth)}},{key:"scrollYTo",value:function(e){if(this.canScrollY()){var t=this.normalizeTopPosition(e,this.computeSizes());this.setStateFromEvent({topPosition:t},g.api)}}},{key:"scrollXTo",value:function(e){if(this.canScrollX()){var t=this.normalizeLeftPosition(e,this.computeSizes());this.setStateFromEvent({leftPosition:t},g.api)}}},{key:"canScrollY",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,t=e.realHeight>e.containerHeight;return t&&this.props.vertical}},{key:"canScrollX",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,t=e.realWidth>e.containerWidth;return t&&this.props.horizontal}},{key:"canScroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state;return this.canScrollY(e)||this.canScrollX(e)}},{key:"getModifiedPositionsIfNeeded",value:function(e){var t=e.realHeight-e.containerHeight;this.state.topPosition>=t&&(e.topPosition=this.canScrollY(e)?(0,m.positiveOrZero)(t):0);var n=e.realWidth-e.containerWidth;return this.state.leftPosition>=n&&(e.leftPosition=this.canScrollX(e)?(0,m.positiveOrZero)(n):0),e}},{key:"focusContent",value:function(){this.content&&(0,m.findDOMNode)(this.content).focus()}}]),t}(f.default.Component);t.default=w,w.childContextTypes={scrollArea:d.default.object},w.propTypes={className:d.default.string,style:d.default.object,speed:d.default.number,contentClassName:d.default.string,contentStyle:d.default.object,vertical:d.default.bool,verticalContainerStyle:d.default.object,verticalScrollbarStyle:d.default.object,horizontal:d.default.bool,horizontalContainerStyle:d.default.object,horizontalScrollbarStyle:d.default.object,onScroll:d.default.func,contentWindow:d.default.any,ownerDocument:d.default.any,smoothScrolling:d.default.bool,minScrollSize:d.default.number,swapWheelAxes:d.default.bool,stopScrollPropagation:d.default.bool,focusableTabIndex:d.default.number},w.defaultProps={speed:1,vertical:!0,horizontal:!0,smoothScrolling:!1,swapWheelAxes:!1,contentWindow:"object"===("undefined"==typeof window?"undefined":l(window))?window:void 0,ownerDocument:"object"===("undefined"==typeof document?"undefined":l(document))?document:void 0,focusableTabIndex:1}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),c=o(u),f=n(2),p=o(f),d=n(12),h=n(9),y=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=n.calculateState(e);return n.state={position:o.position,scrollSize:o.scrollSize,isDragging:!1,lastClientPosition:0},"vertical"===e.type?n.bindedHandleMouseMove=n.handleMouseMoveForVertical.bind(n):n.bindedHandleMouseMove=n.handleMouseMoveForHorizontal.bind(n),n.bindedHandleMouseUp=n.handleMouseUp.bind(n),n}return a(t,e),s(t,[{key:"componentDidMount",value:function(){this.props.ownerDocument&&(this.props.ownerDocument.addEventListener("mousemove",this.bindedHandleMouseMove),this.props.ownerDocument.addEventListener("mouseup",this.bindedHandleMouseUp))}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.calculateState(e))}},{key:"componentWillUnmount",value:function(){this.props.ownerDocument&&(this.props.ownerDocument.removeEventListener("mousemove",this.bindedHandleMouseMove),this.props.ownerDocument.removeEventListener("mouseup",this.bindedHandleMouseUp))}},{key:"calculateFractionalPosition",value:function(e,t,n){var o=e-t;return 1-(o-n)/o}},{key:"calculateState",value:function(e){var t=this.calculateFractionalPosition(e.realSize,e.containerSize,e.position),n=e.containerSize*e.containerSize/e.realSize,o=n<e.minScrollSize?e.minScrollSize:n,r=(e.containerSize-o)*t;return{scrollSize:o,position:Math.round(r)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.smoothScrolling,o=t.isDragging,r=t.type,i=t.scrollbarStyle,a=t.containerStyle,s="horizontal"===r,u="vertical"===r,f=this.createScrollStyles(),p=n?(0,h.modifyObjValues)(f,function(e){return(0,d.spring)(e)}):f,y="scrollbar-container "+(o?"active":"")+" "+(s?"horizontal":"")+" "+(u?"vertical":"");return c.default.createElement(d.Motion,{style:p},function(t){return c.default.createElement("div",{className:y,style:a,onMouseDown:e.handleScrollBarContainerClick.bind(e),ref:function(t){return e.scrollbarContainer=t}},c.default.createElement("div",{className:"scrollbar",style:l({},i,t),onMouseDown:e.handleMouseDown.bind(e)}))})}},{key:"handleScrollBarContainerClick",value:function(e){e.preventDefault();var t=this.computeMultiplier(),n=this.isVertical()?e.clientY:e.clientX,o=this.scrollbarContainer.getBoundingClientRect(),r=o.top,i=o.left,a=this.isVertical()?r:i,l=n-a,s=this.props.containerSize*this.props.containerSize/this.props.realSize;this.setState({isDragging:!0,lastClientPosition:n}),this.props.onPositionChange((l-s/2)/t)}},{key:"handleMouseMoveForHorizontal",value:function(e){var t=this.computeMultiplier();if(this.state.isDragging){e.preventDefault();var n=this.state.lastClientPosition-e.clientX;this.setState({lastClientPosition:e.clientX}),this.props.onMove(0,n/t)}}},{key:"handleMouseMoveForVertical",value:function(e){var t=this.computeMultiplier();if(this.state.isDragging){e.preventDefault();var n=this.state.lastClientPosition-e.clientY;this.setState({lastClientPosition:e.clientY}),this.props.onMove(n/t,0)}}},{key:"handleMouseDown",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.isVertical()?e.clientY:e.clientX;this.setState({isDragging:!0,lastClientPosition:t}),this.props.onFocus()}},{key:"handleMouseUp",value:function(e){this.state.isDragging&&(e.preventDefault(),this.setState({isDragging:!1}))}},{key:"createScrollStyles",value:function(){return"vertical"===this.props.type?{height:this.state.scrollSize,marginTop:this.state.position}:{width:this.state.scrollSize,marginLeft:this.state.position}}},{key:"computeMultiplier",value:function(){return this.props.containerSize/this.props.realSize}},{key:"isVertical",value:function(){return"vertical"===this.props.type}}]),t}(c.default.Component);y.propTypes={onMove:p.default.func,onPositionChange:p.default.func,onFocus:p.default.func,realSize:p.default.number,containerSize:p.default.number,position:p.default.number,containerStyle:p.default.object,scrollbarStyle:p.default.object,type:p.default.oneOf(["vertical","horizontal"]),ownerDocument:p.default.any,smoothScrolling:p.default.bool,minScrollSize:p.default.number},y.defaultProps={type:"vertical",smoothScrolling:!1},t.default=y},function(e,t){var n=function(e,t,n){return n=window.getComputedStyle,(n?n(e):e.currentStyle)[t.replace(/-(\w)/gi,function(e,t){return t.toUpperCase()})]};e.exports=n},function(e,t,n){t=e.exports=n(17)(),t.push([e.id,".scrollarea-content{margin:0;padding:0;overflow:hidden;position:relative}.scrollarea-content:focus{outline:0}.scrollarea{position:relative;overflow:hidden}.scrollarea .scrollbar-container{position:absolute;background:none;opacity:.1;z-index:9999;-webkit-transition:all .4s;transition:all .4s}.scrollarea .scrollbar-container.horizontal{width:100%;height:10px;left:0;bottom:0}.scrollarea .scrollbar-container.horizontal .scrollbar{width:20px;height:8px;background:#000;margin-top:1px}.scrollarea .scrollbar-container.vertical{width:10px;height:100%;right:0;top:0}.scrollarea .scrollbar-container.vertical .scrollbar{width:8px;height:20px;background:#000;margin-left:1px}.scrollarea .scrollbar-container.active,.scrollarea .scrollbar-container:hover{background:gray;opacity:.6!important}.scrollarea:hover .scrollbar-container{opacity:.3}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(o[i]=!0)}for(r=0;r<t.length;r++){var a=t[r];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,t,n){function o(e){var t=r(e,"line-height"),n=parseFloat(t,10);if(t===n+""){var o=e.style.lineHeight;e.style.lineHeight=t+"em",t=r(e,"line-height"),n=parseFloat(t,10),o?e.style.lineHeight=o:delete e.style.lineHeight}if(t.indexOf("pt")!==-1?(n*=4,n/=3):t.indexOf("mm")!==-1?(n*=96,n/=25.4):t.indexOf("cm")!==-1?(n*=96,n/=2.54):t.indexOf("in")!==-1?n*=96:t.indexOf("pc")!==-1&&(n*=16),n=Math.round(n),"normal"===t){var i=e.nodeName,a=document.createElement(i);a.innerHTML="&nbsp;";var l=r(e,"font-size");a.style.fontSize=l;var s=document.body;s.appendChild(a);var u=a.offsetHeight;n=u,s.removeChild(a)}return n}var r=n(15);e.exports=o},function(e,t,n){"use strict";var o=n(21),r=n(22),i=n(20);e.exports=function(){function e(e,t,n,o,a,l){l!==i&&r(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=o,n.PropTypes=n,n}},function(e,t){"use strict";var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";e.exports=n},function(e,t){"use strict";function n(e){return function(){return e}}var o=function(){};o.thatReturns=n,o.thatReturnsFalse=n(!1),o.thatReturnsTrue=n(!0),o.thatReturnsNull=n(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,i,a,l,s){if(r(t),!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,o,i,a,l,s],f=0;u=new Error(t.replace(/%s/g,function(){return c[f++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}}var r=function(e){};e.exports=o},function(e,t,n){(function(t){(function(){var n,o,r,i,a,l;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof t&&null!==t&&t.hrtime?(e.exports=function(){return(n()-a)/1e6},o=t.hrtime,n=function(){var e;return e=o(),1e9*e[0]+e[1]},i=n(),l=1e9*t.uptime(),a=i-l):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(t,n(10))},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(6),u=o(s),c=n(3),f=o(c),p=n(8),d=o(p),h=n(4),y=o(h),v=n(5),m=o(v),b=n(7),S=o(b),g=n(1),w=o(g),P=n(2),T=o(P),k=1e3/60,O=function(e){function t(n){var o=this;r(this,t),e.call(this,n),this.wasAnimating=!1,this.animationID=null,this.prevTime=0,this.accumulatedTime=0,this.unreadPropStyle=null,this.clearUnreadPropStyle=function(e){var t=!1,n=o.state,r=n.currentStyle,i=n.currentVelocity,l=n.lastIdealStyle,s=n.lastIdealVelocity;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var c=e[u];"number"==typeof c&&(t||(t=!0,r=a({},r),i=a({},i),l=a({},l),s=a({},s)),r[u]=c,i[u]=0,l[u]=c,s[u]=0)}t&&o.setState({currentStyle:r,currentVelocity:i,lastIdealStyle:l,lastIdealVelocity:s})},this.startAnimationIfNecessary=function(){o.animationID=m.default(function(e){var t=o.props.style;if(S.default(o.state.currentStyle,t,o.state.currentVelocity))return o.wasAnimating&&o.props.onRest&&o.props.onRest(),o.animationID=null,o.wasAnimating=!1,void(o.accumulatedTime=0);o.wasAnimating=!0;var n=e||y.default(),r=n-o.prevTime;if(o.prevTime=n,o.accumulatedTime=o.accumulatedTime+r,o.accumulatedTime>10*k&&(o.accumulatedTime=0),0===o.accumulatedTime)return o.animationID=null,void o.startAnimationIfNecessary();var i=(o.accumulatedTime-Math.floor(o.accumulatedTime/k)*k)/k,a=Math.floor(o.accumulatedTime/k),l={},s={},u={},c={};for(var f in t)if(Object.prototype.hasOwnProperty.call(t,f)){var p=t[f];if("number"==typeof p)u[f]=p,c[f]=0,l[f]=p,s[f]=0;else{for(var h=o.state.lastIdealStyle[f],v=o.state.lastIdealVelocity[f],m=0;m<a;m++){var b=d.default(k/1e3,h,v,p.val,p.stiffness,p.damping,p.precision);h=b[0],v=b[1]}var g=d.default(k/1e3,h,v,p.val,p.stiffness,p.damping,p.precision),w=g[0],P=g[1];u[f]=h+(w-h)*i,c[f]=v+(P-v)*i,l[f]=h,s[f]=v}}o.animationID=null,o.accumulatedTime-=a*k,o.setState({currentStyle:u,currentVelocity:c,lastIdealStyle:l,lastIdealVelocity:s}),o.unreadPropStyle=null,o.startAnimationIfNecessary()})},this.state=this.defaultState()}return i(t,e),l(t,null,[{key:"propTypes",value:{defaultStyle:T.default.objectOf(T.default.number),style:T.default.objectOf(T.default.oneOfType([T.default.number,T.default.object])).isRequired,children:T.default.func.isRequired,onRest:T.default.func},enumerable:!0}]),t.prototype.defaultState=function(){var e=this.props,t=e.defaultStyle,n=e.style,o=t||f.default(n),r=u.default(o);return{currentStyle:o,currentVelocity:r,lastIdealStyle:o,lastIdealVelocity:r}},t.prototype.componentDidMount=function(){this.prevTime=y.default(),this.startAnimationIfNecessary()},t.prototype.componentWillReceiveProps=function(e){null!=this.unreadPropStyle&&this.clearUnreadPropStyle(this.unreadPropStyle),this.unreadPropStyle=e.style,null==this.animationID&&(this.prevTime=y.default(),this.startAnimationIfNecessary())},t.prototype.componentWillUnmount=function(){null!=this.animationID&&(m.default.cancel(this.animationID),this.animationID=null)},t.prototype.render=function(){var e=this.props.children(this.state.currentStyle);return e&&w.default.Children.only(e)},t}(w.default.Component);t.default=O,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){for(var o=0;o<e.length;o++)if(!g.default(e[o],t[o],n[o]))return!1;return!0}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(6),c=o(u),f=n(3),p=o(f),d=n(8),h=o(d),y=n(4),v=o(y),m=n(5),b=o(m),S=n(7),g=o(S),w=n(1),P=o(w),T=n(2),k=o(T),O=1e3/60,M=function(e){function t(n){var o=this;r(this,t),e.call(this,n),this.animationID=null,this.prevTime=0,this.accumulatedTime=0,this.unreadPropStyles=null,this.clearUnreadPropStyle=function(e){for(var t=o.state,n=t.currentStyles,r=t.currentVelocities,i=t.lastIdealStyles,a=t.lastIdealVelocities,s=!1,u=0;u<e.length;u++){var c=e[u],f=!1;for(var p in c)if(Object.prototype.hasOwnProperty.call(c,p)){var d=c[p];"number"==typeof d&&(f||(f=!0,s=!0,n[u]=l({},n[u]),r[u]=l({},r[u]),i[u]=l({},i[u]),a[u]=l({},a[u])),n[u][p]=d,r[u][p]=0,i[u][p]=d,a[u][p]=0)}}s&&o.setState({currentStyles:n,currentVelocities:r,lastIdealStyles:i,lastIdealVelocities:a})},this.startAnimationIfNecessary=function(){o.animationID=b.default(function(e){
var t=o.props.styles(o.state.lastIdealStyles);if(a(o.state.currentStyles,t,o.state.currentVelocities))return o.animationID=null,void(o.accumulatedTime=0);var n=e||v.default(),r=n-o.prevTime;if(o.prevTime=n,o.accumulatedTime=o.accumulatedTime+r,o.accumulatedTime>10*O&&(o.accumulatedTime=0),0===o.accumulatedTime)return o.animationID=null,void o.startAnimationIfNecessary();for(var i=(o.accumulatedTime-Math.floor(o.accumulatedTime/O)*O)/O,l=Math.floor(o.accumulatedTime/O),s=[],u=[],c=[],f=[],p=0;p<t.length;p++){var d=t[p],y={},m={},b={},S={};for(var g in d)if(Object.prototype.hasOwnProperty.call(d,g)){var w=d[g];if("number"==typeof w)y[g]=w,m[g]=0,b[g]=w,S[g]=0;else{for(var P=o.state.lastIdealStyles[p][g],T=o.state.lastIdealVelocities[p][g],k=0;k<l;k++){var M=h.default(O/1e3,P,T,w.val,w.stiffness,w.damping,w.precision);P=M[0],T=M[1]}var x=h.default(O/1e3,P,T,w.val,w.stiffness,w.damping,w.precision),I=x[0],D=x[1];y[g]=P+(I-P)*i,m[g]=T+(D-T)*i,b[g]=P,S[g]=T}}c[p]=y,f[p]=m,s[p]=b,u[p]=S}o.animationID=null,o.accumulatedTime-=l*O,o.setState({currentStyles:c,currentVelocities:f,lastIdealStyles:s,lastIdealVelocities:u}),o.unreadPropStyles=null,o.startAnimationIfNecessary()})},this.state=this.defaultState()}return i(t,e),s(t,null,[{key:"propTypes",value:{defaultStyles:k.default.arrayOf(k.default.objectOf(k.default.number)),styles:k.default.func.isRequired,children:k.default.func.isRequired},enumerable:!0}]),t.prototype.defaultState=function(){var e=this.props,t=e.defaultStyles,n=e.styles,o=t||n().map(p.default),r=o.map(function(e){return c.default(e)});return{currentStyles:o,currentVelocities:r,lastIdealStyles:o,lastIdealVelocities:r}},t.prototype.componentDidMount=function(){this.prevTime=v.default(),this.startAnimationIfNecessary()},t.prototype.componentWillReceiveProps=function(e){null!=this.unreadPropStyles&&this.clearUnreadPropStyle(this.unreadPropStyles),this.unreadPropStyles=e.styles(this.state.lastIdealStyles),null==this.animationID&&(this.prevTime=v.default(),this.startAnimationIfNecessary())},t.prototype.componentWillUnmount=function(){null!=this.animationID&&(b.default.cancel(this.animationID),this.animationID=null)},t.prototype.render=function(){var e=this.props.children(this.state.currentStyles);return e&&P.default.Children.only(e)},t}(P.default.Component);t.default=M,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){var o=t;return null==o?e.map(function(e,t){return{key:e.key,data:e.data,style:n[t]}}):e.map(function(e,t){for(var r=0;r<o.length;r++)if(o[r].key===e.key)return{key:o[r].key,data:o[r].data,style:n[t]};return{key:e.key,data:e.data,style:n[t]}})}function l(e,t,n,o){if(o.length!==t.length)return!1;for(var r=0;r<o.length;r++)if(o[r].key!==t[r].key)return!1;for(var r=0;r<o.length;r++)if(!k.default(e[r],t[r].style,n[r]))return!1;return!0}function s(e,t,n,o,r,i,a,l,s){for(var u=b.default(o,r,function(e,o){var r=t(o);return null==r?(n({key:o.key,data:o.data}),null):k.default(i[e],r,a[e])?(n({key:o.key,data:o.data}),null):{key:o.key,data:o.data,style:r}}),c=[],f=[],d=[],h=[],y=0;y<u.length;y++){for(var v=u[y],m=null,S=0;S<o.length;S++)if(o[S].key===v.key){m=S;break}if(null==m){var g=e(v);c[y]=g,d[y]=g;var w=p.default(v.style);f[y]=w,h[y]=w}else c[y]=i[m],d[y]=l[m],f[y]=a[m],h[y]=s[m]}return[u,c,f,d,h]}t.__esModule=!0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),f=n(6),p=o(f),d=n(3),h=o(d),y=n(8),v=o(y),m=n(27),b=o(m),S=n(4),g=o(S),w=n(5),P=o(w),T=n(7),k=o(T),O=n(1),M=o(O),x=n(2),I=o(x),D=1e3/60,_=function(e){function t(n){var o=this;r(this,t),e.call(this,n),this.unmounting=!1,this.animationID=null,this.prevTime=0,this.accumulatedTime=0,this.unreadPropStyles=null,this.clearUnreadPropStyle=function(e){for(var t=s(o.props.willEnter,o.props.willLeave,o.props.didLeave,o.state.mergedPropsStyles,e,o.state.currentStyles,o.state.currentVelocities,o.state.lastIdealStyles,o.state.lastIdealVelocities),n=t[0],r=t[1],i=t[2],a=t[3],l=t[4],c=0;c<e.length;c++){var f=e[c].style,p=!1;for(var d in f)if(Object.prototype.hasOwnProperty.call(f,d)){var h=f[d];"number"==typeof h&&(p||(p=!0,r[c]=u({},r[c]),i[c]=u({},i[c]),a[c]=u({},a[c]),l[c]=u({},l[c]),n[c]={key:n[c].key,data:n[c].data,style:u({},n[c].style)}),r[c][d]=h,i[c][d]=0,a[c][d]=h,l[c][d]=0,n[c].style[d]=h)}}o.setState({currentStyles:r,currentVelocities:i,mergedPropsStyles:n,lastIdealStyles:a,lastIdealVelocities:l})},this.startAnimationIfNecessary=function(){o.unmounting||(o.animationID=P.default(function(e){if(!o.unmounting){var t=o.props.styles,n="function"==typeof t?t(a(o.state.mergedPropsStyles,o.unreadPropStyles,o.state.lastIdealStyles)):t;if(l(o.state.currentStyles,n,o.state.currentVelocities,o.state.mergedPropsStyles))return o.animationID=null,void(o.accumulatedTime=0);var r=e||g.default(),i=r-o.prevTime;if(o.prevTime=r,o.accumulatedTime=o.accumulatedTime+i,o.accumulatedTime>10*D&&(o.accumulatedTime=0),0===o.accumulatedTime)return o.animationID=null,void o.startAnimationIfNecessary();for(var u=(o.accumulatedTime-Math.floor(o.accumulatedTime/D)*D)/D,c=Math.floor(o.accumulatedTime/D),f=s(o.props.willEnter,o.props.willLeave,o.props.didLeave,o.state.mergedPropsStyles,n,o.state.currentStyles,o.state.currentVelocities,o.state.lastIdealStyles,o.state.lastIdealVelocities),p=f[0],d=f[1],h=f[2],y=f[3],m=f[4],b=0;b<p.length;b++){var S=p[b].style,w={},P={},T={},k={};for(var O in S)if(Object.prototype.hasOwnProperty.call(S,O)){var M=S[O];if("number"==typeof M)w[O]=M,P[O]=0,T[O]=M,k[O]=0;else{for(var x=y[b][O],I=m[b][O],_=0;_<c;_++){var j=v.default(D/1e3,x,I,M.val,M.stiffness,M.damping,M.precision);x=j[0],I=j[1]}var C=v.default(D/1e3,x,I,M.val,M.stiffness,M.damping,M.precision),z=C[0],E=C[1];w[O]=x+(z-x)*u,P[O]=I+(E-I)*u,T[O]=x,k[O]=I}}y[b]=T,m[b]=k,d[b]=w,h[b]=P}o.animationID=null,o.accumulatedTime-=c*D,o.setState({currentStyles:d,currentVelocities:h,lastIdealStyles:y,lastIdealVelocities:m,mergedPropsStyles:p}),o.unreadPropStyles=null,o.startAnimationIfNecessary()}}))},this.state=this.defaultState()}return i(t,e),c(t,null,[{key:"propTypes",value:{defaultStyles:I.default.arrayOf(I.default.shape({key:I.default.string.isRequired,data:I.default.any,style:I.default.objectOf(I.default.number).isRequired})),styles:I.default.oneOfType([I.default.func,I.default.arrayOf(I.default.shape({key:I.default.string.isRequired,data:I.default.any,style:I.default.objectOf(I.default.oneOfType([I.default.number,I.default.object])).isRequired}))]).isRequired,children:I.default.func.isRequired,willEnter:I.default.func,willLeave:I.default.func,didLeave:I.default.func},enumerable:!0},{key:"defaultProps",value:{willEnter:function(e){return h.default(e.style)},willLeave:function(){return null},didLeave:function(){}},enumerable:!0}]),t.prototype.defaultState=function(){var e=this.props,t=e.defaultStyles,n=e.styles,o=e.willEnter,r=e.willLeave,i=e.didLeave,a="function"==typeof n?n(t):n,l=void 0;l=null==t?a:t.map(function(e){for(var t=0;t<a.length;t++)if(a[t].key===e.key)return a[t];return e});var u=null==t?a.map(function(e){return h.default(e.style)}):t.map(function(e){return h.default(e.style)}),c=null==t?a.map(function(e){return p.default(e.style)}):t.map(function(e){return p.default(e.style)}),f=s(o,r,i,l,a,u,c,u,c),d=f[0],y=f[1],v=f[2],m=f[3],b=f[4];return{currentStyles:y,currentVelocities:v,lastIdealStyles:m,lastIdealVelocities:b,mergedPropsStyles:d}},t.prototype.componentDidMount=function(){this.prevTime=g.default(),this.startAnimationIfNecessary()},t.prototype.componentWillReceiveProps=function(e){this.unreadPropStyles&&this.clearUnreadPropStyle(this.unreadPropStyles);var t=e.styles;"function"==typeof t?this.unreadPropStyles=t(a(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles)):this.unreadPropStyles=t,null==this.animationID&&(this.prevTime=g.default(),this.startAnimationIfNecessary())},t.prototype.componentWillUnmount=function(){this.unmounting=!0,null!=this.animationID&&(P.default.cancel(this.animationID),this.animationID=null)},t.prototype.render=function(){var e=a(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.currentStyles),t=this.props.children(e);return t&&M.default.Children.only(t)},t}(M.default.Component);t.default=_,e.exports=t.default},function(e,t){"use strict";function n(e,t,n){for(var o={},r=0;r<e.length;r++)o[e[r].key]=r;for(var i={},r=0;r<t.length;r++)i[t[r].key]=r;for(var a=[],r=0;r<t.length;r++)a[r]=t[r];for(var r=0;r<e.length;r++)if(!Object.prototype.hasOwnProperty.call(i,e[r].key)){var l=n(r,e[r]);null!=l&&a.push(l)}return a.sort(function(e,n){var r=i[e.key],a=i[n.key],l=o[e.key],s=o[n.key];if(null!=r&&null!=a)return i[e.key]-i[n.key];if(null!=l&&null!=s)return o[e.key]-o[n.key];if(null!=r){for(var u=0;u<t.length;u++){var c=t[u].key;if(Object.prototype.hasOwnProperty.call(o,c)){if(r<i[c]&&s>o[c])return-1;if(r>i[c]&&s<o[c])return 1}}return 1}for(var u=0;u<t.length;u++){var c=t[u].key;if(Object.prototype.hasOwnProperty.call(o,c)){if(a<i[c]&&l>o[c])return 1;if(a>i[c]&&l<o[c])return-1}}return-1})}t.__esModule=!0,t.default=n,e.exports=t.default},function(e,t,n){"use strict";function o(){}t.__esModule=!0,t.default=o;e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){return i({},s,t,{val:e})}t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t.default=r;var a=n(11),l=o(a),s=i({},l.default.noWobble,{precision:.01});e.exports=t.default},function(e,t,n){function o(e,t){for(var n=0;n<e.length;n++){var o=e[n],r=d[o.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](o.parts[i]);for(;i<o.parts.length;i++)r.parts.push(u(o.parts[i],t))}else{for(var a=[],i=0;i<o.parts.length;i++)a.push(u(o.parts[i],t));d[o.id]={id:o.id,refs:1,parts:a}}}}function r(e){for(var t=[],n={},o=0;o<e.length;o++){var r=e[o],i=r[0],a=r[1],l=r[2],s=r[3],u={css:a,media:l,sourceMap:s};n[i]?n[i].parts.push(u):t.push(n[i]={id:i,parts:[u]})}return t}function i(e,t){var n=v(),o=S[S.length-1];if("top"===e.insertAt)o?o.nextSibling?n.insertBefore(t,o.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),S.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=S.indexOf(e);t>=0&&S.splice(t,1)}function l(e){var t=document.createElement("style");return t.type="text/css",i(e,t),t}function s(e){var t=document.createElement("link");return t.rel="stylesheet",i(e,t),t}function u(e,t){var n,o,r;if(t.singleton){var i=b++;n=m||(m=l(t)),o=c.bind(null,n,i,!1),r=c.bind(null,n,i,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=s(t),o=p.bind(null,n),r=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=l(t),o=f.bind(null,n),r=function(){a(n)});return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}function c(e,t,n,o){var r=n?"":o.css;if(e.styleSheet)e.styleSheet.cssText=g(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function f(e,t){var n=t.css,o=t.media;if(o&&e.setAttribute("media",o),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function p(e,t){var n=t.css,o=t.sourceMap;o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var r=new Blob([n],{type:"text/css"}),i=e.href;e.href=URL.createObjectURL(r),i&&URL.revokeObjectURL(i)}var d={},h=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},y=h(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=h(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,b=0,S=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=y()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=r(e);return o(n,t),function(e){for(var i=[],a=0;a<n.length;a++){var l=n[a],s=d[l.id];s.refs--,i.push(s)}if(e){var u=r(e);o(u,t)}for(var a=0;a<i.length;a++){var s=i[a];if(0===s.refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete d[s.id]}}}};var g=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t,n){var o=n(16);"string"==typeof o&&(o=[[e.id,o,""]]);n(30)(o,{});o.locals&&(e.exports=o.locals)}])});
},{"react":"react"}],2:[function(require,module,exports){
"use strict";
;
;
;
var isWebSocket = function (constructor) {
    return constructor && constructor.CLOSING === 2;
};
var isGlobalWebSocket = function () {
    return typeof WebSocket !== 'undefined' && isWebSocket(WebSocket);
};
var getDefaultOptions = function () { return ({
    constructor: isGlobalWebSocket() ? WebSocket : null,
    maxReconnectionDelay: 10000,
    minReconnectionDelay: 1500,
    reconnectionDelayGrowFactor: 1.3,
    connectionTimeout: 4000,
    maxRetries: Infinity,
    debug: false,
}); };
var bypassProperty = function (src, dst, name) {
    Object.defineProperty(dst, name, {
        get: function () { return src[name]; },
        set: function (value) { src[name] = value; },
        enumerable: true,
        configurable: true,
    });
};
var initReconnectionDelay = function (config) {
    return (config.minReconnectionDelay + Math.random() * config.minReconnectionDelay);
};
var updateReconnectionDelay = function (config, previousDelay) {
    var newDelay = previousDelay * config.reconnectionDelayGrowFactor;
    return (newDelay > config.maxReconnectionDelay)
        ? config.maxReconnectionDelay
        : newDelay;
};
var LEVEL_0_EVENTS = ['onopen', 'onclose', 'onmessage', 'onerror'];
var reassignEventListeners = function (ws, oldWs, listeners) {
    Object.keys(listeners).forEach(function (type) {
        listeners[type].forEach(function (_a) {
            var listener = _a[0], options = _a[1];
            ws.addEventListener(type, listener, options);
        });
    });
    if (oldWs) {
        LEVEL_0_EVENTS.forEach(function (name) {
            ws[name] = oldWs[name];
        });
    }
};
var ReconnectingWebsocket = function (url, protocols, options) {
    var _this = this;
    if (options === void 0) { options = {}; }
    var ws;
    var connectingTimeout;
    var reconnectDelay = 0;
    var retriesCount = 0;
    var shouldRetry = true;
    var savedOnClose = null;
    var listeners = {};
    // require new to construct
    if (!(this instanceof ReconnectingWebsocket)) {
        throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");
    }
    // Set config. Not using `Object.assign` because of IE11
    var config = getDefaultOptions();
    Object.keys(config)
        .filter(function (key) { return options.hasOwnProperty(key); })
        .forEach(function (key) { return config[key] = options[key]; });
    if (!isWebSocket(config.constructor)) {
        throw new TypeError('Invalid WebSocket constructor. Set `options.constructor`');
    }
    var log = config.debug ? function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        return console.log.apply(console, ['RWS:'].concat(params));
    } : function () { };
    /**
     * Not using dispatchEvent, otherwise we must use a DOM Event object
     * Deferred because we want to handle the close event before this
     */
    var emitError = function (code, msg) { return setTimeout(function () {
        var err = new Error(msg);
        err.code = code;
        if (Array.isArray(listeners.error)) {
            listeners.error.forEach(function (_a) {
                var fn = _a[0];
                return fn(err);
            });
        }
        if (ws.onerror) {
            ws.onerror(err);
        }
    }, 0); };
    var handleClose = function () {
        log('handleClose', { shouldRetry: shouldRetry });
        retriesCount++;
        log('retries count:', retriesCount);
        if (retriesCount > config.maxRetries) {
            emitError('EHOSTDOWN', 'Too many failed connection attempts');
            return;
        }
        if (!reconnectDelay) {
            reconnectDelay = initReconnectionDelay(config);
        }
        else {
            reconnectDelay = updateReconnectionDelay(config, reconnectDelay);
        }
        log('handleClose - reconnectDelay:', reconnectDelay);
        if (shouldRetry) {
            setTimeout(connect, reconnectDelay);
        }
    };
    var connect = function () {
        if (!shouldRetry) {
            return;
        }
        log('connect');
        var oldWs = ws;
        var wsUrl = (typeof url === 'function') ? url() : url;
        ws = new config.constructor(wsUrl, protocols);
        connectingTimeout = setTimeout(function () {
            log('timeout');
            ws.close();
            emitError('ETIMEDOUT', 'Connection timeout');
        }, config.connectionTimeout);
        log('bypass properties');
        for (var key in ws) {
            // @todo move to constant
            if (['addEventListener', 'removeEventListener', 'close', 'send'].indexOf(key) < 0) {
                bypassProperty(ws, _this, key);
            }
        }
        ws.addEventListener('open', function () {
            clearTimeout(connectingTimeout);
            log('open');
            reconnectDelay = initReconnectionDelay(config);
            log('reconnectDelay:', reconnectDelay);
            retriesCount = 0;
        });
        ws.addEventListener('close', handleClose);
        reassignEventListeners(ws, oldWs, listeners);
        // because when closing with fastClose=true, it is saved and set to null to avoid double calls
        ws.onclose = ws.onclose || savedOnClose;
        savedOnClose = null;
    };
    log('init');
    connect();
    this.close = function (code, reason, _a) {
        if (code === void 0) { code = 1000; }
        if (reason === void 0) { reason = ''; }
        var _b = _a === void 0 ? {} : _a, _c = _b.keepClosed, keepClosed = _c === void 0 ? false : _c, _d = _b.fastClose, fastClose = _d === void 0 ? true : _d, _e = _b.delay, delay = _e === void 0 ? 0 : _e;
        log('close - params:', { reason: reason, keepClosed: keepClosed, fastClose: fastClose, delay: delay, retriesCount: retriesCount, maxRetries: config.maxRetries });
        shouldRetry = !keepClosed && retriesCount <= config.maxRetries;
        if (delay) {
            reconnectDelay = delay;
        }
        ws.close(code, reason);
        if (fastClose) {
            var fakeCloseEvent_1 = {
                code: code,
                reason: reason,
                wasClean: true,
            };
            // execute close listeners soon with a fake closeEvent
            // and remove them from the WS instance so they
            // don't get fired on the real close.
            handleClose();
            ws.removeEventListener('close', handleClose);
            // run and remove level2
            if (Array.isArray(listeners.close)) {
                listeners.close.forEach(function (_a) {
                    var listener = _a[0], options = _a[1];
                    listener(fakeCloseEvent_1);
                    ws.removeEventListener('close', listener, options);
                });
            }
            // run and remove level0
            if (ws.onclose) {
                savedOnClose = ws.onclose;
                ws.onclose(fakeCloseEvent_1);
                ws.onclose = null;
            }
        }
    };
    this.send = function (data) {
        ws.send(data);
    };
    this.addEventListener = function (type, listener, options) {
        if (Array.isArray(listeners[type])) {
            if (!listeners[type].some(function (_a) {
                var l = _a[0];
                return l === listener;
            })) {
                listeners[type].push([listener, options]);
            }
        }
        else {
            listeners[type] = [[listener, options]];
        }
        ws.addEventListener(type, listener, options);
    };
    this.removeEventListener = function (type, listener, options) {
        if (Array.isArray(listeners[type])) {
            listeners[type] = listeners[type].filter(function (_a) {
                var l = _a[0];
                return l !== listener;
            });
        }
        ws.removeEventListener(type, listener, options);
    };
};
module.exports = ReconnectingWebsocket;

},{}],3:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _ChatClient = require('./ChatClient');

var _ChatClient2 = _interopRequireDefault(_ChatClient);

var _Message = require('./Message');

var _Message2 = _interopRequireDefault(_Message);

var _viewsEmptyStateView = require('../views/EmptyStateView');

var _viewsEmptyStateView2 = _interopRequireDefault(_viewsEmptyStateView);

var _materialUi = require('material-ui');

var _ChatUsers = require('./ChatUsers');

var _ChatUsers2 = _interopRequireDefault(_ChatUsers);

var _Pydio$requireLib = _pydio2['default'].requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;
var moment = _Pydio$requireLib.moment;

var Chat = (function (_React$Component) {
    _inherits(Chat, _React$Component);

    function Chat(props) {
        _classCallCheck(this, Chat);

        _React$Component.call(this, props);
        this.client = null;
        this.state = { messages: [], room: null, value: "" };
        this._newMessageListener = this.onNewMessage.bind(this);
    }

    Chat.prototype.componentDidMount = function componentDidMount() {
        this.join(this.props.roomType, this.props.roomObjectId);
    };

    Chat.prototype.componentWillUnmount = function componentWillUnmount() {
        this.stop();
    };

    Chat.prototype.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {
        if (prevState.messages.length <= this.state.messages.length) {
            this.refs.comments.scrollTop = 100000;
        }
    };

    Chat.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
        var pydio = nextProps.pydio;
        var roomType = nextProps.roomType;
        var roomObjectId = nextProps.roomObjectId;

        if (roomType !== this.props.roomType || roomObjectId !== this.props.roomObjectId) {
            if (this.client) {
                this.client.leaveRoom(this.props.roomType, this.props.roomObjectId, this._newMessageListener);
            }
            this.setState({ messages: [], room: null, value: "" });
            if (roomType && roomObjectId) {
                this.join(roomType, roomObjectId);
            }
        }
    };

    Chat.prototype.onRoomMessage = function onRoomMessage(msg) {
        if (msg) {
            this.setState({ room: msg['Room'] });
        }
    };

    Chat.prototype.onNewMessage = function onNewMessage(msg) {
        var deleteMsg = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

        if (!msg) {
            return;
        }
        if (deleteMsg) {
            this.setState({ messages: this.state.messages.filter(function (m) {
                    return m.Uuid !== msg.Uuid;
                }) });
        } else {
            this.setState({ messages: [].concat(this.state.messages, [msg]) });
        }
    };

    Chat.prototype.join = function join(roomType, roomObjectId) {
        if (!roomObjectId) {
            return;
        }
        var pydio = this.props.pydio;

        this.client = _ChatClient2['default'].getInstance(pydio);
        var room = this.client.joinRoom(roomType, roomObjectId, this._newMessageListener, this.onRoomMessage.bind(this));
        if (room !== null) {
            this.setState({ room: room });
        }
        this.client.loadHistory(roomType, roomObjectId);
    };

    Chat.prototype.stop = function stop() {
        var _props = this.props;
        var roomType = _props.roomType;
        var roomObjectId = _props.roomObjectId;

        if (this.client) this.client.leaveRoom(roomType, roomObjectId, this._newMessageListener);
    };

    Chat.prototype.postMessage = function postMessage() {
        if (!this.state.value) {
            return;
        }
        var room = this.state.room;

        if (!room || !room.Uuid) {
            console.error("Cannot find cell info");
            return;
        }
        var message = {
            "@type": "POST",
            "Message": { "RoomUuid": room.Uuid, "Message": this.state.value }
        };
        this.client.send(JSON.stringify(message));
        this.setState({ value: '' });
    };

    Chat.prototype.deleteMessage = function deleteMessage(msg) {
        var room = this.state.room;

        if (!room || !room.Uuid) {
            console.error("Cannot find cell info");
            return;
        }
        var message = {
            "@type": "DELETE_MSG",
            "Message": msg
        };
        this.client.send(JSON.stringify(message));
    };

    Chat.prototype.keyDown = function keyDown(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            this.postMessage();
        }
    };

    Chat.prototype.render = function render() {
        var _this = this;

        var _props2 = this.props;
        var style = _props2.style;
        var msgContainerStyle = _props2.msgContainerStyle;
        var fieldHint = _props2.fieldHint;
        var emptyStateProps = _props2.emptyStateProps;
        var pydio = _props2.pydio;
        var pushMessagesToBottom = _props2.pushMessagesToBottom;
        var computePresenceFromACLs = _props2.computePresenceFromACLs;
        var _state = this.state;
        var messages = _state.messages;
        var room = _state.room;

        var data = [];
        var previousMDate = undefined;
        var previousAuthor = undefined;
        messages.forEach(function (m) {
            if (m['Message']) {
                var mDate = moment(parseFloat(m.Timestamp) * 1000).fromNow();
                var hideDate = previousMDate && previousMDate === mDate;
                var sameAuthor = previousAuthor && previousAuthor === m.Author && hideDate;
                data.push(_react2['default'].createElement(_Message2['default'], { key: m.Uuid, message: m, hideDate: hideDate, sameAuthor: sameAuthor, onDeleteMessage: function () {
                        _this.deleteMessage(m);
                    } }));
                previousMDate = mDate;
                previousAuthor = m.Author;
            }
        });
        var pushStyle = undefined;
        var pusher = undefined;
        if (pushMessagesToBottom) {
            pushStyle = { display: 'flex', flexDirection: 'column' };
            if (data && data.length) {
                pusher = _react2['default'].createElement('span', { style: { flex: 1 } });
            }
        }
        var emptyState = undefined;
        if (emptyStateProps && (!data || !data.length)) {
            emptyState = _react2['default'].createElement(_viewsEmptyStateView2['default'], _extends({ pydio: pydio }, emptyStateProps));
        }
        return _react2['default'].createElement(
            'div',
            { style: _extends({ padding: 0 }, style) },
            computePresenceFromACLs !== undefined && _react2['default'].createElement(_ChatUsers2['default'], { pydio: pydio, ACLs: computePresenceFromACLs, roomUsers: room ? room.Users : [] }),
            _react2['default'].createElement(
                'div',
                { ref: 'comments', className: 'comments_feed', style: _extends({ maxHeight: 300, overflowY: 'auto' }, pushStyle, msgContainerStyle) },
                pusher,
                data,
                emptyState
            ),
            _react2['default'].createElement(
                'div',
                { style: { backgroundColor: 'white', paddingLeft: 16, paddingRight: 16, borderTop: '1px solid #e0e0e0' } },
                _react2['default'].createElement(_materialUi.TextField, {
                    hintText: fieldHint,
                    hintStyle: { whiteSpace: 'nowrap' },
                    value: this.state.value,
                    onChange: function (event, newValue) {
                        _this.setState({ value: newValue });
                    },
                    multiLine: true,
                    ref: 'new_comment',
                    onKeyDown: this.keyDown.bind(this),
                    fullWidth: true,
                    underlineShow: false
                })
            )
        );
    };

    return Chat;
})(_react2['default'].Component);

Chat.PropTypes = {
    roomType: _react2['default'].PropTypes.string,
    roomObjectId: _react2['default'].PropTypes.string
};

exports['default'] = Chat = PydioContextConsumer(Chat);
exports['default'] = Chat;
module.exports = exports['default'];

},{"../views/EmptyStateView":60,"./ChatClient":4,"./ChatUsers":6,"./Message":7,"material-ui":"material-ui","pydio":"pydio","react":"react"}],4:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _pydioHttpWebsocket = require('pydio/http/websocket');

var _pydioHttpWebsocket2 = _interopRequireDefault(_pydioHttpWebsocket);

var _reconnectingWebsocket = require('reconnecting-websocket');

var _reconnectingWebsocket2 = _interopRequireDefault(_reconnectingWebsocket);

var ChatClient = (function (_PydioWebSocket) {
    _inherits(ChatClient, _PydioWebSocket);

    /**
     *
     * @param pydioObject
     * @return {ChatClient}
     */

    ChatClient.getInstance = function getInstance(pydioObject) {
        if (ChatClient._instance !== undefined) {
            return ChatClient._instance;
        } else {
            ChatClient._instance = new ChatClient(pydioObject);
            return ChatClient._instance;
        }
    };

    /**
     *
     * @param pydioObject {Pydio}
     */

    function ChatClient(pydioObject) {
        _classCallCheck(this, ChatClient);

        _PydioWebSocket.call(this, pydioObject);
        this.currentRepo = pydioObject.repositoryId;
        this.subscriptions = {};
        this.rooms = {};
        this.roomInfos = {};
        this.open();
    }

    ChatClient.prototype.getIdentifier = function getIdentifier(roomType, objectId) {
        return roomType + ':' + objectId;
    };

    ChatClient.prototype.getRoomInfoFromIdentifier = function getRoomInfoFromIdentifier(identifier) {
        var _identifier$split = identifier.split(':');

        var roomType = _identifier$split[0];
        var objectId = _identifier$split[1];

        return { roomType: roomType, objectId: objectId };
    };

    ChatClient.prototype.onRoomMessage = function onRoomMessage(msg) {
        if (msg) {
            var room = msg['Room'];
            var identifier = this.getIdentifier(room.Type, room.RoomTypeObject);
            this.roomInfos[identifier] = room;
        }
    };

    /**
     *
     * @param roomType string
     * @param objectId string
     * @param messageHandler Function
     * @param roomUpdateHandler Function
     * @param retry Number
     */

    ChatClient.prototype.joinRoom = function joinRoom(roomType, objectId, messageHandler, roomUpdateHandler) {
        var _this = this;

        var retry = arguments.length <= 4 || arguments[4] === undefined ? 0 : arguments[4];

        var identifier = this.getIdentifier(roomType, objectId);
        if (this.subscriptions[identifier]) {
            var already = false;
            this.subscriptions[identifier].map(function (v) {
                if (v.messageHandler === messageHandler) {
                    already = true;
                }
            });
            if (!already) {
                this.subscriptions[identifier].push({ messageHandler: messageHandler, roomUpdateHandler: roomUpdateHandler });
            }
            return this.roomInfos[identifier];
        }
        if (this.connecting) {
            if (retry < 3) {
                setTimeout(function () {
                    //console.log('Connecting state... retrying now', objectId);
                    _this.joinRoom(roomType, objectId, messageHandler, roomUpdateHandler, retry + 1);
                }, 1500);
                return null;
            }
        } else if (!this.connOpen) {
            this.open();
            setTimeout(function () {
                //console.log('Not open... retrying now', objectId);
                _this.joinRoom(roomType, objectId, messageHandler, roomUpdateHandler, retry + 1);
            }, 1500);
            return null;
        }
        //console.log('Now storing subscription for ', objectId);
        this.subscriptions[roomType + ':' + objectId] = [{ messageHandler: messageHandler, roomUpdateHandler: roomUpdateHandler }];
        var message = { "@type": "JOIN", "Room": { "Type": roomType, "RoomTypeObject": objectId } };
        this.ws.send(JSON.stringify(message));
        return this.roomInfos[identifier];
    };

    /**
     * Send a HISTORY request to receive existing messages in room
     * @param roomType
     * @param objectId
     * @param retry int
     */

    ChatClient.prototype.loadHistory = function loadHistory(roomType, objectId) {
        var _this2 = this;

        var retry = arguments.length <= 2 || arguments[2] === undefined ? 0 : arguments[2];

        if (this.connecting) {
            if (retry < 3) {
                setTimeout(function () {
                    _this2.loadHistory(roomType, objectId, retry + 1);
                }, 1500);
                return;
            }
        }
        var message = { "@type": "HISTORY", "Room": { "Type": roomType, "RoomTypeObject": objectId } };
        this.ws.send(JSON.stringify(message));
    };

    /**
     *
     * @param roomType
     * @param objectId
     * @param messageHandler Function
     */

    ChatClient.prototype.leaveRoom = function leaveRoom(roomType, objectId) {
        var _this3 = this;

        var messageHandler = arguments.length <= 2 || arguments[2] === undefined ? undefined : arguments[2];

        var keep = false;
        var identifier = this.getIdentifier(roomType, objectId);
        //console.log('Leaving room: ' + objectId);
        if (this.subscriptions[identifier]) {
            if (messageHandler) {
                // Just remove this handler
                this.subscriptions[identifier] = this.subscriptions[identifier].filter(function (v) {
                    return v.messageHandler !== messageHandler;
                });
                if (this.subscriptions[identifier].length) {
                    keep = true;
                } else {
                    delete this.subscriptions[identifier];
                }
            } else {
                delete this.subscriptions[identifier];
            }
        }
        if (!keep) {
            Object.keys(this.rooms).map(function (k) {
                if (_this3.rooms[k] === identifier) {
                    delete _this3.rooms[k];
                }
            });
            if (this.connOpen) {
                var message = { "@type": "LEAVE", "Room": { "Type": roomType, "RoomTypeObject": objectId } };
                this.ws.send(JSON.stringify(message));
            }
        }
    };

    /**
     *
     * @param msg
     */

    ChatClient.prototype.handleMessageReceived = function handleMessageReceived(msg) {
        var _this4 = this;

        var data = JSON.parse(msg['data']);
        if (data["@type"] === 'ROOM_UPDATE') {
            var identifier = this.getIdentifier(data.Room.Type, data.Room.RoomTypeObject);
            if (this.subscriptions[identifier]) {
                if (!this.rooms[data.Room.Uuid]) {
                    this.rooms[data.Room.Uuid] = identifier;
                }
                this.onRoomMessage(data);
                this.subscriptions[identifier].map(function (v) {
                    if (v.roomUpdateHandler) {
                        try {
                            v.roomUpdateHandler(data);
                        } catch (e) {}
                    }
                });
            }
        } else {
            (function () {
                var deleteMsg = false;
                var wsMessage = undefined;
                if (data["@type"] === 'DELETE_MSG') {
                    deleteMsg = true;
                    wsMessage = data["Message"];
                } else {
                    wsMessage = data;
                }
                if (wsMessage.RoomUuid && _this4.rooms[wsMessage.RoomUuid]) {
                    var subs = _this4.subscriptions[_this4.rooms[wsMessage.RoomUuid]];
                    var withRoomUpdateHandler = subs.filter(function (v) {
                        return v.roomUpdateHandler;
                    });
                    // If there is a subscriber with a roomUpdateHandler, it is an open room,
                    // so send message only to that one. The ones without are just notification listeners
                    if (withRoomUpdateHandler.length) {
                        subs = withRoomUpdateHandler;
                    }
                    subs.map(function (v) {
                        try {
                            v.messageHandler(wsMessage, deleteMsg);
                        } catch (e) {}
                    });
                }
            })();
        }
    };

    /**
     *
     * @param message
     */

    ChatClient.prototype.send = function send(message) {
        this.ws.send(message);
    };

    ChatClient.prototype.open = function open() {
        var _this5 = this;

        this.close();
        if (!this.currentRepo) {
            return;
        }
        var url = this.pydio.Parameters.get("ENDPOINT_WEBSOCKET").replace("/event", "/chat");
        this.ws = new _reconnectingWebsocket2['default'](url, [], {
            maxReconnectionDelay: 60000,
            reconnectionDelayGrowFactor: 1.6,
            maxRetries: 10
        });

        this.connecting = true;

        this.ws.addEventListener('open', function () {
            _pydioHttpWebsocket2['default'].subscribeJWT(_this5.ws).then(function () {
                _this5.connecting = false;
                _this5.connOpen = true;
            })['catch'](function () {
                _this5.connecting = false;
                _this5.connOpen = false;
            });
        });
        this.ws.addEventListener('message', function (msg) {
            _this5.handleMessageReceived(msg);
        });
        this.ws.addEventListener('close', function (event) {
            _this5.connOpen = false;
            _this5.connecting = false;
            _pydioHttpWebsocket2['default'].logClose(event);
        });
        this.ws.addEventListener('error', function (error) {
            if (error.code === 'EHOSTDOWN') {
                console.error('WebSocket maxRetries reached, host is down!');
            }
        });
    };

    ChatClient.prototype.close = function close() {
        var _this6 = this;

        if (this.ws === null) {
            return;
        }
        Object.keys(this.subscriptions).map(function (k) {
            var _getRoomInfoFromIdentifier = _this6.getRoomInfoFromIdentifier(k);

            var roomType = _getRoomInfoFromIdentifier.roomType;
            var objectId = _getRoomInfoFromIdentifier.objectId;

            _this6.leaveRoom(roomType, objectId);
        });
        this.ws.close(1000, 'Closing', { keepClosed: true });
    };

    return ChatClient;
})(_pydioHttpWebsocket2['default']);

exports['default'] = ChatClient;
module.exports = exports['default'];

},{"pydio/http/websocket":"pydio/http/websocket","reconnecting-websocket":2}],5:[function(require,module,exports){
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _ChatClient = require('./ChatClient');

var _ChatClient2 = _interopRequireDefault(_ChatClient);

var ChatIcon = (function (_React$Component) {
    _inherits(ChatIcon, _React$Component);

    function ChatIcon(props) {
        _classCallCheck(this, ChatIcon);

        _React$Component.call(this, props);
        this.state = { newMessages: 0 };
        this._messageListener = this.onMessage.bind(this);
    }

    ChatIcon.prototype.onMessage = function onMessage(msg) {
        var deleteMsg = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

        if (deleteMsg) {
            this.setState({ newMessages: Math.max(0, this.state.newMessages - 1) });
        } else {
            this.setState({ newMessages: this.state.newMessages + 1 });
        }
    };

    ChatIcon.prototype.listenToRoom = function listenToRoom(roomType, objectId) {
        var client = _ChatClient2['default'].getInstance(this.props.pydio);
        client.joinRoom(roomType, objectId, this._messageListener, null);
    };

    ChatIcon.prototype.leaveRoom = function leaveRoom(roomType, objectId) {
        var client = _ChatClient2['default'].getInstance(this.props.pydio);
        client.leaveRoom(roomType, objectId, this._messageListener);
    };

    ChatIcon.prototype.componentDidMount = function componentDidMount() {
        var _props = this.props;
        var roomType = _props.roomType;
        var objectId = _props.objectId;

        this.listenToRoom(roomType, objectId);
    };

    ChatIcon.prototype.componentWillUnmount = function componentWillUnmount() {
        var _props2 = this.props;
        var roomType = _props2.roomType;
        var objectId = _props2.objectId;

        this.leaveRoom(roomType, objectId);
    };

    ChatIcon.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
        var _this = this;

        var _props3 = this.props;
        var roomType = _props3.roomType;
        var objectId = _props3.objectId;

        if (nextProps.roomType !== roomType || nextProps.objectId !== objectId) {
            this.leaveRoom(roomType, objectId);
            this.setState({ newMessages: 0 }, function () {
                _this.listenToRoom(nextProps.roomType, nextProps.objectId);
            });
        }
    };

    ChatIcon.prototype.onClick = function onClick() {
        var pydio = this.props.pydio;

        pydio.Controller.fireAction('toggle_chat_panel');
        this.setState({ newMessages: 0 });
    };

    ChatIcon.prototype.render = function render() {
        var newMessages = this.state.newMessages;

        if (newMessages === 0) {
            return null;
        }
        var red = '';
        var green = '#8BC34A';
        var style = { display: 'inline-block', padding: '0 5px', fontSize: 15, textAlign: 'center',
            color: green, fontWeight: 500, position: 'relative' };
        var innerStyle = { fontSize: 13, display: 'inline-block', position: 'absolute', top: -1, marginLeft: 2 };
        return _react2['default'].createElement(
            'span',
            { onClick: this.onClick.bind(this), className: 'mdi mdi-comment', style: style },
            _react2['default'].createElement(
                'span',
                { style: innerStyle },
                newMessages
            )
        );
    };

    return ChatIcon;
})(_react2['default'].Component);

exports['default'] = ChatIcon;
module.exports = exports['default'];

},{"./ChatClient":4,"react":"react"}],6:[function(require,module,exports){
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydioModelIdmObjectHelper = require('pydio/model/idm-object-helper');

var _pydioModelIdmObjectHelper2 = _interopRequireDefault(_pydioModelIdmObjectHelper);

var ChatUsers = (function (_React$Component) {
    _inherits(ChatUsers, _React$Component);

    function ChatUsers() {
        _classCallCheck(this, ChatUsers);

        _React$Component.apply(this, arguments);
    }

    ChatUsers.prototype.render = function render() {
        var _props = this.props;
        var ACLs = _props.ACLs;
        var roomUsers = _props.roomUsers;
        var pydio = _props.pydio;

        var style = { user: {
                marginRight: 10
            }, online: {
                color: '#4CAF50',
                marginLeft: 5
            }, offline: {
                marginLeft: 5
            } };

        var users = Object.keys(ACLs).map(function (roleId) {
            var acl = ACLs[roleId];
            var online = undefined;
            var label = _pydioModelIdmObjectHelper2['default'].extractLabel(pydio, acl);
            if (acl.User) {
                if (roomUsers && roomUsers.indexOf(acl.User.Login) > -1) {
                    online = true;
                } else {
                    online = false;
                }
            }
            return _react2['default'].createElement(
                'span',
                { style: style.user },
                label,
                online !== undefined && _react2['default'].createElement('span', { className: "mdi mdi-checkbox-blank-circle" + (online ? "" : "-outline"), style: online ? style.online : style.offline }),
                online === undefined && _react2['default'].createElement('span', { className: "mdi mdi-account-multiple-outline", style: style.offline })
            );
        });

        return _react2['default'].createElement(
            'div',
            { style: { padding: 16, fontWeight: 500, color: '#757575' } },
            users
        );
    };

    return ChatUsers;
})(_react2['default'].Component);

exports['default'] = ChatUsers;
module.exports = exports['default'];

},{"pydio/model/idm-object-helper":"pydio/model/idm-object-helper","react":"react"}],7:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _usersAvatarUserAvatar = require('../users/avatar/UserAvatar');

var _usersAvatarUserAvatar2 = _interopRequireDefault(_usersAvatarUserAvatar);

var _materialUi = require('material-ui');

var _pydioUtilDom = require('pydio/util/dom');

var _pydioUtilDom2 = _interopRequireDefault(_pydioUtilDom);

var _Pydio$requireLib = _pydio2['default'].requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;
var moment = _Pydio$requireLib.moment;

var Message = (function (_React$Component) {
    _inherits(Message, _React$Component);

    function Message(props) {
        _classCallCheck(this, Message);

        _React$Component.call(this, props);
        this.state = { hover: false };
    }

    Message.prototype.render = function render() {
        var _this = this;

        var _props = this.props;
        var message = _props.message;
        var pydio = _props.pydio;
        var hideDate = _props.hideDate;
        var sameAuthor = _props.sameAuthor;
        var onDeleteMessage = _props.onDeleteMessage;

        var mDate = moment(parseFloat(message.Timestamp) * 1000);

        var styles = {
            date: {
                color: 'rgba(0,0,0,.23)',
                textAlign: 'center',
                display: 'flex',
                margin: '5px 0'
            },
            dateLine: {
                flex: 1,
                margin: '10px 20px',
                borderBottom: '1px solid #eee'
            },
            comment: {
                padding: 8,
                display: 'flex',
                alignItems: 'flex-start'
            },
            commentContent: {
                flex: '1',
                marginLeft: 8,
                position: 'relative',
                padding: '8px 10px',
                backgroundColor: '#eee'
            },
            commentDeleteBox: {
                position: 'absolute',
                top: 5,
                right: 5,
                cursor: 'pointer',
                fontSize: 20,
                color: '#424242',
                opacity: 0,
                transition: _pydioUtilDom2['default'].getBeziersTransition()
            }
        };

        var authorIsLogged = false;
        if (pydio.user.id === message.Author) {
            authorIsLogged = true;
        }
        var avatar = _react2['default'].createElement(
            'div',
            { style: sameAuthor ? { visibility: 'hidden' } : { paddingTop: 2 } },
            _react2['default'].createElement(_usersAvatarUserAvatar2['default'], {
                avatarSize: 30,
                pydio: pydio,
                userId: message.Author,
                displayLabel: false,
                richOnHover: true,
                avatarLetters: true
            })
        );
        var textStyle = _extends({}, styles.commentContent);
        if (authorIsLogged) {
            textStyle = _extends({}, textStyle, { marginLeft: 0, marginRight: 8 });
        }
        if (sameAuthor) {
            textStyle = _extends({}, textStyle, { borderRadius: 0 });
        }
        var deleteBox = undefined;
        if (authorIsLogged) {
            var hover = this.state.hover;

            var deleteStyle = styles.commentDeleteBox;
            if (hover) {
                deleteStyle.opacity = 1;
            }
            deleteBox = _react2['default'].createElement('span', {
                onClick: onDeleteMessage,
                className: 'mdi mdi-close',
                style: styles.commentDeleteBox,
                title: pydio.MessageHash['7']
            });
        }
        var text = _react2['default'].createElement(
            _materialUi.Paper,
            { zDepth: 0, style: textStyle },
            deleteBox,
            message.Message
        );

        return _react2['default'].createElement(
            'div',
            { style: sameAuthor ? { marginTop: -16 } : {}, onMouseOver: function () {
                    _this.setState({ hover: true });
                }, onMouseOut: function () {
                    _this.setState({ hover: false });
                } },
            !hideDate && _react2['default'].createElement(
                'div',
                { style: styles.date },
                _react2['default'].createElement('span', { style: styles.dateLine }),
                _react2['default'].createElement(
                    'span',
                    null,
                    mDate.fromNow()
                ),
                _react2['default'].createElement('span', { style: styles.dateLine })
            ),
            authorIsLogged && _react2['default'].createElement(
                'div',
                { style: styles.comment },
                text,
                ' ',
                avatar
            ),
            !authorIsLogged && _react2['default'].createElement(
                'div',
                { style: styles.comment },
                avatar,
                ' ',
                text
            )
        );
    };

    return Message;
})(_react2['default'].Component);

Message.PropTypes = {
    message: _react2['default'].PropTypes.object,
    hideDate: _react2['default'].PropTypes.bool,
    sameAuthor: _react2['default'].PropTypes.bool
};

exports['default'] = Message = PydioContextConsumer(Message);
exports['default'] = Message;
module.exports = exports['default'];

},{"../users/avatar/UserAvatar":57,"material-ui":"material-ui","pydio":"pydio","pydio/util/dom":"pydio/util/dom","react":"react"}],8:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Store = require('./Store');

var _Store2 = _interopRequireDefault(_Store);

var _GridBuilder = require('./GridBuilder');

var _GridBuilder2 = _interopRequireDefault(_GridBuilder);

/**
 * Automatic layout for presenting draggable cards to users. Used for user and admin dashboard.
 */
var React = require('react');
var Pydio = require('pydio');

var _require = require('react-grid-layout');

var Responsive = _require.Responsive;
var WidthProvider = _require.WidthProvider;

var _Pydio$requireLib = Pydio.requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;
var CardsGrid = React.createClass({
    displayName: 'CardsGrid',

    /**
     * Save layouts in the users preference.
     *
     * @param {object} allLayouts Responsive layouts passed for saving
     */
    saveFullLayouts: function saveFullLayouts(allLayouts) {
        var savedPref = this.props.store.getUserPreference('Layout');
        // Compare JSON versions to avoid saving unnecessary changes
        if (savedPref && this.previousLayout && this.previousLayout == JSON.stringify(allLayouts)) {
            return;
        }
        this.previousLayout = JSON.stringify(allLayouts);
        this.props.store.saveUserPreference('Layout', allLayouts);
    },

    onLayoutChange: function onLayoutChange(currentLayout, allLayouts) {
        if (this._blockLayoutSave) return;
        this.saveFullLayouts(allLayouts);
    },

    componentWillUnmount: function componentWillUnmount() {
        this.props.store.stopObserving("cards", this._storeObserver);
    },

    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        if (this.props && nextProps.editMode !== this.props.editMode) {
            Object.keys(this.refs).forEach((function (k) {
                this.refs[k].toggleEditMode(nextProps.editMode);
            }).bind(this));
        }
    },

    shouldComponentUpdate: function shouldComponentUpdate(nextProps, nextState) {
        return this._forceUpdate || false;
    },

    getInitialState: function getInitialState() {
        this._storeObserver = (function (e) {
            var _this = this;

            this._forceUpdate = true;
            this.setState({
                cards: this.props.store.getCards()
            }, function () {
                _this._forceUpdate = false;
            });
        }).bind(this);
        this.props.store.observe("cards", this._storeObserver);
        return { cards: this.props.store.getCards() };
    },

    removeCard: function removeCard(itemKey) {
        this.props.removeCard(itemKey);
    },

    buildCards: function buildCards(cards) {

        var index = 0;
        var layouts = { lg: [], md: [], sm: [], xs: [], xxs: [] };
        var items = [];
        var additionalNamespaces = [];
        var rand = Math.random();
        var savedLayouts = this.props.store.getUserPreference('Layout');
        var buildLayout = function buildLayout(classObject, itemKey, item, x, y) {
            var layout = classObject.getGridLayout(x, y);
            layout['handle'] = 'h4';
            if (item['gridHandle']) {
                layout['handle'] = item['gridHandle'];
            }
            layout['i'] = itemKey;
            return layout;
        };
        cards.map((function (item) {

            var parts = item.componentClass.split(".");
            var classNS = parts[0];
            var className = parts[1];
            var classObject;
            if (global[classNS] && global[classNS][className]) {
                classObject = global[classNS][className];
            } else {
                if (!global[classNS]) {
                    additionalNamespaces.push(classNS);
                }
                return;
            }
            var props = _extends({}, item.props);
            var itemKey = props['key'] = item['id'] || 'item_' + index;
            props.ref = itemKey;
            props.pydio = this.props.pydio;
            props.onCloseAction = (function () {
                this.removeCard(itemKey);
            }).bind(this);
            props.preferencesProvider = this.props.store;
            var defaultX = 0,
                defaultY = 0;
            if (item.defaultPosition) {
                defaultX = item.defaultPosition.x;
                defaultY = item.defaultPosition.y;
            }
            var defaultLayout = buildLayout(classObject, itemKey, item, defaultX, defaultY);

            for (var breakpoint in layouts) {
                if (!layouts.hasOwnProperty(breakpoint)) continue;
                var breakLayout = layouts[breakpoint];
                // Find corresponding element in preference
                var existing;
                if (savedLayouts && savedLayouts[breakpoint]) {
                    savedLayouts[breakpoint].map(function (gridData) {
                        if (gridData['i'] == itemKey && gridData['h'] == defaultLayout['h']) {
                            existing = gridData;
                        }
                    });
                }
                if (existing) {
                    breakLayout.push(existing);
                } else if (item.defaultLayouts && item.defaultLayouts[breakpoint]) {
                    var crtLayout = buildLayout(classObject, itemKey, item, item.defaultLayouts[breakpoint].x, item.defaultLayouts[breakpoint].y);
                    breakLayout.push(crtLayout);
                } else {
                    breakLayout.push(defaultLayout);
                }
            }
            index++;
            items.push(React.createElement(classObject, props));
        }).bind(this));

        if (additionalNamespaces.length) {
            this._blockLayoutSave = true;
            ResourcesManager.loadClassesAndApply(additionalNamespaces, (function () {
                this.setState({ additionalNamespacesLoaded: additionalNamespaces }, (function () {
                    this._blockLayoutSave = false;
                }).bind(this));
            }).bind(this));
        }
        return { cards: items, layouts: layouts };
    },

    render: function render() {
        var _buildCards = this.buildCards(this.state.cards);

        var cards = _buildCards.cards;
        var layouts = _buildCards.layouts;

        var ResponsiveGridLayout = WidthProvider(Responsive);
        return React.createElement(
            ResponsiveGridLayout,
            {
                className: 'dashboard-layout',
                cols: this.props.cols || { lg: 10, md: 8, sm: 8, xs: 4, xxs: 2 },
                layouts: layouts,
                rowHeight: 5,
                onLayoutChange: this.onLayoutChange,
                isDraggable: !this.props.disableDrag,
                style: this.props.style,
                autoSize: false
            },
            cards
        );
    }

});

var DynamicGrid = React.createClass({
    displayName: 'DynamicGrid',

    propTypes: {
        storeNamespace: React.PropTypes.string.isRequired,
        builderNamespaces: React.PropTypes.array,
        defaultCards: React.PropTypes.array,
        pydio: React.PropTypes.instanceOf(Pydio),
        disableDrag: React.PropTypes.bool,
        disableEdit: React.PropTypes.bool
    },

    removeCard: function removeCard(cardId) {

        this.state.store.removeCard(cardId);
    },

    addCard: function addCard(cardDefinition) {

        this.state.store.addCard(cardDefinition);
    },

    resetCardsAndLayout: function resetCardsAndLayout() {
        this.state.store.saveUserPreference('Layout', null);
        this.state.store.setCards(this.props.defaultCards);
    },

    getInitialState: function getInitialState() {
        var store = new _Store2['default'](this.props.storeNamespace, this.props.defaultCards, this.props.pydio);
        return {
            editMode: false,
            store: store
        };
    },

    toggleEditMode: function toggleEditMode() {
        this.setState({ editMode: !this.state.editMode });
    },

    render: function render() {
        var _this2 = this;

        var monitorWidgetEditing = (function (status) {
            this.setState({ widgetEditing: status });
        }).bind(this);

        var builder = undefined;
        if (this.props.builderNamespaces && this.state.editMode) {
            builder = React.createElement(_GridBuilder2['default'], {
                className: 'admin-helper-panel',
                namespaces: this.props.builderNamespaces,
                onCreateCard: this.addCard,
                onResetLayout: this.resetCardsAndLayout,
                onEditStatusChange: monitorWidgetEditing,
                getMessage: function (id) {
                    var ns = arguments.length <= 1 || arguments[1] === undefined ? 'ajxp_admin' : arguments[1];
                    return _this2.props.getMessage(id, ns);
                }
            });
        }
        var propStyle = this.props.style || {};
        var rglStyle = this.props.rglStyle || {};
        return React.createElement(
            'div',
            { style: _extends({}, this.props.style, { width: '100%', flex: '1' }), className: this.state.editMode ? "builder-open" : "" },
            !this.props.disableEdit && React.createElement(
                'div',
                { style: { position: 'absolute', bottom: 30, right: 18, zIndex: 11 } },
                React.createElement(MaterialUI.FloatingActionButton, {
                    tooltip: this.props.getMessage('home.49'),
                    onClick: this.toggleEditMode,
                    iconClassName: this.state.editMode ? "icon-ok" : "mdi mdi-pencil",
                    mini: this.state.editMode,
                    disabled: this.state.editMode && this.state.widgetEditing
                })
            ),
            builder,
            React.createElement(
                'div',
                { className: 'home-dashboard', style: { height: '100%' } },
                React.createElement(CardsGrid, {
                    disableDrag: this.props.disableDrag,
                    cols: this.props.cols,
                    store: this.state.store,
                    style: rglStyle,
                    pydio: this.props.pydio,
                    editMode: this.state.editMode,
                    removeCard: this.removeCard
                })
            )
        );
    }

});

exports['default'] = DynamicGrid = PydioContextConsumer(DynamicGrid);
exports['default'] = DynamicGrid;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./GridBuilder":9,"./Store":11,"pydio":"pydio","react":"react","react-grid-layout":"react-grid-layout"}],9:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var React = require('react');
var Pydio = require('pydio');

var _Pydio$requireLib = Pydio.requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;
var AsyncComponent = _Pydio$requireLib.AsyncComponent;

var GridBuilder = React.createClass({
    displayName: 'GridBuilder',

    propTypes: {
        namespaces: React.PropTypes.array,
        onCreateCard: React.PropTypes.func,
        onEditStatusChange: React.PropTypes.func
    },

    getInitialState: function getInitialState() {
        return {
            selectedIndex: 0,
            availableWidgets: this.listAvailableWidgets()
        };
    },

    listAvailableWidgets: function listAvailableWidgets() {
        var secondPass = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];

        var widgets = [];
        var additionalNamespaces = [];
        this.props.namespaces.map(function (ns) {
            if (!global[ns]) {
                additionalNamespaces.push(ns);
                return;
            }
            for (var k in global[ns]) {
                if (global[ns].hasOwnProperty(k)) {
                    var widgetClass = global[ns][k];
                    if (widgetClass.hasBuilderFields && widgetClass.hasBuilderFields()) {
                        widgets.push({ reactClass: widgetClass, fullName: ns + '.' + widgetClass.displayName });
                    }
                }
            }
        });
        if (additionalNamespaces.length && !secondPass) {
            ResourcesManager.loadClassesAndApply(additionalNamespaces, (function () {
                this.setState({
                    availableWidgets: this.listAvailableWidgets(true)
                });
            }).bind(this));
        }
        return widgets;
    },

    onDropDownChange: function onDropDownChange(event, index, item) {
        var defaultValues = {};
        if (index != 0) {
            item.payload['reactClass'].getBuilderFields().map(function (f) {
                if (f['default']) defaultValues[f.name] = f['default'];
            });
        }
        if (this.props.onEditStatusChange) {
            this.props.onEditStatusChange(index != 0);
        }
        this.setState({
            selectedIndex: index,
            selectedWidget: item.payload,
            currentFormValues: defaultValues
        });
    },

    cancel: function cancel() {
        if (this.props.onEditStatusChange) {
            this.props.onEditStatusChange(false);
        }
        this.setState({ selectedIndex: 0 });
    },

    onFormValueChange: function onFormValueChange(newValues) {
        this.setState({ currentFormValues: newValues });
    },

    onFormSubmit: function onFormSubmit() {
        var values = this.state.currentFormValues;
        var selectedWidget = this.state.selectedWidget;
        var title = values.title ? values.title : values.legend;
        if (!title) title = this.state.selectedWidget['reactClass'].builderDisplayName;
        this.props.onCreateCard({
            componentClass: selectedWidget.fullName,
            title: title,
            props: values
        });
        this.cancel();
    },

    resetLayout: function resetLayout() {
        if (window.confirm(this.props.getMessage('home.51'))) {
            this.props.onResetLayout();
        }
    },

    render: function render() {
        var getMessage = this.props.getMessage;

        var selectorItems = [{ payload: 0, text: getMessage('home.50') }].concat(this.state.availableWidgets.map(function (w, index) {
            return { payload: w, text: w['reactClass'].builderDisplayName };
        }));

        var selector = React.createElement(ReactMUI.DropDownMenu, {
            menuItems: selectorItems,
            onChange: this.onDropDownChange,
            selectedIndex: this.state.selectedIndex,
            autoWidth: false,
            className: 'widget-type-selector'
        });

        var form, add;
        if (this.state.selectedIndex != 0) {
            var fields = this.state.selectedWidget['reactClass'].getBuilderFields();
            var defaultValues = {};
            fields.map(function (f) {
                if (f['default']) defaultValues[f.name] = f['default'];
            });
            if (this.state.currentFormValues) {
                defaultValues = LangUtils.mergeObjectsRecursive(defaultValues, this.state.currentFormValues);
            }
            form = React.createElement(AsyncComponent, {
                namespace: 'PydioForm',
                componentName: 'FormPanel',
                parameters: fields,
                depth: -1,
                values: defaultValues,
                onChange: this.onFormValueChange
            });
            add = React.createElement(
                'div',
                { style: { textAlign: 'center', paddingBottom: 100 } },
                React.createElement(ReactMUI.RaisedButton, { label: getMessage('home.52'), onClick: this.onFormSubmit }),
                ' ',
                React.createElement(ReactMUI.RaisedButton, { label: getMessage('54', ''), onClick: this.cancel })
            );
        }

        return React.createElement(
            ReactMUI.Paper,
            _extends({}, this.props, {
                zDepth: 3 }),
            React.createElement(
                'h3',
                null,
                getMessage('home.53')
            ),
            React.createElement(
                'div',
                { className: 'legend' },
                getMessage('home.54'),
                React.createElement('br', null),
                getMessage('home.55')
            ),
            selector,
            form,
            add,
            React.createElement(
                'div',
                { style: { position: 'absolute', bottom: 30, left: 10 } },
                React.createElement(ReactMUI.FlatButton, { disabled: this.state.selectedIndex != 0, label: getMessage('home.56'), secondary: true, onClick: this.resetLayout })
            )
        );
    }

});

exports['default'] = GridBuilder = PydioContextConsumer(GridBuilder);
exports['default'] = GridBuilder;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"pydio":"pydio","react":"react"}],10:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports['default'] = {

    propTypes: {
        showCloseAction: React.PropTypes.bool,
        onCloseAction: React.PropTypes.func
    },

    focusItem: function focusItem() {
        this.setState({ focus: true });
    },

    blurItem: function blurItem() {
        this.setState({ focus: false });
    },

    mergeStyleWithFocus: function mergeStyleWithFocus() {
        return _extends({}, this.props.style, { zIndex: this.state.focus ? 1 : null });
    },

    getInitialSate: function getInitialSate() {
        return { focus: false, showCloseAction: false };
    },

    toggleEditMode: function toggleEditMode() {
        var value = arguments.length <= 0 || arguments[0] === undefined ? undefined : arguments[0];

        if (value === undefined) {
            this.setState({ showCloseAction: !(this.state && this.state.showCloseAction) });
        } else {
            this.setState({ showCloseAction: value });
        }
    },

    getCloseButton: function getCloseButton() {
        if (this.state && this.state.showCloseAction) {
            var closeAction = this.props.onCloseAction || function () {};
            var overlayStyle = {
                position: 'absolute',
                backgroundColor: 'rgba(0,0,0,0.53)',
                zIndex: 10,
                top: 0,
                left: 0,
                bottom: 0,
                right: 0,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center'
            };
            return React.createElement(
                'div',
                { style: overlayStyle },
                React.createElement(MaterialUI.FlatButton, {
                    label: pydio.MessageHash['ajxp_admin.home.48'],
                    className: 'card-close-button',
                    onTouchTap: closeAction,
                    style: { color: 'white' }
                })
            );
        } else {
            return null;
        }
    },

    statics: {
        getGridLayout: function getGridLayout(x, y) {
            return {
                x: x || 0,
                y: y || 0,
                w: this.gridWidth || 4,
                h: this.gridHeight || 12,
                isResizable: false
            };
        },
        hasBuilderFields: function hasBuilderFields() {
            return this.builderFields ? true : false;
        },
        getBuilderFields: function getBuilderFields() {
            return this.builderFields;
        }
    }

};
module.exports = exports['default'];

},{}],11:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Store = (function (_Observable) {
    _inherits(Store, _Observable);

    /**
     * Init a card store
     * @param prefNamespace Namespace for getting/setting user preferences
     * @param defaultCards Array of cards to be displayed by default
     */

    function Store(prefNamespace, defaultCards, pydioObject) {
        _classCallCheck(this, Store);

        _Observable.call(this);
        this._namespace = prefNamespace;
        this._pydio = pydioObject;
        this._cards = this.getUserPreference("Cards");
        if (!this._cards) {
            this._cards = defaultCards;
        }
    }

    Store.prototype.getUserPreference = function getUserPreference(prefName) {
        var prefKey = this._namespace + prefName;
        var guiPrefs = this._pydio.user.getPreference('gui_preferences', true);
        if (guiPrefs && guiPrefs[prefKey]) {
            return guiPrefs[prefKey];
        } else {
            return null;
        }
    };

    Store.prototype.saveUserPreference = function saveUserPreference(prefName, prefValue) {
        var prefKey = this._namespace + prefName;
        var guiPrefs = this._pydio.user.getPreference('gui_preferences', true);
        if (!guiPrefs) guiPrefs = {};
        guiPrefs[prefKey] = prefValue;
        this._pydio.user.setPreference('gui_preferences', guiPrefs, true);
        this._pydio.user.savePreference('gui_preferences');
    };

    Store.prototype.saveCards = function saveCards(cards) {
        this.saveUserPreference('Cards', cards);
    };

    Store.prototype.resetCards = function resetCards() {
        this.saveUserPreference('Cards', null);
    };

    Store.prototype.setCards = function setCards(newCards) {
        this._cards = newCards;
        this.notify("cards", this._cards);
        this.saveCards(newCards);
    };

    Store.prototype.getCards = function getCards() {
        return this._cards;
    };

    Store.prototype.removeCard = function removeCard(cardId) {
        var index = -1;
        var currentCards = this.getCards();
        currentCards.map(function (card, arrayIndex) {
            if (card.id == cardId) index = arrayIndex;
        });
        if (index == -1) {
            console.warn('Card ID not found, this is strange.', cardId);
            return;
        }
        var newCards;
        if (index == 0) newCards = currentCards.slice(1);else if (index == currentCards.length - 1) newCards = currentCards.slice(0, -1);else newCards = currentCards.slice(0, index).concat(currentCards.slice(index + 1));
        this.setCards(newCards);
    };

    Store.prototype.createCardId = function createCardId(cardDefinition) {
        var randomize = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

        var id = LangUtils.computeStringSlug(cardDefinition['title']);
        if (randomize) {
            id += '-' + Math.round(Math.random() * 100 + 10);
        }
        var alreadyExists = false;
        this._cards.map((function (card) {
            if (card.id == id) alreadyExists = true;
        }).bind(this));
        if (alreadyExists) {
            id = this.createCardId(cardDefinition, true);
        }
        return id;
    };

    Store.prototype.addCard = function addCard(cardDefinition) {
        //console.log(cardDefinition);

        cardDefinition['id'] = this.createCardId(cardDefinition);
        this.setCards(this._cards.concat([cardDefinition]));
    };

    return Store;
})(Observable);

exports['default'] = Store;
module.exports = exports['default'];

},{}],12:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _require = require('react');

var Component = _require.Component;
var PropTypes = _require.PropTypes;

var _require2 = require('material-ui');

var FlatButton = _require2.FlatButton;

var _require3 = require('material-ui/styles');

var muiThemeable = _require3.muiThemeable;

exports['default'] = function (PydioComponent, displayName) {
    var gridDimension = arguments.length <= 2 || arguments[2] === undefined ? { gridWidth: 4, gridHeight: 12 } : arguments[2];
    var builderFields = arguments.length <= 3 || arguments[3] === undefined ? undefined : arguments[3];

    var originalDisplayName = PydioComponent.displayName || PydioComponent.name;
    PydioComponent = muiThemeable()(PydioComponent);

    var GridItem = (function (_Component) {
        _inherits(GridItem, _Component);

        function GridItem(props, context) {
            _classCallCheck(this, GridItem);

            _Component.call(this, props, context);
            this.state = { focus: false, showCloseAction: false };
        }

        GridItem.prototype.focusItem = function focusItem() {
            this.setState({ focus: true });
        };

        GridItem.prototype.blurItem = function blurItem() {
            this.setState({ focus: false });
        };

        GridItem.prototype.mergeStyleWithFocus = function mergeStyleWithFocus() {
            return _extends({}, this.props.style, { zIndex: this.state.focus ? 1 : null });
        };

        GridItem.prototype.toggleEditMode = function toggleEditMode() {
            var value = arguments.length <= 0 || arguments[0] === undefined ? undefined : arguments[0];

            if (value === undefined) {
                this.setState({ showCloseAction: !(this.state && this.state.showCloseAction) });
            } else {
                this.setState({ showCloseAction: value });
            }
        };

        GridItem.prototype.getCloseButton = function getCloseButton() {
            var closeAction = this.props.onCloseAction || function () {};
            var overlayStyle = {
                position: 'absolute',
                backgroundColor: 'rgba(0,0,0,0.53)',
                zIndex: 10,
                top: 0,
                left: 0,
                bottom: 0,
                right: 0,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center'
            };
            return React.createElement(
                'div',
                { style: overlayStyle },
                React.createElement(FlatButton, {
                    label: this.props.pydio.MessageHash['ajxp_admin.home.48'],
                    className: 'card-close-button',
                    onTouchTap: closeAction,
                    style: { color: 'white' }
                })
            );
        };

        GridItem.prototype.render = function render() {
            var props = _extends({}, this.props, {
                style: this.mergeStyleWithFocus(),
                closeButton: this.state.showCloseAction ? this.getCloseButton() : null,
                onFocusItem: this.focusItem.bind(this),
                onBlurItem: this.blurItem.bind(this)
            });
            return React.createElement(PydioComponent, props);
        };

        return GridItem;
    })(Component);

    GridItem.propTypes = {
        onCloseAction: PropTypes.func
    };

    GridItem.displayName = originalDisplayName;
    GridItem.builderDisplayName = displayName;

    GridItem.getGridLayout = function (x, y) {
        return {
            x: x || 0,
            y: y || 0,
            w: gridDimension.gridWidth || 4,
            h: gridDimension.gridHeight || 12,
            isResizable: false
        };
    };

    GridItem.hasBuilderFields = function () {
        return builderFields !== undefined;
    };
    GridItem.getBuilderFields = function () {
        return builderFields;
    };

    return GridItem;
};

module.exports = exports['default'];

},{"material-ui":"material-ui","material-ui/styles":"material-ui/styles","react":"react"}],13:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _materialUi = require('material-ui');

/**
 * Two columns layout used for Workspaces and Plugins editors
 */
var PaperEditorLayout = _react2['default'].createClass({
    displayName: 'PaperEditorLayout',

    propTypes: {
        title: _react2['default'].PropTypes.any,
        titleActionBar: _react2['default'].PropTypes.any,
        leftNav: _react2['default'].PropTypes.any,
        contentFill: _react2['default'].PropTypes.bool,
        className: _react2['default'].PropTypes.string
    },

    toggleMenu: function toggleMenu() {
        var crtLeftOpen = this.state && this.state.forceLeftOpen;
        this.setState({ forceLeftOpen: !crtLeftOpen });
    },

    render: function render() {

        var styles = {
            title: {
                backgroundColor: '#455A64',
                borderRadius: '2px 2px 0 0',
                display: 'flex'
            },
            titleH2: {
                color: 'white',
                flex: 1,
                fontSize: 26,
                padding: '14px 12px 10px',
                marginBottom: 0,
                whiteSpace: 'nowrap',
                overflow: 'hidden',
                textOverflow: 'ellipsis'
            },
            titleBar: {
                marginTop: 15,
                marginRight: 16
            }
        };

        return _react2['default'].createElement(
            'div',
            { className: "paper-editor-content layout-fill vertical-layout" + (this.props.className ? ' ' + this.props.className : '') },
            _react2['default'].createElement(
                'div',
                { className: 'paper-editor-title', style: styles.title },
                _react2['default'].createElement(
                    'h2',
                    { style: styles.titleH2 },
                    this.props.title,
                    ' ',
                    _react2['default'].createElement(
                        'div',
                        { className: 'left-picker-toggle' },
                        _react2['default'].createElement(_materialUi.IconButton, { iconClassName: 'icon-caret-down', onClick: this.toggleMenu })
                    )
                ),
                _react2['default'].createElement(
                    'div',
                    { style: styles.titleBar },
                    this.props.titleActionBar
                )
            ),
            _react2['default'].createElement(
                'div',
                { className: 'layout-fill main-layout-nav-to-stack' },
                this.props.leftNav && _react2['default'].createElement(
                    'div',
                    { className: "paper-editor-left" + (this.state && this.state.forceLeftOpen ? ' picker-open' : ''), onClick: this.toggleMenu },
                    this.props.leftNav
                ),
                _react2['default'].createElement(
                    'div',
                    { className: "layout-fill paper-editor-right" + (this.props.contentFill ? ' vertical-layout' : ''), style: this.props.contentFill ? {} : { overflowY: 'auto' } },
                    this.props.children
                )
            )
        );
    }
});
/**
 * Navigation subheader used by PaperEditorLayout
 */
var PaperEditorNavHeader = _react2['default'].createClass({
    displayName: 'PaperEditorNavHeader',

    propTypes: {
        label: _react2['default'].PropTypes.string
    },

    render: function render() {

        return _react2['default'].createElement(
            'div',
            { className: "mui-subheader", style: { fontSize: 13, fontWeight: 500, color: 'rgba(0, 0, 0, 0.25)', lineHeight: '48px', paddingLeft: 16 } },
            this.props.children,
            this.props.label
        );
    }

});
/**
 * Navigation entry used by PaperEditorLayout.
 */
var PaperEditorNavEntry = _react2['default'].createClass({
    displayName: 'PaperEditorNavEntry',

    propTypes: {
        keyName: _react2['default'].PropTypes.string.isRequired,
        onClick: _react2['default'].PropTypes.func.isRequired,
        label: _react2['default'].PropTypes.string,
        selectedKey: _react2['default'].PropTypes.string,
        isLast: _react2['default'].PropTypes.bool,
        // Drop Down Data
        dropDown: _react2['default'].PropTypes.bool,
        dropDownData: _react2['default'].PropTypes.object,
        dropDownChange: _react2['default'].PropTypes.func,
        dropDownDefaultItems: _react2['default'].PropTypes.array
    },

    onClick: function onClick() {
        this.props.onClick(this.props.keyName);
    },

    captureDropDownClick: function captureDropDownClick() {
        if (this.preventClick) {
            this.preventClick = false;
            return;
        }
        this.props.onClick(this.props.keyName);
    },

    dropDownChange: function dropDownChange(event, index, item) {
        this.preventClick = true;
        this.props.dropDownChange(item);
    },

    render: function render() {

        if (!this.props.dropDown || !this.props.dropDownData) {
            return _react2['default'].createElement(
                'div',
                {
                    className: 'menu-entry' + (this.props.keyName == this.props.selectedKey ? ' menu-entry-selected' : '') + (this.props.isLast ? ' last' : ''),
                    onClick: this.onClick },
                this.props.children,
                this.props.label
            );
        }

        // dropDown & dropDownData are loaded
        var menuItemsTpl = [{ text: this.props.label, payload: '-1' }];
        if (this.props.dropDownDefaultItems) {
            menuItemsTpl = menuItemsTpl.concat(this.props.dropDownDefaultItems);
        }
        this.props.dropDownData.forEach(function (v, k) {
            menuItemsTpl.push({ text: v.label, payload: v });
        });
        return _react2['default'].createElement(
            'div',
            { onClick: this.captureDropDownClick, className: 'menu-entry-dropdown' + (this.props.keyName == this.props.selectedKey ? ' menu-entry-selected' : '') + (this.props.isLast ? ' last' : '') },
            _react2['default'].createElement(_materialUi.DropDownMenu, {
                menuItems: menuItemsTpl,
                className: 'dropdown-full-width',
                style: { width: 256 },
                autoWidth: false,
                onChange: this.dropDownChange
            })
        );
    }
});

exports.PaperEditorLayout = PaperEditorLayout;
exports.PaperEditorNavEntry = PaperEditorNavEntry;
exports.PaperEditorNavHeader = PaperEditorNavHeader;

},{"material-ui":"material-ui","react":"react"}],14:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var propTypes = {
    node: React.PropTypes.instanceOf(AjxpNode).isRequired,
    registry: React.PropTypes.instanceOf(Registry).isRequired,
    editorData: React.PropTypes.object.isRequired,
    icon: React.PropTypes.bool
};

var defaultProps = {
    icon: false
};

var ReactEditorOpener = (function (_React$Component) {
    _inherits(ReactEditorOpener, _React$Component);

    function ReactEditorOpener(props) {
        _classCallCheck(this, ReactEditorOpener);

        _React$Component.call(this, props);

        var node = props.node;
        var editorData = props.editorData;

        this.state = {
            ready: false
        };
    }

    ReactEditorOpener.prototype.componentDidMount = function componentDidMount() {
        var _this = this;

        var _props = this.props;
        var editorData = _props.editorData;
        var registry = _props.registry;

        registry.loadEditorResources(editorData.resourcesManager, function () {
            return _this.setState({ ready: true });
        });
    };

    ReactEditorOpener.prototype.render = function render() {
        var editorData = this.props.editorData;
        var ready = this.state.ready;

        if (!ready) return null;

        var EditorClass = null;
        if (!(EditorClass = FuncUtils.getFunctionByName(editorData.editorClass, window))) {
            return React.createElement(
                "div",
                null,
                "Cannot find editor component (" + editorData.editorClass + ")!"
            );
        }

        // Getting HOC of the class
        return React.createElement(EditorClass.Editor, this.props);
    };

    return ReactEditorOpener;
})(React.Component);

ReactEditorOpener.propTypes = propTypes;
ReactEditorOpener.defaultProps = defaultProps;

exports["default"] = ReactEditorOpener;
module.exports = exports["default"];

},{}],15:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports['default'] = React.createClass({
    displayName: 'ClipboardTextField',

    propTypes: {
        floatingLabelText: React.PropTypes.string,

        inputValue: React.PropTypes.string,
        inputClassName: React.PropTypes.string,
        getMessage: React.PropTypes.func,
        inputCopyMessage: React.PropTypes.string
    },

    getInitialState: function getInitialState() {
        return { copyMessage: null };
    },

    componentDidMount: function componentDidMount() {
        this.attachClipboard();
    },
    componentDidUpdate: function componentDidUpdate() {
        this.attachClipboard();
    },

    attachClipboard: function attachClipboard() {
        if (this._clip) {
            this._clip.destroy();
        }
        if (!this.refs['copy-button']) {
            return;
        }
        this._clip = new Clipboard(this.refs['copy-button'], {
            text: (function (trigger) {
                return this.props.inputValue;
            }).bind(this)
        });
        this._clip.on('success', (function () {
            this.setState({ copyMessage: this.props.getMessage(this.props.inputCopyMessage || '192') }, this.clearCopyMessage);
        }).bind(this));
        this._clip.on('error', (function () {
            var copyMessage;
            if (global.navigator.platform.indexOf("Mac") === 0) {
                copyMessage = this.props.getMessage('144');
            } else {
                copyMessage = this.props.getMessage('143');
            }
            this.refs['input'].focus();
            this.setState({ copyMessage: copyMessage }, this.clearCopyMessage);
        }).bind(this));
    },

    clearCopyMessage: function clearCopyMessage() {
        global.setTimeout((function () {
            this.setState({ copyMessage: '' });
        }).bind(this), 3000);
    },

    render: function render() {

        var select = function select(e) {
            e.currentTarget.select();
        };

        var copyMessage = null;
        if (this.state.copyMessage) {
            var setHtml = (function () {
                return { __html: this.state.copyMessage };
            }).bind(this);
            copyMessage = React.createElement('div', { style: { color: 'rgba(0,0,0,0.23)' }, className: 'copy-message', dangerouslySetInnerHTML: setHtml() });
        }

        var buttonStyle = _extends({
            position: 'absolute',
            right: -8,
            bottom: 13,
            fontSize: 15,
            color: this.props.buttonColor || 'rgba(0, 150, 136, 0.52)',
            height: 26,
            width: 26,
            lineHeight: '28px',
            textAlign: 'center',
            cursor: 'pointer',
            borderRadius: '50%'
        }, this.props.buttonStyle);

        return React.createElement(
            'div',
            null,
            React.createElement(
                'div',
                { style: { position: 'relative' } },
                React.createElement(MaterialUI.TextField, {
                    fullWidth: true,
                    ref: 'input',
                    floatingLabelText: this.props.floatingLabelText,
                    floatingLabelStyle: { whiteSpace: 'nowrap' },
                    underlineShow: this.props.underlineShow,
                    defaultValue: this.props.inputValue,
                    className: this.props.inputClassName,
                    multiLine: this.props.multiLine,
                    rows: this.props.rows,
                    rowsMax: this.props.rowsMax,
                    readOnly: true,
                    onClick: select,
                    style: { marginTop: -10, width: '92%', fontSize: 14 }
                }),
                React.createElement('span', { ref: 'copy-button', style: buttonStyle, title: this.props.getMessage('191'), className: 'copy-button mdi mdi-content-copy' })
            ),
            copyMessage
        );
    }

});
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],16:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;
exports['default'] = React.createClass({
    displayName: 'LabelWithTip',

    propTypes: {
        label: React.PropTypes.string,
        labelElement: React.PropTypes.object,
        tooltip: React.PropTypes.string,
        tooltipClassName: React.PropTypes.string,
        className: React.PropTypes.string,
        style: React.PropTypes.object
    },

    getInitialState: function getInitialState() {
        return { show: false };
    },

    show: function show() {
        this.setState({ show: true });
    },
    hide: function hide() {
        this.setState({ show: false });
    },

    render: function render() {
        if (this.props.tooltip) {
            var tooltipStyle = {};
            if (this.props.label || this.props.labelElement) {
                if (this.state.show) {
                    tooltipStyle = { bottom: -10, top: 'inherit' };
                }
            } else {
                tooltipStyle = { position: 'relative' };
            }
            var label = undefined;
            if (this.props.label) {
                label = React.createElement(
                    'span',
                    { className: 'ellipsis-label' },
                    this.props.label
                );
            } else if (this.props.labelElement) {
                label = this.props.labelElement;
            }
            var style = this.props.style || { position: 'relative' };

            return React.createElement(
                'span',
                { onMouseEnter: this.show, onMouseLeave: this.hide, style: style, className: this.props.className },
                label,
                this.props.children,
                React.createElement(ReactMUI.Tooltip, { label: this.props.tooltip, style: tooltipStyle, className: this.props.tooltipClassName, show: this.state.show })
            );
        } else {
            if (this.props.label) {
                return React.createElement(
                    'span',
                    null,
                    this.props.label
                );
            } else if (this.props.labelElement) {
                return this.props.labelElement;
            } else {
                return React.createElement(
                    'span',
                    null,
                    this.props.children
                );
            }
        }
    }

});
module.exports = exports['default'];

},{}],17:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

/**
 * Simple MuiPaper with a figure and a legend
 */
'use strict';

exports.__esModule = true;
exports['default'] = React.createClass({
    displayName: 'SimpleFigureBadge',

    propTypes: {
        colorIndicator: React.PropTypes.string,
        figure: React.PropTypes.number.isRequired,
        legend: React.PropTypes.string
    },

    getDefaultProps: function getDefaultProps() {
        return {
            colorIndicator: ''
        };
    },

    render: function render() {
        return React.createElement(
            ReactMUI.Paper,
            { style: { display: 'inline-block', marginLeft: 16 } },
            React.createElement(
                'div',
                { className: 'figure-badge', style: this.props.colorIndicator ? { borderLeftColor: this.props.colorIndicator } : {} },
                React.createElement(
                    'div',
                    { className: 'figure' },
                    this.props.figure
                ),
                React.createElement(
                    'div',
                    { className: 'legend' },
                    this.props.legend
                )
            )
        );
    }
});
module.exports = exports['default'];

},{}],18:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _listSortableList = require('./list/SortableList');

var _listSortableList2 = _interopRequireDefault(_listSortableList);

var _listSimpleList = require('./list/SimpleList');

var _listSimpleList2 = _interopRequireDefault(_listSimpleList);

var _listNodeListCustomProvider = require('./list/NodeListCustomProvider');

var _listNodeListCustomProvider2 = _interopRequireDefault(_listNodeListCustomProvider);

var _listListEntry = require('./list/ListEntry');

var _listListPaginator = require('./list/ListPaginator');

var _listListPaginator2 = _interopRequireDefault(_listListPaginator);

var _listMaterialTable = require('./list/MaterialTable');

var _listMaterialTable2 = _interopRequireDefault(_listMaterialTable);

var _viewsTreeView = require('./views/TreeView');

var _elementsLabelWithTip = require('./elements/LabelWithTip');

var _elementsLabelWithTip2 = _interopRequireDefault(_elementsLabelWithTip);

var _elementsSimpleFigureBadge = require('./elements/SimpleFigureBadge');

var _elementsSimpleFigureBadge2 = _interopRequireDefault(_elementsSimpleFigureBadge);

var _elementsClipboardTextField = require('./elements/ClipboardTextField');

var _elementsClipboardTextField2 = _interopRequireDefault(_elementsClipboardTextField);

var _viewsEmptyStateView = require('./views/EmptyStateView');

var _viewsEmptyStateView2 = _interopRequireDefault(_viewsEmptyStateView);

var _viewsModalAppBar = require('./views/ModalAppBar');

var _viewsModalAppBar2 = _interopRequireDefault(_viewsModalAppBar);

var _editorReactEditorOpener = require('./editor/ReactEditorOpener');

var _editorReactEditorOpener2 = _interopRequireDefault(_editorReactEditorOpener);

var _editorPaperEditor = require('./editor/PaperEditor');

var _dynamicGridDynamicGrid = require('./dynamic-grid/DynamicGrid');

var _dynamicGridDynamicGrid2 = _interopRequireDefault(_dynamicGridDynamicGrid);

var _dynamicGridStore = require('./dynamic-grid/Store');

var _dynamicGridStore2 = _interopRequireDefault(_dynamicGridStore);

var _dynamicGridGridItemMixin = require('./dynamic-grid/GridItemMixin');

var _dynamicGridGridItemMixin2 = _interopRequireDefault(_dynamicGridGridItemMixin);

var _dynamicGridAsGridItem = require('./dynamic-grid/asGridItem');

var _dynamicGridAsGridItem2 = _interopRequireDefault(_dynamicGridAsGridItem);

var _utilDND = require('./util/DND');

var _usersAvatarUserAvatar = require('./users/avatar/UserAvatar');

var _usersAvatarUserAvatar2 = _interopRequireDefault(_usersAvatarUserAvatar);

var _usersUsersCompleter = require('./users/UsersCompleter');

var _usersUsersCompleter2 = _interopRequireDefault(_usersUsersCompleter);

var _usersTeamCreationForm = require('./users/TeamCreationForm');

var _usersTeamCreationForm2 = _interopRequireDefault(_usersTeamCreationForm);

var _menuButtonMenu = require('./menu/ButtonMenu');

var _menuButtonMenu2 = _interopRequireDefault(_menuButtonMenu);

var _menuContextMenu = require('./menu/ContextMenu');

var _menuContextMenu2 = _interopRequireDefault(_menuContextMenu);

var _menuIconButtonMenu = require('./menu/IconButtonMenu');

var _menuIconButtonMenu2 = _interopRequireDefault(_menuIconButtonMenu);

var _menuToolbar = require('./menu/Toolbar');

var _menuToolbar2 = _interopRequireDefault(_menuToolbar);

var _usersAddressbookAddressBook = require('./users/addressbook/AddressBook');

var _usersAddressbookAddressBook2 = _interopRequireDefault(_usersAddressbookAddressBook);

var _chatChatClient = require('./chat/ChatClient');

var _chatChatClient2 = _interopRequireDefault(_chatChatClient);

var _chatChat = require('./chat/Chat');

var _chatChat2 = _interopRequireDefault(_chatChat);

var _chatChatIcon = require('./chat/ChatIcon');

var _chatChatIcon2 = _interopRequireDefault(_chatChatIcon);

var _policiesResourcePoliciesPanel = require('./policies/ResourcePoliciesPanel');

var _policiesResourcePoliciesPanel2 = _interopRequireDefault(_policiesResourcePoliciesPanel);

var _usersAvatarCellActionsRenderer = require('./users/avatar/CellActionsRenderer');

var _usersAvatarCellActionsRenderer2 = _interopRequireDefault(_usersAvatarCellActionsRenderer);

var PydioComponents = {

    SortableList: _listSortableList2['default'],
    SimpleList: _listSimpleList2['default'],
    NodeListCustomProvider: _listNodeListCustomProvider2['default'],
    ListEntry: _listListEntry.ListEntry,
    ListPaginator: _listListPaginator2['default'],
    MaterialTable: _listMaterialTable2['default'],

    TreeView: _viewsTreeView.TreeView,
    DNDTreeView: _viewsTreeView.DNDTreeView,
    FoldersTree: _viewsTreeView.FoldersTree,
    ClipboardTextField: _elementsClipboardTextField2['default'],
    LabelWithTip: _elementsLabelWithTip2['default'],
    EmptyStateView: _viewsEmptyStateView2['default'],
    SimpleFigureBadge: _elementsSimpleFigureBadge2['default'],
    ModalAppBar: _viewsModalAppBar2['default'],

    ReactEditorOpener: _editorReactEditorOpener2['default'],
    PaperEditorLayout: _editorPaperEditor.PaperEditorLayout,
    PaperEditorNavEntry: _editorPaperEditor.PaperEditorNavEntry,
    PaperEditorNavHeader: _editorPaperEditor.PaperEditorNavHeader,

    DynamicGrid: _dynamicGridDynamicGrid2['default'],
    DynamicGridItemMixin: _dynamicGridGridItemMixin2['default'],
    asGridItem: _dynamicGridAsGridItem2['default'],
    DynamicGridStore: _dynamicGridStore2['default'],

    DND: {
        Types: _utilDND.Types, collect: _utilDND.collect, collectDrop: _utilDND.collectDrop, nodeDragSource: _utilDND.nodeDragSource, nodeDropTarget: _utilDND.nodeDropTarget, DNDActionParameter: _utilDND.DNDActionParameter
    },
    DNDActionParameter: _utilDND.DNDActionParameter,

    UserAvatar: _usersAvatarUserAvatar2['default'],
    UsersCompleter: _usersUsersCompleter2['default'],
    TeamCreationForm: _usersTeamCreationForm2['default'],
    AddressBook: _usersAddressbookAddressBook2['default'],

    ContextMenu: _menuContextMenu2['default'],
    Toolbar: _menuToolbar2['default'],
    ButtonMenu: _menuButtonMenu2['default'],
    IconButtonMenu: _menuIconButtonMenu2['default'],

    Chat: _chatChat2['default'],
    ChatIcon: _chatChatIcon2['default'],
    ChatClient: _chatChatClient2['default'],
    ResourcePoliciesPanel: _policiesResourcePoliciesPanel2['default'],
    CellActionsRenderer: _usersAvatarCellActionsRenderer2['default']
};

exports['default'] = PydioComponents;
module.exports = exports['default'];

},{"./chat/Chat":3,"./chat/ChatClient":4,"./chat/ChatIcon":5,"./dynamic-grid/DynamicGrid":8,"./dynamic-grid/GridItemMixin":10,"./dynamic-grid/Store":11,"./dynamic-grid/asGridItem":12,"./editor/PaperEditor":13,"./editor/ReactEditorOpener":14,"./elements/ClipboardTextField":15,"./elements/LabelWithTip":16,"./elements/SimpleFigureBadge":17,"./list/ListEntry":21,"./list/ListPaginator":23,"./list/MaterialTable":24,"./list/NodeListCustomProvider":25,"./list/SimpleList":26,"./list/SortableList":28,"./menu/ButtonMenu":32,"./menu/ContextMenu":33,"./menu/IconButtonMenu":34,"./menu/Toolbar":38,"./policies/ResourcePoliciesPanel":40,"./users/TeamCreationForm":41,"./users/UsersCompleter":43,"./users/addressbook/AddressBook":44,"./users/avatar/CellActionsRenderer":55,"./users/avatar/UserAvatar":57,"./util/DND":58,"./views/EmptyStateView":60,"./views/ModalAppBar":61,"./views/TreeView":63}],19:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _ListEntryNodeListenerMixin = require('./ListEntryNodeListenerMixin');

var _ListEntryNodeListenerMixin2 = _interopRequireDefault(_ListEntryNodeListenerMixin);

var _InlineEditor = require('./InlineEditor');

var _InlineEditor2 = _interopRequireDefault(_InlineEditor);

var _ListEntry = require('./ListEntry');

var _materialUi = require('material-ui');

/**
 * Callback based material list entry with custom icon render, firstLine, secondLine, etc.
 */
exports['default'] = _react2['default'].createClass({
    displayName: 'ConfigurableListEntry',

    mixins: [_ListEntryNodeListenerMixin2['default']],

    propTypes: {
        node: _react2['default'].PropTypes.instanceOf(AjxpNode),
        // SEE ALSO ListEntry PROPS
        renderIcon: _react2['default'].PropTypes.func,
        renderFirstLine: _react2['default'].PropTypes.func,
        renderSecondLine: _react2['default'].PropTypes.func,
        renderThirdLine: _react2['default'].PropTypes.func,
        renderActions: _react2['default'].PropTypes.func,
        style: _react2['default'].PropTypes.object
    },

    render: function render() {
        var _this = this;

        var icon = undefined,
            firstLine = undefined,
            secondLine = undefined,
            thirdLine = undefined,
            style = this.props.style || {};
        if (this.props.renderIcon) {
            icon = this.props.renderIcon(this.props.node, this.props);
        } else {
            var node = this.props.node;
            var iconClass = node.getMetadata().get("icon_class") ? node.getMetadata().get("icon_class") : node.isLeaf() ? "icon-file-alt" : "icon-folder-close";
            icon = _react2['default'].createElement(_materialUi.FontIcon, { className: iconClass });
        }

        if (this.props.renderFirstLine) {
            firstLine = this.props.renderFirstLine(this.props.node);
        } else {
            firstLine = this.props.node.getLabel();
        }
        if (this.state && this.state.inlineEdition) {
            firstLine = _react2['default'].createElement(
                'span',
                null,
                _react2['default'].createElement(_InlineEditor2['default'], {
                    node: this.props.node,
                    onClose: function () {
                        _this.setState({ inlineEdition: false });
                    },
                    callback: this.state.inlineEditionCallback
                }),
                firstLine
            );
            style.position = 'relative';
        }
        if (this.props.renderSecondLine) {
            secondLine = this.props.renderSecondLine(this.props.node);
        }
        if (this.props.renderThirdLine) {
            thirdLine = this.props.renderThirdLine(this.props.node);
        }
        var actions = this.props.actions;
        if (this.props.renderActions) {
            actions = this.props.renderActions(this.props.node);
        }

        return _react2['default'].createElement(_ListEntry.DragDropListEntry, _extends({}, this.props, {
            iconCell: icon,
            firstLine: firstLine,
            secondLine: secondLine,
            thirdLine: thirdLine,
            actions: actions,
            style: style
        }));
    }

});
module.exports = exports['default'];

},{"./InlineEditor":20,"./ListEntry":21,"./ListEntryNodeListenerMixin":22,"material-ui":"material-ui","react":"react"}],20:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;
var React = require('react');
var Pydio = require('pydio');
var AjxpNode = require('pydio/model/node');

var _Pydio$requireLib = Pydio.requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;

var _require = require('material-ui');

var Paper = _require.Paper;
var TextField = _require.TextField;
var FlatButton = _require.FlatButton;

var InlineEditor = React.createClass({
    displayName: 'InlineEditor',

    propTypes: {
        node: React.PropTypes.instanceOf(AjxpNode),
        callback: React.PropTypes.func,
        onClose: React.PropTypes.func,
        detached: React.PropTypes.bool
    },

    submit: function submit() {
        if (!this.state || !this.state.value || this.state.value === this.props.node.getLabel()) {
            this.setState({ errorString: 'Please use a different value for renaming!' });
            this.props.getPydio().displayMessage('ERROR', 'Please use a different value for renaming!');
        } else {
            this.props.callback(this.state.value);
            this.props.onClose();
        }
    },

    componentDidMount: function componentDidMount() {
        this.refs.text.focus();
    },

    catchClicks: function catchClicks(e) {
        e.stopPropagation();
    },

    onKeyDown: function onKeyDown(e) {
        if (e.key === 'Enter') {
            this.submit();
        }
        this.setState({ errorString: '' });
        e.stopPropagation();
    },

    render: function render() {
        var _this = this;

        return React.createElement(
            Paper,
            { className: "inline-editor" + (this.props.detached ? " detached" : ""), style: { padding: 8 }, zDepth: 2 },
            React.createElement(TextField, {
                ref: 'text',
                defaultValue: this.props.node.getLabel(),
                onChange: function (e, value) {
                    _this.setState({ value: value });
                },
                onClick: this['catch'], onDoubleClick: this.catchClicks,
                tabIndex: '0', onKeyDown: this.onKeyDown,
                errorText: this.state ? this.state.errorString : null
            }),
            React.createElement(
                'div',
                { style: { textAlign: 'right', paddingTop: 8 } },
                React.createElement(FlatButton, { label: 'Cancel', onClick: this.props.onClose }),
                React.createElement(FlatButton, { label: 'Submit', onClick: this.submit })
            )
        );
    }

});

exports['default'] = InlineEditor = PydioContextConsumer(InlineEditor);

exports['default'] = InlineEditor;
module.exports = exports['default'];

},{"material-ui":"material-ui","pydio":"pydio","pydio/model/node":"pydio/model/node","react":"react"}],21:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _utilDND = require('../util/DND');

var _reactDnd = require('react-dnd');

var _materialUi = require('material-ui');

var _materialUiStyles = require('material-ui/styles');

var _color = require('color');

var _color2 = _interopRequireDefault(_color);

/**
 * Material List Entry
 */

var ListEntry = (function (_React$Component) {
    _inherits(ListEntry, _React$Component);

    function ListEntry() {
        _classCallCheck(this, ListEntry);

        _React$Component.apply(this, arguments);
    }

    ListEntry.prototype.onClick = function onClick(event) {
        if (this.props.showSelector) {
            if (this.props.selectorDisabled) return;
            this.props.onSelect(this.props.node, event);
            event.stopPropagation();
            event.preventDefault();
        } else if (this.props.onClick) {
            this.props.onClick(this.props.node, event);
        }
    };

    ListEntry.prototype.onDoubleClick = function onDoubleClick(event) {
        if (this.props.onDoubleClick) {
            this.props.onDoubleClick(this.props.node, event);
        }
    };

    ListEntry.prototype.render = function render() {
        var _this = this;

        var selector = undefined,
            icon = undefined,
            additionalClassName = undefined;

        var _props = this.props;
        var node = _props.node;
        var showSelector = _props.showSelector;
        var selected = _props.selected;
        var selectorDisabled = _props.selectorDisabled;
        var firstLine = _props.firstLine;
        var secondLine = _props.secondLine;
        var thirdLine = _props.thirdLine;
        var style = _props.style;
        var actions = _props.actions;
        var iconCell = _props.iconCell;
        var mainIcon = _props.mainIcon;
        var className = _props.className;
        var canDrop = _props.canDrop;
        var isOver = _props.isOver;
        var connectDragSource = _props.connectDragSource;
        var connectDropTarget = _props.connectDropTarget;

        var mainClasses = ['material-list-entry', 'material-list-entry-' + (thirdLine ? 3 : secondLine ? 2 : 1) + '-lines'];
        if (className) mainClasses.push(className);

        if (showSelector) {
            selector = React.createElement(
                'div',
                { className: 'material-list-selector' },
                React.createElement(_materialUi.Checkbox, { checked: selected, ref: 'selector', disabled: selectorDisabled })
            );
        }

        if (iconCell) {
            icon = this.props.iconCell;
        } else if (this.props.mainIcon) {
            var _style = {
                fontSize: 18, color: '#FFF', display: 'inline-block', margin: 16, backgroundColor: 'rgb(189, 189, 189)', padding: '7px 3px', width: 33, height: 33, textAlign: 'center'
            };
            icon = React.createElement(_materialUi.FontIcon, { className: "mui-font-icon " + this.props.mainIcon, style: _style });
        }

        if (canDrop && isOver) {
            mainClasses.push('droppable-active');
        }

        if (node) {
            mainClasses.push('listentry' + node.getPath().replace(/\//g, '_'));
            mainClasses.push('ajxp_node_' + (node.isLeaf() ? 'leaf' : 'collection'));
            if (node.getAjxpMime()) {
                mainClasses.push('ajxp_mime_' + node.getAjxpMime());
            }
        }

        var additionalStyle = {
            /*transition:'background-color 250ms cubic-bezier(0.23, 1, 0.32, 1) 0ms, color 250ms cubic-bezier(0.23, 1, 0.32, 1) 0ms'*/
        };
        if (this.state && this.state.hover && !this.props.noHover) {
            additionalStyle = _extends({}, additionalStyle, {
                backgroundColor: 'rgba(0,0,0,0.05)',
                borderBottom: '1px solid transparent'
            });
        }
        if (selected) {
            var selectionColor = this.props.muiTheme.palette.accent2Color;
            var selectionColorDark = _color2['default'](selectionColor).dark();
            additionalStyle = _extends({}, additionalStyle, {
                backgroundColor: selectionColor,
                color: selectionColorDark ? 'white' : 'rgba(0,0,0,.87)'
            });
            mainClasses.push('selected');
            mainClasses.push('selected-' + (selectionColorDark ? 'dark' : 'light'));
        }

        return React.createElement(
            ContextMenuWrapper,
            _extends({}, this.props, {
                ref: function (instance) {
                    var node = _reactDom2['default'].findDOMNode(instance);
                    if (typeof connectDropTarget === 'function') connectDropTarget(node);
                    if (typeof connectDragSource === 'function') connectDragSource(node);
                },
                onClick: this.onClick.bind(this),
                onDoubleClick: showSelector ? null : this.onDoubleClick.bind(this),
                className: mainClasses.join(' '),
                onMouseOver: function () {
                    _this.setState({ hover: true });
                },
                onMouseOut: function () {
                    _this.setState({ hover: false });
                },
                style: _extends({}, style, additionalStyle) }),
            selector,
            React.createElement(
                'div',
                { className: "material-list-icon" + (mainIcon || iconCell ? "" : " material-list-icon-none") },
                icon
            ),
            React.createElement(
                'div',
                { className: 'material-list-text' },
                React.createElement(
                    'div',
                    { key: 'line-1', className: 'material-list-line-1' },
                    firstLine
                ),
                React.createElement(
                    'div',
                    { key: 'line-2', className: 'material-list-line-2' },
                    secondLine
                ),
                React.createElement(
                    'div',
                    { key: 'line-3', className: 'material-list-line-3' },
                    thirdLine
                )
            ),
            React.createElement(
                'div',
                { className: 'material-list-actions' },
                actions
            )
        );
    };

    return ListEntry;
})(React.Component);

var ContextMenuWrapper = function ContextMenuWrapper(props) {
    return React.createElement('div', props);
};
ContextMenuWrapper = PydioHOCs.withContextMenu(ContextMenuWrapper);

ListEntry.propTypes = {
    showSelector: React.PropTypes.bool,
    selected: React.PropTypes.bool,
    selectorDisabled: React.PropTypes.bool,
    onSelect: React.PropTypes.func,
    onClick: React.PropTypes.func,
    iconCell: React.PropTypes.element,
    mainIcon: React.PropTypes.string,
    firstLine: React.PropTypes.node,
    secondLine: React.PropTypes.node,
    thirdLine: React.PropTypes.node,
    actions: React.PropTypes.element,
    activeDroppable: React.PropTypes.bool,
    className: React.PropTypes.string,
    style: React.PropTypes.object,
    noHover: React.PropTypes.bool
};

exports.ListEntry = ListEntry = _materialUiStyles.muiThemeable()(ListEntry);

var DragDropListEntry = _reactDnd.flow(_reactDnd.DragSource(_utilDND.Types.NODE_PROVIDER, _utilDND.nodeDragSource, _utilDND.collect), _reactDnd.DropTarget(_utilDND.Types.NODE_PROVIDER, _utilDND.nodeDropTarget, _utilDND.collectDrop))(ListEntry);

exports.DragDropListEntry = DragDropListEntry;
exports.ListEntry = ListEntry;

},{"../util/DND":58,"color":"color","material-ui":"material-ui","material-ui/styles":"material-ui/styles","react-dnd":"react-dnd","react-dom":"react-dom"}],22:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;
exports["default"] = {

    attach: function attach(node) {
        this._nodeListener = (function () {
            if (!this.isMounted()) {
                this.detach(node);
                return;
            }
            this.forceUpdate();
        }).bind(this);
        this._actionListener = (function (eventMemo) {
            if (!this.isMounted()) {
                this.detach(node);
                return;
            }
            if (eventMemo && eventMemo.type === 'prompt-rename' && eventMemo.callback) {
                this.setState({ inlineEdition: true, inlineEditionCallback: eventMemo.callback });
            }
            return true;
        }).bind(this);
        node.observe("node_replaced", this._nodeListener);
        node.observe("node_action", this._actionListener);
    },

    detach: function detach(node) {
        if (this._nodeListener) {
            node.stopObserving("node_replaced", this._nodeListener);
            node.stopObserving("node_action", this._actionListener);
        }
    },

    componentDidMount: function componentDidMount() {
        this.attach(this.props.node);
    },

    componentWillUnmount: function componentWillUnmount() {
        this.detach(this.props.node);
    }

};
module.exports = exports["default"];

},{}],23:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _materialUi = require('material-ui');

var _utilMessagesConsumerMixin = require('../util/MessagesConsumerMixin');

var _utilMessagesConsumerMixin2 = _interopRequireDefault(_utilMessagesConsumerMixin);

/**
 * Pagination component reading metadata "paginationData" from current node.
 */
exports['default'] = _react2['default'].createClass({
    displayName: 'ListPaginator',

    mixins: [_utilMessagesConsumerMixin2['default']],

    propTypes: {
        dataModel: _react2['default'].PropTypes.instanceOf(PydioDataModel).isRequired,
        node: _react2['default'].PropTypes.instanceOf(AjxpNode)
    },

    componentDidMount: function componentDidMount() {
        var _this = this;

        if (!this.props.node) {
            (function () {
                var dm = _this.props.dataModel;
                _this._dmObserver = (function () {
                    this.setState({ node: dm.getContextNode() });
                }).bind(_this);
                dm.observe("context_changed", _this._dmObserver);
                _this.setState({ node: dm.getContextNode() });
            })();
        }
    },

    componentWillUnmount: function componentWillUnmount() {
        if (this._dmObserver) {
            this.props.dataModel.stopObserving("context_changed", this._dmObserver);
        }
    },

    getInitialState: function getInitialState() {
        return { node: this.props.node };
    },

    changePage: function changePage(event) {
        this.state.node.getMetadata().get("paginationData").set("new_page", event.currentTarget.getAttribute('data-page'));
        this.props.dataModel.requireContextChange(this.state.node);
    },

    onMenuChange: function onMenuChange(event, index, value) {
        this.state.node.getMetadata().get("paginationData").set("new_page", value);
        this.props.dataModel.requireContextChange(this.state.node);
    },

    render: function render() {
        var _this2 = this;

        if (!this.state.node || !this.state.node.getMetadata().get("paginationData")) {
            return null;
        }
        var pData = this.state.node.getMetadata().get("paginationData");
        var current = parseInt(pData.get("current"));
        var total = parseInt(pData.get("total"));
        var pages = [],
            next = undefined,
            last = undefined,
            previous = undefined,
            first = undefined;
        var pageWord = this.context.getMessage ? this.context.getMessage('331', '') : this.props.getMessage('331', '');
        for (var i = 1; i <= total; i++) {
            pages.push(_react2['default'].createElement(_materialUi.MenuItem, {
                value: i,
                primaryText: pageWord + ' ' + i + (i === current ? ' / ' + total : '')
            }));
        }
        if (pages.length <= 1) {
            return null;
        }
        previous = _react2['default'].createElement(_materialUi.IconButton, { onTouchTap: function () {
                _this2.onMenuChange(null, 0, current - 1);
            }, iconClassName: "mdi mdi-chevron-left", disabled: current === 1 });
        next = _react2['default'].createElement(_materialUi.IconButton, { onTouchTap: function () {
                _this2.onMenuChange(null, 0, current + 1);
            }, iconClassName: "mdi mdi-chevron-right", disabled: current === total, style: { marginLeft: -20 } });

        return _react2['default'].createElement(
            'div',
            { id: this.props.id, style: _extends({ display: 'flex', alignItems: 'center' }, this.props.style) },
            previous,
            _react2['default'].createElement(
                _materialUi.DropDownMenu,
                {
                    style: { width: 150, marginTop: -6 },
                    onChange: this.onMenuChange,
                    value: current,
                    underlineStyle: { display: 'none' },
                    labelStyle: { color: 'white' }
                },
                pages
            ),
            next
        );
    }

});
module.exports = exports['default'];

},{"../util/MessagesConsumerMixin":59,"material-ui":"material-ui","react":"react"}],24:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _materialUi = require('material-ui');

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _Pydio$requireLib = _pydio2['default'].requireLib("boot");

var moment = _Pydio$requireLib.moment;

/**
 * Simple material table
 * columns are objects of shape {name, label, style, headerStyle}
 */

var MaterialTable = (function (_React$Component) {
    _inherits(MaterialTable, _React$Component);

    function MaterialTable() {
        _classCallCheck(this, MaterialTable);

        _React$Component.apply(this, arguments);
    }

    MaterialTable.prototype.onRowSelection = function onRowSelection(indexes) {
        var _props = this.props;
        var data = _props.data;
        var onSelectRows = _props.onSelectRows;

        if (!onSelectRows) {
            return;
        }
        if (indexes === 'none') {
            onSelectRows([]);
        } else if (indexes === 'all') {
            onSelectRows(data);
        } else {
            (function () {
                var selection = [];
                indexes.map(function (i) {
                    selection.push(data[i]);
                });
                onSelectRows(selection);
            })();
        }
    };

    MaterialTable.prototype.render = function render() {
        var _props2 = this.props;
        var columns = _props2.columns;
        var data = _props2.data;
        var deselectOnClickAway = _props2.deselectOnClickAway;
        var emptyStateString = _props2.emptyStateString;
        var onSelectRows = _props2.onSelectRows;
        var computeRowStyle = _props2.computeRowStyle;
        var showCheckboxes = this.props.showCheckboxes;

        var rows = data.map(function (model) {
            var rowStyle = undefined;
            if (computeRowStyle) {
                rowStyle = computeRowStyle(model);
            }
            return _react2['default'].createElement(
                _materialUi.TableRow,
                { selectable: onSelectRows !== undefined, style: rowStyle },
                columns.map(function (column) {
                    var value = model[column.name];
                    if (column.useMoment && value) {
                        value = moment(new Date(parseInt(value) * 1000)).fromNow();
                    } else if (column.renderCell) {
                        value = column.renderCell(model);
                    }
                    return _react2['default'].createElement(
                        _materialUi.TableRowColumn,
                        { style: column.style || {}, title: value },
                        value
                    );
                })
            );
        });
        var headers = columns.map(function (column) {
            return _react2['default'].createElement(
                _materialUi.TableHeaderColumn,
                { style: column.headerStyle || {} },
                column.label
            );
        });
        if (emptyStateString && !rows.length) {
            showCheckboxes = false;
            rows = [_react2['default'].createElement(
                _materialUi.TableRow,
                null,
                _react2['default'].createElement(
                    _materialUi.TableRowColumn,
                    { colspan: columns.length },
                    emptyStateString
                )
            )];
        }

        return _react2['default'].createElement(
            _materialUi.Table,
            { onRowSelection: this.onRowSelection.bind(this), multiSelectable: showCheckboxes },
            _react2['default'].createElement(
                _materialUi.TableHeader,
                { displaySelectAll: showCheckboxes, adjustForCheckbox: showCheckboxes, enableSelectAll: showCheckboxes },
                _react2['default'].createElement(
                    _materialUi.TableRow,
                    null,
                    headers
                )
            ),
            _react2['default'].createElement(
                _materialUi.TableBody,
                { deselectOnClickaway: deselectOnClickAway, displayRowCheckbox: showCheckboxes },
                rows
            )
        );
    };

    return MaterialTable;
})(_react2['default'].Component);

MaterialTable.PropTypes = {
    data: _react2['default'].PropTypes.array,
    columns: _react2['default'].PropTypes.array,
    onSelectRows: _react2['default'].PropTypes.func,
    emptyStateString: _react2['default'].PropTypes.string
};

exports['default'] = MaterialTable;
module.exports = exports['default'];

},{"material-ui":"material-ui","pydio":"pydio","react":"react"}],25:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _SimpleList = require('./SimpleList');

var _SimpleList2 = _interopRequireDefault(_SimpleList);

/**
 * Simple to use list component encapsulated with its own query mechanism
 * using a set of properties for the remote node provider.
 */
exports["default"] = React.createClass({
    displayName: "NodeListCustomProvider",

    propTypes: {
        nodeProviderProperties: React.PropTypes.object,
        presetDataModel: React.PropTypes.instanceOf(PydioDataModel),
        autoRefresh: React.PropTypes.number,
        actionBarGroups: React.PropTypes.array,
        heightAutoWithMax: React.PropTypes.number,
        elementHeight: React.PropTypes.number.isRequired,
        nodeClicked: React.PropTypes.func,
        reloadOnServerMessage: React.PropTypes.string,
        entryRenderAsCard: React.PropTypes.func
    },

    reload: function reload() {
        if (this.refs.list && this.isMounted()) {
            this.refs.list.reload();
        }
    },

    componentWillUnmount: function componentWillUnmount() {
        if (this._smObs) {
            this.props.pydio.stopObserving("server_message", this._smObs);
            this.props.pydio.stopObserving("server_message:" + this.props.reloadOnServerMessage, this.reload);
        }
    },

    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        if (this.props.nodeProviderProperties && this.props.nodeProviderProperties !== nextProps.nodeProviderProperties) {
            var _state = this.state;
            var dataModel = _state.dataModel;
            var node = _state.node;

            var provider = new RemoteNodeProvider(nextProps.nodeProviderProperties);
            dataModel.setAjxpNodeProvider(provider);
            node.updateProvider(provider);
            this.setState({ dataModel: dataModel, node: node });
        } else if (this.props.presetDataModel !== nextProps.presetDataModel) {
            this.setState({
                dataModel: nextProps.presetDataModel,
                node: nextProps.presetDataModel.getRootNode()
            });
        }
    },

    getInitialState: function getInitialState() {

        var dataModel = undefined;
        if (this.props.presetDataModel) {
            dataModel = this.props.presetDataModel;
        } else {
            dataModel = PydioDataModel.RemoteDataModelFactory(this.props.nodeProviderProperties);
        }
        var rootNode = dataModel.getRootNode();
        if (this.props.nodeClicked) {
            // leaf
            this.openEditor = (function (node) {
                this.props.nodeClicked(node);
                return false;
            }).bind(this);
            // dir
            dataModel.observe("selection_changed", (function (event) {
                var selectedNodes = event.memo.getSelectedNodes();
                if (selectedNodes.length) {
                    this.props.nodeClicked(selectedNodes[0]);
                    event.memo.setSelectedNodes([]);
                }
            }).bind(this));
        }
        if (this.props.reloadOnServerMessage && this.props.pydio) {
            this._smObs = (function (event) {
                if (XMLUtils.XPathSelectSingleNode(event, this.props.reloadOnServerMessage)) this.reload();
            }).bind(this);
            this.props.pydio.observe("server_message", this._smObs);
            this.props.pydio.observe("server_message:" + this.props.reloadOnServerMessage, this.reload);
        }
        return { node: rootNode, dataModel: dataModel };
    },

    render: function render() {
        var legend;
        if (this.props.legend) {
            legend = React.createElement(
                "div",
                { className: "subtitle" },
                this.props.legend
            );
        }
        return React.createElement(
            "div",
            { className: this.props.heightAutoWithMax ? "" : "layout-fill vertical-layout" },
            React.createElement(_SimpleList2["default"], _extends({}, this.props, {
                openEditor: this.openEditor,
                ref: "list",
                style: Object.assign({ height: '100%' }, this.props.style || {}),
                node: this.state.node,
                dataModel: this.state.dataModel,
                actionBarGroups: this.props.actionBarGroups,
                skipParentNavigation: true,
                observeNodeReload: true,
                hideToolbar: true
            }))
        );
    }

});
module.exports = exports["default"];

},{"./SimpleList":26}],26:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _reactScrollbar = require('react-scrollbar');

var _reactScrollbar2 = _interopRequireDefault(_reactScrollbar);

var _materialUi = require('material-ui');

var _utilMessagesConsumerMixin = require('../util/MessagesConsumerMixin');

var _utilMessagesConsumerMixin2 = _interopRequireDefault(_utilMessagesConsumerMixin);

var _ListEntry = require('./ListEntry');

var _TableListEntry = require('./TableListEntry');

var _TableListEntry2 = _interopRequireDefault(_TableListEntry);

var _TableListHeader = require('./TableListHeader');

var _TableListHeader2 = _interopRequireDefault(_TableListHeader);

var _ConfigurableListEntry = require('./ConfigurableListEntry');

var _ConfigurableListEntry2 = _interopRequireDefault(_ConfigurableListEntry);

var _SortColumns = require('./SortColumns');

var _SortColumns2 = _interopRequireDefault(_SortColumns);

var _ListPaginator = require('./ListPaginator');

var _ListPaginator2 = _interopRequireDefault(_ListPaginator);

var _viewsSimpleReactActionBar = require('../views/SimpleReactActionBar');

var _viewsSimpleReactActionBar2 = _interopRequireDefault(_viewsSimpleReactActionBar);

var _InlineEditor = require('./InlineEditor');

var _InlineEditor2 = _interopRequireDefault(_InlineEditor);

var _viewsEmptyStateView = require('../views/EmptyStateView');

var _viewsEmptyStateView2 = _interopRequireDefault(_viewsEmptyStateView);

var React = require('react');
var Infinite = require('react-infinite');

var DOMUtils = require('pydio/util/dom');
var LangUtils = require('pydio/util/lang');
var PydioDataModel = require('pydio/model/data-model');
var PeriodicalExecuter = require('pydio/util/periodical-executer');

/**
 * Generic List component, using Infinite for cell virtualization, pagination, various
 * displays, etc... It provides many hooks for rendering cells on-demand.
 */
var SimpleList = React.createClass({
    displayName: 'SimpleList',

    mixins: [_utilMessagesConsumerMixin2['default']],

    propTypes: {
        infiniteSliceCount: React.PropTypes.number,
        filterNodes: React.PropTypes.func,
        customToolbar: React.PropTypes.object,
        tableKeys: React.PropTypes.object,
        autoRefresh: React.PropTypes.number,
        reloadAtCursor: React.PropTypes.bool,
        clearSelectionOnReload: React.PropTypes.bool,
        heightAutoWithMax: React.PropTypes.number,
        containerHeight: React.PropTypes.number,
        observeNodeReload: React.PropTypes.bool,
        defaultGroupBy: React.PropTypes.string,
        defaultGroupByLabel: React.PropTypes.string,

        skipParentNavigation: React.PropTypes.bool,
        skipInternalDataModel: React.PropTypes.bool,
        delayInitialLoad: React.PropTypes.number,

        entryEnableSelector: React.PropTypes.func,
        renderCustomEntry: React.PropTypes.func,
        entryRenderIcon: React.PropTypes.func,
        entryRenderActions: React.PropTypes.func,
        entryRenderFirstLine: React.PropTypes.func,
        entryRenderSecondLine: React.PropTypes.func,
        entryRenderThirdLine: React.PropTypes.func,
        entryHandleClicks: React.PropTypes.func,
        hideToolbar: React.PropTypes.bool,
        computeActionsForNode: React.PropTypes.bool,
        multipleActions: React.PropTypes.array,

        openEditor: React.PropTypes.func,
        openCollection: React.PropTypes.func,

        elementStyle: React.PropTypes.object,
        passScrollingStateToChildren: React.PropTypes.bool,
        elementHeight: React.PropTypes.oneOfType([React.PropTypes.number, React.PropTypes.object]).isRequired

    },

    statics: {
        HEIGHT_ONE_LINE: 50,
        HEIGHT_TWO_LINES: 73,
        CLICK_TYPE_SIMPLE: 'simple',
        CLICK_TYPE_DOUBLE: 'double',
        PARENT_FOLDER_ICON: 'mdi mdi-chevron-left'
    },

    getDefaultProps: function getDefaultProps() {
        return { infiniteSliceCount: 30, clearSelectionOnReload: true };
    },

    clickRow: function clickRow(gridRow, event) {
        var node = undefined;
        if (gridRow.props) {
            node = gridRow.props.data.node;
        } else {
            node = gridRow;
        }
        if (this.props.entryHandleClicks) {
            this.props.entryHandleClicks(node, SimpleList.CLICK_TYPE_SIMPLE, event);
            return;
        }
        if (node.isLeaf() && this.props.openEditor) {
            if (this.props.openEditor(node) === false) {
                return;
            }
            var uniqueSelection = new Map();
            uniqueSelection.set(node, true);
            this.setState({ selection: uniqueSelection }, this.rebuildLoadedElements);
        } else if (!node.isLeaf()) {
            if (this.props.openCollection) {
                this.props.openCollection(node);
            } else {
                this.props.dataModel.setSelectedNodes([node]);
            }
        }
    },

    doubleClickRow: function doubleClickRow(gridRow, event) {
        var node = undefined;
        if (gridRow.props) {
            node = gridRow.props.data.node;
        } else {
            node = gridRow;
        }
        if (this.props.entryHandleClicks) {
            this.props.entryHandleClicks(node, SimpleList.CLICK_TYPE_DOUBLE, event);
        }
    },

    onColumnSort: function onColumnSort(column) {
        var stateSetCallback = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

        var pagination = this.props.node.getMetadata().get('paginationData');
        if (pagination && pagination.get('total') > 1 && pagination.get('remote_order')) {

            var dir = 'asc';
            if (this.props.node.getMetadata().get('paginationData').get('currentOrderDir')) {
                dir = this.props.node.getMetadata().get('paginationData').get('currentOrderDir') === 'asc' ? 'desc' : 'asc';
            }
            var orderData = new Map();
            orderData.set('order_column', column['remoteSortAttribute'] ? column.remoteSortAttribute : column.name);
            orderData.set('order_direction', dir);
            this.props.node.getMetadata().set("remote_order", orderData);
            this.props.dataModel.requireContextChange(this.props.node, true);
        } else {

            var att = column['sortAttribute'] ? column['sortAttribute'] : column.name;
            var sortingInfo = undefined;
            var _state$sortingInfo = this.state.sortingInfo;
            var attribute = _state$sortingInfo.attribute;
            var direction = _state$sortingInfo.direction;

            if (attribute === att && direction) {
                if (direction === 'asc') {
                    // Switch direction
                    sortingInfo = { attribute: att, sortType: column.sortType, direction: 'desc' };
                } else {
                    // Reset sorting
                    sortingInfo = this.props.defaultSortingInfo || {};
                }
            } else {
                sortingInfo = { attribute: att, sortType: column.sortType, direction: 'asc' };
            }
            this.setState({ sortingInfo: sortingInfo }, (function () {
                this.rebuildLoadedElements();
                if (stateSetCallback) {
                    stateSetCallback();
                }
            }).bind(this));
        }
    },

    computeSelectionFromCurrentPlusTargetNode: function computeSelectionFromCurrentPlusTargetNode(currentSelection, targetNode) {

        var currentIndexStart = undefined,
            currentIndexEnd = undefined,
            nodeBefore = false;
        if (!this.indexedElements) {
            return [];
        }
        var firstSelected = currentSelection[0];
        var lastSelected = currentSelection[currentSelection.length - 1];
        var newSelection = [];
        for (var i = 0; i < this.indexedElements.length; i++) {
            if (currentIndexStart !== undefined) {
                newSelection.push(this.indexedElements[i].node);
            }
            if (this.indexedElements[i].node === targetNode) {
                if (currentIndexStart !== undefined && currentIndexEnd === undefined) {
                    currentIndexEnd = i;
                    break;
                }
                currentIndexStart = i;
                nodeBefore = true;
                newSelection.push(this.indexedElements[i].node);
            }
            if (this.indexedElements[i].node === firstSelected && currentIndexStart === undefined) {
                currentIndexStart = i;
                newSelection.push(this.indexedElements[i].node);
            }
            if (this.indexedElements[i].node === lastSelected && nodeBefore) {
                currentIndexEnd = i;
                break;
            }
        }
        return newSelection;
    },

    onKeyDown: function onKeyDown(e) {
        var currentIndexStart = undefined,
            currentIndexEnd = undefined;
        var contextHolder = window.pydio.getContextHolder();
        var elementsPerLine = this.props.elementsPerLine || 1;
        var shiftKey = e.shiftKey;
        var key = e.key;

        if (contextHolder.isEmpty() || !this.indexedElements) {
            return;
        }
        var downKeys = ['ArrowDown', 'ArrowRight', 'PageDown', 'End'];

        var position = shiftKey && downKeys.indexOf(key) > -1 ? 'first' : 'last';
        var currentSelection = contextHolder.getSelectedNodes();

        var firstSelected = currentSelection[0];
        var lastSelected = currentSelection[currentSelection.length - 1];

        if (key === 'Enter') {
            this.doubleClickRow(firstSelected);
            return;
        }
        if (key === 'Delete' && global.pydio.Controller.fireActionByKey('key_delete')) {
            return;
        }

        for (var i = 0; i < this.indexedElements.length; i++) {
            if (this.indexedElements[i].node === firstSelected) {
                currentIndexStart = i;
            }
            if (this.indexedElements[i].node === lastSelected) {
                currentIndexEnd = i;
                break;
            }
        }
        var selectionIndex = undefined;
        var maxIndex = this.indexedElements.length - 1;
        var increment = key === 'PageDown' || key === 'PageUp' ? 10 : 1;
        if (key === 'ArrowDown' || key === 'PageDown') {
            selectionIndex = Math.min(currentIndexEnd + elementsPerLine * increment, maxIndex);
        } else if (key === 'ArrowUp' || key === 'PageUp') {
            selectionIndex = Math.max(currentIndexStart - elementsPerLine * increment, 0);
        } else if (key === 'Home') {
            selectionIndex = 0;
        } else if (key === 'End') {
            selectionIndex = maxIndex;
        }
        if (elementsPerLine > 1) {
            if (key === 'ArrowRight') {
                selectionIndex = currentIndexEnd + 1;
            } else if (key === 'ArrowLeft') {
                selectionIndex = currentIndexStart - 1;
            }
        }

        if (shiftKey && selectionIndex !== undefined) {
            var min = Math.min(currentIndexStart, currentIndexEnd, selectionIndex);
            var max = Math.max(currentIndexStart, currentIndexEnd, selectionIndex);
            if (min !== max) {
                var selection = [];
                for (var i = min; i < max + 1; i++) {
                    if (this.indexedElements[i]) selection.push(this.indexedElements[i].node);
                }
                contextHolder.setSelectedNodes(selection);
            }
        } else if (this.indexedElements[selectionIndex] && this.indexedElements[selectionIndex].node) {
            contextHolder.setSelectedNodes([this.indexedElements[selectionIndex].node]);
        }
    },

    getInitialState: function getInitialState() {
        this.actionsCache = { multiple: new Map() };
        if (!this.props.skipInternalDataModel) {
            this.dm = new PydioDataModel();
            this.dm.setRootNode(this.props.dataModel.getContextNode());
            this.dm.setContextNode(this.props.dataModel.getContextNode());
        } else {
            this.dm = this.props.dataModel;
        }
        var state = {
            loaded: this.props.node.isLoaded(),
            loading: !this.props.node.isLoaded(),
            showSelector: false,
            elements: this.props.node.isLoaded() ? this.buildElements(0, this.props.infiniteSliceCount) : [],
            containerHeight: this.props.containerHeight ? this.props.containerHeight : this.props.heightAutoWithMax ? 0 : 500,
            sortingInfo: this.props.defaultSortingInfo || null
        };
        if (this.props.elementHeight instanceof Object) {
            state.elementHeight = this.computeElementHeightResponsive();
        }
        state.infiniteLoadBeginBottomOffset = 200;
        return state;
    },

    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        var _this = this;

        this.indexedElements = null;
        var currentLength = Math.max(this.state.elements.length, nextProps.infiniteSliceCount);
        this.setState({
            loaded: nextProps.node.isLoaded(),
            loading: !nextProps.node.isLoaded(),
            showSelector: false,
            elements: nextProps.node.isLoaded() ? this.buildElements(0, currentLength, nextProps.node) : [],
            infiniteLoadBeginBottomOffset: 200,
            sortingInfo: this.state.sortingInfo || nextProps.defaultSortingInfo || null
        }, function () {
            if (nextProps.node.isLoaded()) _this.updateInfiniteContainerHeight();
        });
        if (!nextProps.autoRefresh && this.refreshInterval) {
            window.clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        } else if (nextProps.autoRefresh && !this.refreshInterval) {
            this.refreshInterval = window.setInterval(this.reload, nextProps.autoRefresh);
        }
        this.patchInfiniteGrid(nextProps.elementsPerLine);
        if (this.props.node && nextProps.node !== this.props.node) {
            this.observeNodeChildren(this.props.node, true);
        }
        if (this._manualScrollPe) {
            this._manualScrollPe.stop();
            this._manualScrollPe = null;
        }
    },

    observeNodeChildren: function observeNodeChildren(node) {
        var stop = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

        if (stop && !this._childrenObserver) return;

        if (!this._childrenObserver) {
            this._childrenObserver = (function () {
                this.indexedElements = null;
                this.rebuildLoadedElements();
            }).bind(this);
        }
        if (!this._childrenActionsObserver) {
            this._childrenActionsObserver = (function (eventMemo) {
                if (eventMemo.type === 'prompt-rename') {
                    this.setState({ inlineEditionForNode: eventMemo.child, inlineEditionCallback: eventMemo.callback });
                }
            }).bind(this);
        }
        if (stop) {
            node.stopObserving("child_added", this._childrenObserver);
            node.stopObserving("child_removed", this._childrenObserver);
            node.stopObserving("child_node_action", this._childrenActionsObserver);
        } else {
            node.observe("child_added", this._childrenObserver);
            node.observe("child_removed", this._childrenObserver);
            node.observe("child_node_action", this._childrenActionsObserver);
        }
    },

    _loadNodeIfNotLoaded: function _loadNodeIfNotLoaded() {
        var node = this.props.node;

        if (!node.isLoaded()) {
            node.observeOnce("loaded", (function () {
                if (!this.isMounted()) return;
                if (this.props.node === node) {
                    this.observeNodeChildren(node);
                    this.setState({
                        loaded: true,
                        loading: false,
                        elements: this.buildElements(0, this.props.infiniteSliceCount)
                    });
                }
                if (this.props.heightAutoWithMax) {
                    this.updateInfiniteContainerHeight();
                }
            }).bind(this));
            node.load();
        } else {
            this.observeNodeChildren(node);
        }
    },

    _loadingListener: function _loadingListener() {
        this.observeNodeChildren(this.props.node, true);
        this.setState({ loaded: false, loading: true });
        this.indexedElements = null;
    },
    _loadedListener: function _loadedListener() {
        var currentLength = Math.max(this.state.elements.length, this.props.infiniteSliceCount);
        this.setState({
            loading: false,
            elements: this.buildElements(0, currentLength, this.props.node)
        });
        if (this.props.heightAutoWithMax) {
            this.updateInfiniteContainerHeight();
        }
        this.observeNodeChildren(this.props.node);
    },

    reload: function reload() {
        if (this.props.reloadAtCursor && this._currentCursor) {
            this.loadStartingAtCursor();
            return;
        }
        if (this.props.clearSelectionOnReload) {
            this.props.dataModel.setSelectedNodes([]);
        }
        this._loadingListener();
        this.props.node.observeOnce("loaded", this._loadedListener);
        this.props.node.reload();
    },

    loadStartingAtCursor: function loadStartingAtCursor() {
        this._loadingListener();
        var node = this.props.node;
        var cachedChildren = node.getChildren();
        var newChildren = [];
        node.observeOnce("loaded", (function () {
            var reorderedChildren = new Map();
            newChildren.map(function (c) {
                reorderedChildren.set(c.getPath(), c);
            });
            cachedChildren.forEach(function (c) {
                reorderedChildren.set(c.getPath(), c);
            });
            node._children = reorderedChildren;
            this._loadedListener();
        }).bind(this));
        node.setLoaded(false);
        node.observe("child_added", function (newChild) {
            newChildren.push(node._children.get(newChild));
        });
        this.props.node.load(null, { cursor: this._currentCursor });
    },

    wireReloadListeners: function wireReloadListeners() {
        this.wrappedLoading = this._loadingListener;
        this.wrappedLoaded = this._loadedListener;
        this.props.node.observe("loading", this.wrappedLoading);
        this.props.node.observe("loaded", this.wrappedLoaded);
    },
    stopReloadListeners: function stopReloadListeners() {
        this.props.node.stopObserving("loading", this.wrappedLoading);
        this.props.node.stopObserving("loaded", this.wrappedLoaded);
    },

    toggleSelector: function toggleSelector() {
        // Force rebuild elements
        this.setState({
            showSelector: !this.state.showSelector,
            selection: new Map()
        }, this.rebuildLoadedElements);
    },

    toggleSelection: function toggleSelection(node) {
        var selection = this.state.selection || new Map();
        if (selection.get(node)) selection['delete'](node);else selection.set(node, true);
        if (this.refs.all_selector) this.refs.all_selector.setChecked(false);
        this.setState({
            selection: selection
        }, this.rebuildLoadedElements);
    },

    selectAll: function selectAll() {
        var _this2 = this;

        if (this.refs.all_selector && !this.refs.all_selector.isChecked()) {
            this.setState({ selection: new Map() }, this.rebuildLoadedElements);
        } else {
            (function () {
                var selection = new Map();
                _this2.props.node.getChildren().forEach((function (child) {
                    if (this.props.filterNodes && !this.props.filterNodes(child)) {
                        return;
                    }
                    if (child.isLeaf()) {
                        selection.set(child, true);
                    }
                }).bind(_this2));
                if (_this2.refs.all_selector) _this2.refs.all_selector.setChecked(true);
                _this2.setState({ selection: selection }, _this2.rebuildLoadedElements);
            })();
        }
    },

    applyMultipleAction: function applyMultipleAction(ev) {
        if (!this.state.selection || !this.state.selection.size) {
            return;
        }
        var actionName = ev.currentTarget.getAttribute('data-action');
        var dm = this.dm || new PydioDataModel();
        dm.setContextNode(this.props.node);
        var selNodes = [];
        this.state.selection.forEach(function (v, node) {
            selNodes.push(node);
        });
        dm.setSelectedNodes(selNodes);
        var a = this.props.pydio.Controller.getActionByName(actionName);
        a.fireContextChange(dm, true, this.props.pydio.user);
        a.apply([dm]);

        ev.stopPropagation();
        ev.preventDefault();
    },

    getActionsForNode: function getActionsForNode(dm, node) {
        if (!this.props.computeActionsForNode) {
            return [];
        }
        var cacheKey = node.isLeaf() ? 'file-' + node.getAjxpMime() : 'folder';
        var selectionType = node.isLeaf() ? 'file' : 'dir';
        var nodeActions = [];
        if (this.actionsCache[cacheKey]) {
            nodeActions = this.actionsCache[cacheKey];
        } else {
            dm.setSelectedNodes([node]);
            window.pydio.Controller.actions.forEach((function (a) {
                a.fireContextChange(dm, true, window.pydio.user);
                if (a.context.selection && a.context.actionBar && a.selectionContext[selectionType] && !a.deny && a.options.icon_class && (!this.props.actionBarGroups || this.props.actionBarGroups.indexOf(a.context.actionBarGroup) !== -1) && (!a.selectionContext.allowedMimes.length || a.selectionContext.allowedMimes.indexOf(node.getAjxpMime()) !== -1)) {
                    nodeActions.push(a);
                    if (node.isLeaf() && a.selectionContext.unique === false) {
                        this.actionsCache.multiple.set(a.options.name, a);
                    }
                }
            }).bind(this));
            this.actionsCache[cacheKey] = nodeActions;
        }
        return nodeActions;
    },

    updateInfiniteContainerHeight: function updateInfiniteContainerHeight() {
        var retries = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];

        if (this.props.containerHeight) {
            return this.props.containerHeight;
        }
        if (!this.refs.infiniteParent) {
            return;
        }
        var containerHeight = this.refs.infiniteParent.clientHeight;
        if (this.props.heightAutoWithMax) {
            var number = this.indexedElements ? this.indexedElements.length : this.props.node.getChildren().size;
            var elementHeight = this.state.elementHeight ? this.state.elementHeight : this.props.elementHeight;
            containerHeight = Math.min(number * elementHeight, this.props.heightAutoWithMax);
        }
        if (!containerHeight && !retries) {
            global.setTimeout((function () {
                this.updateInfiniteContainerHeight(true);
            }).bind(this), 50);
        }
        this.setState({ containerHeight: containerHeight });
    },

    computeElementHeightResponsive: function computeElementHeightResponsive() {
        var breaks = this.props.elementHeight;
        if (!(breaks instanceof Object)) {
            breaks = {
                "min-width:480px": this.props.elementHeight,
                "max-width:480px": Object.keys(this.props.tableKeys).length * 24 + 33
            };
        }
        if (window.matchMedia) {
            for (var k in breaks) {
                if (breaks.hasOwnProperty(k) && window.matchMedia('(' + k + ')').matches) {
                    return breaks[k];
                }
            }
        } else {
            var width = DOMUtils.getViewportWidth();
            if (width < 480) return breaks["max-width:480px"];else return breaks["max-width:480px"];
        }
        return 50;
    },

    updateElementHeightResponsive: function updateElementHeightResponsive() {
        var newH = this.computeElementHeightResponsive();
        if (!this.state || !this.state.elementHeight || this.state.elementHeight != newH) {
            this.setState({ elementHeight: newH }, (function () {
                if (this.props.heightAutoWithMax) {
                    this.updateInfiniteContainerHeight();
                }
            }).bind(this));
        }
    },

    patchInfiniteGrid: function patchInfiniteGrid(els) {
        if (this.refs.infinite && els > 1) {
            this.refs.infinite.state.infiniteComputer.__proto__.getDisplayIndexStart = function (windowTop) {
                return els * Math.floor(windowTop / this.heightData / els);
            };
            this.refs.infinite.state.infiniteComputer.__proto__.getDisplayIndexEnd = function (windowBottom) {
                return els * Math.ceil(windowBottom / this.heightData / els);
            };
        }
    },

    componentDidMount: function componentDidMount() {
        var _this3 = this;

        if (this.props.delayInitialLoad) {
            setTimeout(function () {
                _this3._loadNodeIfNotLoaded();
            }, this.props.delayInitialLoad);
        } else {
            this._loadNodeIfNotLoaded();
        }
        this.patchInfiniteGrid(this.props.elementsPerLine);
        if (this.refs.infiniteParent) {
            this.updateInfiniteContainerHeight();
            if (!this.props.heightAutoWithMax && !this.props.externalResize) {
                if (window.addEventListener) {
                    window.addEventListener('resize', this.updateInfiniteContainerHeight);
                } else {
                    window.attachEvent('onresize', this.updateInfiniteContainerHeight);
                }
            }
        }
        if (this.props.autoRefresh) {
            this.refreshInterval = window.setInterval(this.reload, this.props.autoRefresh);
        }
        if (this.props.observeNodeReload) {
            this.wireReloadListeners();
        }
        if (this.props.elementHeight instanceof Object || this.props.tableKeys) {
            if (window.addEventListener) {
                window.addEventListener('resize', this.updateElementHeightResponsive);
            } else {
                window.attachEvent('onresize', this.updateElementHeightResponsive);
            }
            this.updateElementHeightResponsive();
        }
        this.props.dataModel.observe('root_node_changed', function (rootNode) {
            console.log('root node changed', rootNode, _this3.props.node);
            _this3.rootNodeChangedFlag = true;
        });
        this.props.dataModel.observe('selection_changed', (function () {
            var _this4 = this;

            if (!this.isMounted()) return;
            var selection = new Map();
            var selectedNodes = this.props.dataModel.getSelectedNodes();
            selectedNodes.map(function (n) {
                selection.set(n, true);
            });
            this.setState({ selection: selection }, function () {
                _this4.rebuildLoadedElements();
                if (selectedNodes.length === 1) {
                    _this4.scrollToView(selectedNodes[0]);
                }
            });
        }).bind(this));
    },

    componentWillUnmount: function componentWillUnmount() {
        if (!this.props.heightAutoWithMax) {
            if (window.removeEventListener) {
                window.removeEventListener('resize', this.updateInfiniteContainerHeight);
            } else {
                window.detachEvent('onresize', this.updateInfiniteContainerHeight);
            }
        }
        if (this.props.elementHeight instanceof Object || this.props.tableKeys) {
            if (window.removeEventListener) {
                window.removeEventListener('resize', this.updateElementHeightResponsive);
            } else {
                window.detachEvent('resize', this.updateElementHeightResponsive);
            }
        }
        if (this.refreshInterval) {
            window.clearInterval(this.refreshInterval);
        }
        if (this.props.observeNodeReload) {
            this.stopReloadListeners();
        }
        if (this.props.node) {
            this.observeNodeChildren(this.props.node, true);
        }
    },

    componentDidUpdate: function componentDidUpdate(prevProps, prevState) {
        if (!this.rootNodeChangedFlag && prevProps.node && this.props.node && prevProps.node.getPath() === this.props.node.getPath()) {
            return;
        }
        this._loadNodeIfNotLoaded();
        this.rootNodeChangedFlag = false;
    },

    onScroll: function onScroll(scrollTop) {

        if (!this.props.passScrollingStateToChildren) {
            return;
        }
        // Maintains a series of timeouts to set this.state.isScrolling
        // to be true when the element is scrolling.

        if (this.state.scrollTimeout) {
            clearTimeout(this.state.scrollTimeout);
        }

        var that = this,
            scrollTimeout = setTimeout(function () {
            that.setState({
                isScrolling: false,
                scrollTimeout: undefined
            });
        }, 150);

        this.setState({
            isScrolling: true,
            scrollTimeout: scrollTimeout
        });
    },

    scrollToLast: function scrollToLast() {
        if (this.indexedElements && this.indexedElements[this.indexedElements.length - 1].node) {
            this.scrollToView(this.indexedElements[this.indexedElements.length - 1].node);
        }
    },

    scrollToView: function scrollToView(node) {
        var _this5 = this;

        if (!this.indexedElements || !this.refs.infinite || !this.refs.infinite.scrollable) return;
        var scrollable = this.refs.infinite.scrollable;
        var visibleFrame = {
            top: scrollable.scrollTop + this.props.elementHeight / 2,
            bottom: scrollable.scrollTop + this.state.containerHeight - this.props.elementHeight / 2
        };
        var realMaxScrollTop = this.indexedElements.length * this.props.elementHeight - this.state.containerHeight;

        var position = -1;
        this.indexedElements.forEach(function (e, k) {
            if (e.node && e.node === node) position = k;
        });
        if (position === -1) return;
        var elementHeight = this.props.elementHeight;
        var scrollTarget = position * elementHeight;

        if (scrollTarget > visibleFrame.top && scrollTarget < visibleFrame.bottom) {
            // already visible;
            return;
        } else if (scrollTarget >= visibleFrame.bottom) {
            scrollTarget -= this.state.containerHeight - elementHeight * 2;
        }
        scrollTarget = Math.min(scrollTarget, realMaxScrollTop);
        scrollable.scrollTop = scrollTarget;
        if (this._manualScrollPe) this._manualScrollPe.stop();
        if (scrollable.scrollHeight < scrollTarget) {
            this._manualScrollPe = new PeriodicalExecuter(function () {
                scrollable.scrollTop = scrollTarget;
                if (scrollable.scrollHeight >= scrollTarget) {
                    _this5._manualScrollPe.stop();
                    _this5._manualScrollPe = null;
                }
            }, .25);
        }
    },

    buildElementsFromNodeEntries: function buildElementsFromNodeEntries(nodeEntries, showSelector) {

        var components = [],
            index = 0;
        var nodeEntriesLength = nodeEntries.length;
        nodeEntries.forEach((function (entry) {
            var data = undefined;
            if (entry.parent) {
                data = {
                    node: entry.node,
                    key: entry.node.getPath(),
                    id: entry.node.getPath(),
                    mainIcon: SimpleList.PARENT_FOLDER_ICON,
                    firstLine: "..",
                    className: "list-parent-node",
                    secondLine: this.context.getMessage('react.1'),
                    onClick: this.clickRow,
                    onDoubleClick: this.doubleClickRow,
                    showSelector: false,
                    selectorDisabled: true,
                    noHover: false
                };
                if (this.props.entryRenderParentIcon && !this.props.tableKeys) {
                    data['iconCell'] = this.props.entryRenderParentIcon(entry.node, entry);
                } else {
                    data['mainIcon'] = SimpleList.PARENT_FOLDER_ICON;
                }
                if (this.props.elementStyle) {
                    data['style'] = this.props.elementStyle;
                }
                if (this.props.passScrollingStateToChildren) {
                    data['parentIsScrolling'] = this.state.isScrolling;
                }
                components.push(React.createElement(_ListEntry.ListEntry, data));
            } else if (entry.groupHeader) {
                var id = entry.groupHeader,
                    firstLine = entry.groupHeaderLabel;
                if (this.props.entryRenderGroupHeader) {
                    firstLine = this.props.entryRenderGroupHeader(id, firstLine);
                }
                data = {
                    node: null,
                    key: entry.groupHeader,
                    id: id,
                    mainIcon: null,
                    firstLine: firstLine,
                    className: 'list-group-header',
                    onClick: null,
                    showSelector: false,
                    selectorDisabled: true,
                    noHover: true
                };
                if (this.props.passScrollingStateToChildren) {
                    data['parentIsScrolling'] = this.state.isScrolling;
                }
                components.push(React.createElement(_ListEntry.ListEntry, data));
            } else {
                data = {
                    node: entry.node,
                    onClick: this.clickRow,
                    onDoubleClick: this.doubleClickRow,
                    onSelect: this.toggleSelection,
                    key: entry.node.getPath(),
                    id: entry.node.getPath(),
                    renderIcon: this.props.entryRenderIcon,
                    renderFirstLine: this.props.entryRenderFirstLine,
                    renderSecondLine: this.props.entryRenderSecondLine,
                    renderThirdLine: this.props.entryRenderThirdLine,
                    renderActions: this.props.entryRenderActions,
                    showSelector: showSelector,
                    selected: this.state && this.state.selection ? this.state.selection.get(entry.node) : false,
                    actions: React.createElement(_viewsSimpleReactActionBar2['default'], { node: entry.node, actions: entry.actions, dataModel: this.dm }),
                    selectorDisabled: !(this.props.entryEnableSelector ? this.props.entryEnableSelector(entry.node) : entry.node.isLeaf())
                };
                data['isFirst'] = index === 0;
                data['isLast'] = index === nodeEntriesLength - 1;
                index++;
                if (this.props.elementStyle) {
                    data['style'] = this.props.elementStyle;
                }
                if (this.props.passScrollingStateToChildren) {
                    data['parentIsScrolling'] = this.state.isScrolling;
                }
                if (this.props.renderCustomEntry) {

                    components.push(this.props.renderCustomEntry(data));
                } else if (this.props.tableKeys) {

                    if (this.props.defaultGroupBy) {
                        data['tableKeys'] = LangUtils.deepCopy(this.props.tableKeys);
                        delete data['tableKeys'][this.props.defaultGroupBy];
                    } else {
                        data['tableKeys'] = this.props.tableKeys;
                    }
                    components.push(React.createElement(_TableListEntry2['default'], data));
                } else {

                    components.push(React.createElement(_ConfigurableListEntry2['default'], data));
                }
            }
        }).bind(this));

        return components;
    },

    buildElements: function buildElements(start, end, node, showSelector) {
        var _this6 = this;

        var theNode = this.props.node;
        if (node) theNode = node;
        var theShowSelector = this.state && this.state.showSelector;
        if (showSelector !== undefined) theShowSelector = showSelector;

        if (!this.indexedElements || this.indexedElements.length !== theNode.getChildren().size) {
            (function () {
                _this6.indexedElements = [];
                var groupBy = undefined,
                    groupByLabel = undefined,
                    groups = undefined,
                    groupKeys = undefined,
                    groupLabels = undefined;
                if (_this6.props.defaultGroupBy) {
                    groupBy = _this6.props.defaultGroupBy;
                    groupByLabel = _this6.props.groupByLabel || false;
                    groups = {}, groupKeys = [], groupLabels = {};
                }

                if (!_this6.props.skipParentNavigation && theNode.getParent() && (_this6.props.dataModel.getContextNode() !== theNode || _this6.props.skipInternalDataModel)) {
                    _this6.indexedElements.push({ node: theNode.getParent(), parent: true, actions: null });
                }

                theNode.getChildren().forEach((function (child) {
                    if (child.getMetadata().has('cursor')) {
                        var childCursor = parseInt(child.getMetadata().get('cursor'));
                        this._currentCursor = Math.max(this._currentCursor ? this._currentCursor : 0, childCursor);
                    }
                    if (this.props.filterNodes && !this.props.filterNodes(child)) {
                        return;
                    }
                    var nodeActions = this.getActionsForNode(this.dm, child);
                    if (groupBy) {
                        var groupValue = child.getMetadata().get(groupBy) || 'N/A';
                        if (!groups[groupValue]) {
                            groups[groupValue] = [];
                            groupKeys.push(groupValue);
                        }
                        if (groupByLabel && child.getMetadata().has(groupByLabel) && !groupLabels[groupValue]) {
                            groupLabels[groupValue] = child.getMetadata().get(groupByLabel);
                        }
                        groups[groupValue].push({ node: child, parent: false, actions: nodeActions });
                    } else {
                        this.indexedElements.push({ node: child, parent: false, actions: nodeActions });
                    }
                }).bind(_this6));

                if (groupBy) {
                    groupKeys = groupKeys.sort();
                    groupKeys.map((function (k) {
                        var label = k;
                        if (groupLabels[k]) {
                            label = groupLabels[k];
                        } else if (this.props.renderGroupLabels) {
                            label = this.props.renderGroupLabels(groupBy, k);
                        }
                        this.indexedElements.push({
                            node: null,
                            groupHeader: k,
                            groupHeaderLabel: label,
                            parent: false,
                            actions: null
                        });
                        this.indexedElements = this.indexedElements.concat(groups[k]);
                    }).bind(_this6));
                }
            })();
        }

        if (this.state && this.state.sortingInfo && !this.remoteSortingInfo()) {
            (function () {
                var _state$sortingInfo2 = _this6.state.sortingInfo;
                var attribute = _state$sortingInfo2.attribute;
                var direction = _state$sortingInfo2.direction;
                var sortType = _state$sortingInfo2.sortType;

                var sortFunction = undefined;
                if (sortType === 'file-natural') {
                    sortFunction = function (a, b) {
                        if (a.parent) {
                            return -1;
                        }
                        if (b.parent) {
                            return 1;
                        }
                        var nodeA = a.node;
                        var nodeB = b.node;
                        // Recycle always last
                        if (nodeA.isRecycle()) return 1;
                        if (nodeB.isRecycle()) return -1;
                        // Folders first
                        var aLeaf = nodeA.isLeaf();
                        var bLeaf = nodeB.isLeaf();
                        var res = aLeaf && !bLeaf ? 1 : !aLeaf && bLeaf ? -1 : 0;
                        if (res !== 0) return res;
                        res = nodeA.getLabel().localeCompare(nodeB.getLabel());
                        return res;
                    };
                } else {
                    sortFunction = function (a, b) {
                        if (a.parent) {
                            return -1;
                        }
                        var aMeta = a.node.getMetadata().get(attribute) || "";
                        var bMeta = b.node.getMetadata().get(attribute) || "";
                        var res = undefined;
                        if (sortType === 'number') {
                            aMeta = parseFloat(aMeta);
                            bMeta = parseFloat(bMeta);
                            res = direction === 'asc' ? aMeta - bMeta : bMeta - aMeta;
                        } else if (sortType === 'string') {
                            res = direction === 'asc' ? aMeta.localeCompare(bMeta) : bMeta.localeCompare(aMeta);
                        }
                        if (res === 0) {
                            // Resort by label to make it stable
                            var labComp = a.node.getLabel().localeCompare(b.node.getLabel());
                            res = direction === 'asc' ? labComp : -labComp;
                        }
                        return res;
                    };
                }
                _this6.indexedElements.sort(sortFunction);
            })();
        }

        if (this.props.elementPerLine > 1) {
            end = end * this.props.elementPerLine;
            start = start * this.props.elementPerLine;
        }
        return this.indexedElements.slice(start, end);
    },

    rebuildLoadedElements: function rebuildLoadedElements() {
        var newElements = this.buildElements(0, Math.max(this.state.elements.length, this.props.infiniteSliceCount));
        var infiniteLoadBeginBottomOffset = newElements.length ? 200 : 0;
        this.setState({
            elements: newElements,
            infiniteLoadBeginBottomOffset: infiniteLoadBeginBottomOffset
        });
        this.updateInfiniteContainerHeight();
    },

    handleInfiniteLoad: function handleInfiniteLoad() {
        var elemLength = this.state.elements.length;
        var newElements = this.buildElements(elemLength, elemLength + this.props.infiniteSliceCount);
        var infiniteLoadBeginBottomOffset = newElements.length ? 200 : 0;
        this.setState({
            isInfiniteLoading: false,
            elements: this.state.elements.concat(newElements),
            infiniteLoadBeginBottomOffset: infiniteLoadBeginBottomOffset
        });
    },

    /**
     * Extract remote sorting info from current node metadata
     */
    remoteSortingInfo: function remoteSortingInfo() {
        var meta = this.props.node.getMetadata().get('paginationData');
        if (meta && meta.get('total') > 1 && meta.has('remote_order')) {
            var col = meta.get('currentOrderCol');
            var dir = meta.get('currentOrderDir');
            if (col && dir) {
                return {
                    remote: true,
                    attribute: col,
                    direction: dir
                };
            }
        }
        return null;
    },

    renderToolbar: function renderToolbar() {
        var _this7 = this;

        var rightButtons = [React.createElement(_materialUi.FontIcon, {
            key: 1,
            tooltip: 'Reload',
            className: "mdi mdi-reload" + (this.state.loading ? " rotating" : ""),
            onClick: this.reload
        })];
        var i = 2;
        if (this.props.sortKeys) {

            var sortingInfo = undefined,
                remoteSortingInfo = this.remoteSortingInfo();
            if (remoteSortingInfo) {
                sortingInfo = remoteSortingInfo;
            } else {
                sortingInfo = this.state ? this.state.sortingInfo : null;
            }
            rightButtons.push(React.createElement(_SortColumns2['default'], {
                key: i,
                displayMode: 'menu',
                tableKeys: this.props.sortKeys,
                columnClicked: this.onColumnSort,
                sortingInfo: sortingInfo
            }));
            i++;
        }
        if (this.props.additionalActions) {
            rightButtons.push(this.props.additionalActions);
        }

        var leftToolbar = undefined,
            paginator = undefined;
        if (this.props.node.getMetadata().get("paginationData") && this.props.node.getMetadata().get("paginationData").get('total') > 1) {
            paginator = React.createElement(_ListPaginator2['default'], { dataModel: this.dm, node: this.props.node });
        }

        if (this.props.listTitle) {
            leftToolbar = React.createElement(
                _materialUi.ToolbarGroup,
                { key: 0, float: 'left' },
                React.createElement(
                    'div',
                    { className: 'list-title' },
                    this.props.listTitle
                )
            );
        }

        if (this.props.searchResultData) {

            leftToolbar = React.createElement(
                _materialUi.ToolbarGroup,
                { key: 0, float: 'left' },
                React.createElement(
                    'div',
                    { style: { fontSize: 15, fontWeight: 500, color: '#9e9e9e' } },
                    this.context.getMessage('react.3').replace('%s', this.props.searchResultData.term)
                )
            );
            rightButtons = React.createElement(_materialUi.RaisedButton, { key: 1, label: this.context.getMessage('react.4'), primary: true, onTouchTap: this.props.searchResultData.toggleState, style: { marginRight: -10 } });
        } else if (this.actionsCache.multiple.size || this.props.multipleActions) {
            var bulkLabel = this.context.getMessage('react.2');
            var hiddenStyle = {
                transform: 'translateX(-80px)'
            };
            var cbStyle = _extends({ width: 24 }, hiddenStyle);
            var buttonStyle = _extends({}, hiddenStyle);
            if (this.state.showSelector) {
                cbStyle = { width: 24, transform: 'translateX(-12px)' };
                buttonStyle = { transform: 'translateX(-40px)' };
            }
            if (this.state.selection && this.state.showSelector) {
                bulkLabel += " (" + this.state.selection.size + ")";
            }
            leftToolbar = React.createElement(
                _materialUi.ToolbarGroup,
                { key: 0, float: 'left', className: 'hide-on-vertical-layout' },
                React.createElement(_materialUi.Checkbox, { ref: 'all_selector', onClick: this.selectAll, style: cbStyle }),
                React.createElement(_materialUi.FlatButton, { label: bulkLabel, onClick: this.toggleSelector, style: buttonStyle })
            );

            if (this.state.showSelector) {
                (function () {
                    rightButtons = [];
                    var index = 0;
                    var actions = _this7.props.multipleActions || _this7.actionsCache.multiple;
                    actions.forEach((function (a) {
                        rightButtons.push(React.createElement(_materialUi.RaisedButton, {
                            key: index,
                            label: a.options.text,
                            'data-action': a.options.name,
                            onClick: this.applyMultipleAction,
                            primary: true }));
                    }).bind(_this7));
                    rightButtons = React.createElement(
                        'span',
                        null,
                        rightButtons
                    );
                })();
            }
        }

        return React.createElement(
            _materialUi.Toolbar,
            { style: this.props.toolbarStyle },
            leftToolbar,
            React.createElement(
                _materialUi.ToolbarGroup,
                { key: 1, float: 'right' },
                paginator,
                rightButtons
            )
        );
    },

    render: function render() {
        var _this8 = this;

        var containerClasses = "material-list vertical-layout layout-fill";
        if (this.props.className) {
            containerClasses += " " + this.props.className;
        }
        if (this.state.showSelector) {
            containerClasses += " list-show-selectors";
        }
        if (this.props.tableKeys) {
            containerClasses += " table-mode";
        }
        var toolbar = undefined;
        if (this.props.tableKeys) {
            var tableKeys = undefined;
            if (this.props.defaultGroupBy) {
                tableKeys = LangUtils.deepCopy(this.props.tableKeys);
                delete tableKeys[this.props.defaultGroupBy];
            } else {
                tableKeys = this.props.tableKeys;
            }
            var sortingInfo = undefined,
                remoteSortingInfo = this.remoteSortingInfo();
            if (remoteSortingInfo) {
                sortingInfo = remoteSortingInfo;
            } else {
                sortingInfo = this.state ? this.state.sortingInfo : null;
            }
            toolbar = React.createElement(_TableListHeader2['default'], {
                tableKeys: tableKeys,
                loading: this.state.loading,
                reload: this.reload,
                ref: 'loading_indicator',
                dm: this.props.dataModel,
                node: this.props.node,
                additionalActions: this.props.additionalActions,
                onHeaderClick: this.onColumnSort,
                sortingInfo: sortingInfo
            });
        } else {
            toolbar = this.props.customToolbar ? this.props.customToolbar : !this.props.hideToolbar ? this.renderToolbar() : null;
        }

        var inlineEditor = undefined;
        if (this.state.inlineEditionForNode) {
            inlineEditor = React.createElement(_InlineEditor2['default'], {
                detached: true,
                node: this.state.inlineEditionForNode,
                callback: this.state.inlineEditionCallback,
                onClose: function () {
                    _this8.setState({ inlineEditionForNode: null });
                }
            });
        }

        var emptyState = undefined;
        var _props = this.props;
        var emptyStateProps = _props.emptyStateProps;
        var node = _props.node;

        if (emptyStateProps && this.props.node.isLoaded() && !this.props.node.isLoading() && (!this.state.elements.length || this.state.elements.length === 1 && this.state.elements[0].parent)) {

            var actionProps = {};
            if (this.state.elements.length === 1 && this.state.elements[0].parent) {
                (function () {
                    var parentNode = _this8.state.elements[0].node;
                    actionProps = {
                        actionLabelId: 'react.1',
                        actionIconClassName: SimpleList.PARENT_FOLDER_ICON,
                        actionCallback: function actionCallback(e) {
                            if (_this8.props.entryHandleClicks) {
                                _this8.props.entryHandleClicks(parentNode, SimpleList.CLICK_TYPE_DOUBLE, e);
                            }
                        }
                    };
                })();
            }
            emptyState = React.createElement(_viewsEmptyStateView2['default'], _extends({}, emptyStateProps, actionProps));
        } else if (emptyStateProps && emptyStateProps.checkEmptyState && emptyStateProps.checkEmptyState(this.props.node)) {

            emptyState = React.createElement(_viewsEmptyStateView2['default'], emptyStateProps);
        }

        var elements = this.buildElementsFromNodeEntries(this.state.elements, this.state.showSelector);

        return React.createElement(
            'div',
            { className: containerClasses, onContextMenu: this.contextMenuResponder, tabIndex: '0', onKeyDown: this.onKeyDown, style: this.props.style },
            toolbar,
            inlineEditor,
            React.createElement(
                'div',
                { className: this.props.heightAutoWithMax ? "infinite-parent-smooth-height" : emptyState ? "layout-fill vertical_layout" : "layout-fill", ref: 'infiniteParent' },
                !emptyState && !this.props.verticalScroller && React.createElement(
                    Infinite,
                    {
                        elementHeight: this.state.elementHeight ? this.state.elementHeight : this.props.elementHeight,
                        containerHeight: this.state.containerHeight ? this.state.containerHeight : 1,
                        infiniteLoadBeginEdgeOffset: this.state.infiniteLoadBeginBottomOffset,
                        onInfiniteLoad: this.handleInfiniteLoad,
                        handleScroll: this.onScroll,
                        ref: 'infinite'
                    },
                    elements
                ),
                !emptyState && this.props.verticalScroller && React.createElement(
                    _reactScrollbar2['default'],
                    {
                        speed: 0.8,
                        horizontalScroll: false,
                        style: { height: this.state.containerHeight },
                        verticalScrollbarStyle: { borderRadius: 10, width: 6 },
                        verticalContainerStyle: { width: 8 }
                    },
                    React.createElement(
                        'div',
                        null,
                        elements
                    )
                ),
                emptyState
            )
        );
    }

});

exports['default'] = SimpleList;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../util/MessagesConsumerMixin":59,"../views/EmptyStateView":60,"../views/SimpleReactActionBar":62,"./ConfigurableListEntry":19,"./InlineEditor":20,"./ListEntry":21,"./ListPaginator":23,"./SortColumns":27,"./TableListEntry":29,"./TableListHeader":30,"material-ui":"material-ui","pydio/model/data-model":"pydio/model/data-model","pydio/util/dom":"pydio/util/dom","pydio/util/lang":"pydio/util/lang","pydio/util/periodical-executer":"pydio/util/periodical-executer","react":"react","react-infinite":"react-infinite","react-scrollbar":1}],27:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _menuIconButtonMenu = require('../menu/IconButtonMenu');

var _menuIconButtonMenu2 = _interopRequireDefault(_menuIconButtonMenu);

var React = require('react');
var Pydio = require('pydio');

var _Pydio$requireLib = Pydio.requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;

var _require = require('material-ui-legacy');

var ToolbarGroup = _require.ToolbarGroup;

var SortColumns = React.createClass({
    displayName: 'SortColumns',

    propTypes: {
        tableKeys: React.PropTypes.object.isRequired,
        columnClicked: React.PropTypes.func,
        sortingInfo: React.PropTypes.object,
        displayMode: React.PropTypes.string
    },

    onMenuClicked: function onMenuClicked(object) {
        this.props.columnClicked(object.payload);
    },

    onHeaderClick: function onHeaderClick(key, callback) {
        var data = this.props.tableKeys[key];
        if (data && data['sortType'] && this.props.columnClicked) {
            data['name'] = key;
            this.props.columnClicked(data, callback);
        }
    },

    getColumnsItems: function getColumnsItems(displayMode) {
        var _this = this;

        var controller = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

        var items = [];
        var _callback = function _callback() {
            if (controller) {
                controller.notify('actions_refreshed');
            }
        };

        var _loop = function (key) {
            if (!_this.props.tableKeys.hasOwnProperty(key)) return 'continue';
            var data = _this.props.tableKeys[key];
            var style = data['width'] ? { width: data['width'] } : null;
            var icon = undefined;
            var className = 'cell header_cell cell-' + key;
            if (data['sortType']) {
                className += ' sortable';
                if (_this.props.sortingInfo && (_this.props.sortingInfo.attribute === key || _this.props.sortingInfo.attribute === data['sortAttribute'] || _this.props.sortingInfo.attribute === data['remoteSortAttribute'])) {
                    icon = _this.props.sortingInfo.direction === 'asc' ? 'mdi mdi-arrow-up' : 'mdi mdi-arrow-down';
                    className += ' active-sort-' + _this.props.sortingInfo.direction;
                }
            }
            if (displayMode === 'menu') {
                data['name'] = key;
                items.push({
                    payload: data,
                    text: data['label'],
                    iconClassName: icon
                });
            } else if (displayMode === 'menu_data') {
                items.push({
                    name: data['label'],
                    callback: function callback() {
                        _this.onHeaderClick(key, _callback);
                    },
                    icon_class: icon || '__INSET__'
                });
            } else {
                items.push(React.createElement(
                    'span',
                    {
                        key: key,
                        className: className,
                        style: style,
                        onClick: function () {
                            _this.onHeaderClick(key, _callback);
                        }
                    },
                    data['label']
                ));
            }
        };

        for (var key in this.props.tableKeys) {
            var _ret = _loop(key);

            if (_ret === 'continue') continue;
        }
        return items;
    },

    buildSortingMenuItems: function buildSortingMenuItems(controller) {
        return this.getColumnsItems('menu_data', controller);
    },

    componentDidMount: function componentDidMount() {

        var sortAction = new Action({
            name: 'sort_action',
            icon_class: 'mdi mdi-sort-descending',
            text_id: 450,
            title_id: 450,
            text: this.props.getMessage(450),
            title: this.props.getMessage(450),
            hasAccessKey: false,
            subMenu: true,
            subMenuUpdateImage: true
        }, {
            selection: false,
            dir: true,
            actionBar: true,
            actionBarGroup: 'display_toolbar',
            contextMenu: false,
            infoPanel: false
        }, {}, {}, {
            dynamicBuilder: this.buildSortingMenuItems
        });
        var buttons = new Map();
        buttons.set('sort_action', sortAction);
        this.props.pydio.getController().updateGuiActions(buttons);
    },

    componentWillUnmount: function componentWillUnmount() {
        this.props.pydio.getController().deleteFromGuiActions('sort_action');
    },

    render: function render() {
        if (this.props.displayMode === 'menu') {
            return React.createElement(_menuIconButtonMenu2['default'], { buttonTitle: 'Sort by...', buttonClassName: 'mdi mdi-sort-descending', menuItems: this.getColumnsItems('menu', this.props.pydio.getController()), onMenuClicked: this.onMenuClicked });
        } else {
            return React.createElement(
                ToolbarGroup,
                { float: 'left' },
                this.getColumnsItems('header', this.props.pydio.getController())
            );
        }
    }
});

exports['default'] = SortColumns = PydioContextConsumer(SortColumns);
exports['default'] = SortColumns;
module.exports = exports['default'];

},{"../menu/IconButtonMenu":34,"material-ui-legacy":"material-ui-legacy","pydio":"pydio","react":"react"}],28:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;

var _utilDND = require('../util/DND');

/***************************/
/* REACT DND SORTABLE LIST
 /**************************/
/**
 * Specifies the drag source contract.
 * Only `beginDrag` function is required.
 */
var sortableItemSource = {
    beginDrag: function beginDrag(props) {
        // Return the data describing the dragged item
        return { id: props.id };
    },
    endDrag: function endDrag(props) {
        props.endSwitching();
    }
};

var sortableItemTarget = {

    hover: function hover(props, monitor) {
        var draggedId = monitor.getItem().id;
        if (draggedId !== props.id) {
            props.switchItems(draggedId, props.id);
        }
    }

};

var sortableItem = React.createClass({
    displayName: "sortableItem",

    propTypes: {
        connectDragSource: React.PropTypes.func.isRequired,
        connectDropTarget: React.PropTypes.func.isRequired,
        isDragging: React.PropTypes.bool.isRequired,
        id: React.PropTypes.any.isRequired,
        label: React.PropTypes.string.isRequired,
        switchItems: React.PropTypes.func.isRequired,
        removable: React.PropTypes.bool,
        onRemove: React.PropTypes.func
    },

    removeClicked: function removeClicked() {
        this.props.onRemove(this.props.id);
    },

    render: function render() {
        // Your component receives its own props as usual
        var id = this.props.id;

        // These two props are injected by React DnD,
        // as defined by your `collect` function above:
        var isDragging = this.props.isDragging;
        var connectDragSource = this.props.connectDragSource;
        var connectDropTarget = this.props.connectDropTarget;

        var remove;
        if (this.props.removable) {
            remove = React.createElement("span", { className: "button mdi mdi-close", onClick: this.removeClicked });
        }
        return React.createElement(
            ReactMUI.Paper,
            {
                ref: function (instance) {
                    connectDropTarget(ReactDOM.findDOMNode(instance));
                    connectDragSource(ReactDOM.findDOMNode(instance));
                },
                zDepth: 1,
                style: { opacity: isDragging ? 0 : 1 }
            },
            React.createElement(
                "div",
                { className: this.props.className },
                this.props.label,
                remove
            )
        );
    }
});

var NonDraggableListItem = React.createClass({
    displayName: "NonDraggableListItem",

    render: function render() {
        var remove;
        if (this.props.removable) {
            remove = React.createElement("span", { className: "button mdi mdi-close", onClick: this.removeClicked });
        }
        return React.createElement(
            ReactMUI.Paper,
            { zDepth: 1 },
            React.createElement(
                "div",
                { className: this.props.className },
                this.props.label,
                remove
            )
        );
    }
});

var DraggableListItem;
if (window.ReactDND) {
    DraggableListItem = ReactDND.flow(ReactDND.DragSource(_utilDND.Types.SORTABLE_LIST_ITEM, sortableItemSource, _utilDND.collect), ReactDND.DropTarget(_utilDND.Types.SORTABLE_LIST_ITEM, sortableItemTarget, _utilDND.collectDrop))(sortableItem);
} else {
    DraggableListItem = NonDraggableListItem;
}

var SortableList = React.createClass({
    displayName: "SortableList",

    propTypes: {
        values: React.PropTypes.array.isRequired,
        onOrderUpdated: React.PropTypes.func,
        removable: React.PropTypes.bool,
        onRemove: React.PropTypes.func,
        className: React.PropTypes.string,
        itemClassName: React.PropTypes.string
    },

    getInitialState: function getInitialState() {
        return { values: this.props.values };
    },
    componentWillReceiveProps: function componentWillReceiveProps(props) {
        this.setState({ values: props.values, switchData: null });
    },

    findItemIndex: function findItemIndex(itemId, data) {
        for (var i = 0; i < data.length; i++) {
            if (data[i]['payload'] == itemId) {
                return i;
            }
        }
    },

    switchItems: function switchItems(oldId, newId) {
        var oldIndex = this.findItemIndex(oldId, this.state.values);
        var oldItem = this.state.values[oldIndex];
        var newIndex = this.findItemIndex(newId, this.state.values);
        var newItem = this.state.values[newIndex];

        var currentValues = this.state.values.slice();
        currentValues[oldIndex] = newItem;
        currentValues[newIndex] = oldItem;

        // Check that it did not come back to original state
        var oldPrevious = this.findItemIndex(oldId, this.props.values);
        var newPrevious = this.findItemIndex(newId, this.props.values);
        if (oldPrevious == newIndex && newPrevious == oldIndex) {
            this.setState({ values: currentValues, switchData: null });
            //console.log("no more moves");
        } else {
                this.setState({ values: currentValues, switchData: { oldId: oldId, newId: newId } });
                //console.log({oldId:oldIndex, newId:newIndex});
            }
    },

    endSwitching: function endSwitching() {
        if (this.state.switchData) {
            // Check that it did not come back to original state
            if (this.props.onOrderUpdated) {
                this.props.onOrderUpdated(this.state.switchData.oldId, this.state.switchData.newId, this.state.values);
            }
        }
        this.setState({ switchData: null });
    },

    render: function render() {
        var switchItems = this.switchItems;
        return React.createElement(
            "div",
            { className: this.props.className },
            this.state.values.map((function (item) {
                return React.createElement(DraggableListItem, {
                    id: item.payload,
                    key: item.payload,
                    label: item.text,
                    switchItems: switchItems,
                    endSwitching: this.endSwitching,
                    removable: this.props.removable,
                    onRemove: this.props.onRemove,
                    className: this.props.itemClassName
                });
            }).bind(this))
        );
    }
});

exports["default"] = SortableList;
module.exports = exports["default"];

},{"../util/DND":58}],29:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _ListEntryNodeListenerMixin = require('./ListEntryNodeListenerMixin');

var _ListEntryNodeListenerMixin2 = _interopRequireDefault(_ListEntryNodeListenerMixin);

var _ListEntry = require('./ListEntry');

var _InlineEditor = require('./InlineEditor');

var _InlineEditor2 = _interopRequireDefault(_InlineEditor);

var _pydioUtilPath = require('pydio/util/path');

var _pydioUtilPath2 = _interopRequireDefault(_pydioUtilPath);

var _require$requireLib = require('pydio').requireLib('boot');

var moment = _require$requireLib.moment;

/**
 * Specific list entry rendered as a table row. Not a real table, CSS used.
 */
exports['default'] = React.createClass({
    displayName: 'TableListEntry',

    mixins: [_ListEntryNodeListenerMixin2['default']],

    propTypes: {
        node: React.PropTypes.instanceOf(AjxpNode),
        tableKeys: React.PropTypes.object.isRequired,
        renderActions: React.PropTypes.func
        // See also ListEntry nodes
    },

    render: function render() {
        var _this = this;

        var actions = this.props.actions;
        if (this.props.renderActions) {
            actions = this.props.renderActions(this.props.node);
        }

        var cells = [];
        var firstKey = true;
        var meta = this.props.node.getMetadata();
        for (var key in this.props.tableKeys) {
            if (!this.props.tableKeys.hasOwnProperty(key)) {
                continue;
            }

            var data = this.props.tableKeys[key];
            var style = data['width'] ? { width: data['width'] } : null;
            var value = undefined,
                rawValue = undefined;
            if (data.renderCell) {
                data['name'] = key;
                value = data.renderCell(this.props.node, data);
            } else if (key === 'ajxp_modiftime') {
                var mDate = moment(parseFloat(meta.get('ajxp_modiftime')) * 1000);
                var dateString = mDate.calendar();
                if (dateString.indexOf('/') > -1) {
                    dateString = mDate.fromNow();
                }
                value = dateString;
            } else if (key === 'bytesize') {
                value = _pydioUtilPath2['default'].roundFileSize(parseInt(meta.get(key)));
            } else {
                value = meta.get(key);
            }
            rawValue = meta.get(key);
            var inlineEditor = undefined;
            if (this.state && this.state.inlineEdition && firstKey) {
                inlineEditor = React.createElement(_InlineEditor2['default'], {
                    node: this.props.node,
                    onClose: function () {
                        _this.setState({ inlineEdition: false });
                    },
                    callback: this.state.inlineEditionCallback
                });
                var _style = this.props.style || {};
                _style.position = 'relative';
                this.props.style = _style;
            }
            cells.push(React.createElement(
                'span',
                { key: key, className: 'cell cell-' + key, title: rawValue, style: style, 'data-label': data['label'] },
                inlineEditor,
                value
            ));
            firstKey = false;
        }

        return React.createElement(_ListEntry.DragDropListEntry, _extends({}, this.props, {
            iconCell: null,
            firstLine: cells,
            actions: actions
        }));
    }

});
module.exports = exports['default'];

},{"./InlineEditor":20,"./ListEntry":21,"./ListEntryNodeListenerMixin":22,"pydio":"pydio","pydio/util/path":"pydio/util/path"}],30:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _utilMessagesConsumerMixin = require('../util/MessagesConsumerMixin');

var _utilMessagesConsumerMixin2 = _interopRequireDefault(_utilMessagesConsumerMixin);

var _SortColumns = require('./SortColumns');

var _SortColumns2 = _interopRequireDefault(_SortColumns);

var _ListPaginator = require('./ListPaginator');

var _ListPaginator2 = _interopRequireDefault(_ListPaginator);

/**
 * Specific header for Table layout, reading metadata from node and using keys
 */
exports['default'] = React.createClass({
    displayName: 'TableListHeader',

    mixins: [_utilMessagesConsumerMixin2['default']],

    propTypes: {
        tableKeys: React.PropTypes.object.isRequired,
        loading: React.PropTypes.bool,
        reload: React.PropTypes.func,
        dm: React.PropTypes.instanceOf(PydioDataModel),
        node: React.PropTypes.instanceOf(AjxpNode),
        onHeaderClick: React.PropTypes.func,
        sortingInfo: React.PropTypes.object
    },

    render: function render() {
        var headers = undefined,
            paginator = undefined;
        if (this.props.node.getMetadata().get("paginationData") && this.props.node.getMetadata().get("paginationData").get('total') > 1) {
            paginator = React.createElement(_ListPaginator2['default'], { dataModel: this.props.dm, node: this.props.node });
        }
        return React.createElement(
            ReactMUI.Toolbar,
            { className: 'toolbarTableHeader' },
            React.createElement(_SortColumns2['default'], _extends({ displayMode: 'tableHeader' }, this.props, { columnClicked: this.props.onHeaderClick })),
            React.createElement(
                ReactMUI.ToolbarGroup,
                { float: 'right' },
                paginator,
                React.createElement(ReactMUI.FontIcon, {
                    key: 1,
                    tooltip: this.context.getMessage('149', ''),
                    className: "icon-refresh" + (this.props.loading ? " rotating" : ""),
                    onClick: this.props.reload
                }),
                this.props.additionalActions
            )
        );
    }
});
module.exports = exports['default'];

},{"../util/MessagesConsumerMixin":59,"./ListPaginator":23,"./SortColumns":27}],31:[function(require,module,exports){
/*
 * Copyright 2007-2018 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio Cells.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _MenuItemsConsumer = require('./MenuItemsConsumer');

var _MenuItemsConsumer2 = _interopRequireDefault(_MenuItemsConsumer);

var _react = require("react");

var _react2 = _interopRequireDefault(_react);

var _reactDom = require("react-dom");

var _reactDom2 = _interopRequireDefault(_reactDom);

var _materialUi = require("material-ui");

var ButtonComposed = _react2['default'].createClass({
    displayName: 'ButtonComposed',

    propTypes: {
        buttonTitle: _react2['default'].PropTypes.oneOfType([_react2['default'].PropTypes.string, _react2['default'].PropTypes.object]).isRequired,
        masterAction: _react2['default'].PropTypes.func.isRequired,
        menuItems: _react2['default'].PropTypes.array.isRequired,
        className: _react2['default'].PropTypes.string,
        raised: _react2['default'].PropTypes.bool,
        direction: _react2['default'].PropTypes.oneOf(['left', 'right'])
    },

    componentDidMount: function componentDidMount() {
        var _this = this;

        if (this.props.openOnEvent) {
            this.props.pydio.observe(this.props.openOnEvent, function () {
                _this.showMenu();
            });
        }
    },

    getInitialState: function getInitialState() {
        return { showMenu: false };
    },

    showMenu: function showMenu(event) {
        var anchor = undefined;
        if (event) {
            anchor = event.currentTarget;
        } else {
            anchor = this._buttonDOM;
        }
        this.setState({
            showMenu: true,
            anchor: anchor
        });
    },

    menuClicked: function menuClicked(event, index, object) {
        this.setState({ showMenu: false });
    },

    render: function render() {
        var _this2 = this;

        var masterButton = undefined,
            arrowButton = undefined;
        var _props = this.props;
        var id = _props.id;
        var masterAction = _props.masterAction;
        var buttonTitle = _props.buttonTitle;
        var primary = _props.primary;
        var secondary = _props.secondary;
        var disabled = _props.disabled;
        var raised = _props.raised;
        var menuItems = _props.menuItems;
        var buttonStyle = _props.buttonStyle;
        var buttonLabelStyle = _props.buttonLabelStyle;
        var className = _props.className;
        var direction = _props.direction;

        var masterProps = {
            primary: primary,
            secondary: secondary,
            disabled: disabled,
            label: buttonTitle,
            style: buttonStyle,
            labelStyle: _extends({}, buttonLabelStyle, { paddingRight: 8 }),
            onTouchTap: masterAction,
            onClick: function onClick(e) {
                return e.stopPropagation();
            }
        };
        var arrowProps = {
            primary: primary,
            secondary: secondary,
            disabled: disabled,
            label: _react2['default'].createElement('span', { className: "mdi mdi-menu-down" }),
            onTouchTap: this.showMenu,
            style: _extends({}, buttonStyle, { minWidth: 16 }),
            labelStyle: _extends({}, buttonLabelStyle, { paddingLeft: 8, paddingRight: 8 }),
            onClick: function onClick(e) {
                return e.stopPropagation();
            }
        };
        var _state = this.state;
        var showMenu = _state.showMenu;
        var anchor = _state.anchor;
        var over = _state.over;

        if (menuItems.length) {
            if (raised) {
                arrowButton = _react2['default'].createElement(_materialUi.RaisedButton, _extends({}, arrowProps, { ref: function (b) {
                        _this2._buttonDOM = _reactDom2['default'].findDOMNode(b);
                    } }));
                masterButton = _react2['default'].createElement(_materialUi.RaisedButton, masterProps);
            } else {
                arrowButton = _react2['default'].createElement(_materialUi.FlatButton, _extends({}, arrowProps, { ref: function (b) {
                        _this2._buttonDOM = _reactDom2['default'].findDOMNode(b);
                    } }));
                masterButton = _react2['default'].createElement(_materialUi.FlatButton, masterProps);
            }
        }
        return _react2['default'].createElement(
            'span',
            { id: id, className: className,
                onMouseOver: function () {
                    _this2.setState({ over: true });
                }, onMouseOut: function () {
                    _this2.setState({ over: false });
                },
                style: over || showMenu ? { backgroundColor: 'rgba(153, 153, 153, 0.2)', whiteSpace: 'nowrap' } : { whiteSpace: 'nowrap' }
            },
            masterButton,
            arrowButton,
            _react2['default'].createElement(
                _materialUi.Popover,
                {
                    className: 'menuPopover',
                    open: showMenu,
                    anchorEl: anchor,
                    anchorOrigin: { horizontal: direction || 'left', vertical: 'bottom' },
                    targetOrigin: { horizontal: direction || 'left', vertical: 'top' },
                    onRequestClose: function () {
                        _this2.setState({ showMenu: false });
                    },
                    style: { marginTop: 1 },
                    useLayerForClickAway: false
                },
                _Utils2['default'].itemsToMenu(menuItems, this.menuClicked)
            )
        );
    }

});

exports['default'] = _MenuItemsConsumer2['default'](ButtonComposed);
module.exports = exports['default'];

},{"./MenuItemsConsumer":36,"./Utils":39,"material-ui":"material-ui","react":"react","react-dom":"react-dom"}],32:[function(require,module,exports){
/*
 * Copyright 2007-2018 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio Cells.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _MenuItemsConsumer = require('./MenuItemsConsumer');

var _MenuItemsConsumer2 = _interopRequireDefault(_MenuItemsConsumer);

var _react = require("react");

var _react2 = _interopRequireDefault(_react);

var _reactDom = require("react-dom");

var _reactDom2 = _interopRequireDefault(_reactDom);

var _materialUi = require("material-ui");

var ButtonMenu = _react2['default'].createClass({
    displayName: 'ButtonMenu',

    propTypes: {
        buttonTitle: _react2['default'].PropTypes.oneOfType([_react2['default'].PropTypes.string, _react2['default'].PropTypes.object]).isRequired,
        menuItems: _react2['default'].PropTypes.array.isRequired,
        className: _react2['default'].PropTypes.string,
        raised: _react2['default'].PropTypes.bool,
        direction: _react2['default'].PropTypes.oneOf(['left', 'right'])
    },

    componentDidMount: function componentDidMount() {
        var _this = this;

        if (this.props.openOnEvent) {
            this.props.pydio.observe(this.props.openOnEvent, function () {
                _this.showMenu();
            });
        }
    },

    getInitialState: function getInitialState() {
        return { showMenu: false };
    },

    showMenu: function showMenu(event) {
        var anchor = undefined;
        if (event) {
            anchor = event.currentTarget;
        } else {
            anchor = this._buttonDOM;
        }
        this.setState({
            showMenu: true,
            anchor: anchor
        });
    },

    menuClicked: function menuClicked(event, index, object) {
        this.setState({ showMenu: false });
    },

    render: function render() {
        var _this2 = this;

        var _state = this.state;
        var showMenu = _state.showMenu;
        var anchor = _state.anchor;

        var label = _react2['default'].createElement(
            'span',
            { style: { whiteSpace: 'nowrap' } },
            this.props.buttonTitle,
            ' ',
            _react2['default'].createElement('span', { className: 'mdi mdi-menu-down' })
        );
        var button = undefined;
        var props = {
            primary: this.props.primary,
            secondary: this.props.secondary,
            disabled: this.props.disabeld,
            label: label,
            onTouchTap: this.showMenu,
            labelStyle: _extends({}, this.props.buttonLabelStyle, { paddingRight: 10 }),
            style: _extends({}, this.props.buttonStyle, { backgroundColor: showMenu ? 'rgba(153,153,153,.2)' : '' }),
            onClick: function onClick(e) {
                return e.stopPropagation();
            }
        };
        var menuItems = this.props.menuItems;

        if (menuItems.length) {
            if (this.props.raised) {
                button = _react2['default'].createElement(_materialUi.RaisedButton, _extends({}, props, { ref: function (b) {
                        _this2._buttonDOM = _reactDom2['default'].findDOMNode(b);
                    } }));
            } else {
                button = _react2['default'].createElement(_materialUi.FlatButton, _extends({}, props, { ref: function (b) {
                        _this2._buttonDOM = _reactDom2['default'].findDOMNode(b);
                    } }));
            }
        }
        return _react2['default'].createElement(
            'span',
            { id: this.props.id, className: this.props.className },
            button,
            _react2['default'].createElement(
                _materialUi.Popover,
                {
                    className: 'menuPopover',
                    open: showMenu,
                    anchorEl: anchor,
                    anchorOrigin: { horizontal: this.props.direction || 'left', vertical: 'bottom' },
                    targetOrigin: { horizontal: this.props.direction || 'left', vertical: 'top' },
                    onRequestClose: function () {
                        _this2.setState({ showMenu: false });
                    },
                    style: { marginTop: 1 },
                    useLayerForClickAway: false
                },
                _Utils2['default'].itemsToMenu(menuItems, this.menuClicked)
            )
        );
    }

});

exports['default'] = _MenuItemsConsumer2['default'](ButtonMenu);
module.exports = exports['default'];

},{"./MenuItemsConsumer":36,"./Utils":39,"material-ui":"material-ui","react":"react","react-dom":"react-dom"}],33:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _pydioModelContextMenu = require('pydio/model/context-menu');

var _pydioModelContextMenu2 = _interopRequireDefault(_pydioModelContextMenu);

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _PopupMenu = require('./PopupMenu');

var _PopupMenu2 = _interopRequireDefault(_PopupMenu);

var _require = require('react');

var Component = _require.Component;

var dims = {
    MENU_ITEM_HEIGHT: 32, //48 if not display:compact
    MENU_SEP_HEIGHT: 16,
    MENU_VERTICAL_PADDING: 8,
    MENU_WIDTH: 250,
    OFFSET_VERTICAL: 8,
    OFFSET_HORIZONTAL: 8
};

var ContextMenu = (function (_Component) {
    _inherits(ContextMenu, _Component);

    function ContextMenu() {
        _classCallCheck(this, ContextMenu);

        _Component.apply(this, arguments);
    }

    ContextMenu.prototype.modelOpen = function modelOpen(node) {
        var position = _pydioModelContextMenu2['default'].getInstance().getPosition();
        var items = undefined;
        if (node) {
            var dm = pydio.getContextHolder();
            if (dm.getSelectedNodes().indexOf(node) !== -1) {
                this.openMenu('selectionContext', position);
            } else {
                pydio.observeOnce("actions_refreshed", (function (dataModel) {
                    this.openMenu('selectionContext', position);
                }).bind(this));
                dm.setSelectedNodes([node]);
            }
        } else {
            this.openMenu('genericContext', position);
        }
    };

    ContextMenu.prototype.openMenu = function openMenu(context, position) {
        var items = this.computeMenuItems(context);
        this._items = items;
        var mobile = this.props.pydio.UI.MOBILE_EXTENSIONS;
        if (!mobile) {
            position = this.computeVisiblePosition(position, items);
            this.refs['menu'].showMenu({
                top: position.y,
                left: position.x
            }, items);
        } else {
            this.refs['menu'].showMenu({
                bottom: 0,
                left: 0,
                right: 0,
                height: 200,
                zIndex: 10000,
                overflowY: 'auto'
            }, items);
        }
    };

    ContextMenu.prototype.computeMenuItems = function computeMenuItems(context) {
        var actions = this.props.pydio.Controller.getContextActions(context, ['inline', 'info_panel', 'info_panel_share']);
        return _Utils2['default'].pydioActionsToItems(actions);
    };

    ContextMenu.prototype.computeVisiblePosition = function computeVisiblePosition(position, items) {
        var menuHeight = dims.MENU_VERTICAL_PADDING * 2;
        items.map(function (it) {
            if (it.separator) menuHeight += dims.MENU_SEP_HEIGHT;else menuHeight += dims.MENU_ITEM_HEIGHT;
        });
        var menuWidth = dims.MENU_WIDTH;
        var windowW = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        var windowH = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        if (position.x + menuWidth > windowW) {
            position.x = Math.max(position.x - menuWidth, 10) - dims.OFFSET_HORIZONTAL;
        } else {
            position.x += dims.OFFSET_HORIZONTAL;
        }
        if (position.y + menuHeight > windowH) {
            position.y = Math.max(position.y - menuHeight, 10) - dims.OFFSET_VERTICAL;
        } else {
            position.y += dims.OFFSET_VERTICAL;
        }
        return position;
    };

    ContextMenu.prototype.componentDidMount = function componentDidMount() {
        this._modelOpen = this.modelOpen.bind(this);
        _pydioModelContextMenu2['default'].getInstance().observe("open", this._modelOpen);
    };

    ContextMenu.prototype.componentWillUnmount = function componentWillUnmount() {
        _pydioModelContextMenu2['default'].getInstance().stopObserving("open", this._modelOpen);
    };

    ContextMenu.prototype.render = function render() {
        var mobile = this.props.pydio.UI.MOBILE_EXTENSIONS;
        return React.createElement(_PopupMenu2['default'], {
            ref: 'menu',
            menuItems: this._items || [],
            onMenuClosed: this.props.onMenuClosed,
            menuProps: mobile ? { width: 600, autoWidth: false, desktop: false } : {},
            zDepth: mobile ? 2 : 1
        });
    };

    return ContextMenu;
})(Component);

exports['default'] = ContextMenu;
module.exports = exports['default'];

},{"./PopupMenu":37,"./Utils":39,"pydio/model/context-menu":"pydio/model/context-menu","react":"react"}],34:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _MenuItemsConsumer = require('./MenuItemsConsumer');

var _MenuItemsConsumer2 = _interopRequireDefault(_MenuItemsConsumer);

var React = require('react');

var _require = require('material-ui');

var IconButton = _require.IconButton;
var Popover = _require.Popover;

var IconButtonMenu = (function (_React$Component) {
    _inherits(IconButtonMenu, _React$Component);

    function IconButtonMenu(props, context) {
        _classCallCheck(this, IconButtonMenu);

        _React$Component.call(this, props, context);
        this.state = { showMenu: false };
    }

    IconButtonMenu.prototype.showMenu = function showMenu(event) {
        this.setState({
            showMenu: true,
            anchor: event.currentTarget
        });
    };

    IconButtonMenu.prototype.closeMenu = function closeMenu(event, index, menuItem) {
        this.setState({ showMenu: false });
    };

    IconButtonMenu.prototype.render = function render() {
        var _this = this;

        var _props = this.props;
        var menuItems = _props.menuItems;
        var className = _props.className;
        var buttonTitle = _props.buttonTitle;
        var buttonClassName = _props.buttonClassName;
        var buttonStyle = _props.buttonStyle;
        var popoverDirection = _props.popoverDirection;
        var popoverTargetPosition = _props.popoverTargetPosition;
        var menuProps = _props.menuProps;

        if (!menuItems.length) {
            return null;
        }
        return React.createElement(
            'span',
            { className: "toolbars-button-menu " + (className ? className : '') },
            React.createElement(IconButton, {
                ref: 'menuButton',
                tooltip: buttonTitle,
                iconClassName: buttonClassName,
                onTouchTap: this.showMenu.bind(this),
                iconStyle: buttonStyle
            }),
            React.createElement(
                Popover,
                {
                    open: this.state.showMenu,
                    anchorEl: this.state.anchor,
                    anchorOrigin: { horizontal: popoverDirection || 'right', vertical: popoverTargetPosition || 'bottom' },
                    targetOrigin: { horizontal: popoverDirection || 'right', vertical: 'top' },
                    onRequestClose: function () {
                        _this.setState({ showMenu: false });
                    },
                    useLayerForClickAway: false
                },
                _Utils2['default'].itemsToMenu(menuItems, this.closeMenu.bind(this), false, menuProps || undefined)
            )
        );
    };

    return IconButtonMenu;
})(React.Component);

IconButtonMenu.propTypes = {
    buttonTitle: React.PropTypes.string.isRequired,
    buttonClassName: React.PropTypes.string.isRequired,
    className: React.PropTypes.string,
    popoverDirection: React.PropTypes.oneOf(['right', 'left']),
    popoverPosition: React.PropTypes.oneOf(['top', 'bottom']),
    menuProps: React.PropTypes.object,
    menuItems: React.PropTypes.array.isRequired
};

exports['default'] = _MenuItemsConsumer2['default'](IconButtonMenu);
module.exports = exports['default'];

},{"./MenuItemsConsumer":36,"./Utils":39,"material-ui":"material-ui","react":"react"}],35:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = require('react');

var _require = require('material-ui');

var IconButton = _require.IconButton;
var Popover = _require.Popover;

var IconButtonPopover = (function (_React$Component) {
    _inherits(IconButtonPopover, _React$Component);

    function IconButtonPopover(props, context) {
        _classCallCheck(this, IconButtonPopover);

        _React$Component.call(this, props, context);
        this.state = { showPopover: false };
    }

    IconButtonPopover.prototype.showPopover = function showPopover(event) {
        this.setState({
            showPopover: true,
            anchor: event.currentTarget
        });
    };

    IconButtonPopover.prototype.render = function render() {
        var _this = this;

        return React.createElement(
            'span',
            { className: "toolbars-button-menu " + (this.props.className ? this.props.className : '') },
            React.createElement(IconButton, {
                ref: 'menuButton',
                tooltip: this.props.buttonTitle,
                iconClassName: this.props.buttonClassName,
                onTouchTap: this.showPopover.bind(this),
                iconStyle: this.props.buttonStyle
            }),
            React.createElement(
                Popover,
                {
                    open: this.state.showPopover,
                    anchorEl: this.state.anchor,
                    anchorOrigin: { horizontal: this.props.direction || 'right', vertical: 'bottom' },
                    targetOrigin: { horizontal: this.props.direction || 'right', vertical: 'top' },
                    onRequestClose: function () {
                        _this.setState({ showPopover: false });
                    },
                    useLayerForClickAway: false
                },
                this.props.popoverContent
            )
        );
    };

    return IconButtonPopover;
})(React.Component);

IconButtonPopover.propTypes = {
    buttonTitle: React.PropTypes.string.isRequired,
    buttonClassName: React.PropTypes.string.isRequired,
    className: React.PropTypes.string,
    direction: React.PropTypes.oneOf(['right', 'left']),
    popoverContent: React.PropTypes.object.isRequired
};

exports['default'] = IconButtonPopover;
module.exports = exports['default'];

},{"material-ui":"material-ui","react":"react"}],36:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var React = require('react');
var Controller = require('pydio/model/controller');

exports['default'] = function (Component) {
    var Wrapped = (function (_React$Component) {
        _inherits(Wrapped, _React$Component);

        function Wrapped(props, context) {
            _classCallCheck(this, Wrapped);

            _React$Component.call(this, props, context);
            this.state = {
                menuItems: this.props.menuItems || []
            };
        }

        Wrapped.prototype.componentDidMount = function componentDidMount() {
            var _this = this;

            if (this.props.controller && !this.props.menuItems) {
                this._observer = function () {
                    var actions = _this.props.controller.getContextActions('genericContext', null, _this.props.toolbars);
                    var menuItems = _Utils2['default'].pydioActionsToItems(actions);
                    _this.setState({ menuItems: menuItems });
                };
                if (this.props.controller === this.props.pydio.Controller) {
                    this.props.pydio.observe("actions_refreshed", this._observer);
                } else {
                    this.props.controller.observe("actions_refreshed", this._observer);
                }
                this._observer();
            }
        };

        Wrapped.prototype.componentWillUnmount = function componentWillUnmount() {
            if (this._observer) {
                if (this.props.controller === this.props.pydio.Controller) {
                    this.props.pydio.stopObserving("actions_refreshed", this._observer);
                } else {
                    this.props.controller.stopObserving("actions_refreshed", this._observer);
                }
            }
        };

        Wrapped.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
            if (nextProps.menuItems && nextProps.menuItems !== this.props.menuItems) {
                this.setState({ menuItems: nextProps.menuItems });
            }
        };

        Wrapped.prototype.render = function render() {
            return React.createElement(Component, _extends({}, this.props, { menuItems: this.state.menuItems }));
        };

        return Wrapped;
    })(React.Component);

    Wrapped.propTypes = {
        menuItems: React.PropTypes.array,
        toolbars: React.PropTypes.array,
        controller: React.PropTypes.instanceOf(Controller),
        pydio: React.PropTypes.instanceOf(Pydio)
    };

    return Wrapped;
};

module.exports = exports['default'];

},{"./Utils":39,"pydio/model/controller":"pydio/model/controller","react":"react"}],37:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var React = require('react');
var ReactDOM = require('react-dom');

var _require = require('material-ui');

var Menu = _require.Menu;
var Paper = _require.Paper;
exports['default'] = React.createClass({
    displayName: 'PopupMenu',

    propTypes: {
        menuItems: React.PropTypes.array.isRequired,
        onExternalClickCheckElements: React.PropTypes.func,
        className: React.PropTypes.string,
        style: React.PropTypes.object,
        onMenuClosed: React.PropTypes.func
    },

    getInitialState: function getInitialState() {
        return { showMenu: false, menuItems: this.props.menuItems };
    },
    showMenu: function showMenu() {
        var style = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];
        var menuItems = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

        this.setState({
            showMenu: true,
            style: style,
            menuItems: menuItems ? menuItems : this.state.menuItems
        });
    },
    hideMenu: function hideMenu(event) {
        if (!event) {
            this.setState({ showMenu: false });
            if (this.props.onMenuClosed) this.props.onMenuClosed();
            return;
        }
        // Firefox trigger a click event when you mouse up on contextmenu event
        if (typeof event !== 'undefined' && event.button === 2 && event.type !== 'contextmenu') {
            return;
        }
        var node = ReactDOM.findDOMNode(this.refs.menuContainer);
        if (node.contains(event.target) || node === event.target) {
            return;
        }

        this.setState({ showMenu: false });
        if (this.props.onMenuClosed) this.props.onMenuClosed();
    },
    componentDidMount: function componentDidMount() {
        this._observer = this.hideMenu;
    },
    componentWillUnmount: function componentWillUnmount() {
        document.removeEventListener('click', this._observer, false);
    },
    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        if (nextProps.menuItems) {
            this.setState({ menuItems: nextProps.menuItems });
        }
    },
    componentDidUpdate: function componentDidUpdate(prevProps, nextProps) {
        if (this.state.showMenu) {
            document.addEventListener('click', this._observer, false);
        } else {
            document.removeEventListener('click', this._observer, false);
        }
    },

    menuClicked: function menuClicked(event, index, menuItem) {
        this.hideMenu();
    },
    render: function render() {

        var style = this.state.style || {};
        style = _extends({}, style, { zIndex: 1000 });
        var menu = _Utils2['default'].itemsToMenu(this.state.menuItems, this.menuClicked, false, _extends({ desktop: true, display: 'right', width: 250 }, this.props.menuProps));
        if (this.state.showMenu) {
            return React.createElement(
                Paper,
                { zDepth: this.props.zDepth || 1, ref: 'menuContainer', className: 'menu-positioner', style: style },
                menu
            );
        } else {
            return null;
        }
    }

});
module.exports = exports['default'];

},{"./Utils":39,"material-ui":"material-ui","react":"react","react-dom":"react-dom"}],38:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Utils = require('./Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _IconButtonMenu = require('./IconButtonMenu');

var _IconButtonMenu2 = _interopRequireDefault(_IconButtonMenu);

var _ButtonMenu = require('./ButtonMenu');

var _ButtonMenu2 = _interopRequireDefault(_ButtonMenu);

var _ButtonComposed = require('./ButtonComposed');

var _ButtonComposed2 = _interopRequireDefault(_ButtonComposed);

var _IconButtonPopover = require('./IconButtonPopover');

var _IconButtonPopover2 = _interopRequireDefault(_IconButtonPopover);

var _materialUi = require('material-ui');

exports['default'] = _react2['default'].createClass({
    displayName: 'Toolbar',

    propTypes: {
        toolbars: _react2['default'].PropTypes.array,
        groupOtherList: _react2['default'].PropTypes.array,
        renderingType: _react2['default'].PropTypes.string,
        controller: _react2['default'].PropTypes.instanceOf(Controller),
        toolbarStyle: _react2['default'].PropTypes.object,
        buttonStyle: _react2['default'].PropTypes.object,
        fabAction: _react2['default'].PropTypes.string,
        buttonMenuNoLabel: _react2['default'].PropTypes.bool
    },

    componentDidMount: function componentDidMount() {
        this._observer = (function () {
            if (!this.isMounted()) return;
            this.setState({
                groups: this.props.controller.getToolbarsActions(this.props.toolbars, this.props.groupOtherList)
            });
        }).bind(this);
        if (this.props.controller === pydio.Controller) {
            pydio.observe("actions_refreshed", this._observer);
        } else {
            this.props.controller.observe("actions_refreshed", this._observer);
        }
    },

    componentWillUnmount: function componentWillUnmount() {
        if (this.props.controller === pydio.Controller) {
            pydio.stopObserving("actions_refreshed", this._observer);
        } else {
            this.props.controller.stopObserving("actions_refreshed", this._observer);
        }
    },

    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        if (nextProps.toolbars !== this.props.toolbars) {
            this.setState({
                groups: this.props.controller.getToolbarsActions(nextProps.toolbars, nextProps.groupOtherList)
            });
        }
    },

    getInitialState: function getInitialState() {
        return {
            groups: this.props.controller.getToolbarsActions(this.props.toolbars, this.props.groupOtherList)
        };
    },

    getDefaultProps: function getDefaultProps() {
        return {
            controller: global.pydio.Controller,
            renderingType: 'button',
            groupOtherList: []
        };
    },

    render: function render() {
        var groups = this.state.groups;

        var actions = [];
        var _props = this.props;
        var toolbars = _props.toolbars;
        var renderingType = _props.renderingType;
        var groupOtherList = _props.groupOtherList;
        var buttonStyle = _props.buttonStyle;
        var tooltipPosition = _props.tooltipPosition;
        var controller = _props.controller;
        var fabAction = _props.fabAction;
        var toolbarStyle = _props.toolbarStyle;
        var buttonMenuNoLabel = _props.buttonMenuNoLabel;
        var buttonMenuPopoverDirection = _props.buttonMenuPopoverDirection;
        var flatButtonStyle = _props.flatButtonStyle;

        var allToolbars = [].concat(toolbars);
        if (groupOtherList.length) {
            allToolbars = allToolbars.concat(['MORE_ACTION']);
        }
        allToolbars.map(function (barName) {
            if (!groups.has(barName)) {
                return;
            }
            groups.get(barName).map(function (action) {
                if (action.deny) {
                    return;
                }
                var menuItems = undefined,
                    popoverContent = undefined,
                    menuTitle = undefined,
                    menuIcon = undefined,
                    menuItemsUseMasterAction = undefined;
                var actionName = action.options.name;

                menuTitle = pydio.MessageHash[action.options.text_id] || action.options.text;
                menuIcon = action.options.icon_class;

                if (barName === 'MORE_ACTION') {
                    (function () {
                        var subItems = action.subMenuItems.dynamicItems;
                        var items = [];
                        subItems.map(function (obj) {
                            if (obj.separator) {
                                items.push(obj);
                            } else if (obj.actionId && !obj.actionId.deny) {
                                items.push(obj.actionId.getMenuData());
                            }
                        });
                        menuItems = _Utils2['default'].pydioActionsToItems(items);
                        menuIcon = "mdi mdi-dots-vertical";
                    })();
                } else if (action.subMenuItems.staticItems) {
                    menuItems = _Utils2['default'].pydioActionsToItems(action.subMenuItems.staticItems);
                } else if (action.subMenuItems.dynamicBuilder) {
                    menuItems = _Utils2['default'].pydioActionsToItems(action.subMenuItems.dynamicBuilder(controller));
                } else if (action.subMenuItems.popoverContent) {
                    popoverContent = action.subMenuItems.popoverContent;
                }
                if (menuItems && action.subMenuItems.masterAction) {
                    (function () {
                        var masterAction = controller.getActionByName(action.subMenuItems.masterAction);
                        if (masterAction && !masterAction.deny) {
                            menuItemsUseMasterAction = function () {
                                masterAction.apply();
                            };
                        }
                    })();
                }
                var id = 'action-' + action.options.name;
                if (renderingType === 'button-icon') {
                    menuTitle = _react2['default'].createElement(
                        'span',
                        { className: 'button-icon' },
                        _react2['default'].createElement('span', { className: "button-icon-icon " + menuIcon }),
                        _react2['default'].createElement(
                            'span',
                            { className: 'button-icon-label' },
                            menuTitle
                        )
                    );
                }
                if (menuItems) {
                    if (renderingType === 'button' || renderingType === 'button-icon') {
                        if (menuItemsUseMasterAction) {
                            actions.push(_react2['default'].createElement(_ButtonComposed2['default'], {
                                key: actionName,
                                className: id,
                                buttonTitle: menuTitle,
                                menuItems: menuItems,
                                masterAction: menuItemsUseMasterAction,
                                buttonLabelStyle: buttonStyle,
                                direction: buttonMenuPopoverDirection
                            }));
                        } else {
                            actions.push(_react2['default'].createElement(_ButtonMenu2['default'], {
                                key: actionName,
                                className: id,
                                buttonTitle: buttonMenuNoLabel ? '' : menuTitle,
                                menuItems: menuItems,
                                buttonLabelStyle: buttonStyle,
                                direction: buttonMenuPopoverDirection
                            }));
                        }
                    } else {
                        actions.push(_react2['default'].createElement(_IconButtonMenu2['default'], {
                            key: actionName,
                            className: id,
                            onMenuClicked: function (object) {
                                object.payload();
                            },
                            buttonClassName: menuIcon,
                            buttonTitle: menuTitle,
                            menuItems: menuItems,
                            buttonStyle: buttonStyle,
                            popoverDirection: buttonMenuPopoverDirection
                        }));
                    }
                } else if (popoverContent) {
                    actions.push(_react2['default'].createElement(_IconButtonPopover2['default'], {
                        key: actionName,
                        className: id,
                        buttonClassName: menuIcon,
                        buttonTitle: menuTitle,
                        buttonStyle: buttonStyle,
                        popoverContent: popoverContent
                    }));
                } else {
                    var click = function click() {
                        action.apply();
                    };
                    if (fabAction && fabAction === actionName) {
                        actions.push(_react2['default'].createElement(_materialUi.FloatingActionButton, {
                            key: actionName,
                            onTouchTap: click,
                            iconClassName: menuIcon,
                            mini: true,
                            backgroundColor: toolbarStyle.backgroundColor,
                            style: { position: 'absolute', top: -20, left: 10 }
                        }));
                    } else if (renderingType === 'button-icon') {
                        actions.push(_react2['default'].createElement(ReactMUI.FlatButton, {
                            key: actionName,
                            className: id,
                            onTouchTap: click,
                            label: menuTitle,
                            labelStyle: buttonStyle
                        }));
                    } else if (renderingType === 'button') {
                        actions.push(_react2['default'].createElement(_materialUi.FlatButton, {
                            key: actionName,
                            className: id,
                            onTouchTap: click,
                            label: menuTitle,
                            labelStyle: buttonStyle,
                            style: flatButtonStyle
                        }));
                    } else {
                        actions.push(_react2['default'].createElement(_materialUi.IconButton, {
                            key: actionName,
                            iconClassName: menuIcon + ' ' + id,
                            iconStyle: buttonStyle,
                            onTouchTap: click,
                            tooltip: menuTitle,
                            tooltipPosition: tooltipPosition
                        }));
                    }
                }
            });
        });
        var cName = this.props.className ? this.props.className : '';
        cName += ' ' + 'toolbar';
        if (!actions.length) {
            cName += ' empty-toolbar';
        }
        var style = _extends({}, toolbarStyle);
        return _react2['default'].createElement(
            'div',
            { className: cName, style: style, id: this.props.id },
            actions
        );
    }

});
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./ButtonComposed":31,"./ButtonMenu":32,"./IconButtonMenu":34,"./IconButtonPopover":35,"./Utils":39,"material-ui":"material-ui","react":"react"}],39:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _require = require('material-ui');

var Divider = _require.Divider;
var Menu = _require.Menu;
var MenuItem = _require.MenuItem;
var FontIcon = _require.FontIcon;

function pydioActionsToItems() {
    var actions = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];

    var items = [];
    var lastIsSeparator = false;
    actions.map((function (action, index) {
        if (action.separator) {
            if (lastIsSeparator) return;
            items.push(action);
            lastIsSeparator = true;
            return;
        }
        lastIsSeparator = false;
        var label = action.raw_name ? action.raw_name : action.name;
        var iconClass = action.icon_class;
        var payload = undefined;
        if (action.subMenu) {
            var subItems = action.subMenuBeforeShow ? pydioActionsToItems(action.subMenuBeforeShow()) : action.subMenu;
            items.push({
                text: label,
                iconClassName: iconClass,
                subItems: subItems
            });
        } else {
            items.push({
                text: label,
                iconClassName: iconClass,
                payload: action.callback
            });
        }
    }).bind(this));
    if (lastIsSeparator) {
        items = items.slice(0, items.length - 1);
    }
    if (items.length && items[0] && items[0].separator) {
        items.shift();
    }
    return items;
}

function itemsToMenu(items, closeMenuCallback) {
    var subItemsOnly = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];
    var menuProps = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];

    menuProps = _extends({
        display: 'normal',
        width: 216,
        desktop: true,
        autoWidth: false
    }, menuProps);

    var menuItems = items.map(function (item, index) {

        if (item.separator) return React.createElement(Divider, { key: "divider" + index });

        var subItems = undefined,
            payload = undefined;
        if (item.subItems) {
            subItems = itemsToMenu(item.subItems, closeMenuCallback, true);
        } else if (item.payload) {
            payload = function () {
                item.payload();
                closeMenuCallback();
            };
        }

        var leftIcon = undefined,
            rightIcon = undefined;
        var iconClassName = item.iconClassName;var inset = false;
        if (iconClassName === '__INSET__') {
            iconClassName = '';
            inset = true;
        }

        if (menuProps.display === 'normal') {
            leftIcon = iconClassName ? React.createElement(FontIcon, { className: item.iconClassName + ' menu-icons', style: { fontSize: 16, padding: 5 } }) : null;
        } else if (menuProps.display === 'right') {
            rightIcon = iconClassName ? React.createElement(FontIcon, { className: item.iconClassName + ' menu-icons', style: { fontSize: 16, padding: 5 } }) : null;
        }
        rightIcon = subItems && subItems.length ? React.createElement(FontIcon, { className: 'mdi mdi-menu-right menu-icons' }) : rightIcon;

        return React.createElement(MenuItem, {
            key: item.text,
            primaryText: item.text,
            insetChildren: inset,
            leftIcon: leftIcon,
            rightIcon: rightIcon,
            onTouchTap: payload,
            menuItems: subItems
        });
    });

    if (subItemsOnly) {
        return menuItems;
    } else {
        return React.createElement(
            Menu,
            menuProps,
            menuItems
        );
    }
}

exports['default'] = { pydioActionsToItems: pydioActionsToItems, itemsToMenu: itemsToMenu };
module.exports = exports['default'];

},{"material-ui":"material-ui"}],40:[function(require,module,exports){
/*
 * Copyright 2007-2018 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _materialUi = require('material-ui');

var _materialUiStyles = require('material-ui/styles');

var _pydioHttpPolicies = require('pydio/http/policies');

var _pydioHttpPolicies2 = _interopRequireDefault(_pydioHttpPolicies);

var _pydioHttpUsersApi = require('pydio/http/users-api');

var _pydioHttpRestApi = require('pydio/http/rest-api');

var _pydio2 = require('pydio');

var _pydio3 = _interopRequireDefault(_pydio2);

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

var _usersUsersCompleter = require('../users/UsersCompleter');

var _usersUsersCompleter2 = _interopRequireDefault(_usersUsersCompleter);

var ResourcePoliciesPanel = (function (_React$Component) {
    _inherits(ResourcePoliciesPanel, _React$Component);

    function ResourcePoliciesPanel(props) {
        _classCallCheck(this, ResourcePoliciesPanel);

        if (!props.subjectsDisabled) {
            props.subjectsDisabled = { 'READ': {}, 'WRITE': {} };
        }
        if (props.cellAcls) {
            Object.keys(props.cellAcls).map(function (k) {
                if (props.cellAcls[k].RoleId) {
                    props.subjectsDisabled['READ']["role:" + props.cellAcls[k].RoleId] = true;
                }
            });
        }
        _React$Component.call(this, props);
        this.state = {
            loading: true,
            policies: [],
            diffPolicies: { add: {}, remove: {} }
        };
    }

    ResourcePoliciesPanel.prototype.componentDidMount = function componentDidMount() {
        this.setState({ loading: true });
        this.reload();
    };

    ResourcePoliciesPanel.prototype.reload = function reload() {
        var _this = this;

        var _props = this.props;
        var resourceType = _props.resourceType;
        var resourceId = _props.resourceId;
        var _pydio = pydio;
        var user = _pydio.user;

        var proms = [_pydioHttpPolicies2['default'].loadPolicies(resourceType, resourceId), user.getIdmUser()];
        if (resourceType !== 'team') {
            proms.push(_pydioHttpApi2['default'].getRestClient().getIdmApi().listTeams());
        }
        Promise.all(proms).then(function (result) {
            var policies = result[0];
            var resourceUuid = policies[0].Resource;
            var idmUser = result[1];
            var teams = [];
            if (resourceType !== 'team' && result[2]) {
                teams = result[2].Teams;
            }
            _this.setState({
                policies: policies,
                idmUser: idmUser,
                userTeams: teams,
                loading: false,
                resourceUuid: resourceUuid
            });
        })['catch'](function (error) {
            _this.setState({ error: error.message, loading: false });
        });
    };

    ResourcePoliciesPanel.prototype.revert = function revert() {
        this.setState({ dirtyPolicies: null, diffPolicies: { add: {}, remove: {} } });
    };

    ResourcePoliciesPanel.prototype.save = function save() {
        var _this2 = this;

        var _state = this.state;
        var dirtyPolicies = _state.dirtyPolicies;
        var diffPolicies = _state.diffPolicies;
        var _props2 = this.props;
        var resourceType = _props2.resourceType;
        var resourceId = _props2.resourceId;
        var onSavePolicies = _props2.onSavePolicies;

        _pydioHttpPolicies2['default'].savePolicies(resourceType, resourceId, dirtyPolicies).then(function (result) {
            _this2.setState({ policies: result, dirtyPolicies: null, diffPolicies: { add: {}, remove: {} } });
            if (onSavePolicies) {
                onSavePolicies(diffPolicies);
            }
        })['catch'](function (reason) {
            _this2.setState({ error: reason.message });
        });
        //console.log(dirtyPolicies, diffPolicies);
    };

    ResourcePoliciesPanel.prototype.removePolicy = function removePolicy(action, subject) {
        var _state2 = this.state;
        var policies = _state2.policies;
        var dirtyPolicies = _state2.dirtyPolicies;
        var diffPolicies = _state2.diffPolicies;

        if (dirtyPolicies) {
            policies = dirtyPolicies;
        }
        var newPolicies = [];
        policies.map(function (p) {
            if (p.Action !== action || p.Subject !== subject) {
                newPolicies.push(p);
            }
        });
        diffPolicies.remove[action + '///' + subject] = true;
        if (diffPolicies.add[action + '///' + subject]) {
            delete diffPolicies.add[action + '///' + subject];
        }
        this.setState({ dirtyPolicies: newPolicies, diffPolicies: diffPolicies });
    };

    ResourcePoliciesPanel.prototype.addPolicy = function addPolicy(action, subject) {
        var isPickedUser = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];
        var _state3 = this.state;
        var policies = _state3.policies;
        var dirtyPolicies = _state3.dirtyPolicies;
        var resourceUuid = _state3.resourceUuid;
        var diffPolicies = _state3.diffPolicies;

        var newPolicies = dirtyPolicies ? [].concat(dirtyPolicies) : [].concat(policies);
        var newPol = new _pydioHttpRestApi.ServiceResourcePolicy();
        newPol.Resource = resourceUuid;
        newPol.Effect = 'allow';
        newPol.Subject = subject;
        newPol.Action = action;
        newPolicies.push(newPol);

        diffPolicies.add[action + '///' + subject] = true;
        if (diffPolicies.remove[action + '///' + subject]) {
            delete diffPolicies.remove[action + '///' + subject];
        }
        if (isPickedUser) {
            this.setState({ dirtyPolicies: newPolicies, diffPolicies: diffPolicies, pickedUser: null, pickedLabel: null });
        } else {
            this.setState({ dirtyPolicies: newPolicies, diffPolicies: diffPolicies });
        }
    };

    /**
     *
     * @param userSubjects
     * @param policies
     * @return {boolean}
     */

    ResourcePoliciesPanel.prototype.hasOneWrite = function hasOneWrite(userSubjects, policies) {
        for (var i = 0; i < userSubjects.length; i++) {
            for (var j = 0; j < policies.length; j++) {
                if (policies[j].Subject === userSubjects[i] && policies[j].Action === 'WRITE') {
                    return true;
                }
            }
        }
        return false;
    };

    /**
     *
     * @param idmUser
     * @param policies
     * @return {{groupBlocks: Array, hasWrite: boolean}}
     */

    ResourcePoliciesPanel.prototype.listUserRoles = function listUserRoles(idmUser, policies) {
        var crtUserSubject = 'user:' + idmUser.Login;
        var values = {};
        idmUser.Roles.map(function (role) {
            if (!role.GroupRole) {
                return;
            }
            values['role:' + role.Uuid] = role.Label;
        });
        values[crtUserSubject] = 'You';
        var hasWrite = this.hasOneWrite(Object.keys(values), policies);
        // Add other subjects
        values = _extends({}, this.listOtherUsersSubjects(policies, crtUserSubject), values);
        var keys = Object.keys(values);
        // Build Lines
        var groupBlocks = [];
        for (var i = keys.length - 1; i >= 0; i--) {
            var newKey = keys[i];
            var newVal = values[newKey];
            groupBlocks.push(this.renderLine(newKey, newVal, policies, !hasWrite || newKey === crtUserSubject));
        }
        return { groupBlocks: groupBlocks, hasWrite: hasWrite };
    };

    /**
     *
     * @param userTeams
     * @param policies
     * @param disabled
     * @return {XML}[]
     */

    ResourcePoliciesPanel.prototype.listUserTeams = function listUserTeams(userTeams, policies, disabled) {
        var _this3 = this;

        return userTeams.map(function (role) {
            return _this3.renderLine('role:' + role.Uuid, role.Label, policies, disabled);
        });
    };

    ResourcePoliciesPanel.prototype.listOtherUsersSubjects = function listOtherUsersSubjects(policies, currentUserSubject) {
        var _props3 = this.props;
        var resourceId = _props3.resourceId;
        var cellAcls = _props3.cellAcls;

        var subs = {};
        policies.map(function (p) {
            if (p.Subject.indexOf('user:') === 0 && p.Subject !== currentUserSubject && p.Subject !== 'user:' + resourceId) {
                subs[p.Subject] = p.Subject.substr('user:'.length);
            }
            if (cellAcls && p.Subject.indexOf('role:') === 0 && cellAcls[p.Subject.substr('role:'.length)]) {
                var roleId = p.Subject.substr('role:'.length);
                if (cellAcls[roleId].User) {
                    var usr = cellAcls[roleId].User;
                    if (currentUserSubject !== 'user:' + usr.Login) {
                        subs[p.Subject] = usr.Attributes && usr.Attributes['displayName'] ? usr.Attributes['displayName'] : usr.Login;
                    }
                } else if (cellAcls[roleId].Group) {
                    var grp = cellAcls[roleId].Group;
                    subs[p.Subject] = grp.Attributes && grp.Attributes['displayName'] ? grp.Attributes['displayName'] : grp.GroupLabel;
                }
            }
        });
        return subs;
    };

    /**
     *
     * @param userOrRole {{IdmUser,IdmRole}}
     */

    ResourcePoliciesPanel.prototype.pickUser = function pickUser(userOrRole) {
        var subject = undefined,
            label = undefined;
        if (userOrRole.IdmUser) {
            var IdmUser = userOrRole.IdmUser;

            var attributes = IdmUser.Attributes || {};
            if (IdmUser.IsGroup) {
                subject = 'role:' + IdmUser.Uuid;
                label = attributes['displayName'] || IdmUser.GroupLabel;
            } else {
                subject = 'user:' + IdmUser.Login;
                label = attributes['displayName'] || IdmUser.Login;
            }
        } else {
            var IdmRole = userOrRole.IdmRole;

            subject = 'role:' + IdmRole.Uuid;
            label = IdmRole.Label;
        }
        this.setState({ pickedUser: subject, pickedLabel: label });
    };

    /**
     *
     * @param subject
     * @param label
     * @param policies
     * @param disabled
     * @param isPickedUser
     * @return {XML}
     */

    ResourcePoliciesPanel.prototype.renderLine = function renderLine(subject, label, policies, disabled) {
        var _this4 = this;

        var isPickedUser = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];
        var _props4 = this.props;
        var subjectsDisabled = _props4.subjectsDisabled;
        var subjectsHidden = _props4.subjectsHidden;
        var readonly = _props4.readonly;

        if (subjectsHidden && subjectsHidden[subject]) {
            return null;
        }

        var read = false,
            write = false;
        var readChange = function readChange() {
            _this4.addPolicy('READ', subject, isPickedUser);
        };
        var writeChange = function writeChange() {
            _this4.addPolicy('WRITE', subject, isPickedUser);
        };
        policies.map(function (p) {
            if (p.Subject !== subject) {
                return;
            }
            if (p.Action === 'WRITE') {
                write = p.Action === 'WRITE';
                writeChange = function () {
                    _this4.removePolicy('WRITE', subject);
                };
            } else if (p.Action === 'READ') {
                read = p.Action === 'READ';
                readChange = function () {
                    _this4.removePolicy('READ', subject);
                };
            }
        });
        var disableWrite = disabled;
        var disableRead = disabled;
        if (readonly) {
            disableRead = true;
            disableWrite = true;
        } else {
            if (subjectsDisabled && subjectsDisabled['READ'] && subjectsDisabled['READ'][subject]) {
                disableRead = true;
            }
            if (subjectsDisabled && subjectsDisabled['WRITE'] && subjectsDisabled['WRITE'][subject]) {
                disableWrite = true;
            }
        }
        return _react2['default'].createElement(
            'div',
            { style: { display: 'flex', margin: 10, marginRight: 0 } },
            _react2['default'].createElement(
                'div',
                { style: { flex: 1 } },
                label
            ),
            _react2['default'].createElement(_materialUi.Checkbox, { checked: read, disabled: disableRead, style: { width: 40 }, onCheck: readChange }),
            _react2['default'].createElement(_materialUi.Checkbox, { checked: write, disabled: disableWrite, style: { width: 40 }, onCheck: writeChange })
        );
    };

    ResourcePoliciesPanel.prototype.render = function render() {
        var _this5 = this;

        var appBar = this.props.muiTheme.appBar;

        var styles = {
            title: {
                paddingLeft: 10,
                backgroundColor: appBar.color,
                display: 'flex',
                alignItems: 'center',
                fontSize: 16,
                color: appBar.textColor
            },
            subheader: {
                margin: 10,
                fontWeight: 500,
                color: '#9E9E9E',
                display: 'flex'
            },
            subject: {
                margin: 10
            },
            head: {
                display: 'inline-block',
                width: 40,
                textAlign: 'center',
                fontSize: 10
            }
        };
        var _state4 = this.state;
        var policies = _state4.policies;
        var dirtyPolicies = _state4.dirtyPolicies;
        var error = _state4.error;
        var idmUser = _state4.idmUser;
        var userTeams = _state4.userTeams;
        var loading = _state4.loading;
        var pickedUser = _state4.pickedUser;
        var pickedLabel = _state4.pickedLabel;
        var _props5 = this.props;
        var onDismiss = _props5.onDismiss;
        var style = _props5.style;
        var skipTitle = _props5.skipTitle;
        var resourceId = _props5.resourceId;
        var pydio = _props5.pydio;
        var userListExcludes = _props5.userListExcludes;
        var readonly = _props5.readonly;

        var blocks = [];
        if (!loading && !error) {
            var _listUserRoles = this.listUserRoles(idmUser, dirtyPolicies ? dirtyPolicies : policies);

            var groupBlocks = _listUserRoles.groupBlocks;
            var hasWrite = _listUserRoles.hasWrite;

            var teamBlocks = this.listUserTeams(userTeams, dirtyPolicies ? dirtyPolicies : policies, !hasWrite);
            var heads = _react2['default'].createElement(
                'div',
                null,
                _react2['default'].createElement(
                    'span',
                    { style: styles.head },
                    'View'
                ),
                _react2['default'].createElement(
                    'span',
                    { style: styles.head },
                    'Edit'
                )
            );
            if (groupBlocks.length) {
                blocks.push(_react2['default'].createElement(
                    'div',
                    { style: styles.subheader },
                    _react2['default'].createElement(
                        'span',
                        { style: { flex: 1 } },
                        'Users'
                    ),
                    heads
                ));
                blocks.push(groupBlocks);
                blocks.push(_react2['default'].createElement(_materialUi.Divider, null));
            }
            if (teamBlocks.length) {
                blocks.push(_react2['default'].createElement(
                    'div',
                    { style: styles.subheader },
                    _react2['default'].createElement(
                        'span',
                        { style: { flex: 1 } },
                        'Your Teams'
                    ),
                    heads
                ));
                blocks.push(teamBlocks);
                blocks.push(_react2['default'].createElement(_materialUi.Divider, null));
            }
            if (pickedUser) {
                blocks.push(_react2['default'].createElement(
                    'div',
                    { style: styles.subheader },
                    'Set visible to...'
                ));
                blocks.push(this.renderLine(pickedUser, pickedLabel, policies, false, true));
                blocks.push(_react2['default'].createElement(
                    'div',
                    { style: { textAlign: 'right' } },
                    _react2['default'].createElement(_materialUi.FlatButton, { label: "Cancel", onTouchTap: function () {
                            _this5.setState({ pickedUser: null, pickedLabel: null });
                        } })
                ));
                blocks.push(_react2['default'].createElement(_materialUi.Divider, null));
            } else if (!readonly) {
                (function () {
                    var crtUserSubject = 'user:' + idmUser.Login;
                    var userSubjects = _this5.listOtherUsersSubjects(dirtyPolicies ? dirtyPolicies : policies, crtUserSubject);
                    var exludes = [];
                    Object.keys(userSubjects).map(function (k) {
                        exludes.push(userSubjects[k]);
                    });

                    // select an arbitrary resource
                    blocks.push(_react2['default'].createElement(
                        'div',
                        { style: styles.subheader },
                        'Set visible to ...'
                    ));
                    blocks.push(_react2['default'].createElement(
                        'div',
                        { style: { margin: '-30px 10px 0' } },
                        _react2['default'].createElement(_usersUsersCompleter2['default'], {
                            className: 'share-form-users',
                            fieldLabel: 'Select user',
                            renderSuggestion: function (userObject) {
                                return _react2['default'].createElement(
                                    'div',
                                    { style: { fontSize: 13 } },
                                    userObject.getExtendedLabel()
                                );
                            },
                            onValueSelected: _this5.pickUser.bind(_this5),
                            usersOnly: true,
                            existingOnly: true,
                            excludes: [resourceId].concat(userListExcludes, exludes),
                            pydio: pydio,
                            showAddressBook: false,
                            usersFrom: 'local'
                        })
                    ));
                    blocks.push(_react2['default'].createElement(_materialUi.Divider, null));
                })();
            }

            blocks.pop();
        }

        return _react2['default'].createElement(
            'div',
            { style: style },
            _react2['default'].createElement(
                'div',
                { style: styles.title },
                _react2['default'].createElement(
                    'span',
                    { style: { flex: 1 } },
                    skipTitle ? '' : 'Visibility'
                ),
                dirtyPolicies && _react2['default'].createElement(_materialUi.IconButton, { iconClassName: "mdi mdi-undo-variant", tooltip: "Revert changes", onTouchTap: this.revert.bind(this), iconStyle: { color: appBar.textColor } }),
                dirtyPolicies && _react2['default'].createElement(_materialUi.IconButton, { iconClassName: "mdi mdi-content-save", tooltip: "Save changes", onTouchTap: this.save.bind(this), iconStyle: { color: appBar.textColor } }),
                !dirtyPolicies && onDismiss && _react2['default'].createElement(_materialUi.IconButton, { iconClassName: "mdi mdi-close", onTouchTap: onDismiss, iconStyle: { color: appBar.textColor } })
            ),
            error && _react2['default'].createElement(
                'div',
                null,
                'Error: ',
                error
            ),
            _react2['default'].createElement(
                'div',
                null,
                blocks
            )
        );
    };

    return ResourcePoliciesPanel;
})(_react2['default'].Component);

ResourcePoliciesPanel.PropTypes = {
    pydio: _react2['default'].PropTypes.instanceOf(_pydio3['default']),
    resourceType: _react2['default'].PropTypes.string.isRequired,
    resourceId: _react2['default'].PropTypes.string.isRequired,
    onSavePolicies: _react2['default'].PropTypes.func,
    userListExcludes: _react2['default'].PropTypes.array,
    subjectsDisabled: _react2['default'].PropTypes.array,
    subjectsHidden: _react2['default'].PropTypes.object,
    readonly: _react2['default'].PropTypes.bool,
    cellAcls: _react2['default'].PropTypes.object,

    onDismiss: _react2['default'].PropTypes.func,
    style: _react2['default'].PropTypes.object,
    skipTitle: _react2['default'].PropTypes.bool

};

exports['default'] = ResourcePoliciesPanel = _materialUiStyles.muiThemeable()(ResourcePoliciesPanel);

exports['default'] = ResourcePoliciesPanel;
module.exports = exports['default'];

},{"../users/UsersCompleter":43,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","pydio/http/api":"pydio/http/api","pydio/http/policies":"pydio/http/policies","pydio/http/rest-api":"pydio/http/rest-api","pydio/http/users-api":"pydio/http/users-api","react":"react"}],41:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

/**
 * Simple form for creating a team
 */

var _require = require('react');

var Component = _require.Component;
var PropTypes = _require.PropTypes;

var _require2 = require('material-ui');

var TextField = _require2.TextField;
var FlatButton = _require2.FlatButton;

var _require$requireLib = require('pydio').requireLib('boot');

var PydioContextConsumer = _require$requireLib.PydioContextConsumer;

var TeamCreationForm = (function (_Component) {
    _inherits(TeamCreationForm, _Component);

    function TeamCreationForm(props, context) {
        _classCallCheck(this, TeamCreationForm);

        _Component.call(this, props, context);
        this.state = { value: '' };
    }

    TeamCreationForm.prototype.onChange = function onChange(e, value) {
        this.setState({ value: value });
    };

    TeamCreationForm.prototype.submitCreationForm = function submitCreationForm() {
        var value = this.state.value;
        _pydioHttpApi2['default'].getRestClient().getIdmApi().saveSelectionAsTeam(value, [], this.props.onTeamCreated);
    };

    TeamCreationForm.prototype.render = function render() {
        var getMessage = this.props.getMessage;

        return React.createElement(
            'div',
            null,
            React.createElement(
                'div',
                { style: { padding: 20 } },
                React.createElement(
                    'div',
                    null,
                    getMessage(591)
                ),
                React.createElement(TextField, { floatingLabelText: getMessage(578), value: this.state.value, onChange: this.onChange.bind(this), fullWidth: true })
            ),
            React.createElement(
                'div',
                null,
                React.createElement(
                    'div',
                    { style: { textAlign: 'right', padding: 8 } },
                    React.createElement(FlatButton, { label: getMessage(49), onTouchTap: this.props.onCancel.bind(this) }),
                    React.createElement(FlatButton, { label: getMessage(579), primary: true, onTouchTap: this.submitCreationForm.bind(this) })
                )
            )
        );
    };

    return TeamCreationForm;
})(Component);

TeamCreationForm.propTypes = {
    /**
     * Callback triggered after team creation succeeded
     */
    onTeamCreated: PropTypes.func.isRequired,
    /**
     * Request modal close
     */
    onCancel: PropTypes.func.isRequired
};

exports['default'] = TeamCreationForm = PydioContextConsumer(TeamCreationForm);

exports['default'] = TeamCreationForm;
module.exports = exports['default'];

},{"material-ui":"material-ui","pydio":"pydio","pydio/http/api":"pydio/http/api","react":"react"}],42:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

var _materialUi = require('material-ui');

var _pydioHttpUsersApi = require('pydio/http/users-api');

var _Pydio$requireLib = _pydio2['default'].requireLib('form');

var Manager = _Pydio$requireLib.Manager;
var FormPanel = _Pydio$requireLib.FormPanel;

var UserCreationForm = (function (_React$Component) {
    _inherits(UserCreationForm, _React$Component);

    UserCreationForm.prototype.getCreateUserParameters = function getCreateUserParameters() {
        var editMode = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];

        var basicParameters = [];
        var pydio = this.props.pydio;
        var MessageHash = pydio.MessageHash;

        var prefix = pydio.getPluginConfigs('action.share').get('SHARED_USERS_TMP_PREFIX');
        basicParameters.push({
            IdmUserField: 'Login',
            description: MessageHash['533'],
            readonly: editMode,
            expose: "true",
            label: MessageHash['522'],
            name: editMode ? "existing_user_id" : "new_user_id",
            scope: "user",
            type: "string",
            mandatory: true,
            "default": prefix ? prefix : ''
        }, {
            IdmUserField: 'Password',
            description: MessageHash['534'],
            editable: "true",
            expose: "true",
            label: MessageHash['523'],
            name: "new_password",
            scope: "user",
            type: "valid-password",
            mandatory: true
        });

        var params = global.pydio.getPluginConfigs('auth').get('NEWUSERS_EDIT_PARAMETERS').split(',');
        for (var i = 0; i < params.length; i++) {
            params[i] = "user/preferences/pref[@exposed]|//param[@name='" + params[i] + "']";
        }
        var xPath = params.join('|');
        Manager.parseParameters(this.props.pydio.getXmlRegistry(), xPath).map(function (el) {
            basicParameters.push(el);
        });
        if (!editMode) {
            basicParameters.push({
                description: MessageHash['536'],
                editable: "true",
                expose: "true",
                label: MessageHash['535'],
                name: "send_email",
                scope: "user",
                type: "boolean",
                mandatory: true
            });
        }
        return basicParameters;
    };

    UserCreationForm.prototype.getDefaultProps = function getDefaultProps() {
        return { editMode: false };
    };

    UserCreationForm.prototype.getParameters = function getParameters() {
        if (!this._parsedParameters) {
            this._parsedParameters = this.getCreateUserParameters(this.props.editMode);
        }
        return this._parsedParameters;
    };

    UserCreationForm.prototype.getValuesForPost = function getValuesForPost(prefix) {
        return Manager.getValuesForPOST(this.getParameters(), this.state.values, prefix);
    };

    function UserCreationForm(props, context) {
        var _this = this;

        _classCallCheck(this, UserCreationForm);

        _React$Component.call(this, props, context);

        var _props = this.props;
        var pydio = _props.pydio;
        var newUserName = _props.newUserName;
        var editMode = _props.editMode;
        var userData = _props.userData;

        var userPrefix = pydio.getPluginConfigs('action.share').get('SHARED_USERS_TMP_PREFIX');
        if (!userPrefix || newUserName.startsWith(userPrefix)) userPrefix = '';
        var values = {
            new_password: '',
            send_email: true
        };
        if (editMode && userData && userData.IdmUser) {
            (function () {
                var IdmUser = userData.IdmUser;

                _this.getParameters().forEach(function (param) {
                    var name = param.name;
                    var IdmUserField = param.IdmUserField;
                    var scope = param.scope;
                    var pluginId = param.pluginId;

                    var value = undefined;
                    if (IdmUserField) {
                        value = IdmUser[IdmUserField];
                    } else if (scope === 'user' && IdmUser.Attributes) {
                        value = IdmUser.Attributes[name];
                    } else if (pluginId && IdmUser.Attributes["parameter:" + pluginId + ":" + name]) {
                        value = JSON.parse(IdmUser.Attributes["parameter:" + pluginId + ":" + name]);
                    }
                    if (value !== undefined) {
                        values[name] = value;
                    }
                });
            })();
        } else {
            values['new_user_id'] = userPrefix + newUserName;
            values['lang'] = pydio.currentLanguage;
        }
        this.state = { values: values };
    }

    UserCreationForm.prototype.onValuesChange = function onValuesChange(newValues) {
        this.setState({ values: newValues });
    };

    UserCreationForm.prototype.changeValidStatus = function changeValidStatus(status) {
        this.setState({ valid: status });
    };

    UserCreationForm.prototype.submitCreationForm = function submitCreationForm() {
        var _this2 = this;

        var existingUser = undefined;
        var _props2 = this.props;
        var editMode = _props2.editMode;
        var userData = _props2.userData;

        if (editMode) {
            existingUser = userData.IdmUser;
        }
        _pydioHttpApi2['default'].getRestClient().getIdmApi().putExternalUser(this.state.values, this.getParameters(), existingUser).then(function (idmUser) {
            _this2.props.onUserCreated(_pydioHttpUsersApi.User.fromIdmUser(idmUser));
        });
    };

    UserCreationForm.prototype.cancelCreationForm = function cancelCreationForm() {
        this.props.onCancel();
    };

    UserCreationForm.prototype.render = function render() {
        var _props3 = this.props;
        var pydio = _props3.pydio;
        var editMode = _props3.editMode;
        var newUserName = _props3.newUserName;

        var status = this.state.valid;
        if (!status && editMode && !this.state.values['new_password']) {
            status = true;
        }

        return _react2['default'].createElement(
            _materialUi.Paper,
            { zDepth: this.props.zDepth !== undefined ? this.props.zDepth : 2, style: _extends({ minHeight: 250, display: 'flex', flexDirection: 'column' }, this.props.style) },
            _react2['default'].createElement(FormPanel, {
                className: 'reset-pydio-forms',
                depth: -1,
                parameters: this.getParameters(),
                values: this.state.values,
                onChange: this.onValuesChange.bind(this),
                onValidStatusChange: this.changeValidStatus.bind(this),
                style: { overflowY: 'auto', flex: 1 }
            }),
            _react2['default'].createElement(_materialUi.Divider, { style: { flexShrink: 0 } }),
            _react2['default'].createElement(
                'div',
                { style: { padding: 8, textAlign: 'right' } },
                _react2['default'].createElement(_materialUi.FlatButton, { label: pydio.MessageHash[49], onTouchTap: this.cancelCreationForm.bind(this) }),
                _react2['default'].createElement(_materialUi.FlatButton, { label: this.props.editMode ? pydio.MessageHash[519] : pydio.MessageHash[484], primary: true, onTouchTap: this.submitCreationForm.bind(this), disabled: !status })
            )
        );
    };

    return UserCreationForm;
})(_react2['default'].Component);

UserCreationForm.propTypes = {
    newUserName: _react2['default'].PropTypes.string,
    onUserCreated: _react2['default'].PropTypes.func.isRequired,
    onCancel: _react2['default'].PropTypes.func.isRequired,
    editMode: _react2['default'].PropTypes.bool,
    userData: _react2['default'].PropTypes.object
};

exports['default'] = UserCreationForm;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"material-ui":"material-ui","pydio":"pydio","pydio/http/api":"pydio/http/api","pydio/http/users-api":"pydio/http/users-api","react":"react"}],43:[function(require,module,exports){
(function (global){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _addressbookAddressBook = require('./addressbook/AddressBook');

var _addressbookAddressBook2 = _interopRequireDefault(_addressbookAddressBook);

var _materialUi = require('material-ui');

var _pydioUtilFunc = require('pydio/util/func');

var _pydioUtilFunc2 = _interopRequireDefault(_pydioUtilFunc);

var _UserCreationForm = require('./UserCreationForm');

var _UserCreationForm2 = _interopRequireDefault(_UserCreationForm);

/**
 * Ready to use autocomplete field that will load users/groups/roles from
 * the server (using user_list_authorized_users API).
 * Used for sharing, addressbooks, send email, etc.
 *
 * Can also open a "selector-style" adress book.
 */
var UsersLoader = _react2['default'].createClass({
    displayName: 'UsersLoader',

    propTypes: {

        /**
         * Method called to render a commponent, taking a UserObject as input
         */
        renderSuggestion: _react2['default'].PropTypes.func.isRequired,
        /**
         * Callback when a value is finally selected
         */
        onValueSelected: _react2['default'].PropTypes.func.isRequired,
        /**
         * Floating Label Text displayed on the field
         */
        fieldLabel: _react2['default'].PropTypes.string.isRequired,
        /**
         * Array of values to ignore
         */
        excludes: _react2['default'].PropTypes.array.isRequired,
        /**
         * Display only users, no groups nor roles
         */
        usersOnly: _react2['default'].PropTypes.bool,
        /**
         * Display users from local directory and/or from remote.
         */
        usersFrom: _react2['default'].PropTypes.oneOf(['local', 'remote', 'any']),
        /**
         * Do not propose a "Create user" option
         */
        existingOnly: _react2['default'].PropTypes.bool,
        /**
         * Allow free typing
         */
        freeValueAllowed: _react2['default'].PropTypes.bool,
        /**
         * Will be passed to the root component
         */
        className: _react2['default'].PropTypes.string
    },

    getInitialState: function getInitialState() {
        return {
            dataSource: [],
            loading: false,
            searchText: '',
            minChars: parseInt(global.pydio.getPluginConfigs("core.auth").get("USERS_LIST_COMPLETE_MIN_CHARS"))
        };
    },

    /**
     * Loads values from server
     * @param {string} input Currently searched text
     * @param {Function} callback Called with the values
     */
    suggestionLoader: function suggestionLoader(input, callback) {
        var _this = this;

        var excludes = this.props.excludes;
        //const disallowTemporary = this.props.existingOnly && !this.props.freeValueAllowed;
        this.setState({ loading: this.state.loading + 1 });
        var api = _pydioHttpApi2['default'].getRestClient().getIdmApi();
        var uPromise = api.listUsers('/', input, true, 0, 20);
        var gPromise = api.listGroups('/', input, true, 0, 20);
        var tPromise = api.listTeams(input, 0, 20);
        Promise.all([uPromise, gPromise, tPromise]).then(function (results) {
            _this.setState({ loading: _this.state.loading - 1 });
            var users = results[0];
            var groups = results[1];
            var teams = results[2];

            users = users.Users;
            groups = groups.Groups;
            teams = teams.Teams;
            if (excludes && excludes.length) {
                users = users.filter(function (user) {
                    return excludes.indexOf(user.Login) === -1;
                });
                groups = groups.filter(function (group) {
                    return excludes.indexOf(group.GroupLabel) === -1;
                });
                teams = teams.filter(function (team) {
                    return excludes.indexOf(team.Label === -1);
                });
            }
            callback([].concat(groups.map(function (u) {
                return { IdmUser: u };
            }), teams.map(function (u) {
                return { IdmRole: u };
            }), users.map(function (u) {
                return { IdmUser: u };
            })));
        });
    },

    /**
     * Called when the field is updated
     * @param value
     */
    textFieldUpdate: function textFieldUpdate(value) {

        this.setState({ searchText: value });
        if (this.state.minChars && value && value.length < this.state.minChars) {
            return;
        }
        this.loadBuffered(value, 350);
    },

    getPendingSearchText: function getPendingSearchText() {
        return this.state.searchText || false;
    },

    componentWillReceiveProps: function componentWillReceiveProps() {
        this._emptyValueList = null;
    },

    /**
     * Debounced call for rendering search
     * @param value {string}
     * @param timeout {int}
     */
    loadBuffered: function loadBuffered(value, timeout) {

        if (!value && this._emptyValueList) {
            this.setState({ dataSource: this._emptyValueList });
            return;
        }
        var _props = this.props;
        var existingOnly = _props.existingOnly;
        var freeValueAllowed = _props.freeValueAllowed;
        var excludes = _props.excludes;

        _pydioUtilFunc2['default'].bufferCallback('remote_users_search', timeout, (function () {
            this.setState({ loading: true });
            var excluded = [_pydio2['default'].getInstance().user.id, 'pydio.anon.user'];
            this.suggestionLoader(value, (function (users) {
                var valueExists = false;
                var values = users.filter(function (userObject) {
                    return !(userObject.IdmUser && !userObject.IdmUser.IsGroup && excluded.indexOf(userObject.IdmUser.Login) > -1);
                }).filter(function (userObject) {
                    if (!excludes) {
                        return true;
                    }
                    if (userObject.IdmUser && userObject.IdmUser.IsGroup) {
                        return excludes.filter(function (e) {
                            return e.Group && e.Group.Uuid === userObject.IdmUser.Uuid;
                        }).length === 0;
                    } else if (userObject.IdmUser) {
                        return excludes.filter(function (e) {
                            return e.User && e.User.Uuid === userObject.IdmUser.Uuid;
                        }).length === 0;
                    } else {
                        return excludes.filter(function (e) {
                            return e.Role && e.Role.Uuid === userObject.IdmRole.Uuid;
                        }).length === 0;
                    }
                }).map(function (userObject) {
                    var identifier = undefined,
                        icon = undefined,
                        label = undefined;
                    if (userObject.IdmUser && userObject.IdmUser.IsGroup) {
                        identifier = userObject.IdmUser.GroupLabel;
                        label = userObject.IdmUser.Attributes && userObject.IdmUser.Attributes["displayName"] ? userObject.IdmUser.Attributes["displayName"] : identifier;
                        icon = "mdi mdi-folder-account";
                    } else if (userObject.IdmUser) {
                        identifier = userObject.IdmUser.Login;
                        label = userObject.IdmUser.Attributes && userObject.IdmUser.Attributes["displayName"] ? userObject.IdmUser.Attributes["displayName"] : identifier;
                        var shared = userObject.IdmUser.Attributes && userObject.IdmUser.Attributes["profile"] === "shared";
                        if (shared) {
                            icon = "mdi mdi-account";
                        } else {
                            icon = "mdi mdi-account-box-outline";
                        }
                    } else {
                        identifier = userObject.IdmRole.Uuid;
                        label = userObject.IdmRole.Label;
                        icon = "mdi mdi-account-multiple-outline";
                    }
                    valueExists |= label === value;
                    var component = _react2['default'].createElement(_materialUi.MenuItem, {
                        primaryText: label,
                        leftIcon: _react2['default'].createElement(_materialUi.FontIcon, { className: icon, style: { margin: '0 12px' } })
                    });
                    return {
                        userObject: userObject,
                        text: identifier,
                        value: component
                    };
                });
                if (!value) {
                    this._emptyValueList = values;
                }
                // Append temporary create user
                if (value && !valueExists && (!existingOnly || freeValueAllowed)) {
                    var m = _pydio2['default'].getMessages()["448"] || "create";
                    var createItem = _react2['default'].createElement(_materialUi.MenuItem, {
                        primaryText: value + (freeValueAllowed ? '' : ' (' + m + ')'),
                        leftIcon: _react2['default'].createElement(_materialUi.FontIcon, { className: "mdi mdi-account-plus", style: { margin: '0 12px' } })
                    });
                    values = [{ text: value, value: createItem }].concat(values);
                }
                this.setState({ dataSource: values, loading: false });
            }).bind(this));
        }).bind(this));
    },

    /**
     * Called when user selects a value from the list
     * @param value
     * @param index
     */
    onCompleterRequest: function onCompleterRequest(value, index) {
        var freeValueAllowed = this.props.freeValueAllowed;

        if (index === -1) {
            this.state.dataSource.map(function (entry) {
                if (entry.text === value) {
                    value = entry;
                }
            });
            if (value && !value.userObject && this.props.freeValueAllowed) {
                this.props.onValueSelected({ FreeValue: value.text });
                this.setState({ searchText: '', dataSource: [] });
                return;
            }
        }
        if (value) {
            if (value.userObject) {
                this.props.onValueSelected(value.userObject);
            } else if (freeValueAllowed) {
                this.props.onValueSelected({ FreeValue: value.text });
            } else {
                this.setState({ createUser: value.text });
            }
            this.setState({ searchText: '', dataSource: [] });
        }
    },

    /**
     * Triggers onValueSelected props callback
     * @param {Pydio.User} newUser
     */
    onUserCreated: function onUserCreated(newUser) {
        this.props.onValueSelected(newUser);
        this.setState({ createUser: null });
    },

    /**
     * Close user creation form
     */
    onCreationCancelled: function onCreationCancelled() {
        this.setState({ createUser: null });
    },

    /**
     * Open address book inside a Popover
     * @param event
     */
    openAddressBook: function openAddressBook(event) {
        this.setState({
            addressBookOpen: true,
            addressBookAnchor: event.currentTarget
        });
    },

    /**
     * Close address book popover
     */
    closeAddressBook: function closeAddressBook() {
        this.setState({ addressBookOpen: false });
    },

    /**
     * Triggered when user clicks on an entry from adress book.
     * @param item
     */
    onAddressBookItemSelected: function onAddressBookItemSelected(item) {
        this.props.onValueSelected(item);
    },

    render: function render() {
        var _this2 = this;

        var _state = this.state;
        var dataSource = _state.dataSource;
        var createUser = _state.createUser;

        var containerStyle = { position: 'relative', overflow: 'visible' };

        return _react2['default'].createElement(
            'div',
            { style: containerStyle, ref: function (el) {
                    _this2._popoverAnchor = el;
                } },
            !createUser && _react2['default'].createElement(_materialUi.AutoComplete, {
                filter: _materialUi.AutoComplete.noFilter,
                dataSource: dataSource,
                searchText: this.state.searchText,
                onUpdateInput: this.textFieldUpdate,
                className: this.props.className,
                openOnFocus: true,
                floatingLabelText: this.props.fieldLabel,
                underlineShow: !this.props.underlineHide,
                fullWidth: true,
                onNewRequest: this.onCompleterRequest,
                listStyle: { maxHeight: 350, overflowY: 'auto' },
                onFocus: function () {
                    _this2.loadBuffered(_this2.state.searchText, 100);
                }
            }),
            createUser && _react2['default'].createElement(_materialUi.TextField, {
                floatingLabelText: this.props.fieldLabel,
                value: global.pydio.MessageHash[485] + ' (' + this.state.createUser + ')',
                disabled: true,
                fullWidth: true,
                underlineShow: !this.props.underlineHide
            }),
            !createUser && _react2['default'].createElement(
                'div',
                { style: { position: 'absolute', right: 4, bottom: 14, height: 20, width: 20 } },
                _react2['default'].createElement(_materialUi.RefreshIndicator, {
                    size: 20,
                    left: 0,
                    top: 0,
                    status: this.state.loading ? 'loading' : 'hide'
                })
            ),
            this.props.showAddressBook && !createUser && _react2['default'].createElement(_addressbookAddressBook2['default'], {
                mode: 'popover',
                pydio: this.props.pydio,
                loaderStyle: { width: 320, height: 420 },
                onItemSelected: this.onAddressBookItemSelected,
                usersFrom: this.props.usersFrom,
                disableSearch: true
            }),
            _react2['default'].createElement(
                _materialUi.Popover,
                {
                    open: createUser,
                    anchorEl: this._popoverAnchor,
                    anchorOrigin: { horizontal: 'left', vertical: 'bottom' },
                    targetOrigin: { horizontal: 'left', vertical: 'top' },
                    onRequestClose: this.onCreationCancelled,
                    canAutoPosition: false
                },
                createUser && _react2['default'].createElement(_UserCreationForm2['default'], {
                    onUserCreated: this.onUserCreated.bind(this),
                    onCancel: this.onCreationCancelled.bind(this),
                    style: { width: 350, height: 320 },
                    newUserName: this.state.createUser,
                    pydio: this.props.pydio
                })
            )
        );
    }

});

exports['default'] = UsersLoader;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./UserCreationForm":42,"./addressbook/AddressBook":44,"material-ui":"material-ui","pydio":"pydio","pydio/http/api":"pydio/http/api","pydio/util/func":"pydio/util/func","react":"react"}],44:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _NestedListItem = require('./NestedListItem');

var _NestedListItem2 = _interopRequireDefault(_NestedListItem);

var _UsersList = require('./UsersList');

var _UsersList2 = _interopRequireDefault(_UsersList);

var _RightPanelCard = require('./RightPanelCard');

var _RightPanelCard2 = _interopRequireDefault(_RightPanelCard);

var _SearchPanel = require('./SearchPanel');

var _SearchPanel2 = _interopRequireDefault(_SearchPanel);

var _Loaders = require('./Loaders');

var _Loaders2 = _interopRequireDefault(_Loaders);

var _TeamCreationForm = require('../TeamCreationForm');

var _TeamCreationForm2 = _interopRequireDefault(_TeamCreationForm);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _materialUi = require('material-ui');

var _materialUiStyles = require('material-ui/styles');

var _avatarActionsPanel = require('../avatar/ActionsPanel');

var _avatarActionsPanel2 = _interopRequireDefault(_avatarActionsPanel);

var _UserCreationForm = require('../UserCreationForm');

var _UserCreationForm2 = _interopRequireDefault(_UserCreationForm);

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

/**
 * High level component to browse users, groups and teams, either in a large format (mode='book') or a more compact
 * format (mode='selector'|'popover').
 * Address book allows to create external users, teams, and also to browse trusted server directories if Federated Sharing
 * is active.
 */

var _Pydio$requireLib = _pydio2['default'].requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;
var AddressBook = _react2['default'].createClass({
    displayName: 'AddressBook',

    propTypes: {
        /**
         * Main instance of pydio
         */
        pydio: _react2['default'].PropTypes.instanceOf(_pydio2['default']),
        /**
         * Display mode, either large (book) or small picker ('selector', 'popover').
         */
        mode: _react2['default'].PropTypes.oneOf(['book', 'selector', 'popover']).isRequired,
        /**
         * Use book mode but display as column
         */
        bookColumn: _react2['default'].PropTypes.bool,
        /**
         * Callback triggered in 'selector' mode whenever an item is clicked.
         */
        onItemSelected: _react2['default'].PropTypes.func,
        /**
         * Display users only, no teams or groups
         */
        usersOnly: _react2['default'].PropTypes.bool,
        /**
         * Choose various user sources, either the local directory or remote ( = trusted ) servers.
         */
        usersFrom: _react2['default'].PropTypes.oneOf(['local', 'remote', 'any']),
        /**
         * Disable the search engine
         */
        disableSearch: _react2['default'].PropTypes.bool,
        /**
         * Theme object passed by muiThemeable() wrapper
         */
        muiTheme: _react2['default'].PropTypes.object,
        /**
         * Will be passed to the Popover object
         */
        popoverStyle: _react2['default'].PropTypes.object,
        /**
         * Used as a button to open the selector in a popover
         */
        popoverButton: _react2['default'].PropTypes.object,
        /**
         * Will be passed to the Popover container object
         */
        popoverContainerStyle: _react2['default'].PropTypes.object,
        /**
         * Will be passed to the Popover Icon Button.
         */
        popoverIconButtonStyle: _react2['default'].PropTypes.object
    },

    getDefaultProps: function getDefaultProps() {
        return {
            mode: 'book',
            usersOnly: false,
            usersFrom: 'any',
            teamsOnly: false,
            disableSearch: false
        };
    },

    getInitialState: function getInitialState() {
        var _this = this;

        var _props = this.props;
        var pydio = _props.pydio;
        var mode = _props.mode;
        var usersOnly = _props.usersOnly;
        var usersFrom = _props.usersFrom;
        var teamsOnly = _props.teamsOnly;
        var disableSearch = _props.disableSearch;

        var getMessage = function getMessage(id) {
            return _this.props.getMessage(id, '');
        };
        var authConfigs = pydio.getPluginConfigs('core.auth');

        var root = undefined;
        if (teamsOnly) {
            root = {
                id: 'teams',
                label: getMessage(568),
                childrenLoader: _Loaders2['default'].loadTeams,
                _parent: null,
                _notSelectable: true,
                actions: {
                    type: 'teams',
                    create: '+ ' + getMessage(569),
                    remove: getMessage(570),
                    multiple: true
                }
            };
            return {
                root: root,
                selectedItem: root,
                loading: false,
                rightPaneItem: null
            };
        }

        root = {
            id: 'root',
            label: getMessage(592),
            type: 'root',
            collections: []
        };
        if (usersFrom !== 'remote') {
            if (authConfigs.get('USER_CREATE_USERS')) {
                root.collections.push({
                    id: 'ext',
                    label: getMessage(593),
                    icon: 'mdi mdi-account-network',
                    itemsLoader: _Loaders2['default'].loadExternalUsers,
                    _parent: root,
                    _notSelectable: true,
                    actions: {
                        type: 'users',
                        create: '+ ' + getMessage(484),
                        remove: getMessage(582),
                        multiple: true
                    }
                });
            }
            if (!usersOnly) {
                root.collections.push({
                    id: 'teams',
                    label: getMessage(568),
                    icon: 'mdi mdi-account-multiple',
                    childrenLoader: _Loaders2['default'].loadTeams,
                    _parent: root,
                    _notSelectable: true,
                    actions: {
                        type: 'teams',
                        create: '+ ' + getMessage(569),
                        remove: getMessage(570),
                        multiple: true
                    }
                });
            }
            root.collections.push({
                id: 'PYDIO_GRP_/',
                label: getMessage(584),
                icon: 'mdi mdi-account-box',
                childrenLoader: _Loaders2['default'].loadGroups,
                itemsLoader: _Loaders2['default'].loadGroupUsers,
                _parent: root,
                _notSelectable: true
            });
        }

        var ocsRemotes = pydio.getPluginConfigs('core.ocs').get('TRUSTED_SERVERS');
        if (ocsRemotes && !usersOnly && usersFrom !== 'local') {
            var remotes = JSON.parse(ocsRemotes);
            var remotesNodes = {
                id: 'remotes',
                label: getMessage(594),
                //icon:'mdi mdi-server',
                collections: [],
                _parent: root,
                _notSelectable: true
            };
            for (var k in remotes) {
                if (!remotes.hasOwnProperty(k)) continue;
                remotesNodes.collections.push({
                    id: k,
                    label: remotes[k],
                    icon: 'mdi mdi-server-network',
                    type: 'remote',
                    _parent: remotesNodes,
                    _notSelectable: true
                });
            }
            if (remotesNodes.collections.length) {
                root.collections.push(remotesNodes);
            }
        }

        return {
            root: root,
            selectedItem: mode === 'selector' ? root : root.collections[0],
            loading: false,
            rightPaneItem: null
        };
    },

    componentDidMount: function componentDidMount() {
        this.state.selectedItem && this.onFolderClicked(this.state.selectedItem);
    },

    onFolderClicked: function onFolderClicked(item) {
        var _this2 = this;

        var callback = arguments.length <= 1 || arguments[1] === undefined ? undefined : arguments[1];

        // Special case for teams
        if (this.props.mode === 'selector' && item.IdmRole && item.IdmRole.IsTeam) {
            this.onUserListItemClicked(item);
            return;
        }
        this.setState({ loading: true });

        _Loaders2['default'].childrenAsPromise(item, false).then(function (children) {
            _Loaders2['default'].childrenAsPromise(item, true).then(function (children) {
                _this2.setState({ selectedItem: item, loading: false }, callback);
            });
        });
    },

    onUserListItemClicked: function onUserListItemClicked(item) {
        if (this.props.onItemSelected) {
            var uObject = new PydioUsers.User(item.id, item.label, item.type, item.group, item.avatar, item.temporary, item.external);
            if (item.trusted_server_id) {
                uObject.trustedServerId = item.trusted_server_id;
                uObject.trustedServerLabel = item.trusted_server_label;
            }
            uObject._uuid = item.uuid;
            if (item.IdmUser) uObject.IdmUser = item.IdmUser;
            if (item.IdmRole) uObject.IdmRole = item.IdmRole;
            this.props.onItemSelected(uObject);
        } else {
            this.setState({ rightPaneItem: item });
        }
    },

    onCreateAction: function onCreateAction(item) {
        this.setState({ createDialogItem: item });
    },

    closeCreateDialogAndReload: function closeCreateDialogAndReload() {
        this.setState({ createDialogItem: null });
        this.reloadCurrentNode();
    },

    onCardUpdateAction: function onCardUpdateAction(item) {
        if (item._parent && item._parent === this.state.selectedItem) {
            this.reloadCurrentNode();
        }
    },

    onDeleteAction: function onDeleteAction(parentItem, selection) {
        var _this3 = this;

        var skipConfirm = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

        if (!skipConfirm && !confirm(this.props.getMessage(278))) {
            return;
        }
        switch (parentItem.actions.type) {
            case 'users':
                Promise.all(selection.map(function (user) {
                    if (_this3.state.rightPaneItem === user) {
                        _this3.setState({ rightPaneItem: null });
                    }
                    return _pydioHttpApi2['default'].getRestClient().getIdmApi().deleteIdmUser(user.IdmUser);
                })).then(function () {
                    _this3.reloadCurrentNode();
                });
                break;
            case 'teams':
                Promise.all(selection.map(function (team) {
                    if (_this3.state.rightPaneItem === team) {
                        _this3.setState({ rightPaneItem: null });
                    }
                    return _pydioHttpApi2['default'].getRestClient().getIdmApi().deleteRole(team.IdmRole.Uuid);
                })).then(function () {
                    _this3.reloadCurrentNode();
                });
                break;
            case 'team':
                Promise.all(selection.map(function (user) {
                    return _pydioHttpApi2['default'].getRestClient().getIdmApi().removeUserFromTeam(parentItem.IdmRole.Uuid, user.IdmUser.Login);
                })).then(function () {
                    _this3.reloadCurrentNode();
                });
                break;
            default:
                break;
        }
    },

    openPopover: function openPopover(event) {
        this.setState({
            popoverOpen: true,
            popoverAnchor: event.currentTarget
        });
    },

    closePopover: function closePopover() {
        this.setState({ popoverOpen: false });
    },

    reloadCurrentNode: function reloadCurrentNode() {
        var _this4 = this;

        this.state.selectedItem.leafLoaded = false;
        this.state.selectedItem.collectionsLoaded = false;
        this.onFolderClicked(this.state.selectedItem, function () {
            if (_this4.state.rightPaneItem) {
                (function () {
                    var rPaneId = _this4.state.rightPaneItem.id;
                    var foundItem = null;
                    var leafs = _this4.state.selectedItem.leafs || [];
                    var collections = _this4.state.selectedItem.collections || [];
                    [].concat(leafs, collections).forEach(function (leaf) {
                        if (leaf.id === rPaneId) foundItem = leaf;
                    });
                    _this4.setState({ rightPaneItem: foundItem });
                })();
            }
        });
    },

    reloadCurrentAtPage: function reloadCurrentAtPage(letterOrRange) {
        this.state.selectedItem.leafLoaded = false;
        this.state.selectedItem.collectionsLoaded = false;
        if (letterOrRange === -1) {
            this.state.selectedItem.currentParams = null;
        } else if (letterOrRange.indexOf('-') !== -1) {
            this.state.selectedItem.range = letterOrRange;
        } else {
            this.state.selectedItem.range = null;
            this.state.selectedItem.currentParams = { alpha_pages: 'true', value: letterOrRange };
        }
        this.onFolderClicked(this.state.selectedItem);
    },

    reloadCurrentWithSearch: function reloadCurrentWithSearch(value) {
        if (!value) {
            this.reloadCurrentAtPage(-1);
            return;
        }
        this.state.selectedItem.leafLoaded = false;
        this.state.selectedItem.collectionsLoaded = false;
        this.state.selectedItem.currentParams = { has_search: true, value: value, existing_only: true };
        this.onFolderClicked(this.state.selectedItem);
    },

    render: function render() {
        var _this5 = this;

        var _props2 = this.props;
        var mode = _props2.mode;
        var getMessage = _props2.getMessage;
        var bookColumn = _props2.bookColumn;

        if (mode === 'popover') {

            var popoverStyle = this.props.popoverStyle || {};
            var popoverContainerStyle = this.props.popoverContainerStyle || {};
            var iconButtonStyle = this.props.popoverIconButtonStyle || {};
            var iconButton = _react2['default'].createElement(_materialUi.IconButton, {
                style: _extends({ position: 'absolute', padding: 15, zIndex: 100, right: 0, top: 25, display: this.state.loading ? 'none' : 'initial' }, iconButtonStyle),
                iconStyle: { fontSize: 19, color: 'rgba(0,0,0,0.6)' },
                iconClassName: 'mdi mdi-book-open-variant',
                onTouchTap: this.openPopover
            });
            if (this.props.popoverButton) {
                iconButton = _react2['default'].createElement(this.props.popoverButton.type, _extends({}, this.props.popoverButton.props, { onTouchTap: this.openPopover }));
            }
            return _react2['default'].createElement(
                'span',
                null,
                iconButton,
                _react2['default'].createElement(
                    _materialUi.Popover,
                    {
                        open: this.state.popoverOpen,
                        anchorEl: this.state.popoverAnchor,
                        anchorOrigin: { horizontal: 'right', vertical: 'top' },
                        targetOrigin: { horizontal: 'left', vertical: 'top' },
                        onRequestClose: this.closePopover,
                        style: _extends({ marginLeft: 20 }, popoverStyle),
                        zDepth: 2
                    },
                    _react2['default'].createElement(
                        'div',
                        { style: _extends({ width: 320, height: 420 }, popoverContainerStyle) },
                        _react2['default'].createElement(AddressBook, _extends({}, this.props, { mode: 'selector' }))
                    )
                )
            );
        }

        var _state = this.state;
        var selectedItem = _state.selectedItem;
        var root = _state.root;
        var rightPaneItem = _state.rightPaneItem;
        var createDialogItem = _state.createDialogItem;

        var leftColumnStyle = {
            backgroundColor: _materialUiStyles.colors.grey100,
            width: 256,
            overflowY: 'auto',
            overflowX: 'hidden'
        };
        var centerComponent = undefined,
            rightPanel = undefined,
            leftPanel = undefined,
            topActionsPanel = undefined,
            onEditLabel = undefined;

        if (selectedItem.id === 'search') {

            centerComponent = _react2['default'].createElement(_SearchPanel2['default'], {
                item: selectedItem,
                title: getMessage(583, ''),
                searchLabel: getMessage(595, ''),
                onItemClicked: this.onUserListItemClicked,
                onFolderClicked: this.onFolderClicked,
                mode: mode
            });
        } else if (selectedItem.type === 'remote') {

            centerComponent = _react2['default'].createElement(_SearchPanel2['default'], {
                item: selectedItem,
                params: { trusted_server_id: selectedItem.id },
                searchLabel: getMessage(595, ''),
                title: getMessage(596, '').replace('%s', selectedItem.label),
                onItemClicked: this.onUserListItemClicked,
                onFolderClicked: this.onFolderClicked,
                mode: mode
            });
        } else {

            var emptyStatePrimary = undefined;
            var emptyStateSecondary = undefined;
            var otherProps = {};
            if (selectedItem.id === 'teams') {
                emptyStatePrimary = getMessage(571, '');
                emptyStateSecondary = getMessage(572, '');
            } else if (selectedItem.id === 'ext') {
                emptyStatePrimary = getMessage(585, '');
                emptyStateSecondary = getMessage(586, '');
            } else if (selectedItem.IdmUser && selectedItem.IdmUser.IsGroup || selectedItem.id === 'PYDIO_GRP_/') {
                otherProps = {
                    showSubheaders: true,
                    paginatorType: !(selectedItem.currentParams && selectedItem.currentParams.has_search) && 'alpha',
                    paginatorCallback: this.reloadCurrentAtPage.bind(this),
                    enableSearch: !this.props.disableSearch,
                    searchLabel: getMessage(595, ''),
                    onSearch: this.reloadCurrentWithSearch.bind(this)
                };
            }

            if ((mode === 'book' || bookColumn) && selectedItem.IdmRole && selectedItem.IdmRole.IsTeam) {
                topActionsPanel = _react2['default'].createElement(_avatarActionsPanel2['default'], _extends({}, this.props, {
                    team: selectedItem,
                    userEditable: true,
                    reloadAction: function () {
                        _this5.reloadCurrentNode();
                    },
                    onDeleteAction: function () {
                        if (confirm(_this5.props.getMessage(278))) {
                            (function () {
                                var parent = selectedItem._parent;
                                _this5.setState({ selectedItem: parent }, function () {
                                    _this5.onDeleteAction(parent, [selectedItem], true);
                                });
                            })();
                        }
                    },
                    style: { backgroundColor: 'transparent', borderTop: 0, borderBottom: 0 }
                }));
                onEditLabel = function (item, newLabel) {
                    _pydioHttpApi2['default'].getRestClient().getIdmApi().updateTeamLabel(item.IdmRole.Uuid, newLabel, function () {
                        var parent = selectedItem._parent;
                        _this5.setState({ selectedItem: parent }, function () {
                            _this5.reloadCurrentNode();
                        });
                    });
                };
            }

            centerComponent = _react2['default'].createElement(_UsersList2['default'], _extends({
                item: selectedItem,
                onItemClicked: this.onUserListItemClicked,
                onFolderClicked: this.onFolderClicked,
                onCreateAction: this.onCreateAction,
                onDeleteAction: this.onDeleteAction,
                reloadAction: this.reloadCurrentNode.bind(this),
                onEditLabel: onEditLabel,
                loading: this.state.loading,
                mode: mode,
                bookColumn: bookColumn,
                emptyStatePrimaryText: emptyStatePrimary,
                emptyStateSecondaryText: emptyStateSecondary,
                onTouchTap: this.state.rightPaneItem ? function () {
                    _this5.setState({ rightPaneItem: null });
                } : null,
                actionsPanel: topActionsPanel,
                actionsForCell: this.props.actionsForCell
            }, otherProps));
        }
        var rightPanelStyle = _extends({}, leftColumnStyle, {
            position: 'absolute',
            transformOrigin: 'right',
            backgroundColor: 'white',
            right: 8,
            bottom: 8,
            top: 120,
            zIndex: 2
        });
        if (!rightPaneItem) {
            rightPanelStyle = _extends({}, rightPanelStyle, {
                //transform: 'translateX(256px)',
                transform: 'scale(0)'
            });
        }
        //                width: 0
        rightPanel = _react2['default'].createElement(_RightPanelCard2['default'], {
            pydio: this.props.pydio,
            onRequestClose: function () {
                _this5.setState({ rightPaneItem: null });
            },
            style: rightPanelStyle,
            onCreateAction: this.onCreateAction,
            onDeleteAction: this.onDeleteAction,
            onUpdateAction: this.onCardUpdateAction,
            item: rightPaneItem });
        if (mode === 'book') {
            (function () {
                var nestedRoots = [];
                root.collections.map((function (e) {
                    nestedRoots.push(_react2['default'].createElement(_NestedListItem2['default'], {
                        key: e.id,
                        selected: selectedItem.id,
                        nestedLevel: 0,
                        entry: e,
                        onTouchTap: this.onFolderClicked
                    }));
                    nestedRoots.push(_react2['default'].createElement(_materialUi.Divider, { key: e.id + '-divider' }));
                }).bind(_this5));
                nestedRoots.pop();
                leftPanel = _react2['default'].createElement(
                    MaterialUI.Paper,
                    { zDepth: 1, style: _extends({}, leftColumnStyle, { zIndex: 2 }) },
                    _react2['default'].createElement(
                        MaterialUI.List,
                        null,
                        nestedRoots
                    )
                );
            })();
        }

        var dialogTitle = undefined,
            dialogContent = undefined;
        if (createDialogItem) {
            if (createDialogItem.actions.type === 'users') {
                dialogTitle = getMessage(484, '');
                dialogContent = _react2['default'].createElement(
                    'div',
                    { style: { height: 500 } },
                    _react2['default'].createElement(_UserCreationForm2['default'], {
                        zDepth: 0,
                        style: { height: 500 },
                        newUserName: "",
                        onUserCreated: this.closeCreateDialogAndReload.bind(this),
                        onCancel: function () {
                            _this5.setState({ createDialogItem: null });
                        },
                        pydio: this.props.pydio
                    })
                );
            } else if (createDialogItem.actions.type === 'teams') {
                dialogTitle = getMessage(569, '');
                dialogContent = _react2['default'].createElement(_TeamCreationForm2['default'], {
                    onTeamCreated: this.closeCreateDialogAndReload,
                    onCancel: function () {
                        _this5.setState({ createDialogItem: null });
                    }
                });
            } else if (createDialogItem.actions.type === 'team') {
                var selectUser = function selectUser(item) {
                    _pydioHttpApi2['default'].getRestClient().getIdmApi().addUserToTeam(createDialogItem.IdmRole.Uuid, item.IdmUser.Login).then(function () {
                        _this5.reloadCurrentNode();
                    });
                };
                dialogTitle = null;
                dialogContent = _react2['default'].createElement(AddressBook, {
                    pydio: this.props.pydio,
                    mode: 'selector',
                    usersOnly: true,
                    disableSearch: true,
                    onItemSelected: selectUser
                });
            }
        }

        var style = this.props.style || {};
        return _react2['default'].createElement(
            'div',
            { style: _extends({ display: 'flex', height: mode === 'selector' ? 420 : 450 }, style) },
            leftPanel,
            centerComponent,
            rightPanel,
            _react2['default'].createElement(
                MaterialUI.Dialog,
                {
                    contentStyle: { width: 380, minWidth: 380, maxWidth: 380, padding: 0 },
                    bodyStyle: { padding: 0 },
                    title: _react2['default'].createElement(
                        'div',
                        { style: { padding: 20 } },
                        dialogTitle
                    ),
                    actions: null,
                    modal: false,
                    open: createDialogItem ? true : false,
                    onRequestClose: function () {
                        _this5.setState({ createDialogItem: null });
                    }
                },
                dialogContent
            )
        );
    }

});

exports['default'] = AddressBook = PydioContextConsumer(AddressBook);
exports['default'] = AddressBook = _materialUiStyles.muiThemeable()(AddressBook);
exports['default'] = AddressBook;
module.exports = exports['default'];

},{"../TeamCreationForm":41,"../UserCreationForm":42,"../avatar/ActionsPanel":54,"./Loaders":46,"./NestedListItem":47,"./RightPanelCard":48,"./SearchPanel":50,"./UsersList":53,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","pydio/http/api":"pydio/http/api","react":"react"}],45:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _materialUiStyles = require('material-ui/styles');

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _materialUi = require('material-ui');

/**
 * Alphabet and pages generator to give a first-letter-based pagination
 */

var _Pydio$requireLib = _pydio2['default'].requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;

var AlphaPaginator = (function (_Component) {
    _inherits(AlphaPaginator, _Component);

    function AlphaPaginator() {
        _classCallCheck(this, AlphaPaginator);

        _Component.apply(this, arguments);
    }

    AlphaPaginator.prototype.render = function render() {

        var letters = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');
        letters = [-1].concat(letters);
        var _props = this.props;
        var item = _props.item;
        var paginatorCallback = _props.paginatorCallback;
        var style = _props.style;
        var getMessage = _props.getMessage;

        var paginator = undefined;
        if (item.pagination) {
            (function () {
                var _item$pagination = item.pagination;
                var start = _item$pagination.start;
                var end = _item$pagination.end;
                var max = _item$pagination.max;
                var interval = _item$pagination.interval;

                var total_pages = Math.ceil(max / interval);
                var current = Math.ceil(start / interval);
                var pages = [];
                for (var i = 0; i < total_pages; i++) {
                    pages.push(i);
                }paginator = React.createElement(
                    _materialUi.SelectField,
                    { floatingLabelText: getMessage(331), style: { width: 60 }, fullWidth: true, value: current, onChange: function (e, i, v) {
                            paginatorCallback(v * interval + '-' + (v + 1) * interval);
                        } },
                    pages.map(function (p) {
                        return React.createElement(_materialUi.MenuItem, { value: p, key: p, primaryText: p + 1 });
                    })
                );
            })();
        }

        var currentPage = item.currentParams && item.currentParams.alpha_pages && item.currentParams.value || -1;

        return React.createElement(
            'div',
            { style: _extends({}, style, { display: 'flex', paddingRight: 8, alignItems: 'center' }) },
            React.createElement(
                'div',
                { style: { flex: 1 } },
                getMessage(249, '')
            ),
            paginator,
            React.createElement(
                _materialUi.SelectField,
                { floatingLabelText: getMessage(625), style: { width: 60, marginLeft: 20 }, fullWidth: true, value: currentPage, onChange: function (e, i, v) {
                        paginatorCallback(v);
                    } },
                letters.map(function (l) {
                    return React.createElement(_materialUi.MenuItem, { value: l, key: l, primaryText: l === -1 ? getMessage(597, '') : l });
                })
            )
        );
    };

    return AlphaPaginator;
})(_react.Component);

AlphaPaginator.propTypes = {
    /**
     * Currently selected Item
     */
    item: _react.PropTypes.object,
    /**
     * When a letter is clicked, function(letter)
     */
    paginatorCallback: _react.PropTypes.func.isRequired,
    /**
     * Main instance of pydio
     */
    pydio: _react.PropTypes.instanceOf(_pydio2['default']),
    /**
     * Display mode, either large (book) or small picker ('selector', 'popover').
     */
    mode: _react.PropTypes.oneOf(['book', 'selector', 'popover']).isRequired
};

exports['default'] = AlphaPaginator = PydioContextConsumer(AlphaPaginator);
exports['default'] = AlphaPaginator = _materialUiStyles.muiThemeable()(AlphaPaginator);

exports['default'] = AlphaPaginator;
module.exports = exports['default'];

},{"material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","react":"react"}],46:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

var _pydioUtilLang = require('pydio/util/lang');

var _pydioUtilLang2 = _interopRequireDefault(_pydioUtilLang);

var IdmApi = _pydioHttpApi2['default'].getRestClient().getIdmApi();

var Loaders = (function () {
    function Loaders() {
        _classCallCheck(this, Loaders);
    }

    Loaders.childrenAsPromise = function childrenAsPromise(item) {
        var leaf = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];
        var childrenLoader = item.childrenLoader;
        var itemsLoader = item.itemsLoader;
        var leafLoaded = item.leafLoaded;
        var collectionsLoaded = item.collectionsLoaded;
        var leafs = item.leafs;
        var collections = item.collections;

        var loader = leaf ? itemsLoader : childrenLoader;
        var loaded = leaf ? leafLoaded : collectionsLoaded;
        return new Promise(function (resolve, reject) {
            if (!loaded && loader) {
                loader(item, function (newChildren) {
                    if (leaf) {
                        item.leafs = newChildren;
                        item.leafLoaded = true;
                    } else {
                        item.collections = newChildren;
                        item.collectionsLoaded = true;
                    }
                    resolve(newChildren);
                });
            } else {
                var res = (leaf ? leafs : collections) || [];
                resolve(res);
            }
        });
    };

    Loaders.computePagination = function computePagination(result) {
        var count = undefined;
        if (result.Users) {
            count = result.Users.length;
        } else if (result.Groups) {
            count = result.Groups.length;
        } else if (result.Teams) {
            count = result.Teams.length;
        }
        if (result.Total > count) {
            return {
                start: result.Offset,
                end: result.Offset + result.Limit,
                max: result.Total,
                interval: result.Limit
            };
        } else {
            return null;
        }
    };

    Loaders.loadTeams = function loadTeams(entry, callback) {
        var offset = 0,
            limit = 50;
        if (entry.range) {
            var _entry$range$split = entry.range.split('-');

            var start = _entry$range$split[0];
            var end = _entry$range$split[1];

            offset = parseInt(start);
            end = parseInt(end);
            limit = end - offset;
        }
        IdmApi.listTeams('', offset, limit).then(function (collection) {
            entry.pagination = Loaders.computePagination(collection);
            var items = collection.Teams.map(function (team) {
                return {
                    _parent: entry,
                    id: team.Uuid,
                    label: team.Label,
                    type: 'team',
                    icon: 'mdi mdi-account-multiple-outline',
                    itemsLoader: Loaders.loadTeamUsers,
                    actions: {
                        type: 'team',
                        remove: '574',
                        multiple: true
                    },
                    _notSelectable: true,
                    IdmRole: team
                };
            });
            callback(items);
        });
    };

    Loaders.loadGroups = function loadGroups(entry, callback) {
        var path = '/',
            filter = '';
        if (entry.IdmUser) {
            path = _pydioUtilLang2['default'].trimRight(entry.IdmUser.GroupPath, '/') + '/' + entry.IdmUser.GroupLabel;
        }
        if (entry.currentParams && entry.currentParams.has_search) {
            filter = entry.currentParams.value;
        }

        IdmApi.listGroups(path, filter, false, 0, 1000).then(function (groups) {
            var items = groups.Groups.map(function (idmUser) {
                return {
                    _parent: entry,
                    id: idmUser.Uuid,
                    label: idmUser.GroupLabel,
                    type: 'group',
                    icon: 'mdi mdi-account-multiple',
                    childrenLoader: entry.childrenLoader ? Loaders.loadGroups : null,
                    itemsLoader: entry.itemsLoader ? Loaders.loadGroupUsers : null,
                    currentParams: entry.currentParams && entry.currentParams.alpha_pages ? _extends({}, entry.currentParams) : {},
                    IdmUser: idmUser
                };
            });
            callback(items);
        });
    };

    Loaders.loadExternalUsers = function loadExternalUsers(entry, callback) {
        var filter = '',
            offset = 0,
            limit = 50;
        if (entry.currentParams && entry.currentParams.alpha_pages) {
            filter = entry.currentParams.value;
        }
        if (entry.range) {
            var _entry$range$split2 = entry.range.split('-');

            var start = _entry$range$split2[0];
            var end = _entry$range$split2[1];

            offset = parseInt(start);
            end = parseInt(end);
            limit = end - offset;
        }
        var pydio = _pydioHttpApi2['default'].getClient().getPydioObject();
        IdmApi.listUsers('/', filter, true, offset, limit, 'shared').then(function (users) {
            entry.pagination = Loaders.computePagination(users);
            var items = users.Users.filter(function (idmUser) {
                return idmUser.Login !== pydio.user.id;
            }).map(function (idmUser) {
                return {
                    _parent: entry,
                    id: idmUser.Login,
                    label: idmUser.Attributes && idmUser.Attributes["displayName"] ? idmUser.Attributes["displayName"] : idmUser.Login,
                    avatar: idmUser.Attributes && idmUser.Attributes["avatar"] ? idmUser.Attributes["avatar"] : undefined,
                    type: 'user',
                    external: true,
                    IdmUser: idmUser
                };
            });
            callback(items);
        });
    };

    Loaders.loadGroupUsers = function loadGroupUsers(entry, callback) {
        var path = '/',
            filter = '',
            offset = 0,
            limit = 50;
        if (entry.IdmUser) {
            path = _pydioUtilLang2['default'].trimRight(entry.IdmUser.GroupPath, '/') + '/' + entry.IdmUser.GroupLabel;
        }
        if (entry.currentParams && (entry.currentParams.alpha_pages || entry.currentParams.has_search)) {
            filter = entry.currentParams.value;
        }
        if (entry.range) {
            var _entry$range$split3 = entry.range.split('-');

            var start = _entry$range$split3[0];
            var end = _entry$range$split3[1];

            offset = parseInt(start);
            end = parseInt(end);
            limit = end - offset;
        }
        var pydio = _pydioHttpApi2['default'].getClient().getPydioObject();
        IdmApi.listUsers(path, filter, false, offset, limit, '!shared').then(function (users) {
            entry.pagination = Loaders.computePagination(users);
            var items = users.Users.filter(function (idmUser) {
                return idmUser.Login !== pydio.user.id && idmUser.Login !== "pydio.anon.user";
            }).map(function (idmUser) {
                return {
                    _parent: entry,
                    id: idmUser.Login,
                    label: idmUser.Attributes && idmUser.Attributes["displayName"] ? idmUser.Attributes["displayName"] : idmUser.Login,
                    avatar: idmUser.Attributes && idmUser.Attributes["avatar"] ? idmUser.Attributes["avatar"] : undefined,
                    type: 'user',
                    IdmUser: idmUser
                };
            });
            callback(items);
        });
    };

    Loaders.loadTeamUsers = function loadTeamUsers(entry, callback) {
        var offset = 0,
            limit = 50;
        if (entry.range) {
            var _entry$range$split4 = entry.range.split('-');

            var start = _entry$range$split4[0];
            var end = _entry$range$split4[1];

            offset = parseInt(start);
            end = parseInt(end);
            limit = end - offset;
        }
        IdmApi.listUsersWithRole(entry.IdmRole.Uuid, offset, limit).then(function (users) {
            entry.pagination = Loaders.computePagination(users);
            var items = users.Users.map(function (idmUser) {
                return {
                    _parent: entry,
                    id: idmUser.Login,
                    label: idmUser.Attributes && idmUser.Attributes["displayName"] ? idmUser.Attributes["displayName"] : idmUser.Login,
                    type: 'user',
                    IdmUser: idmUser
                };
            });
            callback(items);
        });
    };

    return Loaders;
})();

exports['default'] = Loaders;
module.exports = exports['default'];

},{"pydio/http/api":"pydio/http/api","pydio/util/lang":"pydio/util/lang"}],47:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _materialUi = require('material-ui');

/**
 * Left panel of the address book
 * Display treeview hierarchy of users, teams, groups.
 */

var NestedListItem = (function (_Component) {
    _inherits(NestedListItem, _Component);

    function NestedListItem() {
        _classCallCheck(this, NestedListItem);

        _Component.apply(this, arguments);
    }

    /**
     * Triggers this.props.onTouchTap
     */

    NestedListItem.prototype.onTouchTap = function onTouchTap() {
        this.props.onTouchTap(this.props.entry);
    };

    /**
     * Recursively build other NestedListItem
     * @param data
     */

    NestedListItem.prototype.buildNestedItems = function buildNestedItems(data) {
        return data.map((function (entry) {
            return React.createElement(NestedListItem, {
                nestedLevel: this.props.nestedLevel + 1,
                entry: entry,
                onTouchTap: this.props.onTouchTap,
                selected: this.props.selected,
                showIcons: true
            });
        }).bind(this));
    };

    NestedListItem.prototype.render = function render() {
        var _props = this.props;
        var showIcons = _props.showIcons;
        var entry = _props.entry;
        var selected = _props.selected;
        var id = entry.id;
        var label = entry.label;
        var icon = entry.icon;

        var children = entry.collections || [];
        var nested = this.buildNestedItems(children);
        var fontIcon = undefined;
        if (icon && showIcons) {
            fontIcon = React.createElement(_materialUi.FontIcon, { className: icon });
        }
        return React.createElement(_materialUi.ListItem, {
            nestedLevel: this.props.nestedLevel,
            key: id,
            primaryText: label,
            onTouchTap: this.onTouchTap.bind(this),
            nestedItems: nested,
            initiallyOpen: true,
            leftIcon: fontIcon,
            innerDivStyle: { fontWeight: selected === entry.id ? 500 : 400 },
            style: selected === entry.id ? { backgroundColor: "#efefef" } : {}
        });
    };

    return NestedListItem;
})(_react.Component);

NestedListItem.propTypes = {
    /**
     * Keeps track of the current depth level
     */
    nestedLevel: _react.PropTypes.number,
    /**
     * Currently selected node id
     */
    selected: _react.PropTypes.string,
    /**
     * Callback triggered when an entry is selected
     */
    onTouchTap: _react.PropTypes.func
};

exports['default'] = NestedListItem;
module.exports = exports['default'];

},{"material-ui":"material-ui","react":"react"}],48:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _TeamCard = require('./TeamCard');

var _TeamCard2 = _interopRequireDefault(_TeamCard);

var _UserCard = require('./UserCard');

var _UserCard2 = _interopRequireDefault(_UserCard);

var React = require('react');

var _require = require('material-ui');

var Paper = _require.Paper;
var IconButton = _require.IconButton;

/**
 * Container for UserCard or TeamCard
 */

var RightPanelCard = (function (_React$Component) {
  _inherits(RightPanelCard, _React$Component);

  function RightPanelCard() {
    _classCallCheck(this, RightPanelCard);

    _React$Component.apply(this, arguments);
  }

  RightPanelCard.prototype.render = function render() {

    var content = undefined;
    var item = this.props.item || {};
    if (item.type === 'user') {
      content = React.createElement(_UserCard2['default'], this.props);
    } else if (item.IdmRole && item.IdmRole.IsTeam) {
      content = React.createElement(_TeamCard2['default'], this.props);
    }

    return React.createElement(
      Paper,
      { zDepth: 2, style: _extends({ position: 'relative' }, this.props.style) },
      React.createElement(IconButton, { iconClassName: "mdi mdi-close", style: { position: 'absolute', top: 0, right: 0 }, iconStyle: { color: '#e0e0e0' }, onTouchTap: this.props.onRequestClose }),
      content
    );
  };

  return RightPanelCard;
})(React.Component);

RightPanelCard.propTypes = {
  /**
   * Pydio instance
   */
  pydio: React.PropTypes.instanceOf(Pydio),
  /**
   * Selected item
   */
  item: React.PropTypes.object,
  /**
   * Applies to root container
   */
  style: React.PropTypes.object,
  /**
   * Forwarded to child
   */
  onRequestClose: React.PropTypes.func,
  /**
   * Forwarded to child
   */
  onDeleteAction: React.PropTypes.func,
  /**
   * Forwarded to child
   */
  onUpdateAction: React.PropTypes.func
};

exports['default'] = RightPanelCard;
module.exports = exports['default'];

},{"./TeamCard":51,"./UserCard":52,"material-ui":"material-ui","react":"react"}],49:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _materialUi = require('material-ui');

var _lodashDebounce = require('lodash.debounce');

var _lodashDebounce2 = _interopRequireDefault(_lodashDebounce);

/**
 * Ready to use Form + Result List for search users
 */

var SearchForm = (function (_Component) {
    _inherits(SearchForm, _Component);

    function SearchForm(props, context) {
        _classCallCheck(this, SearchForm);

        _Component.call(this, props, context);
        this.state = { value: '' };
        this.search = _lodashDebounce2['default'](this.search.bind(this), 300);
    }

    SearchForm.prototype.search = function search() {
        this.props.onSearch(this.state.value);
    };

    SearchForm.prototype.onChange = function onChange(event, value) {
        this.setState({ value: value });
        this.search();
    };

    SearchForm.prototype.render = function render() {
        var _props = this.props;
        var underlineShow = _props.underlineShow;
        var searchLabel = _props.searchLabel;
        var style = _props.style;
        var value = this.state.value;

        return React.createElement(
            'div',
            { style: _extends({ minWidth: 320 }, style) },
            React.createElement(_materialUi.TextField, {
                fullWidth: true,
                value: value,
                onChange: this.onChange.bind(this),
                hintText: searchLabel,
                underlineShow: underlineShow === undefined ? true : underlineShow
            })
        );
    };

    return SearchForm;
})(_react.Component);

SearchForm.propTypes = {
    /**
     * Label displayed in the search field
     */
    searchLabel: _react.PropTypes.string.isRequired,
    /**
     * Callback triggered to search
     */
    onSearch: _react.PropTypes.func.isRequired,
    /**
     * Will be appended to the root element
     */
    style: _react.PropTypes.object,
    /**
     * To be applied on TextField
     */
    underlineShow: _react.PropTypes.bool
};

exports['default'] = SearchForm;
module.exports = exports['default'];

},{"lodash.debounce":"lodash.debounce","material-ui":"material-ui","react":"react"}],50:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _SearchForm = require('./SearchForm');

var _SearchForm2 = _interopRequireDefault(_SearchForm);

var _UsersList = require('./UsersList');

var _UsersList2 = _interopRequireDefault(_UsersList);

var _Loaders = require('./Loaders');

var _Loaders2 = _interopRequireDefault(_Loaders);

/**
 * Ready to use Form + Result List for search users
 */

var _require = require('react');

var Component = _require.Component;
var PropTypes = _require.PropTypes;

var _require$requireLib = require('pydio').requireLib('boot');

var PydioContextConsumer = _require$requireLib.PydioContextConsumer;

var SearchPanel = (function (_Component) {
    _inherits(SearchPanel, _Component);

    function SearchPanel(props, context) {
        _classCallCheck(this, SearchPanel);

        _Component.call(this, props.context);
        this.state = { items: [] };
    }

    SearchPanel.prototype.onSearch = function onSearch(value) {
        var _this = this;

        if (!value) {
            this.setState({ items: [] });
            return;
        }
        var params = { value: value, existing_only: 'true' };
        if (this.props.params) {
            params = _extends({}, params, this.props.params);
        }
        _Loaders2['default'].listUsers(params, function (children) {
            _this.setState({ items: children });
        });
    };

    SearchPanel.prototype.render = function render() {
        var _this2 = this;

        var _props = this.props;
        var mode = _props.mode;
        var item = _props.item;
        var getMessage = _props.getMessage;

        return React.createElement(
            'div',
            { style: { flex: 1, display: 'flex', flexDirection: 'column' } },
            React.createElement(
                'div',
                { style: { padding: 10, height: 56, backgroundColor: this.state.select ? activeTbarColor : '#fafafa', display: 'flex', alignItems: 'center', transition: DOMUtils.getBeziersTransition() } },
                mode === "selector" && item._parent && React.createElement(MaterialUI.IconButton, { iconClassName: 'mdi mdi-chevron-left', onTouchTap: function () {
                        _this2.props.onFolderClicked(item._parent);
                    } }),
                mode === 'book' && React.createElement(
                    'div',
                    { style: { fontSize: 20, color: 'rgba(0,0,0,0.87)', flex: 1 } },
                    this.props.title
                ),
                React.createElement(_SearchForm2['default'], { style: mode === 'book' ? { minWidth: 320 } : { flex: 1 }, searchLabel: this.props.searchLabel, onSearch: this.onSearch.bind(this) })
            ),
            React.createElement(_UsersList2['default'], {
                mode: this.props.mode,
                onItemClicked: this.props.onItemClicked,
                item: { leafs: this.state.items },
                noToolbar: true,
                emptyStatePrimaryText: getMessage(587, ''),
                emptyStateSecondaryText: getMessage(588, '')
            })
        );
    };

    return SearchPanel;
})(Component);

SearchPanel.propTypes = {
    /**
     * Optional parameters added to listUsers() request
     */
    params: PropTypes.object,
    /**
     * Label displayed in the toolbar
     */
    searchLabel: PropTypes.string,
    /**
     * Callback triggered when a search result is clicked
     */
    onItemClicked: PropTypes.func,
    /**
     * Currently selected item, required for navigation
     */
    item: PropTypes.object,
    /**
     * Callback triggered if the result is a collection
     */
    onFolderClicked: PropTypes.func
};

exports['default'] = SearchPanel = PydioContextConsumer(SearchPanel);
exports['default'] = SearchPanel;
module.exports = exports['default'];

},{"./Loaders":46,"./SearchForm":49,"./UsersList":53,"pydio":"pydio","react":"react"}],51:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _UsersList = require('./UsersList');

var _UsersList2 = _interopRequireDefault(_UsersList);

var _Loaders = require('./Loaders');

var _Loaders2 = _interopRequireDefault(_Loaders);

var _avatarActionsPanel = require('../avatar/ActionsPanel');

var _avatarActionsPanel2 = _interopRequireDefault(_avatarActionsPanel);

var _pydioHttpApi = require('pydio/http/api');

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

var React = require('react');

var _require = require('material-ui');

var TextField = _require.TextField;
var FlatButton = _require.FlatButton;
var CardTitle = _require.CardTitle;
var Divider = _require.Divider;

var _require$requireLib = require('pydio').requireLib('boot');

var PydioContextConsumer = _require$requireLib.PydioContextConsumer;

/**
 * Display info about a Team inside a popover-able card
 */

var TeamCard = (function (_React$Component) {
    _inherits(TeamCard, _React$Component);

    function TeamCard(props, context) {
        _classCallCheck(this, TeamCard);

        _React$Component.call(this, props, context);
        this.state = { label: this.props.item.label };
    }

    /**
     * Use loader to get team participants
     * @param item
     */

    TeamCard.prototype.loadMembers = function loadMembers(item) {
        var _this = this;

        this.setState({ loading: true });
        _Loaders2['default'].childrenAsPromise(item, false).then(function (children) {
            _Loaders2['default'].childrenAsPromise(item, true).then(function (children) {
                _this.setState({ members: item.leafs, loading: false });
            });
        });
    };

    TeamCard.prototype.componentWillMount = function componentWillMount() {
        this.loadMembers(this.props.item);
    };

    TeamCard.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
        this.loadMembers(nextProps.item);
        this.setState({ label: nextProps.item.label });
    };

    TeamCard.prototype.onLabelChange = function onLabelChange(e, value) {
        this.setState({ label: value });
    };

    TeamCard.prototype.updateLabel = function updateLabel() {
        var _this2 = this;

        if (this.state.label !== this.props.item.label) {
            _pydioHttpApi2['default'].getRestClient().getIdmApi().updateTeamLabel(this.props.item.IdmRole.Uuid, this.state.label, function () {
                _this2.props.onUpdateAction(_this2.props.item);
            });
        }
        this.setState({ editMode: false });
    };

    TeamCard.prototype.render = function render() {
        var _this3 = this;

        var _props = this.props;
        var item = _props.item;
        var onDeleteAction = _props.onDeleteAction;
        var onCreateAction = _props.onCreateAction;
        var getMessage = _props.getMessage;

        var editProps = {
            team: item,
            userEditable: this.props.item.IdmRole.PoliciesContextEditable,
            onDeleteAction: function onDeleteAction() {
                _this3.props.onDeleteAction(item._parent, [item]);
            },
            onEditAction: function onEditAction() {
                _this3.setState({ editMode: !_this3.state.editMode });
            },
            reloadAction: function reloadAction() {
                _this3.props.onUpdateAction(item);
            }
        };

        var title = undefined;
        if (this.state.editMode) {
            title = React.createElement(
                'div',
                { style: { display: 'flex', alignItems: 'center', margin: 16 } },
                React.createElement(TextField, { style: { flex: 1, fontSize: 24 }, fullWidth: true, disabled: false, underlineShow: false, value: this.state.label, onChange: this.onLabelChange.bind(this) }),
                React.createElement(FlatButton, { secondary: true, label: getMessage(48), onTouchTap: function () {
                        _this3.updateLabel();
                    } })
            );
        } else {
            title = React.createElement(CardTitle, { title: this.state.label, subtitle: item.leafs && item.leafs.length ? getMessage(576).replace('%s', item.leafs.length) : getMessage(577) });
        }
        var _props2 = this.props;
        var style = _props2.style;

        var otherProps = _objectWithoutProperties(_props2, ['style']);

        return React.createElement(
            'div',
            null,
            title,
            React.createElement(_avatarActionsPanel2['default'], _extends({}, otherProps, editProps)),
            React.createElement(Divider, null),
            React.createElement(_UsersList2['default'], { subHeader: getMessage(575), onItemClicked: function () {}, item: item, mode: 'inner', onDeleteAction: onDeleteAction })
        );
    };

    return TeamCard;
})(React.Component);

TeamCard.propTypes = {
    /**
     * Pydio instance
     */
    pydio: React.PropTypes.instanceOf(Pydio),
    /**
     * Team data object
     */
    item: React.PropTypes.object,
    /**
     * Applied to root container
     */
    style: React.PropTypes.object,
    /**
     * Called to dismiss the popover
     */
    onRequestClose: React.PropTypes.func,
    /**
     * Delete current team
     */
    onDeleteAction: React.PropTypes.func,
    /**
     * Update current team
     */
    onUpdateAction: React.PropTypes.func
};

exports['default'] = TeamCard = PydioContextConsumer(TeamCard);

exports['default'] = TeamCard;
module.exports = exports['default'];

},{"../avatar/ActionsPanel":54,"./Loaders":46,"./UsersList":53,"material-ui":"material-ui","pydio":"pydio","pydio/http/api":"pydio/http/api","react":"react"}],52:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _avatarUserAvatar = require('../avatar/UserAvatar');

var _avatarUserAvatar2 = _interopRequireDefault(_avatarUserAvatar);

var _UserCreationForm = require('../UserCreationForm');

var _UserCreationForm2 = _interopRequireDefault(_UserCreationForm);

/**
 * Card presentation of a user. Relies on the UserAvatar object,
 * plus the PydioForm.UserCreationForm when in edit mode.
 */

var UserCard = (function (_React$Component) {
    _inherits(UserCard, _React$Component);

    function UserCard(props, context) {
        _classCallCheck(this, UserCard);

        _React$Component.call(this, props, context);
        this.state = { editForm: false };
    }

    UserCard.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
        if (nextProps.item !== this.props.item) {
            this.setState({ editForm: false });
        }
    };

    UserCard.prototype.render = function render() {
        var _this = this;

        var item = this.props.item;

        var editableProps = {},
            editForm = undefined;
        if (item._parent && item._parent.id === 'ext') {
            editableProps = {
                userEditable: item.IdmUser.PoliciesContextEditable,
                onDeleteAction: function onDeleteAction() {
                    _this.props.onDeleteAction(item._parent, [item]);
                },
                onEditAction: function onEditAction() {
                    _this.setState({ editForm: true });
                },
                reloadAction: function reloadAction() {
                    _this.props.onUpdateAction(item);
                }
            };
        }

        if (this.state.editForm) {
            editForm = _react2['default'].createElement(_UserCreationForm2['default'], {
                pydio: this.props.pydio,
                zDepth: 0,
                style: { flex: 1 },
                newUserName: item.id,
                editMode: true,
                userData: item,
                onUserCreated: function () {
                    _this.props.onUpdateAction(item);_this.setState({ editForm: false });
                },
                onCancel: function () {
                    _this.setState({ editForm: false });
                }
            });
            editableProps = _extends({}, editableProps, {
                displayLabel: true,
                displayAvatar: true,
                useDefaultAvatar: true,
                style: { textAlign: 'center', borderBottom: '1px solid #e0e0e0', padding: 10, backgroundColor: '#fafafa' },
                avatarStyle: { marginBottom: 16 }
            });
        }

        return _react2['default'].createElement(
            'div',
            { style: editForm ? { height: '100%', display: 'flex', flexDirection: 'column' } : {} },
            _react2['default'].createElement(_avatarUserAvatar2['default'], _extends({
                userId: this.props.item.id,
                richCard: !editForm,
                pydio: this.props.pydio,
                cardSize: this.props.style.width
            }, editableProps)),
            editForm
        );
    };

    return UserCard;
})(_react2['default'].Component);

UserCard.propTypes = {
    /**
     * Pydio instance
     */
    pydio: _react2['default'].PropTypes.instanceOf(Pydio),
    /**
     * Team data object
     */
    item: _react2['default'].PropTypes.object,
    /**
     * Applied to root container
     */
    style: _react2['default'].PropTypes.object,
    /**
     * Called to dismiss the popover
     */
    onRequestClose: _react2['default'].PropTypes.func,
    /**
     * Delete current team
     */
    onDeleteAction: _react2['default'].PropTypes.func,
    /**
     * Update current team
     */
    onUpdateAction: _react2['default'].PropTypes.func
};

exports['default'] = UserCard;
module.exports = exports['default'];

},{"../UserCreationForm":42,"../avatar/UserAvatar":57,"react":"react"}],53:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _avatarUserAvatar = require('../avatar/UserAvatar');

var _avatarUserAvatar2 = _interopRequireDefault(_avatarUserAvatar);

var _materialUi = require('material-ui');

var _materialUiStyles = require('material-ui/styles');

var _viewsEmptyStateView = require('../../views/EmptyStateView');

var _viewsEmptyStateView2 = _interopRequireDefault(_viewsEmptyStateView);

var _AlphaPaginator = require('./AlphaPaginator');

var _AlphaPaginator2 = _interopRequireDefault(_AlphaPaginator);

var _SearchForm = require('./SearchForm');

var _SearchForm2 = _interopRequireDefault(_SearchForm);

var _pydioUtilDom = require('pydio/util/dom');

var _pydioUtilDom2 = _interopRequireDefault(_pydioUtilDom);

var _avatarCellActionsRenderer = require('../avatar/CellActionsRenderer');

var _avatarCellActionsRenderer2 = _interopRequireDefault(_avatarCellActionsRenderer);

var _require$requireLib = require('pydio').requireLib('boot');

var Loader = _require$requireLib.Loader;
var PydioContextConsumer = _require$requireLib.PydioContextConsumer;

var UsersList = (function (_React$Component) {
    _inherits(UsersList, _React$Component);

    function UsersList(props, context) {
        _classCallCheck(this, UsersList);

        _React$Component.call(this, props, context);
        this.state = { select: false, selection: [], editLabel: false };
    }

    UsersList.prototype.onLabelKeyEnter = function onLabelKeyEnter(e) {
        if (e.key === 'Enter') {
            this.updateLabel();
        }
    };

    UsersList.prototype.onLabelChange = function onLabelChange(e, value) {
        this.setState({ label: value });
    };

    UsersList.prototype.updateLabel = function updateLabel() {
        if (this.state.label !== this.props.item.label) {
            this.props.onEditLabel(this.props.item, this.state.label);
        }
        this.setState({ editLabel: false });
    };

    UsersList.prototype.render = function render() {
        var _this = this;

        var _props = this.props;
        var item = _props.item;
        var mode = _props.mode;
        var paginatorType = _props.paginatorType;
        var loading = _props.loading;
        var enableSearch = _props.enableSearch;
        var showSubheaders = _props.showSubheaders;
        var getMessage = _props.getMessage;
        var actionsPanel = _props.actionsPanel;
        var muiTheme = _props.muiTheme;
        var bookColumn = _props.bookColumn;
        var pydio = _props.pydio;
        var reloadAction = _props.reloadAction;

        var folders = item.collections || [];
        var leafs = item.leafs || [];
        var foldersSubHeader = folders.length && (leafs.length || showSubheaders) ? [{ subheader: getMessage('532') }] : [];
        var usersSubHeader = [];
        if (showSubheaders || paginatorType) {
            usersSubHeader = [{ subheader: paginatorType ? _react2['default'].createElement(_AlphaPaginator2['default'], _extends({}, this.props, { style: { lineHeight: '20px', padding: '14px 0' } })) : getMessage('249') }];
        }
        var items = [].concat(foldersSubHeader, folders, usersSubHeader, leafs);
        var total = items.length;
        var elements = [];
        var toggleSelect = function toggleSelect() {
            _this.setState({ select: !_this.state.select, selection: [] });
        };
        var createAction = function createAction() {
            _this.props.onCreateAction(item);
        };
        var deleteAction = function deleteAction() {
            _this.props.onDeleteAction(item, _this.state.selection);_this.setState({ select: false, selection: [] });
        };

        var accentColor = muiTheme.palette.accent2Color;
        var appBar = muiTheme.appBar;
        var stylesProps = {
            toolbarHeight: mode === 'book' ? 56 : 48,
            toolbarBgColor: mode === 'book' ? this.state.select ? accentColor : '#fafafa' : appBar.color,
            titleFontsize: mode === 'book' ? 20 : 16,
            titleFontWeight: 400,
            titleColor: mode === 'book' ? this.state.select ? 'white' : 'rgba(0,0,0,0.87)' : appBar.textColor,
            titlePadding: 10,
            button: {
                border: '1px solid ' + accentColor,
                borderRadius: '50%',
                margin: '0 4px',
                width: 36,
                height: 36,
                padding: 6
            },
            icon: {
                fontSize: 22,
                color: accentColor
            }
        };
        if (bookColumn) {
            stylesProps.toolbarBgColor = 'transparent';
            stylesProps.titleColor = 'rgba(0,0,0,0.54)';
            stylesProps.titleFontsize = 14;
            stylesProps.titleFontWeight = 500;
            stylesProps.titlePadding = '10px 16px';
            stylesProps.button.border = '0';
            stylesProps.icon.color = muiTheme.palette.primary1Color;
        }

        var label = item.label;
        if (this.props.onEditLabel && !this.state.select) {
            if (this.state.editLabel) {
                label = _react2['default'].createElement(
                    'div',
                    { style: { display: 'flex', alignItems: 'center', flex: 1 } },
                    _react2['default'].createElement(_materialUi.TextField, { style: { fontSize: 20 }, value: this.state.label, onChange: this.onLabelChange.bind(this), onKeyDown: this.onLabelKeyEnter.bind(this) }),
                    _react2['default'].createElement(_materialUi.IconButton, { iconStyle: { color: '#e0e0e0' }, secondary: true, iconClassName: "mdi mdi-content-save", tooltip: getMessage(48), onTouchTap: function () {
                            _this.updateLabel();
                        } })
                );
            } else {
                label = _react2['default'].createElement(
                    'div',
                    { style: { display: 'flex', alignItems: 'center', flex: 1 } },
                    label,
                    _react2['default'].createElement(_materialUi.IconButton, { iconStyle: { color: '#e0e0e0' }, iconClassName: "mdi mdi-pencil", tooltip: getMessage(48), onTouchTap: function () {
                            _this.setState({ editLabel: true, label: item.label });
                        } })
                );
            }
        }
        var createIcon = 'mdi mdi-account-plus';
        if (item.actions && item.actions.type === 'teams') {
            createIcon = 'mdi mdi-account-multiple-plus';
        }
        var toolbar = _react2['default'].createElement(
            'div',
            { style: { padding: stylesProps.titlePadding, height: stylesProps.toolbarHeight, backgroundColor: stylesProps.toolbarBgColor, borderRadius: '2px 2px 0 0', display: 'flex', alignItems: 'center', transition: _pydioUtilDom2['default'].getBeziersTransition() } },
            mode === "selector" && item._parent && _react2['default'].createElement(_materialUi.IconButton, { style: { marginLeft: -10 }, iconClassName: 'mdi mdi-chevron-left', onTouchTap: function () {
                    _this.props.onFolderClicked(item._parent);
                } }),
            mode === 'book' && total > 0 && item.actions && item.actions.multiple && _react2['default'].createElement(_materialUi.Checkbox, { style: { width: 'initial', marginLeft: this.state.select ? 7 : 14 }, checked: this.state.select, onCheck: toggleSelect }),
            _react2['default'].createElement(
                'div',
                { style: { flex: 2, fontSize: stylesProps.titleFontsize, color: stylesProps.titleColor, fontWeight: stylesProps.titleFontWeight } },
                label
            ),
            (mode === 'book' || mode === 'selector' && bookColumn) && item.actions && item.actions.create && !this.state.select && _react2['default'].createElement(_materialUi.IconButton, { style: stylesProps.button, iconStyle: stylesProps.icon, iconClassName: createIcon, tooltipPosition: "bottom-left", tooltip: getMessage(item.actions.create), onTouchTap: createAction }),
            bookColumn && !item._parent && _react2['default'].createElement(_materialUi.IconButton, { style: stylesProps.button, iconStyle: stylesProps.icon, iconClassName: "mdi mdi-window-restore", tooltipPosition: "bottom-left", tooltip: pydio.MessageHash['411'], onTouchTap: function () {
                    pydio.Controller.fireAction('open_address_book');
                } }),
            mode === 'book' && item.actions && item.actions.remove && this.state.select && _react2['default'].createElement(_materialUi.RaisedButton, { secondary: true, label: getMessage(item.actions.remove), disabled: !this.state.selection.length, onTouchTap: deleteAction }),
            !this.state.select && actionsPanel,
            enableSearch && !bookColumn && _react2['default'].createElement(_SearchForm2['default'], { searchLabel: this.props.searchLabel, onSearch: this.props.onSearch, style: { flex: 1, minWidth: 200 } }),
            reloadAction && (mode === 'book' || mode === 'selector' && bookColumn) && _react2['default'].createElement(_materialUi.IconButton, { style: stylesProps.button, iconStyle: stylesProps.icon, iconClassName: "mdi mdi-refresh", tooltipPosition: "bottom-left", tooltip: pydio.MessageHash['149'], onTouchTap: reloadAction, disabled: loading })
        );
        // PARENT NODE
        if (item._parent && mode === 'book' && item._parent._parent && item._parent.id !== 'teams') {
            elements.push(_react2['default'].createElement(_materialUi.ListItem, {
                key: '__parent__',
                primaryText: "..",
                onTouchTap: function (e) {
                    e.stopPropagation();_this.props.onFolderClicked(item._parent);
                },
                leftAvatar: _react2['default'].createElement(_materialUi.Avatar, { icon: _react2['default'].createElement(_materialUi.FontIcon, { className: 'mdi mdi-arrow-up' }), size: 36 })
            }));
            if (total) {
                elements.push(_react2['default'].createElement(_materialUi.Divider, { inset: true, key: 'parent-divider' }));
            }
        }
        // ITEMS
        items.forEach((function (item, index) {
            var _this2 = this;

            if (item.subheader) {
                elements.push(_react2['default'].createElement(
                    _materialUi.Subheader,
                    { key: item.subheader },
                    item.subheader
                ));
                return;
            }
            var fontIcon = _react2['default'].createElement(_avatarUserAvatar2['default'], { avatarSize: 36, pydio: this.props.pydio || pydio,
                userId: item.id,
                userLabel: item.label,
                avatar: item.avatar,
                icon: item.icon,
                idmUser: item.IdmUser,
                userType: item.type || 'group',
                avatarOnly: true,
                useDefaultAvatar: true
            });
            var rightIconButton = undefined;
            var touchTap = function touchTap(e) {
                e.stopPropagation();_this2.props.onItemClicked(item);
            };
            if (folders.indexOf(item) > -1 && this.props.onFolderClicked) {
                touchTap = function (e) {
                    e.stopPropagation();_this2.props.onFolderClicked(item);
                };
                if (mode === 'selector' && !item._notSelectable) {
                    rightIconButton = _react2['default'].createElement(_materialUi.IconButton, {
                        iconClassName: "mdi mdi-account-multiple-plus",
                        tooltip: "Select this group",
                        tooltipPosition: 'bottom-left',
                        onTouchTap: function () {
                            _this2.props.onItemClicked(item);
                        }
                    });
                }
            } else if (mode === 'inner' && this.props.onDeleteAction) {
                rightIconButton = _react2['default'].createElement(_materialUi.IconButton, {
                    iconClassName: "mdi mdi-delete",
                    tooltip: getMessage(257),
                    tooltipPosition: 'bottom-left',
                    iconStyle: { color: 'rgba(0,0,0,0.13)', hoverColor: 'rgba(0,0,0,0.53)' },
                    onTouchTap: function () {
                        _this2.props.onDeleteAction(_this2.props.item, [item]);
                    }
                });
            }
            if (bookColumn && this.props.actionsForCell && item.type) {
                var menuItems = new _avatarCellActionsRenderer2['default'](pydio, this.props.actionsForCell, null, item).renderItems();
                if (menuItems.length) {
                    rightIconButton = _react2['default'].createElement(
                        _materialUi.IconMenu,
                        {
                            iconButtonElement: _react2['default'].createElement(_materialUi.IconButton, { iconClassName: 'mdi mdi-dots-vertical', iconStyle: { color: 'rgba(0,0,0,.33)' } }),
                            targetOrigin: { horizontal: 'right', vertical: 'top' },
                            anchorOrigin: { horizontal: 'right', vertical: 'top' }
                        },
                        menuItems
                    );
                }
            }
            var select = function select(e, checked) {
                if (checked) {
                    _this2.setState({ selection: [].concat(_this2.state.selection, [item]) });
                } else {
                    var stateSel = _this2.state.selection;
                    var selection = [].concat(stateSel.slice(0, stateSel.indexOf(item)), stateSel.slice(stateSel.indexOf(item) + 1));
                    _this2.setState({ selection: selection });
                }
            };
            elements.push(_react2['default'].createElement(_materialUi.ListItem, {
                key: item.id,
                primaryText: item.label,
                onTouchTap: touchTap,
                disabled: mode === 'inner',
                leftAvatar: !this.state.select && fontIcon,
                rightIconButton: rightIconButton,
                leftCheckbox: this.state.select && _react2['default'].createElement(_materialUi.Checkbox, { checked: this.state.selection.indexOf(item) > -1, onCheck: select })
            }));
            if (mode !== 'inner' && index < total - 1) {
                elements.push(_react2['default'].createElement(_materialUi.Divider, { inset: true, key: item.id + '-divider' }));
            }
        }).bind(this));

        var emptyState = undefined;
        if (!elements.length) {
            var emptyStateProps = {
                style: { backgroundColor: 'transparent', minHeight: 300 },
                iconClassName: 'mdi mdi-account-off',
                primaryTextId: this.props.emptyStatePrimaryText || getMessage(629),
                secondaryTextId: mode === 'book' ? this.props.emptyStateSecondaryText || null : null
            };
            if (mode === 'book' && item.actions && item.actions.create) {
                emptyStateProps = _extends({}, emptyStateProps, {
                    actionLabelId: getMessage(item.actions.create),
                    actionCallback: createAction
                });
            }
            emptyState = _react2['default'].createElement(_viewsEmptyStateView2['default'], emptyStateProps);
        }

        return _react2['default'].createElement(
            'div',
            { style: { flex: 1, flexDirection: 'column', display: 'flex' }, onTouchTap: this.props.onTouchTap },
            mode !== 'inner' && !this.props.noToolbar && toolbar,
            !emptyState && !loading && _react2['default'].createElement(
                _materialUi.List,
                { style: { flex: 1, overflowY: mode !== 'inner' ? 'auto' : 'initial' } },
                this.props.subHeader && _react2['default'].createElement(
                    _materialUi.Subheader,
                    null,
                    this.props.subHeader
                ),
                elements
            ),
            loading && _react2['default'].createElement(Loader, { style: { flex: 1 } }),
            !loading && emptyState,
            mode === 'selector' && enableSearch && bookColumn && _react2['default'].createElement(_SearchForm2['default'], {
                searchLabel: this.props.searchLabel,
                onSearch: this.props.onSearch,
                style: { padding: '0 20px', minWidth: null, borderTop: '1px solid #e0e0e0' },
                underlineShow: false
            })
        );
    };

    return UsersList;
})(_react2['default'].Component);

UsersList.propTypes = {
    item: _react2['default'].PropTypes.object,
    onCreateAction: _react2['default'].PropTypes.func,
    onDeleteAction: _react2['default'].PropTypes.func,
    onItemClicked: _react2['default'].PropTypes.func,
    onFolderClicked: _react2['default'].PropTypes.func,
    onEditLabel: _react2['default'].PropTypes.func,
    mode: _react2['default'].PropTypes.oneOf(['book', 'selector', 'inner']),
    bookColumn: _react2['default'].PropTypes.bool
};

exports['default'] = UsersList = PydioContextConsumer(UsersList);
exports['default'] = UsersList = _materialUiStyles.muiThemeable()(UsersList);

exports['default'] = UsersList;
module.exports = exports['default'];

},{"../../views/EmptyStateView":60,"../avatar/CellActionsRenderer":55,"../avatar/UserAvatar":57,"./AlphaPaginator":45,"./SearchForm":49,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","pydio/util/dom":"pydio/util/dom","react":"react"}],54:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _addressbookAddressBook = require('../addressbook/AddressBook');

var _addressbookAddressBook2 = _interopRequireDefault(_addressbookAddressBook);

var _policiesResourcePoliciesPanel = require('../../policies/ResourcePoliciesPanel');

var _policiesResourcePoliciesPanel2 = _interopRequireDefault(_policiesResourcePoliciesPanel);

var React = require('react');
var PydioApi = require('pydio/http/api');
var ResourcesManager = require('pydio/http/resources-manager');

var _require = require('material-ui');

var IconButton = _require.IconButton;
var Popover = _require.Popover;

var _require2 = require('material-ui/styles');

var muiThemeable = _require2.muiThemeable;

var _require$requireLib = require('pydio').requireLib('boot');

var PydioContextConsumer = _require$requireLib.PydioContextConsumer;
var AsyncComponent = _require$requireLib.AsyncComponent;

var ActionsPanel = (function (_React$Component) {
    _inherits(ActionsPanel, _React$Component);

    function ActionsPanel(props, context) {
        _classCallCheck(this, ActionsPanel);

        _React$Component.call(this, props, context);
        this.state = {
            showPicker: false, pickerAnchor: null,
            showMailer: false, mailerAnchor: null,
            showPolicies: false, policiesAnchor: null
        };
    }

    ActionsPanel.prototype.onTeamSelected = function onTeamSelected(item) {
        this.setState({ showPicker: false });
        if (item.IdmRole && item.IdmRole.IsTeam) {
            PydioApi.getRestClient().getIdmApi().addUserToTeam(item.IdmRole.Uuid, this.props.userId, this.props.reloadAction);
        }
    };

    ActionsPanel.prototype.onUserSelected = function onUserSelected(item) {
        this.setState({ showPicker: false });
        PydioApi.getRestClient().getIdmApi().addUserToTeam(this.props.team.id, item.IdmUser.Login, this.props.reloadAction);
    };

    ActionsPanel.prototype.openPicker = function openPicker(event) {
        this.setState({ showPicker: true, pickerAnchor: event.currentTarget });
    };

    ActionsPanel.prototype.openPolicies = function openPolicies(event) {
        this.setState({ showPolicies: true, policiesAnchor: event.currentTarget });
    };

    ActionsPanel.prototype.openMailer = function openMailer(event) {
        var _this = this;

        var target = event.currentTarget;
        ResourcesManager.loadClassesAndApply(['PydioMailer'], function () {
            _this.setState({ mailerLibLoaded: true }, function () {
                _this.setState({ showMailer: true, mailerAnchor: target });
            });
        });
    };

    ActionsPanel.prototype.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {
        if (!this.props.lockOnSubPopoverOpen) {
            return;
        }
        if ((this.state.showPicker || this.state.showMailer) && !(prevState.showPicker || prevState.showMailer)) {
            this.props.lockOnSubPopoverOpen(true);
        } else if (!(this.state.showPicker || this.state.showMailer) && (prevState.showPicker || prevState.showMailer)) {
            this.props.lockOnSubPopoverOpen(false);
        }
    };

    ActionsPanel.prototype.render = function render() {
        var _this2 = this;

        var _props = this.props;
        var getMessage = _props.getMessage;
        var muiTheme = _props.muiTheme;
        var team = _props.team;
        var user = _props.user;
        var userEditable = _props.userEditable;
        var userId = _props.userId;
        var style = _props.style;
        var zDepth = _props.zDepth;

        var styles = {
            button: {
                //backgroundColor: muiTheme.palette.accent2Color,
                border: '1px solid ' + muiTheme.palette.accent2Color,
                borderRadius: '50%',
                margin: '0 4px',
                width: 36,
                height: 36,
                padding: 6
            },
            icon: {
                fontSize: 22,
                //color: 'white'
                color: muiTheme.palette.accent2Color
            }
        };
        var usermails = {};
        var actions = [];
        var resourceType = undefined,
            resourceId = undefined;
        if (user && user.hasEmail) {
            actions.push({ key: 'message', label: getMessage(598), icon: 'email', callback: this.openMailer.bind(this) });
            usermails[user.id] = PydioUsers.User.fromObject(user);
        }
        if (team) {
            resourceType = 'team';
            resourceId = team.id;
            actions.push({ key: 'users', label: getMessage(599), icon: 'account-multiple-plus', callback: this.openPicker.bind(this) });
        } else {
            resourceType = 'user';
            resourceId = userId;
            actions.push({ key: 'teams', label: getMessage(573), icon: 'account-multiple-plus', callback: this.openPicker.bind(this) });
        }
        if (userEditable) {
            if (this.props.onEditAction) {
                actions.push({ key: 'edit', label: this.props.team ? getMessage(580) : getMessage(600), icon: 'pencil', callback: this.props.onEditAction });
            }
            actions.push({ key: 'policies', label: 'Visibility', icon: 'security', callback: this.openPolicies.bind(this) });
            if (this.props.onDeleteAction) {
                actions.push({ key: 'delete', label: this.props.team ? getMessage(570) : getMessage(582), icon: 'delete', callback: this.props.onDeleteAction });
            }
        }

        return React.createElement(
            'div',
            { style: _extends({ textAlign: 'center', paddingTop: 10, paddingBottom: 10, borderTop: '1px solid #e0e0e0', borderBottom: '1px solid #e0e0e0' }, style) },
            actions.map(function (a) {
                return React.createElement(IconButton, {
                    key: a.key,
                    style: styles.button,
                    iconStyle: styles.icon,
                    tooltip: a.label,
                    iconClassName: "mdi mdi-" + a.icon,
                    onTouchTap: a.callback
                });
            }),
            React.createElement(
                Popover,
                {
                    open: this.state.showPicker,
                    anchorEl: this.state.pickerAnchor,
                    anchorOrigin: { horizontal: 'right', vertical: 'top' },
                    targetOrigin: { horizontal: 'right', vertical: 'top' },
                    onRequestClose: function () {
                        _this2.setState({ showPicker: false });
                    },
                    useLayerForClickAway: false,
                    style: { zIndex: 2200 }
                },
                React.createElement(
                    'div',
                    { style: { width: 256, height: 320 } },
                    React.createElement(_addressbookAddressBook2['default'], {
                        mode: 'selector',
                        pydio: this.props.pydio,
                        loaderStyle: { width: 320, height: 420 },
                        onItemSelected: this.props.team ? this.onUserSelected.bind(this) : this.onTeamSelected.bind(this),
                        teamsOnly: !this.props.team,
                        usersOnly: !!this.props.team
                    })
                )
            ),
            React.createElement(
                Popover,
                {
                    open: this.state.showMailer,
                    anchorEl: this.state.mailerAnchor,
                    anchorOrigin: { horizontal: 'right', vertical: 'top' },
                    targetOrigin: { horizontal: 'right', vertical: 'top' },
                    useLayerForClickAway: false,
                    style: { zIndex: 2200 }
                },
                React.createElement(
                    'div',
                    { style: { width: 256, height: 320 } },
                    this.state.mailerLibLoaded && React.createElement(AsyncComponent, {
                        namespace: 'PydioMailer',
                        componentName: 'Pane',
                        zDepth: 0,
                        panelTitle: getMessage(598),
                        uniqueUserStyle: true,
                        users: usermails,
                        onDismiss: function () {
                            _this2.setState({ showMailer: false });
                        },
                        onFieldFocus: this.props.otherPopoverMouseOver
                    })
                )
            ),
            React.createElement(
                Popover,
                {
                    open: this.state.showPolicies,
                    anchorEl: this.state.policiesAnchor,
                    anchorOrigin: { horizontal: 'right', vertical: 'top' },
                    targetOrigin: { horizontal: 'right', vertical: 'top' },
                    useLayerForClickAway: false,
                    style: { zIndex: 2000 }
                },
                React.createElement(
                    'div',
                    { style: { width: 256, height: 320 } },
                    React.createElement(_policiesResourcePoliciesPanel2['default'], {
                        pydio: this.props.pydio,
                        resourceType: resourceType,
                        resourceId: resourceId,
                        onDismiss: function () {
                            _this2.setState({ showPolicies: false });
                        }
                    })
                )
            )
        );
    };

    return ActionsPanel;
})(React.Component);

ActionsPanel.propTypes = {

    /**
     * User data, props must pass at least one of 'user' or 'team'
     */
    user: React.PropTypes.object,
    /**
     * Team data, props must pass at least one of 'user' or 'team'
     */
    team: React.PropTypes.object,
    /**
     * For users, whether it is editable or not
     */
    userEditable: React.PropTypes.object

};

exports['default'] = ActionsPanel = PydioContextConsumer(ActionsPanel);
exports['default'] = ActionsPanel = muiThemeable()(ActionsPanel);

exports['default'] = ActionsPanel;
module.exports = exports['default'];

},{"../../policies/ResourcePoliciesPanel":40,"../addressbook/AddressBook":44,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager","react":"react"}],55:[function(require,module,exports){
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _materialUi = require('material-ui');

var _pydioModelIdmObjectHelper = require('pydio/model/idm-object-helper');

var _pydioModelIdmObjectHelper2 = _interopRequireDefault(_pydioModelIdmObjectHelper);

var _pydioModelCell = require('pydio/model/cell');

var _pydioModelCell2 = _interopRequireDefault(_pydioModelCell);

var CellActionsRenderer = (function () {
    function CellActionsRenderer(pydio, cellModel, acl) {
        var addressBookItem = arguments.length <= 3 || arguments[3] === undefined ? null : arguments[3];

        _classCallCheck(this, CellActionsRenderer);

        this.props = { pydio: pydio, cellModel: cellModel, acl: acl, addressBookItem: addressBookItem };
    }

    CellActionsRenderer.prototype.createCell = function createCell() {
        var _props = this.props;
        var addressBookItem = _props.addressBookItem;
        var pydio = _props.pydio;

        var m = pydio.MessageHash;

        var idmObject = undefined;
        if (addressBookItem.IdmUser) {
            idmObject = addressBookItem.IdmUser;
        } else if (addressBookItem.IdmRole) {
            idmObject = addressBookItem.IdmRole;
        }
        if (idmObject) {
            pydio.user.getIdmUser().then(function (loggedUser) {

                var loggedLabel = _pydioModelIdmObjectHelper2['default'].extractLabelFromIdmObject(loggedUser);
                var targetLabel = _pydioModelIdmObjectHelper2['default'].extractLabelFromIdmObject(addressBookItem.IdmUser || addressBookItem.IdmRole);

                var model = new _pydioModelCell2['default']();
                model.setLabel(loggedLabel + ", " + targetLabel);
                model.setDescription("Created by " + loggedLabel);
                model.addUser(idmObject);
                model.save().then(function (res) {
                    pydio.UI.displayMessage('SUCCESS', m['643'].replace('%s', targetLabel));
                })['catch'](function (reason) {
                    pydio.UI.displayMessage('ERROR', m['644'].replace('%s', reason.message));
                });
            });
        }
    };

    CellActionsRenderer.prototype.addToCell = function addToCell() {
        var idmObject = undefined;
        var _props2 = this.props;
        var addressBookItem = _props2.addressBookItem;
        var cellModel = _props2.cellModel;

        if (addressBookItem.IdmUser) {
            idmObject = addressBookItem.IdmUser;
        } else if (addressBookItem.IdmRole) {
            idmObject = addressBookItem.IdmRole;
        }
        if (idmObject) {
            cellModel.addUser(idmObject);
            cellModel.save();
        }
    };

    CellActionsRenderer.prototype.removeFromCell = function removeFromCell() {
        var _props3 = this.props;
        var acl = _props3.acl;
        var cellModel = _props3.cellModel;

        cellModel.removeUser(acl.RoleId);
        cellModel.save();
    };

    CellActionsRenderer.prototype.renderItems = function renderItems() {
        var _props4 = this.props;
        var pydio = _props4.pydio;
        var cellModel = _props4.cellModel;
        var acl = _props4.acl;
        var addressBookItem = _props4.addressBookItem;

        var m = pydio.MessageHash;

        // Check if current user it the logged one
        var isLogged = undefined;
        if (acl) {
            isLogged = acl.User && acl.User.Login === pydio.user.id;
        } else {
            isLogged = userType === 'user' && pydio.user.id === userId;
        }
        var items = [];
        if (isLogged) {
            return items;
        }
        var userId = undefined,
            userType = undefined;
        if (addressBookItem) {
            userId = addressBookItem.id;
            userType = addressBookItem.type;
            if (userType === 'group' && addressBookItem.IdmRole) {
                userId = addressBookItem.IdmRole.Uuid;userType = 'team';
            }
        }
        var label = undefined;
        if (acl) {
            label = _pydioModelIdmObjectHelper2['default'].extractLabel(pydio, acl);
        } else {
            label = addressBookItem.label;
        }
        // Special case cellModel is "TRUE", not a real cell model
        if (cellModel === true) {
            return [React.createElement(_materialUi.MenuItem, { primaryText: m['640'].replace('%s', label), onTouchTap: this.createCell.bind(this) })];
        }

        var canWrite = cellModel.isEditable();
        // Check if current acl or userId/userType is in cell
        var acls = cellModel.getAcls();
        // Check if user is already in the current cell
        var isInCurrent = undefined;
        Object.keys(acls).map(function (k) {
            var cellAcl = acls[k];
            var crt = undefined;
            if (acl) {
                crt = acl.RoleId === cellAcl.RoleId;
            } else {
                crt = userType === 'user' && cellAcl.User && cellAcl.User.Login === userId || userType === 'group' && cellAcl.Group && cellAcl.Group.Uuid === userId || userType === 'team' && cellAcl.Role && cellAcl.Role.Uuid === userId;
            }
            if (crt) {
                isInCurrent = true;
            }
        });

        if (isInCurrent) {
            items.push(React.createElement(_materialUi.MenuItem, { primaryText: m['641'], disabled: !canWrite, onTouchTap: this.removeFromCell.bind(this) }));
        } else {
            items.push(React.createElement(_materialUi.MenuItem, { primaryText: m['642'], disabled: !canWrite, onTouchTap: this.addToCell.bind(this) }));
        }
        items.push(React.createElement(_materialUi.Divider, null), React.createElement(_materialUi.MenuItem, { primaryText: m['640'].replace('%s', label), onTouchTap: this.createCell.bind(this) }));

        return items;
    };

    return CellActionsRenderer;
})();

exports['default'] = CellActionsRenderer;
module.exports = exports['default'];

},{"material-ui":"material-ui","pydio/model/cell":"pydio/model/cell","pydio/model/idm-object-helper":"pydio/model/idm-object-helper"}],56:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _addressbookUsersList = require('../addressbook/UsersList');

var _addressbookUsersList2 = _interopRequireDefault(_addressbookUsersList);

var _require = require('react');

var Component = _require.Component;

var _require2 = require('material-ui');

var Divider = _require2.Divider;
var Subheader = _require2.Subheader;
var List = _require2.List;
var ListItem = _require2.ListItem;
var FontIcon = _require2.FontIcon;
var Avatar = _require2.Avatar;

var PydioApi = require('pydio/http/api');

var _require$requireLib = require('pydio').requireLib('boot');

var PydioContextConsumer = _require$requireLib.PydioContextConsumer;

/**
 * Display information about user or team relations
 */

var GraphPanel = (function (_Component) {
    _inherits(GraphPanel, _Component);

    function GraphPanel() {
        _classCallCheck(this, GraphPanel);

        _Component.apply(this, arguments);
    }

    GraphPanel.prototype.render = function render() {
        var _props = this.props;
        var graph = _props.graph;
        var userLabel = _props.userLabel;
        var pydio = _props.pydio;
        var getMessage = _props.getMessage;

        var elements = [];
        if (graph.teams && graph.teams.length) {
            var onDeleteAction = (function (parentItem, team) {
                var _this = this;

                PydioApi.getRestClient().getIdmApi().removeUserFromTeam(team[0].id, this.props.userId, function (response) {
                    if (response.message) {
                        pydio.UI.displayMessage('SUCCESS', response.message);
                    }
                    _this.props.reloadAction();
                });
            }).bind(this);
            elements.push(React.createElement(
                'div',
                { key: 'teams' },
                React.createElement(_addressbookUsersList2['default'], { subHeader: getMessage(581).replace('%s', graph.teams.length), onItemClicked: function () {}, item: { leafs: graph.teams }, mode: 'inner', onDeleteAction: onDeleteAction })
            ));
        }
        if (graph.cells) {
            var cells = Object.values(graph.cells).filter(function (cell) {
                return cell.Scope === "ROOM";
            });
            if (cells.length) {
                elements.push(React.createElement(
                    'div',
                    null,
                    elements.length ? React.createElement(Divider, null) : null,
                    React.createElement(
                        Subheader,
                        null,
                        cells.length === 1 ? getMessage('601') : getMessage('602').replace('%1', cells.length)
                    ),
                    React.createElement(
                        List,
                        null,
                        cells.map(function (cell) {
                            return React.createElement(ListItem, {
                                leftAvatar: React.createElement(Avatar, { icon: React.createElement(FontIcon, { className: 'mdi mdi-share-variant' }), backgroundColor: "#009688", size: 36 }),
                                primaryText: cell.Label,
                                onTouchTap: function () {
                                    pydio.triggerRepositoryChange(cell.UUID);
                                } });
                        })
                    )
                ));
            }
        }
        return React.createElement(
            'div',
            null,
            elements
        );
    };

    return GraphPanel;
})(Component);

exports['default'] = GraphPanel = PydioContextConsumer(GraphPanel);
exports['default'] = GraphPanel;
module.exports = exports['default'];

},{"../addressbook/UsersList":53,"material-ui":"material-ui","pydio":"pydio","pydio/http/api":"pydio/http/api","react":"react"}],57:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _GraphPanel = require('./GraphPanel');

var _GraphPanel2 = _interopRequireDefault(_GraphPanel);

var _ActionsPanel = require('./ActionsPanel');

var _ActionsPanel2 = _interopRequireDefault(_ActionsPanel);

var _pydioHttpApi = require("pydio/http/api");

var _pydioHttpApi2 = _interopRequireDefault(_pydioHttpApi);

/**
 * Generic component for display a user and her avatar (first letters or photo)
 */

var debounce = require('lodash.debounce');
var React = require('react');
var Color = require('color');

var _require = require('material-ui');

var FontIcon = _require.FontIcon;
var Popover = _require.Popover;
var Paper = _require.Paper;
var Avatar = _require.Avatar;
var CardTitle = _require.CardTitle;
var Divider = _require.Divider;

var _require2 = require('material-ui/styles');

var muiThemeable = _require2.muiThemeable;

var MetaCacheService = require('pydio/http/meta-cache-service');

var _require3 = require('pydio/http/users-api');

var UsersApi = _require3.UsersApi;

var UserAvatar = (function (_React$Component) {
    _inherits(UserAvatar, _React$Component);

    function UserAvatar(props, context) {
        _classCallCheck(this, UserAvatar);

        _React$Component.call(this, props, context);
        this.state = {
            user: null,
            avatar: null,
            graph: null,
            local: false
        };
    }

    UserAvatar.prototype.componentDidMount = function componentDidMount() {
        this.loadPublicData(this.props.userId, this.props.idmUser);
    };

    UserAvatar.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
        if (!this.props.userId || this.props.userId !== nextProps.userId) {
            this.setState({ label: nextProps.userId });
            this.loadPublicData(nextProps.userId, nextProps.idmUser);
        }
    };

    UserAvatar.prototype.componentWillUnmount = function componentWillUnmount() {
        if (this._userLoggedObs) {
            this.props.pydio.stopObserving('user_logged', this._userLoggedObs);
        }
    };

    /**
     *
     * @param userId string
     * @param idmUser {IdmUser}
     */

    UserAvatar.prototype.loadPublicData = function loadPublicData(userId, idmUser) {
        var _this = this;

        var _props = this.props;
        var userType = _props.userType;
        var richCard = _props.richCard;
        var pydio = _props.pydio;

        if (userType === "group" || userType === "team") {
            return;
        }
        UsersApi.getUserPromise(userId, idmUser).then(function (userObject) {
            if (userObject.isLocal()) {
                _this._userLoggedObs = function (eventUser) {
                    _this._userLoggedObs = null;
                    if (eventUser !== null) {
                        _this.loadPublicData(userId);
                    }
                };
                pydio.observeOnce('user_logged', _this._userLoggedObs);
            }
            _this.setState({
                user: userObject,
                avatar: userObject.getAvatar(),
                local: userObject.isLocal()
            });
            // Load graph
            if (richCard && !userObject.isNotFound()) {
                _pydioHttpApi2['default'].getRestClient().getIdmApi().loadUserGraph(userId).then(function (response) {
                    var graph = { cells: {}, teams: [] };
                    if (response.SharedCells) {
                        response.SharedCells.forEach(function (workspace) {
                            graph.cells = response.SharedCells;
                        });
                    }
                    if (response.BelongsToTeams) {
                        response.BelongsToTeams.forEach(function (role) {
                            graph.teams.push({
                                id: role.Uuid,
                                label: role.Label,
                                type: 'team',
                                IdmRole: role
                            });
                        });
                    }
                    _this.setState({ graph: graph });
                });
            }
        })['catch'](function (e) {
            // User may have been deleted
            _this.setState({ loadError: true });
        });
    };

    UserAvatar.prototype.render = function render() {
        var _this2 = this;

        var _state = this.state;
        var user = _state.user;
        var avatar = _state.avatar;
        var graph = _state.graph;
        var local = _state.local;
        var loadError = _state.loadError;
        var _props2 = this.props;
        var pydio = _props2.pydio;
        var userId = _props2.userId;
        var userType = _props2.userType;
        var icon = _props2.icon;
        var style = _props2.style;
        var labelStyle = _props2.labelStyle;
        var avatarLetters = _props2.avatarLetters;
        var avatarStyle = _props2.avatarStyle;
        var avatarSize = _props2.avatarSize;
        var className = _props2.className;
        var labelClassName = _props2.labelClassName;
        var displayLabel = _props2.displayLabel;
        var displayLocalLabel = _props2.displayLocalLabel;
        var displayAvatar = _props2.displayAvatar;
        var useDefaultAvatar = _props2.useDefaultAvatar;
        var richCard = _props2.richCard;
        var cardSize = _props2.cardSize;
        var muiTheme = _props2.muiTheme;
        var noActionsPanel = _props2.noActionsPanel;
        var label = this.state.label;

        var userTypeLabel = undefined;
        var userNotFound = loadError;
        var userIsPublic = false;
        if (user) {
            label = user.getLabel();
            userNotFound = user.isNotFound();
            userIsPublic = user.isPublic();
        } else if (!label) {
            label = this.props.userLabel || this.props.userId;
        }
        if (local && displayLocalLabel) {
            label = pydio.MessageHash['634'];
        }

        var avatarContent = undefined,
            avatarColor = undefined,
            avatarIcon = undefined;
        if (richCard) {
            displayAvatar = true;
            useDefaultAvatar = true;
            displayLabel = true;
        }
        if (displayAvatar && !avatar && label && (!displayLabel || useDefaultAvatar)) {
            var avatarsColor = muiTheme.palette.avatarsColor;
            if (userType === 'group' || userType === 'team' || userId.indexOf('PYDIO_GRP_/') === 0 || userId.indexOf('/USER_TEAM/') === 0) {
                avatarsColor = Color(avatarsColor).darken(0.2).toString();
            }
            var iconClassName = undefined;
            switch (userType) {
                case 'group':
                    iconClassName = 'mdi mdi-account-multiple';
                    userTypeLabel = '289';
                    break;
                case 'team':
                    iconClassName = 'mdi mdi-account-multiple-outline';
                    userTypeLabel = '603';
                    break;
                case 'remote':
                    iconClassName = 'mdi mdi-account-network';
                    userTypeLabel = '604';
                    break;
                default:
                    iconClassName = 'mdi mdi-account';
                    if (user) {
                        if (user.getExternal()) {
                            userTypeLabel = '589';
                            if (user.isPublic()) {
                                userTypeLabel = '589';
                                label = pydio.MessageHash["public_link_user"];
                                iconClassName = 'mdi mdi-link';
                            }
                        } else {
                            userTypeLabel = '590';
                        }
                    } else {
                        userTypeLabel = '288';
                    }
                    break;
            }
            if (icon) {
                iconClassName = icon;
            }
            if (userTypeLabel) {
                userTypeLabel = pydio.MessageHash[userTypeLabel];
            }
            if (richCard) {
                avatarIcon = React.createElement(FontIcon, { className: iconClassName, style: { color: avatarsColor } });
                avatarColor = '#f5f5f5';
            } else {
                avatarColor = avatarsColor;
                if (iconClassName && !avatarLetters) {
                    avatarIcon = React.createElement(FontIcon, { className: iconClassName });
                } else {
                    avatarContent = label.split(' ').map(function (word) {
                        return word[0];
                    }).join('').substring(0, 2);
                    if (avatarContent.length < 2) {
                        avatarContent = label.substring(0, 2);
                    }
                }
            }
        }
        var reloadAction = undefined,
            onEditAction = undefined,
            onMouseOver = undefined,
            onMouseOut = undefined,
            onClick = undefined,
            popover = undefined;
        if (richCard) {
            (function () {

                displayAvatar = true;
                style = _extends({}, style, { flexDirection: 'column' });
                //avatarSize = cardSize ? cardSize : '100%';
                //avatarStyle = {borderRadius: 0};
                avatarSize = 100;
                avatarStyle = { marginTop: 20 };
                var localReload = function localReload() {
                    MetaCacheService.getInstance().deleteKey('user_public_data-graph', _this2.props.userId);
                    _this2.loadPublicData(_this2.props.userId, _this2.props.idmUser);
                };
                reloadAction = function () {
                    localReload();
                    if (_this2.props.reloadAction) {
                        _this2.props.reloadAction();
                    }
                };
                onEditAction = function () {
                    localReload();
                    if (_this2.props.onEditAction) {
                        _this2.props.onEditAction();
                    }
                };
            })();
        } else if (!local && !userNotFound && !userIsPublic && this.props.richOnHover) {
            (function () {

                onMouseOut = function () {
                    if (!_this2.lockedBySubPopover) {
                        _this2.setState({ showPopover: false });
                    }
                };
                onMouseOut = debounce(onMouseOut, 350);
                onMouseOver = function (e) {
                    _this2.setState({ showPopover: true, popoverAnchor: e.currentTarget });
                    onMouseOut.cancel();
                };
                var onMouseOverInner = function onMouseOverInner(e) {
                    _this2.setState({ showPopover: true });
                    onMouseOut.cancel();
                };

                var lockOnSubPopoverOpen = function lockOnSubPopoverOpen(status) {
                    _this2.lockedBySubPopover = status;
                    onMouseOverInner();
                };
                var _props3 = _this2.props;
                var style = _props3.style;

                var popoverProps = _objectWithoutProperties(_props3, ['style']);

                popover = React.createElement(
                    Popover,
                    {
                        open: _this2.state.showPopover,
                        anchorEl: _this2.state.popoverAnchor,
                        onRequestClose: function (reason) {
                            if (reason !== 'clickAway' || !_this2.lockedBySubPopover) {
                                _this2.setState({ showPopover: false });
                            }
                        },
                        anchorOrigin: { horizontal: "left", vertical: "center" },
                        targetOrigin: { horizontal: "right", vertical: "center" },
                        useLayerForClickAway: false
                    },
                    React.createElement(
                        Paper,
                        { zDepth: 2, style: { width: 220, height: 320, overflowY: 'auto' }, onMouseOver: onMouseOverInner, onMouseOut: onMouseOut },
                        React.createElement(UserAvatar, _extends({}, popoverProps, { richCard: true, richOnHover: false, cardSize: 220, lockOnSubPopoverOpen: lockOnSubPopoverOpen }))
                    )
                );
            })();
        } else if (!local && !userNotFound && !userIsPublic && this.props.richOnClick) {
            (function () {

                onMouseOut = function () {
                    if (!_this2.lockedBySubPopover) {
                        _this2.setState({ showPopover: false });
                    }
                };
                onMouseOut = debounce(onMouseOut, 350);
                onClick = function (e) {
                    _this2.setState({ showPopover: true, popoverAnchor: e.currentTarget });
                    onMouseOut.cancel();
                };
                var onMouseOverInner = function onMouseOverInner(e) {
                    _this2.setState({ showPopover: true });
                    onMouseOut.cancel();
                };

                var lockOnSubPopoverOpen = function lockOnSubPopoverOpen(status) {
                    _this2.lockedBySubPopover = status;
                    onMouseOverInner();
                };
                var _props4 = _this2.props;
                var style = _props4.style;

                var popoverProps = _objectWithoutProperties(_props4, ['style']);

                popover = React.createElement(
                    Popover,
                    {
                        open: _this2.state.showPopover,
                        anchorEl: _this2.state.popoverAnchor,
                        onRequestClose: function (reason) {
                            if (reason !== 'clickAway' || !_this2.lockedBySubPopover) {
                                _this2.setState({ showPopover: false });
                            }
                        },
                        anchorOrigin: { horizontal: "left", vertical: "bottom" },
                        targetOrigin: { horizontal: "left", vertical: "top" },
                        useLayerForClickAway: false
                    },
                    React.createElement(
                        Paper,
                        { zDepth: 2, style: { width: 220, height: 320, overflowY: 'auto' }, onMouseOver: onMouseOverInner, onMouseOut: onMouseOut },
                        React.createElement(UserAvatar, _extends({}, popoverProps, { richCard: true, richOnHover: false, cardSize: 220, lockOnSubPopoverOpen: lockOnSubPopoverOpen }))
                    )
                );
            })();
        }

        if (avatar) {
            avatarIcon = React.createElement(FontIcon, { style: {
                    backgroundImage: "url(" + avatar + "?dim=" + avatarSize + ")",
                    backgroundSize: 'cover',
                    margin: 0,
                    width: '100%',
                    height: '100%',
                    borderRadius: '50%',
                    backgroundPosition: 'center'
                } });
        }

        var avatarComponent = React.createElement(
            Avatar,
            {
                icon: avatarIcon,
                size: avatarSize,
                style: this.props.avatarOnly ? this.props.style : avatarStyle,
                backgroundColor: avatarColor
            },
            avatarContent
        );

        if (this.props.avatarOnly) {
            return avatarComponent;
        }

        if (richCard) {
            avatarComponent = React.createElement(
                'div',
                { style: { textAlign: 'center' } },
                avatarComponent
            );
        } else if (userNotFound) {
            labelStyle = _extends({}, labelStyle, { textDecoration: 'line-through' });
        }

        return React.createElement(
            'div',
            { className: className, style: style, onMouseOver: onMouseOver, onMouseOut: onMouseOut, onClick: onClick },
            displayAvatar && (avatar || avatarContent || avatarIcon) && avatarComponent,
            displayLabel && !richCard && React.createElement(
                'div',
                {
                    className: labelClassName,
                    style: labelStyle },
                label
            ),
            displayLabel && richCard && React.createElement(CardTitle, { style: { textAlign: 'center' }, title: label, subtitle: userTypeLabel }),
            richCard && user && !noActionsPanel && React.createElement(_ActionsPanel2['default'], _extends({}, this.state, this.props, { reloadAction: reloadAction, onEditAction: onEditAction })),
            richCard && graph && !noActionsPanel && React.createElement(_GraphPanel2['default'], _extends({ graph: graph }, this.props, { userLabel: label, reloadAction: reloadAction, onEditAction: onEditAction })),
            this.props.children,
            popover
        );
    };

    return UserAvatar;
})(React.Component);

UserAvatar.propTypes = {
    /**
     * Id of the user to be loaded
     */
    userId: React.PropTypes.string.isRequired,
    /**
     * Pydio instance
     */
    pydio: React.PropTypes.instanceOf(Pydio),
    /**
     * Label of the user, if we already have it (otherwise will be loaded)
     */
    userLabel: React.PropTypes.string,
    /**
     * Type of user
     */
    userType: React.PropTypes.oneOf(['user', 'group', 'remote', 'team']),
    /**
     * Icon to be displayed in avatar
     */
    icon: React.PropTypes.string,
    /**
     * Display a rich card or a simple avatar+label chip
     */
    richCard: React.PropTypes.bool,
    /**
     * If not rich, display a rich card as popover on mouseover
     */
    richOnHover: React.PropTypes.bool,
    /**
     * If not rich, display a rich card as popover on click
     */
    richOnClick: React.PropTypes.bool,

    /**
     * Add edit action to the card
     */
    userEditable: React.PropTypes.bool,
    /**
     * Triggered after successful edition
     */
    onEditAction: React.PropTypes.func,
    /**
     * Triggered after deletion
     */
    onDeleteAction: React.PropTypes.func,
    /**
     * Triggered if a reload is required
     */
    reloadAction: React.PropTypes.func,

    /**
     * Display label element or not
     */
    displayLabel: React.PropTypes.bool,
    /**
     * Display label element or not
     */
    displayLocalLabel: React.PropTypes.bool,
    /**
     * Display avatar element or not
     */
    displayAvatar: React.PropTypes.bool,
    /**
     * Display only avatar
     */
    avatarOnly: React.PropTypes.bool,
    /**
     * Use default avatar
     */
    useDefaultAvatar: React.PropTypes.bool,
    /**
     * Avatar size, 40px by default
     */
    avatarSize: React.PropTypes.number,
    /**
     * If only the default icon is available, will display
     * the first letters of the name instead
     */
    avatarLetters: React.PropTypes.bool,
    /**
     * Do not display ActionsPanel in RichCard mode
     */
    noActionsPanel: React.PropTypes.bool,

    /**
     * Add class name to root element
     */
    className: React.PropTypes.string,
    /**
     * Add class name to label element
     */
    labelClassName: React.PropTypes.string,
    /**
     * Add class name to avatar element
     */
    avatarClassName: React.PropTypes.string,
    /**
     * Add style to root element
     */
    style: React.PropTypes.object,
    /**
     * Add style to label element
     */
    labelStyle: React.PropTypes.object,
    /**
     * Add style to avatar element
     */
    avatarStyle: React.PropTypes.object
};

UserAvatar.defaultProps = {
    displayLabel: true,
    displayAvatar: true,
    avatarSize: 40,
    userType: 'user',
    className: 'user-avatar-widget',
    avatarClassName: 'user-avatar',
    labelClassName: 'user-label'
};

exports['default'] = UserAvatar = muiThemeable()(UserAvatar);

exports['default'] = UserAvatar;
module.exports = exports['default'];

},{"./ActionsPanel":54,"./GraphPanel":56,"color":"color","lodash.debounce":"lodash.debounce","material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio/http/api":"pydio/http/api","pydio/http/meta-cache-service":"pydio/http/meta-cache-service","pydio/http/users-api":"pydio/http/users-api","react":"react"}],58:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var FuncUtils = require("pydio/util/func");
var ResourcesManager = require("pydio/http/resources-manager");

/******************************/
/* REACT DND GENERIC COMPONENTS
 /******************************/
var Types = {
    NODE_PROVIDER: 'node',
    SORTABLE_LIST_ITEM: 'sortable-list-item'
};

/**
 * Specifies which props to inject into your component.
 */
function collect(connect, monitor) {
    return {
        connectDragSource: connect.dragSource(),
        isDragging: monitor.isDragging()
    };
}

function collectDrop(connect, monitor) {
    return {
        connectDropTarget: connect.dropTarget(),
        canDrop: monitor.canDrop(),
        isOver: monitor.isOver(),
        isOverCurrent: monitor.isOver({ shallow: true })
    };
}

var DNDActionParameter = (function () {
    function DNDActionParameter(source, target, step) {
        _classCallCheck(this, DNDActionParameter);

        this._source = source;
        this._target = target;
        this._step = step;
    }

    DNDActionParameter.prototype.getSource = function getSource() {
        return this._source;
    };

    DNDActionParameter.prototype.getTarget = function getTarget() {
        return this._target;
    };

    DNDActionParameter.prototype.getStep = function getStep() {
        return this._step;
    };

    return DNDActionParameter;
})();

DNDActionParameter.STEP_BEGIN_DRAG = 'beginDrag';
DNDActionParameter.STEP_END_DRAG = 'endDrag';
DNDActionParameter.STEP_CAN_DROP = 'canDrop';
DNDActionParameter.STEP_HOVER_DROP = 'hover';

var applyDNDAction = function applyDNDAction(source, target, step) {
    var Controller = window.pydio.Controller;

    var dnd = Controller.defaultActions.get("dragndrop");
    if (dnd) {
        var dndAction = Controller.getActionByName(dnd);
        dndAction.enable();
        var params = new DNDActionParameter(source, target, step);
        var checkModule = dndAction.options.dragndropCheckModule;
        if (step === DNDActionParameter.STEP_CAN_DROP && checkModule) {
            if (!FuncUtils.getFunctionByName(checkModule, window)) {
                ResourcesManager.detectModuleToLoadAndApply(checkModule, function () {});
                throw new Error('Cannot find test module, trying to load it');
            }
            FuncUtils.executeFunctionByName(dndAction.options.dragndropCheckModule, window, Controller, params);
        } else {
            dndAction.apply(params);
        }
    } else {
        throw new Error('No DND Actions available');
    }
};

/****************************/
/* REACT DND DRAG/DROP NODES
 /***************************/

var nodeDragSource = {
    beginDrag: function beginDrag(props) {
        // Return the data describing the dragged item
        return { node: props.node };
    },

    endDrag: function endDrag(props, monitor, component) {
        if (!monitor.didDrop()) {
            return;
        }
        var item = monitor.getItem();
        var dropResult = monitor.getDropResult();
        try {
            applyDNDAction(item.node, dropResult.node, DNDActionParameter.STEP_END_DRAG);
        } catch (e) {}
    }
};

var nodeDropTarget = {

    hover: function hover(props, monitor) {},

    canDrop: function canDrop(props, monitor) {

        var source = monitor.getItem().node;
        var target = props.node;

        try {
            applyDNDAction(source, target, DNDActionParameter.STEP_CAN_DROP);
        } catch (e) {
            return false;
        }
        return true;
    },

    drop: function drop(props, monitor) {
        var hasDroppedOnChild = monitor.didDrop();
        if (hasDroppedOnChild) {
            return;
        }
        return { node: props.node };
    }

};

exports.Types = Types;
exports.collect = collect;
exports.collectDrop = collectDrop;
exports.nodeDragSource = nodeDragSource;
exports.nodeDropTarget = nodeDropTarget;
exports.DNDActionParameter = DNDActionParameter;

},{"pydio/http/resources-manager":"pydio/http/resources-manager","pydio/util/func":"pydio/util/func"}],59:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

"use strict";

exports.__esModule = true;
exports["default"] = {
    contextTypes: {
        messages: React.PropTypes.object,
        getMessage: React.PropTypes.func
    }
};
module.exports = exports["default"];

},{}],60:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _require = require('react');

var Component = _require.Component;
var PropTypes = _require.PropTypes;

var _require2 = require('material-ui');

var FlatButton = _require2.FlatButton;
var FontIcon = _require2.FontIcon;

var _require3 = require('material-ui/styles');

var muiThemeable = _require3.muiThemeable;

var Color = require('color');
var Pydio = require('pydio');

var _Pydio$requireLib = Pydio.requireLib('boot');

var PydioContextConsumer = _Pydio$requireLib.PydioContextConsumer;

var EmptyStateView = (function (_Component) {
    _inherits(EmptyStateView, _Component);

    function EmptyStateView(props, context) {
        _classCallCheck(this, EmptyStateView);

        _Component.call(this, props, context);
    }

    EmptyStateView.prototype.render = function render() {
        var _props = this.props;
        var style = _props.style;
        var iconClassName = _props.iconClassName;
        var primaryTextId = _props.primaryTextId;
        var secondaryTextId = _props.secondaryTextId;
        var actionLabelId = _props.actionLabelId;
        var actionCallback = _props.actionCallback;
        var actionStyle = _props.actionStyle;
        var actionIconClassName = _props.actionIconClassName;
        var getMessage = _props.getMessage;
        var iconStyle = _props.iconStyle;
        var legendStyle = _props.legendStyle;

        var mainColor = Color(this.props.muiTheme.palette.primary1Color);

        var styles = {
            container: _extends({
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                height: '100%',
                width: '100%',
                flex: 1,
                backgroundColor: mainColor.lightness(97).rgb().toString()
            }, style),
            centered: {
                maxWidth: 280,
                textAlign: 'center',
                color: mainColor.fade(0.6).toString()
            },
            icon: _extends({
                fontSize: 100
            }, iconStyle),
            primaryText: _extends({
                fontSize: 16,
                fontWeight: 500
            }, legendStyle),
            secondaryText: {
                marginTop: 20,
                fontSize: 13
            },
            buttonContainer: {
                marginTop: 100,
                textAlign: 'center'
            },
            buttonStyle: {
                color: this.props.muiTheme.palette.accent2Color
            }
        };
        var buttonIcon = actionIconClassName ? React.createElement(FontIcon, { className: actionIconClassName }) : null;
        return React.createElement(
            'div',
            { style: styles.container },
            React.createElement(
                'div',
                { style: styles.centered },
                React.createElement('div', { className: iconClassName, style: styles.icon }),
                React.createElement(
                    'div',
                    { style: styles.primaryText },
                    getMessage(primaryTextId)
                ),
                secondaryTextId && React.createElement(
                    'div',
                    { style: styles.secondaryText },
                    getMessage(secondaryTextId)
                ),
                actionLabelId && actionCallback && React.createElement(
                    'div',
                    { style: _extends({}, styles.buttonContainer, actionStyle) },
                    React.createElement(FlatButton, { style: styles.buttonStyle, label: getMessage(actionLabelId), onTouchTap: actionCallback, icon: buttonIcon })
                )
            )
        );
    };

    return EmptyStateView;
})(Component);

EmptyStateView.propTypes = {

    pydio: PropTypes.instanceOf(Pydio).isRequired,
    iconClassName: PropTypes.string.isRequired,
    primaryTextId: PropTypes.string.isRequired,

    secondaryTextId: PropTypes.string,
    actionLabelId: PropTypes.string,
    actionCallback: PropTypes.func,
    actionStyle: PropTypes.object,

    style: PropTypes.object,
    iconStyle: PropTypes.object,
    legendStyle: PropTypes.object,
    getMessage: PropTypes.func

};

exports['default'] = EmptyStateView = PydioContextConsumer(EmptyStateView);
exports['default'] = EmptyStateView = muiThemeable()(EmptyStateView);

exports['default'] = EmptyStateView;
module.exports = exports['default'];

},{"color":"color","material-ui":"material-ui","material-ui/styles":"material-ui/styles","pydio":"pydio","react":"react"}],61:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _materialUi = require('material-ui');

var ModalAppBar = function ModalAppBar(props) {
    var style = props.style;
    var titleStyle = props.titleStyle;
    var iconStyleRight = props.iconStyleRight;
    var iconStyleLeft = props.iconStyleLeft;

    var otherProps = _objectWithoutProperties(props, ['style', 'titleStyle', 'iconStyleRight', 'iconStyleLeft']);

    var styles = {
        style: _extends({
            flexShrink: 0
        }, style),
        titleStyle: _extends({
            lineHeight: '56px',
            height: 56,
            marginLeft: -8
        }, titleStyle),
        iconStyleRight: _extends({
            marginTop: 4
        }, iconStyleRight),
        iconStyleLeft: _extends({
            marginTop: 4
        }, iconStyleLeft)
    };

    return _react2['default'].createElement(_materialUi.AppBar, _extends({}, otherProps, styles));
};

exports['default'] = ModalAppBar;
module.exports = exports['default'];
/*borderRadius: '2px 2px 0 0',*/

},{"material-ui":"material-ui","react":"react"}],62:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

/**
 * Get info from Pydio controller an build an
 * action bar with active actions.
 * TBC
 */
'use strict';

exports.__esModule = true;
exports['default'] = React.createClass({
    displayName: 'SimpleReactActionBar',

    propTypes: {
        dataModel: React.PropTypes.instanceOf(PydioDataModel).isRequired,
        node: React.PropTypes.instanceOf(AjxpNode).isRequired,
        actions: React.PropTypes.array
    },

    clickAction: function clickAction(event) {
        var actionName = event.currentTarget.getAttribute("data-action");
        this.props.dataModel.setSelectedNodes([this.props.node]);
        var a = window.pydio.Controller.getActionByName(actionName);
        a.fireContextChange(this.props.dataModel, true, window.pydio.user);
        //a.fireSelectionChange(this.props.dataModel);
        a.apply([this.props.dataModel]);
        event.stopPropagation();
        event.preventDefault();
    },

    render: function render() {
        var actions = this.props.actions.map((function (a) {
            return React.createElement('div', {
                key: a.options.name,
                className: a.options.icon_class + ' material-list-action-inline' || '',
                title: a.options.title,
                'data-action': a.options.name,
                onClick: this.clickAction });
        }).bind(this));
        return React.createElement(
            'span',
            null,
            actions
        );
    }
});
module.exports = exports['default'];

},{}],63:[function(require,module,exports){
/*
 * Copyright 2007-2017 Charles du Jeu - Abstrium SAS <team (at) pyd.io>
 * This file is part of Pydio.
 *
 * Pydio is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Pydio is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Pydio.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The latest code can be found at <https://pydio.com>.
 */

'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _utilDND = require('../util/DND');

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _pydio = require('pydio');

var _pydio2 = _interopRequireDefault(_pydio);

var _Pydio$requireLib = _pydio2['default'].requireLib('hoc');

var withContextMenu = _Pydio$requireLib.withContextMenu;

var ContextMenuWrapper = function ContextMenuWrapper(props) {
    return _react2['default'].createElement('div', props);
};
ContextMenuWrapper = withContextMenu(ContextMenuWrapper);

/**
 * Tree Node
 */
var SimpleTreeNode = _react2['default'].createClass({
    displayName: 'SimpleTreeNode',

    propTypes: {
        collapse: _react2['default'].PropTypes.bool,
        forceExpand: _react2['default'].PropTypes.bool,
        childrenOnly: _react2['default'].PropTypes.bool,
        depth: _react2['default'].PropTypes.number,
        onNodeSelect: _react2['default'].PropTypes.func,
        node: _react2['default'].PropTypes.instanceOf(AjxpNode),
        dataModel: _react2['default'].PropTypes.instanceOf(PydioDataModel),
        forceLabel: _react2['default'].PropTypes.string,
        // Optional currently selected detection
        nodeIsSelected: _react2['default'].PropTypes.func,
        // Optional checkboxes
        checkboxes: _react2['default'].PropTypes.array,
        checkboxesValues: _react2['default'].PropTypes.object,
        checkboxesComputeStatus: _react2['default'].PropTypes.func,
        onCheckboxCheck: _react2['default'].PropTypes.func,
        paddingOffset: _react2['default'].PropTypes.number
    },

    getDefaultProps: function getDefaultProps() {
        return {
            collapse: false,
            childrenOnly: false,
            depth: 0,
            paddingOffset: 0,
            onNodeSelect: function onNodeSelect(node) {}
        };
    },

    listenToNode: function listenToNode(node) {
        this._childrenListener = (function () {
            if (!this.isMounted()) return;
            this.setState({ children: this._nodeToChildren(node) });
        }).bind(this);
        this._nodeListener = (function () {
            if (!this.isMounted()) return;
            this.forceUpdate();
        }).bind(this);
        node.observe("child_added", this._childrenListener);
        node.observe("child_removed", this._childrenListener);
        node.observe("node_replaced", this._nodeListener);
    },

    stopListening: function stopListening(node) {
        node.stopObserving("child_added", this._childrenListener);
        node.stopObserving("child_removed", this._childrenListener);
        node.stopObserving("node_replaced", this._nodeListener);
    },

    componentDidMount: function componentDidMount() {
        this.listenToNode(this.props.node);
    },

    componentWillUnmount: function componentWillUnmount() {
        this.stopListening(this.props.node);
    },

    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        var oldNode = this.props.node;
        var newNode = nextProps.node;
        if (newNode == oldNode && newNode.getMetadata().get("paginationData")) {
            var remapedChildren = this.state.children.map(function (c) {
                c.setParent(newNode);return c;
            });
            var remapedPathes = this.state.children.map(function (c) {
                return c.getPath();
            });
            var newChildren = this._nodeToChildren(newNode);
            newChildren.forEach(function (nc) {
                if (remapedPathes.indexOf(nc.getPath()) === -1) {
                    remapedChildren.push(nc);
                }
            });
            this.setState({ children: remapedChildren });
        } else {
            this.setState({ children: this._nodeToChildren(newNode) });
        }
        if (newNode !== oldNode) {
            this.stopListening(oldNode);
            this.listenToNode(newNode);
        }
    },

    getInitialState: function getInitialState() {
        return {
            showChildren: !this.props.collapse || this.props.forceExpand,
            children: this._nodeToChildren(this.props.node)
        };
    },

    _nodeToChildren: function _nodeToChildren() {
        var children = [];
        this.props.node.getChildren().forEach(function (c) {
            if (!c.isLeaf() || c.getAjxpMime() === 'ajxp_browsable_archive') children.push(c);
        });
        return children;
    },

    onNodeSelect: function onNodeSelect(ev) {
        if (this.props.onNodeSelect) {
            this.props.onNodeSelect(this.props.node);
        }
        ev.preventDefault();
        ev.stopPropagation();
    },
    onChildDisplayToggle: function onChildDisplayToggle(ev) {
        if (this.props.node.getChildren().size) {
            this.setState({ showChildren: !this.state.showChildren });
        }
        ev.preventDefault();
        ev.stopPropagation();
    },
    nodeIsSelected: function nodeIsSelected(n) {
        if (this.props.nodeIsSelected) return this.props.nodeIsSelected(n);else return this.props.dataModel.getSelectedNodes().indexOf(n) !== -1;
    },
    render: function render() {
        var _this = this;

        var _props = this.props;
        var node = _props.node;
        var childrenOnly = _props.childrenOnly;
        var canDrop = _props.canDrop;
        var isOverCurrent = _props.isOverCurrent;
        var checkboxes = _props.checkboxes;
        var checkboxesComputeStatus = _props.checkboxesComputeStatus;
        var checkboxesValues = _props.checkboxesValues;
        var onCheckboxCheck = _props.onCheckboxCheck;
        var depth = _props.depth;
        var paddingOffset = _props.paddingOffset;
        var forceExpand = _props.forceExpand;
        var selectedItemStyle = _props.selectedItemStyle;
        var getItemStyle = _props.getItemStyle;
        var forceLabel = _props.forceLabel;

        var hasFolderChildrens = this.state.children.length ? true : false;
        var hasChildren;
        if (hasFolderChildrens) {
            hasChildren = _react2['default'].createElement(
                'span',
                { onClick: this.onChildDisplayToggle },
                this.state.showChildren || forceExpand ? _react2['default'].createElement('span', { className: 'tree-icon icon-angle-down' }) : _react2['default'].createElement('span', { className: 'tree-icon icon-angle-right' })
            );
        } else {
            var cname = "tree-icon icon-angle-right";
            if (node.isLoaded()) {
                cname += " no-folder-children";
            }
            hasChildren = _react2['default'].createElement('span', { className: cname });
        }
        var isSelected = this.nodeIsSelected(node) ? 'mui-menu-item mui-is-selected' : 'mui-menu-item';
        var selfLabel;
        if (!childrenOnly) {
            if (canDrop && isOverCurrent) {
                isSelected += ' droppable-active';
            }
            var boxes;
            if (checkboxes) {
                var values = {},
                    inherited = false,
                    disabled = {},
                    additionalClassName = '';
                if (checkboxesComputeStatus) {
                    var status = checkboxesComputeStatus(node);
                    values = status.VALUES;
                    inherited = status.INHERITED;
                    disabled = status.DISABLED;
                    if (status.CLASSNAME) additionalClassName = ' ' + status.CLASSNAME;
                } else if (checkboxesValues && checkboxesValues[node.getPath()]) {
                    values = checkboxesValues[node.getPath()];
                }
                var valueClasses = [];
                boxes = checkboxes.map((function (c) {
                    var selected = values[c] !== undefined ? values[c] : false;
                    var click = (function (event, value) {
                        onCheckboxCheck(node, c, value);
                    }).bind(this);
                    if (selected) valueClasses.push(c);
                    return _react2['default'].createElement(ReactMUI.Checkbox, {
                        name: c,
                        key: c + "-" + (selected ? "true" : "false"),
                        checked: selected,
                        onCheck: click,
                        disabled: disabled[c],
                        className: "cbox-" + c
                    });
                }).bind(this));
                isSelected += inherited ? " inherited " : "";
                isSelected += valueClasses.length ? " checkbox-values-" + valueClasses.join('-') : " checkbox-values-empty";
                boxes = _react2['default'].createElement(
                    'div',
                    { className: "tree-checkboxes" + additionalClassName },
                    boxes
                );
            }
            var itemStyle = { paddingLeft: paddingOffset + depth * 20 };
            if (this.nodeIsSelected(node) && selectedItemStyle) {
                itemStyle = _extends({}, itemStyle, selectedItemStyle);
            }
            if (getItemStyle) {
                itemStyle = _extends({}, itemStyle, getItemStyle(node));
            }
            var icon = 'mdi mdi-folder';
            var ajxpMime = node.getAjxpMime();
            if (ajxpMime === 'ajxp_browsable_archive') {
                icon = 'mdi mdi-archive';
            } else if (ajxpMime === 'ajxp_recycle') {
                icon = 'mdi mdi-delete';
            }
            selfLabel = _react2['default'].createElement(
                ContextMenuWrapper,
                { node: node, className: 'tree-item ' + isSelected + (boxes ? ' has-checkboxes' : ''), style: itemStyle },
                _react2['default'].createElement(
                    'div',
                    { className: 'tree-item-label', onClick: this.onNodeSelect, title: node.getLabel(),
                        'data-id': node.getPath() },
                    hasChildren,
                    _react2['default'].createElement('span', { className: "tree-icon " + icon }),
                    forceLabel ? forceLabel : node.getLabel()
                ),
                boxes
            );
        }

        var children = [];
        var connector = function connector(instance) {
            return instance;
        };
        var draggable = false;
        if (window.ReactDND && this.props.connectDropTarget && this.props.connectDragSource) {
            (function () {
                var connectDragSource = _this.props.connectDragSource;
                var connectDropTarget = _this.props.connectDropTarget;
                connector = function (instance) {
                    connectDragSource(ReactDOM.findDOMNode(instance));
                    connectDropTarget(ReactDOM.findDOMNode(instance));
                };
                draggable = true;
            })();
        }

        if (this.state.showChildren || forceExpand) {
            children = this.state.children.map((function (child) {
                var props = _extends({}, this.props, {
                    forceLabel: null,
                    childrenOnly: false,
                    key: child.getPath(),
                    node: child,
                    depth: depth + 1
                });
                return _react2['default'].createElement(draggable ? DragDropTreeNode : SimpleTreeNode, props);
            }).bind(this));
        }
        return _react2['default'].createElement(
            'li',
            { ref: connector, className: "treenode" + node.getPath().replace(/\//g, '_') },
            selfLabel,
            _react2['default'].createElement(
                'ul',
                null,
                children
            )
        );
    }
});

var DragDropTreeNode;
if (window.ReactDND) {
    DragDropTreeNode = ReactDND.flow(ReactDND.DragSource(_utilDND.Types.NODE_PROVIDER, _utilDND.nodeDragSource, _utilDND.collect), ReactDND.DropTarget(_utilDND.Types.NODE_PROVIDER, _utilDND.nodeDropTarget, _utilDND.collectDrop))(SimpleTreeNode);
} else {
    DragDropTreeNode = SimpleTreeNode;
}

/**
 * Simple openable / loadable tree taking AjxpNode as inputs
 */
var DNDTreeView = _react2['default'].createClass({
    displayName: 'DNDTreeView',

    propTypes: {
        showRoot: _react2['default'].PropTypes.bool,
        rootLabel: _react2['default'].PropTypes.string,
        onNodeSelect: _react2['default'].PropTypes.func,
        node: _react2['default'].PropTypes.instanceOf(AjxpNode).isRequired,
        dataModel: _react2['default'].PropTypes.instanceOf(PydioDataModel).isRequired,
        selectable: _react2['default'].PropTypes.bool,
        selectableMultiple: _react2['default'].PropTypes.bool,
        initialSelectionModel: _react2['default'].PropTypes.array,
        onSelectionChange: _react2['default'].PropTypes.func,
        forceExpand: _react2['default'].PropTypes.bool,
        // Optional currently selected detection
        nodeIsSelected: _react2['default'].PropTypes.func,
        // Optional checkboxes
        checkboxes: _react2['default'].PropTypes.array,
        checkboxesValues: _react2['default'].PropTypes.object,
        checkboxesComputeStatus: _react2['default'].PropTypes.func,
        onCheckboxCheck: _react2['default'].PropTypes.func,
        paddingOffset: _react2['default'].PropTypes.number
    },

    getDefaultProps: function getDefaultProps() {
        return {
            showRoot: true,
            onNodeSelect: this.onNodeSelect
        };
    },

    onNodeSelect: function onNodeSelect(node) {
        if (this.props.onNodeSelect) {
            this.props.onNodeSelect(node);
        } else {
            this.props.dataModel.setSelectedNodes([node]);
        }
    },

    render: function render() {
        return _react2['default'].createElement(
            'ul',
            { className: this.props.className },
            _react2['default'].createElement(DragDropTreeNode, {
                childrenOnly: !this.props.showRoot,
                forceExpand: this.props.forceExpand,
                node: this.props.node ? this.props.node : this.props.dataModel.getRootNode(),
                dataModel: this.props.dataModel,
                onNodeSelect: this.onNodeSelect,
                nodeIsSelected: this.props.nodeIsSelected,
                forceLabel: this.props.rootLabel,
                checkboxes: this.props.checkboxes,
                checkboxesValues: this.props.checkboxesValues,
                checkboxesComputeStatus: this.props.checkboxesComputeStatus,
                onCheckboxCheck: this.props.onCheckboxCheck,
                selectedItemStyle: this.props.selectedItemStyle,
                getItemStyle: this.props.getItemStyle,
                paddingOffset: this.props.paddingOffset
            })
        );
    }
});

var TreeView = _react2['default'].createClass({
    displayName: 'TreeView',

    propTypes: {
        showRoot: _react2['default'].PropTypes.bool,
        rootLabel: _react2['default'].PropTypes.string,
        onNodeSelect: _react2['default'].PropTypes.func,
        node: _react2['default'].PropTypes.instanceOf(AjxpNode).isRequired,
        dataModel: _react2['default'].PropTypes.instanceOf(PydioDataModel).isRequired,
        selectable: _react2['default'].PropTypes.bool,
        selectableMultiple: _react2['default'].PropTypes.bool,
        initialSelectionModel: _react2['default'].PropTypes.array,
        onSelectionChange: _react2['default'].PropTypes.func,
        forceExpand: _react2['default'].PropTypes.bool,
        // Optional currently selected detection
        nodeIsSelected: _react2['default'].PropTypes.func,
        // Optional checkboxes
        checkboxes: _react2['default'].PropTypes.array,
        checkboxesValues: _react2['default'].PropTypes.object,
        checkboxesComputeStatus: _react2['default'].PropTypes.func,
        onCheckboxCheck: _react2['default'].PropTypes.func,
        paddingOffset: _react2['default'].PropTypes.number
    },

    getDefaultProps: function getDefaultProps() {
        return {
            showRoot: true,
            onNodeSelect: this.onNodeSelect
        };
    },

    onNodeSelect: function onNodeSelect(node) {
        if (this.props.onNodeSelect) {
            this.props.onNodeSelect(node);
        } else {
            this.props.dataModel.setSelectedNodes([node]);
        }
    },

    render: function render() {
        return _react2['default'].createElement(
            'ul',
            { className: this.props.className },
            _react2['default'].createElement(SimpleTreeNode, {
                childrenOnly: !this.props.showRoot,
                forceExpand: this.props.forceExpand,
                node: this.props.node ? this.props.node : this.props.dataModel.getRootNode(),
                dataModel: this.props.dataModel,
                onNodeSelect: this.onNodeSelect,
                nodeIsSelected: this.props.nodeIsSelected,
                forceLabel: this.props.rootLabel,
                checkboxes: this.props.checkboxes,
                checkboxesValues: this.props.checkboxesValues,
                checkboxesComputeStatus: this.props.checkboxesComputeStatus,
                onCheckboxCheck: this.props.onCheckboxCheck,
                selectedItemStyle: this.props.selectedItemStyle,
                getItemStyle: this.props.getItemStyle,
                paddingOffset: this.props.paddingOffset
            })
        );
    }

});

var FoldersTree = _react2['default'].createClass({
    displayName: 'FoldersTree',

    propTypes: {
        pydio: _react2['default'].PropTypes.instanceOf(_pydio2['default']).isRequired,
        dataModel: _react2['default'].PropTypes.instanceOf(PydioDataModel).isRequired,
        className: _react2['default'].PropTypes.string,
        onNodeSelected: _react2['default'].PropTypes.func,
        draggable: _react2['default'].PropTypes.bool
    },

    nodeObserver: function nodeObserver() {
        var r = this.props.dataModel.getRootNode();
        if (!r.isLoaded()) {
            r.observeOnce("loaded", (function () {
                this.forceUpdate();
            }).bind(this));
        } else {
            this.forceUpdate();
        }
    },

    componentDidMount: function componentDidMount() {
        var dm = this.props.dataModel;
        this._dmObs = this.nodeObserver;
        dm.observe("context_changed", this._dmObs);
        dm.observe("root_node_changed", this._dmObs);
        this.nodeObserver();
    },

    componentWillUnmount: function componentWillUnmount() {
        if (this._dmObs) {
            var dm = this.props.dataModel;
            dm.stopObserving("context_changed", this._dmObs);
            dm.stopObserving("root_node_changed", this._dmObs);
        }
    },

    treeNodeSelected: function treeNodeSelected(n) {
        if (this.props.onNodeSelected) {
            this.props.onNodeSelected(n);
        } else {
            this.props.dataModel.requireContextChange(n);
        }
    },

    nodeIsSelected: function nodeIsSelected(n) {
        return n === this.props.dataModel.getContextNode();
    },

    render: function render() {
        if (this.props.draggable) {
            return _react2['default'].createElement(PydioComponents.DNDTreeView, {
                onNodeSelect: this.treeNodeSelected,
                nodeIsSelected: this.nodeIsSelected,
                dataModel: this.props.dataModel,
                node: this.props.dataModel.getRootNode(),
                showRoot: this.props.showRoot ? true : false,
                selectedItemStyle: this.props.selectedItemStyle,
                getItemStyle: this.props.getItemStyle,
                className: "folders-tree" + (this.props.className ? ' ' + this.props.className : '')
            });
        } else {
            return _react2['default'].createElement(PydioComponents.TreeView, {
                onNodeSelect: this.treeNodeSelected,
                nodeIsSelected: this.nodeIsSelected,
                dataModel: this.props.dataModel,
                node: this.props.dataModel.getRootNode(),
                selectedItemStyle: this.props.selectedItemStyle,
                getItemStyle: this.props.getItemStyle,
                showRoot: this.props.showRoot ? true : false,
                className: "folders-tree" + (this.props.className ? ' ' + this.props.className : '')
            });
        }
    }

});

exports.TreeView = TreeView;
exports.DNDTreeView = DNDTreeView;
exports.FoldersTree = FoldersTree;

},{"../util/DND":58,"pydio":"pydio","react":"react"}]},{},[18])(18)
});

//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvcmVhY3Qtc2Nyb2xsYmFyL2Rpc3Qvc2Nyb2xsQXJlYS5qcyIsIm5vZGVfbW9kdWxlcy9yZWNvbm5lY3Rpbmctd2Vic29ja2V0L2Rpc3QvaW5kZXguanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9jaGF0L0NoYXQuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9jaGF0L0NoYXRDbGllbnQuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9jaGF0L0NoYXRJY29uLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvY2hhdC9DaGF0VXNlcnMuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9jaGF0L01lc3NhZ2UuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9keW5hbWljLWdyaWQvRHluYW1pY0dyaWQuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9keW5hbWljLWdyaWQvR3JpZEJ1aWxkZXIuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9keW5hbWljLWdyaWQvR3JpZEl0ZW1NaXhpbi5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL2R5bmFtaWMtZ3JpZC9TdG9yZS5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL2R5bmFtaWMtZ3JpZC9hc0dyaWRJdGVtLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvZWRpdG9yL1BhcGVyRWRpdG9yLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvZWRpdG9yL1JlYWN0RWRpdG9yT3BlbmVyLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvZWxlbWVudHMvQ2xpcGJvYXJkVGV4dEZpZWxkLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvZWxlbWVudHMvTGFiZWxXaXRoVGlwLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvZWxlbWVudHMvU2ltcGxlRmlndXJlQmFkZ2UuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9pbmRleC5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL2xpc3QvQ29uZmlndXJhYmxlTGlzdEVudHJ5LmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbGlzdC9JbmxpbmVFZGl0b3IuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L0xpc3RFbnRyeS5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL2xpc3QvTGlzdEVudHJ5Tm9kZUxpc3RlbmVyTWl4aW4uanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L0xpc3RQYWdpbmF0b3IuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L01hdGVyaWFsVGFibGUuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L05vZGVMaXN0Q3VzdG9tUHJvdmlkZXIuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L1NpbXBsZUxpc3QuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L1NvcnRDb2x1bW5zLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbGlzdC9Tb3J0YWJsZUxpc3QuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9saXN0L1RhYmxlTGlzdEVudHJ5LmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbGlzdC9UYWJsZUxpc3RIZWFkZXIuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9tZW51L0J1dHRvbkNvbXBvc2VkLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbWVudS9CdXR0b25NZW51LmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbWVudS9Db250ZXh0TWVudS5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL21lbnUvSWNvbkJ1dHRvbk1lbnUuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy9tZW51L0ljb25CdXR0b25Qb3BvdmVyLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbWVudS9NZW51SXRlbXNDb25zdW1lci5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL21lbnUvUG9wdXBNZW51LmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbWVudS9Ub29sYmFyLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvbWVudS9VdGlscy5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3BvbGljaWVzL1Jlc291cmNlUG9saWNpZXNQYW5lbC5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3VzZXJzL1RlYW1DcmVhdGlvbkZvcm0uanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy91c2Vycy9Vc2VyQ3JlYXRpb25Gb3JtLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvVXNlcnNDb21wbGV0ZXIuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy91c2Vycy9hZGRyZXNzYm9vay9BZGRyZXNzQm9vay5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3VzZXJzL2FkZHJlc3Nib29rL0FscGhhUGFnaW5hdG9yLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYWRkcmVzc2Jvb2svTG9hZGVycy5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3VzZXJzL2FkZHJlc3Nib29rL05lc3RlZExpc3RJdGVtLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYWRkcmVzc2Jvb2svUmlnaHRQYW5lbENhcmQuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy91c2Vycy9hZGRyZXNzYm9vay9TZWFyY2hGb3JtLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYWRkcmVzc2Jvb2svU2VhcmNoUGFuZWwuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy91c2Vycy9hZGRyZXNzYm9vay9UZWFtQ2FyZC5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3VzZXJzL2FkZHJlc3Nib29rL1VzZXJDYXJkLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYWRkcmVzc2Jvb2svVXNlcnNMaXN0LmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYXZhdGFyL0FjdGlvbnNQYW5lbC5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3VzZXJzL2F2YXRhci9DZWxsQWN0aW9uc1JlbmRlcmVyLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXNlcnMvYXZhdGFyL0dyYXBoUGFuZWwuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy91c2Vycy9hdmF0YXIvVXNlckF2YXRhci5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3V0aWwvRE5ELmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdXRpbC9NZXNzYWdlc0NvbnN1bWVyTWl4aW4uanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy92aWV3cy9FbXB0eVN0YXRlVmlldy5qcyIsInJlcy9idWlsZC91aS9Db21wb25lbnRzL3ZpZXdzL01vZGFsQXBwQmFyLmpzIiwicmVzL2J1aWxkL3VpL0NvbXBvbmVudHMvdmlld3MvU2ltcGxlUmVhY3RBY3Rpb25CYXIuanMiLCJyZXMvYnVpbGQvdWkvQ29tcG9uZW50cy92aWV3cy9UcmVlVmlldy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9RQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzdNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3hNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM5RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzNJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzd6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDMVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdmxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3hQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3BhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDenNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2WEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9SQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaGxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiIWZ1bmN0aW9uKGUsdCl7XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHMmJlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGU/bW9kdWxlLmV4cG9ydHM9dChyZXF1aXJlKFwicmVhY3RcIikpOlwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wicmVhY3RcIl0sdCk6XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHM/ZXhwb3J0cy5TY3JvbGxBcmVhPXQocmVxdWlyZShcInJlYWN0XCIpKTplLlNjcm9sbEFyZWE9dChlLlJlYWN0KX0odGhpcyxmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChvKXtpZihuW29dKXJldHVybiBuW29dLmV4cG9ydHM7dmFyIHI9bltvXT17ZXhwb3J0czp7fSxpZDpvLGxvYWRlZDohMX07cmV0dXJuIGVbb10uY2FsbChyLmV4cG9ydHMscixyLmV4cG9ydHMsdCksci5sb2FkZWQ9ITAsci5leHBvcnRzfXZhciBuPXt9O3JldHVybiB0Lm09ZSx0LmM9bix0LnA9XCJcIix0KDApfShbZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOntkZWZhdWx0OmV9fU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pLG4oMzEpO3ZhciByPW4oMTMpLGk9byhyKTt0LmRlZmF1bHQ9aS5kZWZhdWx0fSxmdW5jdGlvbih0LG4pe3QuZXhwb3J0cz1lfSxmdW5jdGlvbihlLHQsbil7ZS5leHBvcnRzPW4oMTkpKCl9LGZ1bmN0aW9uKGUsdCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbihlKXt2YXIgdD17fTtmb3IodmFyIG4gaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxuKSYmKHRbbl09XCJudW1iZXJcIj09dHlwZW9mIGVbbl0/ZVtuXTplW25dLnZhbCk7cmV0dXJuIHR9dC5fX2VzTW9kdWxlPSEwLHQuZGVmYXVsdD1uLGUuZXhwb3J0cz10LmRlZmF1bHR9LGZ1bmN0aW9uKGUsdCxuKXsoZnVuY3Rpb24odCl7KGZ1bmN0aW9uKCl7dmFyIG4sbyxyO1widW5kZWZpbmVkXCIhPXR5cGVvZiBwZXJmb3JtYW5jZSYmbnVsbCE9PXBlcmZvcm1hbmNlJiZwZXJmb3JtYW5jZS5ub3c/ZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuIHBlcmZvcm1hbmNlLm5vdygpfTpcInVuZGVmaW5lZFwiIT10eXBlb2YgdCYmbnVsbCE9PXQmJnQuaHJ0aW1lPyhlLmV4cG9ydHM9ZnVuY3Rpb24oKXtyZXR1cm4obigpLXIpLzFlNn0sbz10LmhydGltZSxuPWZ1bmN0aW9uKCl7dmFyIGU7cmV0dXJuIGU9bygpLDFlOSplWzBdK2VbMV19LHI9bigpKTpEYXRlLm5vdz8oZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubm93KCktcn0scj1EYXRlLm5vdygpKTooZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCktcn0scj0obmV3IERhdGUpLmdldFRpbWUoKSl9KS5jYWxsKHRoaXMpfSkuY2FsbCh0LG4oMTApKX0sZnVuY3Rpb24oZSx0LG4peyhmdW5jdGlvbih0KXtmb3IodmFyIG89bigyMykscj1cInVuZGVmaW5lZFwiPT10eXBlb2Ygd2luZG93P3Q6d2luZG93LGk9W1wibW96XCIsXCJ3ZWJraXRcIl0sYT1cIkFuaW1hdGlvbkZyYW1lXCIsbD1yW1wicmVxdWVzdFwiK2FdLHM9cltcImNhbmNlbFwiK2FdfHxyW1wiY2FuY2VsUmVxdWVzdFwiK2FdLHU9MDshbCYmdTxpLmxlbmd0aDt1KyspbD1yW2lbdV0rXCJSZXF1ZXN0XCIrYV0scz1yW2lbdV0rXCJDYW5jZWxcIithXXx8cltpW3VdK1wiQ2FuY2VsUmVxdWVzdFwiK2FdO2lmKCFsfHwhcyl7dmFyIGM9MCxmPTAscD1bXSxkPTFlMy82MDtsPWZ1bmN0aW9uKGUpe2lmKDA9PT1wLmxlbmd0aCl7dmFyIHQ9bygpLG49TWF0aC5tYXgoMCxkLSh0LWMpKTtjPW4rdCxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGU9cC5zbGljZSgwKTtwLmxlbmd0aD0wO2Zvcih2YXIgdD0wO3Q8ZS5sZW5ndGg7dCsrKWlmKCFlW3RdLmNhbmNlbGxlZCl0cnl7ZVt0XS5jYWxsYmFjayhjKX1jYXRjaChlKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dGhyb3cgZX0sMCl9fSxNYXRoLnJvdW5kKG4pKX1yZXR1cm4gcC5wdXNoKHtoYW5kbGU6KytmLGNhbGxiYWNrOmUsY2FuY2VsbGVkOiExfSksZn0scz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PHAubGVuZ3RoO3QrKylwW3RdLmhhbmRsZT09PWUmJihwW3RdLmNhbmNlbGxlZD0hMCl9fWUuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm4gbC5jYWxsKHIsZSl9LGUuZXhwb3J0cy5jYW5jZWw9ZnVuY3Rpb24oKXtzLmFwcGx5KHIsYXJndW1lbnRzKX0sZS5leHBvcnRzLnBvbHlmaWxsPWZ1bmN0aW9uKGUpe2V8fChlPXIpLGUucmVxdWVzdEFuaW1hdGlvbkZyYW1lPWwsZS5jYW5jZWxBbmltYXRpb25GcmFtZT1zfX0pLmNhbGwodCxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpKX0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKGUpe3ZhciB0PXt9O2Zvcih2YXIgbiBpbiBlKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLG4pJiYodFtuXT0wKTtyZXR1cm4gdH10Ll9fZXNNb2R1bGU9ITAsdC5kZWZhdWx0PW4sZS5leHBvcnRzPXQuZGVmYXVsdH0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKGUsdCxuKXtmb3IodmFyIG8gaW4gdClpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxvKSl7aWYoMCE9PW5bb10pcmV0dXJuITE7dmFyIHI9XCJudW1iZXJcIj09dHlwZW9mIHRbb10/dFtvXTp0W29dLnZhbDtpZihlW29dIT09cilyZXR1cm4hMX1yZXR1cm4hMH10Ll9fZXNNb2R1bGU9ITAsdC5kZWZhdWx0PW4sZS5leHBvcnRzPXQuZGVmYXVsdH0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKGUsdCxuLHIsaSxhLGwpe3ZhciBzPS1pKih0LXIpLHU9LWEqbixjPXMrdSxmPW4rYyplLHA9dCtmKmU7cmV0dXJuIE1hdGguYWJzKGYpPGwmJk1hdGguYWJzKHAtcik8bD8ob1swXT1yLG9bMV09MCxvKToob1swXT1wLG9bMV09ZixvKX10Ll9fZXNNb2R1bGU9ITAsdC5kZWZhdWx0PW47dmFyIG89WzAsMF07ZS5leHBvcnRzPXQuZGVmYXVsdH0sZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOntkZWZhdWx0OmV9fWZ1bmN0aW9uIHIoZSl7cmV0dXJuIHA/Zi5kZWZhdWx0LmZpbmRET01Ob2RlKGUpOmV9ZnVuY3Rpb24gaSgpe2R8fHB8fChkPSEwLGNvbnNvbGUuZXJyb3IoXCJXaXRoIFJlYWN0IDAuMTQgYW5kIGxhdGVyIHZlcnNpb25zLCB5b3Ugbm8gbG9uZ2VyIG5lZWQgdG8gd3JhcCA8U2Nyb2xsQXJlYT4gY2hpbGQgaW50byBhIGZ1bmN0aW9uLlwiKSl9ZnVuY3Rpb24gYSgpeyFkJiZwJiYoZD0hMCxjb25zb2xlLmVycm9yKFwiV2l0aCBSZWFjdCAwLjEzLCB5b3UgbmVlZCB0byB3cmFwIDxTY3JvbGxBcmVhPiBjaGlsZCBpbnRvIGEgZnVuY3Rpb24uXCIpKX1mdW5jdGlvbiBsKGUpe3JldHVybiBlPDA/MDplfWZ1bmN0aW9uIHMoZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOmZ1bmN0aW9uKGUpe3JldHVybiBlfSxuPXt9O2Zvcih2YXIgbyBpbiBlKWUuaGFzT3duUHJvcGVydHkobykmJihuW29dPXQoZVtvXSkpO3JldHVybiBufWZ1bmN0aW9uIHUoZSl7dmFyIHQ9ZS52ZXJzaW9uO2lmKFwic3RyaW5nXCIhPXR5cGVvZiB0KXJldHVybiEwO3ZhciBuPXQuc3BsaXQoXCIuXCIpLG89cGFyc2VJbnQoblswXSwxMCkscj1wYXJzZUludChuWzFdLDEwKTtyZXR1cm4gMD09PW8mJjEzPT09cn1PYmplY3QuZGVmaW5lUHJvcGVydHkodCxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KSx0LmZpbmRET01Ob2RlPXIsdC53YXJuQWJvdXRGdW5jdGlvbkNoaWxkPWksdC53YXJuQWJvdXRFbGVtZW50Q2hpbGQ9YSx0LnBvc2l0aXZlT3JaZXJvPWwsdC5tb2RpZnlPYmpWYWx1ZXM9cyx0LmlzUmVhY3QxMz11O3ZhciBjPW4oMSksZj1vKGMpLHA9dShmLmRlZmF1bHQpLGQ9ITF9LGZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gbigpe3Rocm93IG5ldyBFcnJvcihcInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWRcIil9ZnVuY3Rpb24gbygpe3Rocm93IG5ldyBFcnJvcihcImNsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZFwiKX1mdW5jdGlvbiByKGUpe2lmKGM9PT1zZXRUaW1lb3V0KXJldHVybiBzZXRUaW1lb3V0KGUsMCk7aWYoKGM9PT1ufHwhYykmJnNldFRpbWVvdXQpcmV0dXJuIGM9c2V0VGltZW91dCxzZXRUaW1lb3V0KGUsMCk7dHJ5e3JldHVybiBjKGUsMCl9Y2F0Y2godCl7dHJ5e3JldHVybiBjLmNhbGwobnVsbCxlLDApfWNhdGNoKHQpe3JldHVybiBjLmNhbGwodGhpcyxlLDApfX19ZnVuY3Rpb24gaShlKXtpZihmPT09Y2xlYXJUaW1lb3V0KXJldHVybiBjbGVhclRpbWVvdXQoZSk7aWYoKGY9PT1vfHwhZikmJmNsZWFyVGltZW91dClyZXR1cm4gZj1jbGVhclRpbWVvdXQsY2xlYXJUaW1lb3V0KGUpO3RyeXtyZXR1cm4gZihlKX1jYXRjaCh0KXt0cnl7cmV0dXJuIGYuY2FsbChudWxsLGUpfWNhdGNoKHQpe3JldHVybiBmLmNhbGwodGhpcyxlKX19fWZ1bmN0aW9uIGEoKXt5JiZkJiYoeT0hMSxkLmxlbmd0aD9oPWQuY29uY2F0KGgpOnY9LTEsaC5sZW5ndGgmJmwoKSl9ZnVuY3Rpb24gbCgpe2lmKCF5KXt2YXIgZT1yKGEpO3k9ITA7Zm9yKHZhciB0PWgubGVuZ3RoO3Q7KXtmb3IoZD1oLGg9W107Kyt2PHQ7KWQmJmRbdl0ucnVuKCk7dj0tMSx0PWgubGVuZ3RofWQ9bnVsbCx5PSExLGkoZSl9fWZ1bmN0aW9uIHMoZSx0KXt0aGlzLmZ1bj1lLHRoaXMuYXJyYXk9dH1mdW5jdGlvbiB1KCl7fXZhciBjLGYscD1lLmV4cG9ydHM9e307IWZ1bmN0aW9uKCl7dHJ5e2M9XCJmdW5jdGlvblwiPT10eXBlb2Ygc2V0VGltZW91dD9zZXRUaW1lb3V0Om59Y2F0Y2goZSl7Yz1ufXRyeXtmPVwiZnVuY3Rpb25cIj09dHlwZW9mIGNsZWFyVGltZW91dD9jbGVhclRpbWVvdXQ6b31jYXRjaChlKXtmPW99fSgpO3ZhciBkLGg9W10seT0hMSx2PS0xO3AubmV4dFRpY2s9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgtMSk7aWYoYXJndW1lbnRzLmxlbmd0aD4xKWZvcih2YXIgbj0xO248YXJndW1lbnRzLmxlbmd0aDtuKyspdFtuLTFdPWFyZ3VtZW50c1tuXTtoLnB1c2gobmV3IHMoZSx0KSksMSE9PWgubGVuZ3RofHx5fHxyKGwpfSxzLnByb3RvdHlwZS5ydW49ZnVuY3Rpb24oKXt0aGlzLmZ1bi5hcHBseShudWxsLHRoaXMuYXJyYXkpfSxwLnRpdGxlPVwiYnJvd3NlclwiLHAuYnJvd3Nlcj0hMCxwLmVudj17fSxwLmFyZ3Y9W10scC52ZXJzaW9uPVwiXCIscC52ZXJzaW9ucz17fSxwLm9uPXUscC5hZGRMaXN0ZW5lcj11LHAub25jZT11LHAub2ZmPXUscC5yZW1vdmVMaXN0ZW5lcj11LHAucmVtb3ZlQWxsTGlzdGVuZXJzPXUscC5lbWl0PXUscC5iaW5kaW5nPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcihcInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkXCIpfSxwLmN3ZD1mdW5jdGlvbigpe3JldHVyblwiL1wifSxwLmNoZGlyPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcihcInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZFwiKX0scC51bWFzaz1mdW5jdGlvbigpe3JldHVybiAwfX0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjt0Ll9fZXNNb2R1bGU9ITAsdC5kZWZhdWx0PXtub1dvYmJsZTp7c3RpZmZuZXNzOjE3MCxkYW1waW5nOjI2fSxnZW50bGU6e3N0aWZmbmVzczoxMjAsZGFtcGluZzoxNH0sd29iYmx5OntzdGlmZm5lc3M6MTgwLGRhbXBpbmc6MTJ9LHN0aWZmOntzdGlmZm5lc3M6MjEwLGRhbXBpbmc6MjB9fSxlLmV4cG9ydHM9dC5kZWZhdWx0fSxmdW5jdGlvbihlLHQsbil7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbyhlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlP2UuZGVmYXVsdDplfXQuX19lc01vZHVsZT0hMDt2YXIgcj1uKDI0KTt0Lk1vdGlvbj1vKHIpO3ZhciBpPW4oMjUpO3QuU3RhZ2dlcmVkTW90aW9uPW8oaSk7dmFyIGE9bigyNik7dC5UcmFuc2l0aW9uTW90aW9uPW8oYSk7dmFyIGw9bigyOSk7dC5zcHJpbmc9byhsKTt2YXIgcz1uKDExKTt0LnByZXNldHM9byhzKTt2YXIgdT1uKDMpO3Quc3RyaXBTdHlsZT1vKHUpO3ZhciBjPW4oMjgpO3QucmVvcmRlcktleXM9byhjKX0sZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOntkZWZhdWx0OmV9fWZ1bmN0aW9uIHIoZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpfWZ1bmN0aW9uIGkoZSx0KXtpZighZSl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7cmV0dXJuIXR8fFwib2JqZWN0XCIhPXR5cGVvZiB0JiZcImZ1bmN0aW9uXCIhPXR5cGVvZiB0P2U6dH1mdW5jdGlvbiBhKGUsdCl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIrdHlwZW9mIHQpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLHQmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKGUsdCk6ZS5fX3Byb3RvX189dCl9T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGw9XCJmdW5jdGlvblwiPT10eXBlb2YgU3ltYm9sJiZcInN5bWJvbFwiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKGUpe3JldHVybiB0eXBlb2YgZX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJlwiZnVuY3Rpb25cIj09dHlwZW9mIFN5bWJvbCYmZS5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmZSE9PVN5bWJvbC5wcm90b3R5cGU/XCJzeW1ib2xcIjp0eXBlb2YgZX0scz1PYmplY3QuYXNzaWdufHxmdW5jdGlvbihlKXtmb3IodmFyIHQ9MTt0PGFyZ3VtZW50cy5sZW5ndGg7dCsrKXt2YXIgbj1hcmd1bWVudHNbdF07Zm9yKHZhciBvIGluIG4pT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG4sbykmJihlW29dPW5bb10pfXJldHVybiBlfSx1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlLHQpe2Zvcih2YXIgbj0wO248dC5sZW5ndGg7bisrKXt2YXIgbz10W25dO28uZW51bWVyYWJsZT1vLmVudW1lcmFibGV8fCExLG8uY29uZmlndXJhYmxlPSEwLFwidmFsdWVcImluIG8mJihvLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxvLmtleSxvKX19cmV0dXJuIGZ1bmN0aW9uKHQsbixvKXtyZXR1cm4gbiYmZSh0LnByb3RvdHlwZSxuKSxvJiZlKHQsbyksdH19KCksYz1uKDEpLGY9byhjKSxwPW4oMiksZD1vKHApLGg9bigxOCkseT1vKGgpLHY9bigxMiksbT1uKDkpLGI9bigxNCksUz1vKGIpLGc9e3doZWVsOlwid2hlZWxcIixhcGk6XCJhcGlcIix0b3VjaDpcInRvdWNoXCIsdG91Y2hFbmQ6XCJ0b3VjaEVuZFwiLG1vdXNlbW92ZTpcIm1vdXNlbW92ZVwiLGtleVByZXNzOlwia2V5cHJlc3NcIn0sdz1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUpe3IodGhpcyx0KTt2YXIgbj1pKHRoaXMsKHQuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YodCkpLmNhbGwodGhpcyxlKSk7cmV0dXJuIG4uc3RhdGU9e3RvcFBvc2l0aW9uOjAsbGVmdFBvc2l0aW9uOjAscmVhbEhlaWdodDowLGNvbnRhaW5lckhlaWdodDowLHJlYWxXaWR0aDowLGNvbnRhaW5lcldpZHRoOjB9LG4uc2Nyb2xsQXJlYT17cmVmcmVzaDpmdW5jdGlvbigpe24uc2V0U2l6ZXNUb1N0YXRlKCl9LHNjcm9sbFRvcDpmdW5jdGlvbigpe24uc2Nyb2xsVG9wKCl9LHNjcm9sbEJvdHRvbTpmdW5jdGlvbigpe24uc2Nyb2xsQm90dG9tKCl9LHNjcm9sbFlUbzpmdW5jdGlvbihlKXtuLnNjcm9sbFlUbyhlKX0sc2Nyb2xsTGVmdDpmdW5jdGlvbigpe24uc2Nyb2xsTGVmdCgpfSxzY3JvbGxSaWdodDpmdW5jdGlvbigpe24uc2Nyb2xsUmlnaHQoKX0sc2Nyb2xsWFRvOmZ1bmN0aW9uKGUpe24uc2Nyb2xsWFRvKGUpfX0sbi5ldm50c1ByZXZpb3VzVmFsdWVzPXtjbGllbnRYOjAsY2xpZW50WTowLGRlbHRhWDowLGRlbHRhWTowfSxuLmJpbmRlZEhhbmRsZVdpbmRvd1Jlc2l6ZT1uLmhhbmRsZVdpbmRvd1Jlc2l6ZS5iaW5kKG4pLG59cmV0dXJuIGEodCxlKSx1KHQsW3trZXk6XCJnZXRDaGlsZENvbnRleHRcIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybntzY3JvbGxBcmVhOnRoaXMuc2Nyb2xsQXJlYX19fSx7a2V5OlwiY29tcG9uZW50RGlkTW91bnRcIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMucHJvcHMuY29udGVudFdpbmRvdyYmdGhpcy5wcm9wcy5jb250ZW50V2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIix0aGlzLmJpbmRlZEhhbmRsZVdpbmRvd1Jlc2l6ZSksdGhpcy5saW5lSGVpZ2h0UHg9KDAseS5kZWZhdWx0KSgoMCxtLmZpbmRET01Ob2RlKSh0aGlzLmNvbnRlbnQpKSx0aGlzLnNldFNpemVzVG9TdGF0ZSgpfX0se2tleTpcImNvbXBvbmVudFdpbGxVbm1vdW50XCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnByb3BzLmNvbnRlbnRXaW5kb3cmJnRoaXMucHJvcHMuY29udGVudFdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsdGhpcy5iaW5kZWRIYW5kbGVXaW5kb3dSZXNpemUpfX0se2tleTpcImNvbXBvbmVudERpZFVwZGF0ZVwiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5zZXRTaXplc1RvU3RhdGUoKX19LHtrZXk6XCJyZW5kZXJcIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLnByb3BzLG49dC5jaGlsZHJlbixvPXQuY2xhc3NOYW1lLHI9dC5jb250ZW50Q2xhc3NOYW1lLGk9dC5vd25lckRvY3VtZW50LGE9dGhpcy5wcm9wcy5zbW9vdGhTY3JvbGxpbmcmJih0aGlzLnN0YXRlLmV2ZW50VHlwZT09PWcud2hlZWx8fHRoaXMuc3RhdGUuZXZlbnRUeXBlPT09Zy5hcGl8fHRoaXMuc3RhdGUuZXZlbnRUeXBlPT09Zy50b3VjaEVuZHx8dGhpcy5zdGF0ZS5ldmVudFR5cGU9PT1nLmtleVByZXNzKSxsPXRoaXMuY2FuU2Nyb2xsWSgpP2YuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFMuZGVmYXVsdCx7b3duZXJEb2N1bWVudDppLHJlYWxTaXplOnRoaXMuc3RhdGUucmVhbEhlaWdodCxjb250YWluZXJTaXplOnRoaXMuc3RhdGUuY29udGFpbmVySGVpZ2h0LHBvc2l0aW9uOnRoaXMuc3RhdGUudG9wUG9zaXRpb24sb25Nb3ZlOnRoaXMuaGFuZGxlU2Nyb2xsYmFyTW92ZS5iaW5kKHRoaXMpLG9uUG9zaXRpb25DaGFuZ2U6dGhpcy5oYW5kbGVTY3JvbGxiYXJZUG9zaXRpb25DaGFuZ2UuYmluZCh0aGlzKSxjb250YWluZXJTdHlsZTp0aGlzLnByb3BzLnZlcnRpY2FsQ29udGFpbmVyU3R5bGUsc2Nyb2xsYmFyU3R5bGU6dGhpcy5wcm9wcy52ZXJ0aWNhbFNjcm9sbGJhclN0eWxlLHNtb290aFNjcm9sbGluZzphLG1pblNjcm9sbFNpemU6dGhpcy5wcm9wcy5taW5TY3JvbGxTaXplLG9uRm9jdXM6dGhpcy5mb2N1c0NvbnRlbnQuYmluZCh0aGlzKSx0eXBlOlwidmVydGljYWxcIn0pOm51bGwsdT10aGlzLmNhblNjcm9sbFgoKT9mLmRlZmF1bHQuY3JlYXRlRWxlbWVudChTLmRlZmF1bHQse293bmVyRG9jdW1lbnQ6aSxyZWFsU2l6ZTp0aGlzLnN0YXRlLnJlYWxXaWR0aCxjb250YWluZXJTaXplOnRoaXMuc3RhdGUuY29udGFpbmVyV2lkdGgscG9zaXRpb246dGhpcy5zdGF0ZS5sZWZ0UG9zaXRpb24sb25Nb3ZlOnRoaXMuaGFuZGxlU2Nyb2xsYmFyTW92ZS5iaW5kKHRoaXMpLG9uUG9zaXRpb25DaGFuZ2U6dGhpcy5oYW5kbGVTY3JvbGxiYXJYUG9zaXRpb25DaGFuZ2UuYmluZCh0aGlzKSxjb250YWluZXJTdHlsZTp0aGlzLnByb3BzLmhvcml6b250YWxDb250YWluZXJTdHlsZSxzY3JvbGxiYXJTdHlsZTp0aGlzLnByb3BzLmhvcml6b250YWxTY3JvbGxiYXJTdHlsZSxzbW9vdGhTY3JvbGxpbmc6YSxtaW5TY3JvbGxTaXplOnRoaXMucHJvcHMubWluU2Nyb2xsU2l6ZSxvbkZvY3VzOnRoaXMuZm9jdXNDb250ZW50LmJpbmQodGhpcyksdHlwZTpcImhvcml6b250YWxcIn0pOm51bGw7XCJmdW5jdGlvblwiPT10eXBlb2Ygbj8oKDAsbS53YXJuQWJvdXRGdW5jdGlvbkNoaWxkKSgpLG49bigpKTooMCxtLndhcm5BYm91dEVsZW1lbnRDaGlsZCkoKTt2YXIgYz1cInNjcm9sbGFyZWEgXCIrKG98fFwiXCIpLHA9XCJzY3JvbGxhcmVhLWNvbnRlbnQgXCIrKHJ8fFwiXCIpLGQ9e21hcmdpblRvcDotdGhpcy5zdGF0ZS50b3BQb3NpdGlvbixtYXJnaW5MZWZ0Oi10aGlzLnN0YXRlLmxlZnRQb3NpdGlvbn0saD1hPygwLG0ubW9kaWZ5T2JqVmFsdWVzKShkLGZ1bmN0aW9uKGUpe3JldHVybigwLHYuc3ByaW5nKShlKX0pOmQ7cmV0dXJuIGYuZGVmYXVsdC5jcmVhdGVFbGVtZW50KHYuTW90aW9uLHtzdHlsZTpofSxmdW5jdGlvbih0KXtyZXR1cm4gZi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIix7cmVmOmZ1bmN0aW9uKHQpe3JldHVybiBlLndyYXBwZXI9dH0sY2xhc3NOYW1lOmMsc3R5bGU6ZS5wcm9wcy5zdHlsZSxvbldoZWVsOmUuaGFuZGxlV2hlZWwuYmluZChlKX0sZi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIix7cmVmOmZ1bmN0aW9uKHQpe3JldHVybiBlLmNvbnRlbnQ9dH0sc3R5bGU6cyh7fSxlLnByb3BzLmNvbnRlbnRTdHlsZSx0KSxjbGFzc05hbWU6cCxvblRvdWNoU3RhcnQ6ZS5oYW5kbGVUb3VjaFN0YXJ0LmJpbmQoZSksb25Ub3VjaE1vdmU6ZS5oYW5kbGVUb3VjaE1vdmUuYmluZChlKSxvblRvdWNoRW5kOmUuaGFuZGxlVG91Y2hFbmQuYmluZChlKSxvbktleURvd246ZS5oYW5kbGVLZXlEb3duLmJpbmQoZSksdGFiSW5kZXg6ZS5wcm9wcy5mb2N1c2FibGVUYWJJbmRleH0sbiksbCx1KX0pfX0se2tleTpcInNldFN0YXRlRnJvbUV2ZW50XCIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLnByb3BzLm9uU2Nyb2xsJiZ0aGlzLnByb3BzLm9uU2Nyb2xsKGUpLHRoaXMuc2V0U3RhdGUocyh7fSxlLHtldmVudFR5cGU6dH0pKX19LHtrZXk6XCJoYW5kbGVUb3VjaFN0YXJ0XCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50b3VjaGVzO2lmKDE9PT10Lmxlbmd0aCl7dmFyIG49dFswXSxvPW4uY2xpZW50WCxyPW4uY2xpZW50WTt0aGlzLmV2ZW50UHJldmlvdXNWYWx1ZXM9cyh7fSx0aGlzLmV2ZW50UHJldmlvdXNWYWx1ZXMse2NsaWVudFk6cixjbGllbnRYOm8sdGltZXN0YW1wOkRhdGUubm93KCl9KX19fSx7a2V5OlwiaGFuZGxlVG91Y2hNb3ZlXCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5jYW5TY3JvbGwoKSYmKGUucHJldmVudERlZmF1bHQoKSxlLnN0b3BQcm9wYWdhdGlvbigpKTt2YXIgdD1lLnRvdWNoZXM7aWYoMT09PXQubGVuZ3RoKXt2YXIgbj10WzBdLG89bi5jbGllbnRYLHI9bi5jbGllbnRZLGk9dGhpcy5ldmVudFByZXZpb3VzVmFsdWVzLmNsaWVudFktcixhPXRoaXMuZXZlbnRQcmV2aW91c1ZhbHVlcy5jbGllbnRYLW87dGhpcy5ldmVudFByZXZpb3VzVmFsdWVzPXMoe30sdGhpcy5ldmVudFByZXZpb3VzVmFsdWVzLHtkZWx0YVk6aSxkZWx0YVg6YSxjbGllbnRZOnIsY2xpZW50WDpvLHRpbWVzdGFtcDpEYXRlLm5vdygpfSksdGhpcy5zZXRTdGF0ZUZyb21FdmVudCh0aGlzLmNvbXBvc2VOZXdTdGF0ZSgtYSwtaSkpfX19LHtrZXk6XCJoYW5kbGVUb3VjaEVuZFwiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuZXZlbnRQcmV2aW91c1ZhbHVlcyxuPXQuZGVsdGFYLG89dC5kZWx0YVkscj10LnRpbWVzdGFtcDtcInVuZGVmaW5lZFwiPT10eXBlb2YgbiYmKG49MCksXCJ1bmRlZmluZWRcIj09dHlwZW9mIG8mJihvPTApLERhdGUubm93KCktcjwyMDAmJnRoaXMuc2V0U3RhdGVGcm9tRXZlbnQodGhpcy5jb21wb3NlTmV3U3RhdGUoMTAqLW4sMTAqLW8pLGcudG91Y2hFbmQpLHRoaXMuZXZlbnRQcmV2aW91c1ZhbHVlcz1zKHt9LHRoaXMuZXZlbnRQcmV2aW91c1ZhbHVlcyx7ZGVsdGFZOjAsZGVsdGFYOjB9KX19LHtrZXk6XCJoYW5kbGVTY3JvbGxiYXJNb3ZlXCIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLnNldFN0YXRlRnJvbUV2ZW50KHRoaXMuY29tcG9zZU5ld1N0YXRlKHQsZSkpfX0se2tleTpcImhhbmRsZVNjcm9sbGJhclhQb3NpdGlvbkNoYW5nZVwiLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMuc2Nyb2xsWFRvKGUpfX0se2tleTpcImhhbmRsZVNjcm9sbGJhcllQb3NpdGlvbkNoYW5nZVwiLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMuc2Nyb2xsWVRvKGUpfX0se2tleTpcImhhbmRsZVdoZWVsXCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5kZWx0YVksbj1lLmRlbHRhWDtpZih0aGlzLnByb3BzLnN3YXBXaGVlbEF4ZXMpe3ZhciBvPVtuLHRdO3Q9b1swXSxuPW9bMV19MT09PWUuZGVsdGFNb2RlJiYodCo9dGhpcy5saW5lSGVpZ2h0UHgsbio9dGhpcy5saW5lSGVpZ2h0UHgpLHQqPXRoaXMucHJvcHMuc3BlZWQsbio9dGhpcy5wcm9wcy5zcGVlZDt2YXIgcj10aGlzLmNvbXBvc2VOZXdTdGF0ZSgtbiwtdCk7KHIudG9wUG9zaXRpb24mJnRoaXMuc3RhdGUudG9wUG9zaXRpb24hPT1yLnRvcFBvc2l0aW9ufHxyLmxlZnRQb3NpdGlvbiYmdGhpcy5zdGF0ZS5sZWZ0UG9zaXRpb24hPT1yLmxlZnRQb3NpdGlvbnx8dGhpcy5wcm9wcy5zdG9wU2Nyb2xsUHJvcGFnYXRpb24pJiYoZS5wcmV2ZW50RGVmYXVsdCgpLGUuc3RvcFByb3BhZ2F0aW9uKCkpLHRoaXMuc2V0U3RhdGVGcm9tRXZlbnQocixnLndoZWVsKSx0aGlzLmZvY3VzQ29udGVudCgpfX0se2tleTpcImhhbmRsZUtleURvd25cIix2YWx1ZTpmdW5jdGlvbihlKXtpZihcImlucHV0XCIhPT1lLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJlwidGV4dGFyZWFcIiE9PWUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSYmIWUudGFyZ2V0LmlzQ29udGVudEVkaXRhYmxlKXt2YXIgdD0wLG49MCxvPXRoaXMubGluZUhlaWdodFB4P3RoaXMubGluZUhlaWdodFB4OjEwO3N3aXRjaChlLmtleUNvZGUpe2Nhc2UgMzM6dD10aGlzLnN0YXRlLmNvbnRhaW5lckhlaWdodC1vO2JyZWFrO2Nhc2UgMzQ6dD0tdGhpcy5zdGF0ZS5jb250YWluZXJIZWlnaHQrbzticmVhaztjYXNlIDM3Om49bzticmVhaztjYXNlIDM4OnQ9bzticmVhaztjYXNlIDM5Om49LW87YnJlYWs7Y2FzZSA0MDp0PS1vfWlmKDAhPT10fHwwIT09bil7dmFyIHI9dGhpcy5jb21wb3NlTmV3U3RhdGUobix0KTtlLnByZXZlbnREZWZhdWx0KCksZS5zdG9wUHJvcGFnYXRpb24oKSx0aGlzLnNldFN0YXRlRnJvbUV2ZW50KHIsZy5rZXlQcmVzcyl9fX19LHtrZXk6XCJoYW5kbGVXaW5kb3dSZXNpemVcIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuY29tcHV0ZVNpemVzKCk7ZT10aGlzLmdldE1vZGlmaWVkUG9zaXRpb25zSWZOZWVkZWQoZSksdGhpcy5zZXRTdGF0ZUZyb21FdmVudChlKX19LHtrZXk6XCJjb21wb3NlTmV3U3RhdGVcIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMuY29tcHV0ZVNpemVzKCk7cmV0dXJuIHRoaXMuY2FuU2Nyb2xsWShuKT9uLnRvcFBvc2l0aW9uPXRoaXMuY29tcHV0ZVRvcFBvc2l0aW9uKHQsbik6bi50b3BQb3NpdGlvbj0wLHRoaXMuY2FuU2Nyb2xsWChuKSYmKG4ubGVmdFBvc2l0aW9uPXRoaXMuY29tcHV0ZUxlZnRQb3NpdGlvbihlLG4pKSxufX0se2tleTpcImNvbXB1dGVUb3BQb3NpdGlvblwiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcy5zdGF0ZS50b3BQb3NpdGlvbi1lO3JldHVybiB0aGlzLm5vcm1hbGl6ZVRvcFBvc2l0aW9uKG4sdCl9fSx7a2V5OlwiY29tcHV0ZUxlZnRQb3NpdGlvblwiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcy5zdGF0ZS5sZWZ0UG9zaXRpb24tZTtyZXR1cm4gdGhpcy5ub3JtYWxpemVMZWZ0UG9zaXRpb24obix0KX19LHtrZXk6XCJub3JtYWxpemVUb3BQb3NpdGlvblwiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU+dC5yZWFsSGVpZ2h0LXQuY29udGFpbmVySGVpZ2h0JiYoZT10LnJlYWxIZWlnaHQtdC5jb250YWluZXJIZWlnaHQpLGU8MCYmKGU9MCksZX19LHtrZXk6XCJub3JtYWxpemVMZWZ0UG9zaXRpb25cIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiBlPnQucmVhbFdpZHRoLXQuY29udGFpbmVyV2lkdGg/ZT10LnJlYWxXaWR0aC10LmNvbnRhaW5lcldpZHRoOmU8MCYmKGU9MCksZX19LHtrZXk6XCJjb21wdXRlU2l6ZXNcIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuY29udGVudC5vZmZzZXRIZWlnaHQsdD10aGlzLndyYXBwZXIub2Zmc2V0SGVpZ2h0LG49dGhpcy5jb250ZW50Lm9mZnNldFdpZHRoLG89dGhpcy53cmFwcGVyLm9mZnNldFdpZHRoO3JldHVybntyZWFsSGVpZ2h0OmUsY29udGFpbmVySGVpZ2h0OnQscmVhbFdpZHRoOm4sY29udGFpbmVyV2lkdGg6b319fSx7a2V5Olwic2V0U2l6ZXNUb1N0YXRlXCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmNvbXB1dGVTaXplcygpO2UucmVhbEhlaWdodD09PXRoaXMuc3RhdGUucmVhbEhlaWdodCYmZS5yZWFsV2lkdGg9PT10aGlzLnN0YXRlLnJlYWxXaWR0aHx8dGhpcy5zZXRTdGF0ZUZyb21FdmVudCh0aGlzLmdldE1vZGlmaWVkUG9zaXRpb25zSWZOZWVkZWQoZSkpfX0se2tleTpcInNjcm9sbFRvcFwiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5zY3JvbGxZVG8oMCl9fSx7a2V5Olwic2Nyb2xsQm90dG9tXCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNjcm9sbFlUbyh0aGlzLnN0YXRlLnJlYWxIZWlnaHQtdGhpcy5zdGF0ZS5jb250YWluZXJIZWlnaHQpfX0se2tleTpcInNjcm9sbExlZnRcIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuc2Nyb2xsWFRvKDApfX0se2tleTpcInNjcm9sbFJpZ2h0XCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNjcm9sbFhUbyh0aGlzLnN0YXRlLnJlYWxXaWR0aC10aGlzLnN0YXRlLmNvbnRhaW5lcldpZHRoKX19LHtrZXk6XCJzY3JvbGxZVG9cIix2YWx1ZTpmdW5jdGlvbihlKXtpZih0aGlzLmNhblNjcm9sbFkoKSl7dmFyIHQ9dGhpcy5ub3JtYWxpemVUb3BQb3NpdGlvbihlLHRoaXMuY29tcHV0ZVNpemVzKCkpO3RoaXMuc2V0U3RhdGVGcm9tRXZlbnQoe3RvcFBvc2l0aW9uOnR9LGcuYXBpKX19fSx7a2V5Olwic2Nyb2xsWFRvXCIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYodGhpcy5jYW5TY3JvbGxYKCkpe3ZhciB0PXRoaXMubm9ybWFsaXplTGVmdFBvc2l0aW9uKGUsdGhpcy5jb21wdXRlU2l6ZXMoKSk7dGhpcy5zZXRTdGF0ZUZyb21FdmVudCh7bGVmdFBvc2l0aW9uOnR9LGcuYXBpKX19fSx7a2V5OlwiY2FuU2Nyb2xsWVwiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnRoaXMuc3RhdGUsdD1lLnJlYWxIZWlnaHQ+ZS5jb250YWluZXJIZWlnaHQ7cmV0dXJuIHQmJnRoaXMucHJvcHMudmVydGljYWx9fSx7a2V5OlwiY2FuU2Nyb2xsWFwiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnRoaXMuc3RhdGUsdD1lLnJlYWxXaWR0aD5lLmNvbnRhaW5lcldpZHRoO3JldHVybiB0JiZ0aGlzLnByb3BzLmhvcml6b250YWx9fSx7a2V5OlwiY2FuU2Nyb2xsXCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06dGhpcy5zdGF0ZTtyZXR1cm4gdGhpcy5jYW5TY3JvbGxZKGUpfHx0aGlzLmNhblNjcm9sbFgoZSl9fSx7a2V5OlwiZ2V0TW9kaWZpZWRQb3NpdGlvbnNJZk5lZWRlZFwiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWUucmVhbEhlaWdodC1lLmNvbnRhaW5lckhlaWdodDt0aGlzLnN0YXRlLnRvcFBvc2l0aW9uPj10JiYoZS50b3BQb3NpdGlvbj10aGlzLmNhblNjcm9sbFkoZSk/KDAsbS5wb3NpdGl2ZU9yWmVybykodCk6MCk7dmFyIG49ZS5yZWFsV2lkdGgtZS5jb250YWluZXJXaWR0aDtyZXR1cm4gdGhpcy5zdGF0ZS5sZWZ0UG9zaXRpb24+PW4mJihlLmxlZnRQb3NpdGlvbj10aGlzLmNhblNjcm9sbFgoZSk/KDAsbS5wb3NpdGl2ZU9yWmVybykobik6MCksZX19LHtrZXk6XCJmb2N1c0NvbnRlbnRcIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuY29udGVudCYmKDAsbS5maW5kRE9NTm9kZSkodGhpcy5jb250ZW50KS5mb2N1cygpfX1dKSx0fShmLmRlZmF1bHQuQ29tcG9uZW50KTt0LmRlZmF1bHQ9dyx3LmNoaWxkQ29udGV4dFR5cGVzPXtzY3JvbGxBcmVhOmQuZGVmYXVsdC5vYmplY3R9LHcucHJvcFR5cGVzPXtjbGFzc05hbWU6ZC5kZWZhdWx0LnN0cmluZyxzdHlsZTpkLmRlZmF1bHQub2JqZWN0LHNwZWVkOmQuZGVmYXVsdC5udW1iZXIsY29udGVudENsYXNzTmFtZTpkLmRlZmF1bHQuc3RyaW5nLGNvbnRlbnRTdHlsZTpkLmRlZmF1bHQub2JqZWN0LHZlcnRpY2FsOmQuZGVmYXVsdC5ib29sLHZlcnRpY2FsQ29udGFpbmVyU3R5bGU6ZC5kZWZhdWx0Lm9iamVjdCx2ZXJ0aWNhbFNjcm9sbGJhclN0eWxlOmQuZGVmYXVsdC5vYmplY3QsaG9yaXpvbnRhbDpkLmRlZmF1bHQuYm9vbCxob3Jpem9udGFsQ29udGFpbmVyU3R5bGU6ZC5kZWZhdWx0Lm9iamVjdCxob3Jpem9udGFsU2Nyb2xsYmFyU3R5bGU6ZC5kZWZhdWx0Lm9iamVjdCxvblNjcm9sbDpkLmRlZmF1bHQuZnVuYyxjb250ZW50V2luZG93OmQuZGVmYXVsdC5hbnksb3duZXJEb2N1bWVudDpkLmRlZmF1bHQuYW55LHNtb290aFNjcm9sbGluZzpkLmRlZmF1bHQuYm9vbCxtaW5TY3JvbGxTaXplOmQuZGVmYXVsdC5udW1iZXIsc3dhcFdoZWVsQXhlczpkLmRlZmF1bHQuYm9vbCxzdG9wU2Nyb2xsUHJvcGFnYXRpb246ZC5kZWZhdWx0LmJvb2wsZm9jdXNhYmxlVGFiSW5kZXg6ZC5kZWZhdWx0Lm51bWJlcn0sdy5kZWZhdWx0UHJvcHM9e3NwZWVkOjEsdmVydGljYWw6ITAsaG9yaXpvbnRhbDohMCxzbW9vdGhTY3JvbGxpbmc6ITEsc3dhcFdoZWVsQXhlczohMSxjb250ZW50V2luZG93Olwib2JqZWN0XCI9PT0oXCJ1bmRlZmluZWRcIj09dHlwZW9mIHdpbmRvdz9cInVuZGVmaW5lZFwiOmwod2luZG93KSk/d2luZG93OnZvaWQgMCxvd25lckRvY3VtZW50Olwib2JqZWN0XCI9PT0oXCJ1bmRlZmluZWRcIj09dHlwZW9mIGRvY3VtZW50P1widW5kZWZpbmVkXCI6bChkb2N1bWVudCkpP2RvY3VtZW50OnZvaWQgMCxmb2N1c2FibGVUYWJJbmRleDoxfX0sZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOntkZWZhdWx0OmV9fWZ1bmN0aW9uIHIoZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpfWZ1bmN0aW9uIGkoZSx0KXtpZighZSl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7cmV0dXJuIXR8fFwib2JqZWN0XCIhPXR5cGVvZiB0JiZcImZ1bmN0aW9uXCIhPXR5cGVvZiB0P2U6dH1mdW5jdGlvbiBhKGUsdCl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIrdHlwZW9mIHQpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLHQmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKGUsdCk6ZS5fX3Byb3RvX189dCl9T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGw9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49YXJndW1lbnRzW3RdO2Zvcih2YXIgbyBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLG8pJiYoZVtvXT1uW29dKX1yZXR1cm4gZX0scz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIG89dFtuXTtvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlfHwhMSxvLmNvbmZpZ3VyYWJsZT0hMCxcInZhbHVlXCJpbiBvJiYoby53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsby5rZXksbyl9fXJldHVybiBmdW5jdGlvbih0LG4sbyl7cmV0dXJuIG4mJmUodC5wcm90b3R5cGUsbiksbyYmZSh0LG8pLHR9fSgpLHU9bigxKSxjPW8odSksZj1uKDIpLHA9byhmKSxkPW4oMTIpLGg9big5KSx5PWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSl7cih0aGlzLHQpO3ZhciBuPWkodGhpcywodC5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSkuY2FsbCh0aGlzLGUpKSxvPW4uY2FsY3VsYXRlU3RhdGUoZSk7cmV0dXJuIG4uc3RhdGU9e3Bvc2l0aW9uOm8ucG9zaXRpb24sc2Nyb2xsU2l6ZTpvLnNjcm9sbFNpemUsaXNEcmFnZ2luZzohMSxsYXN0Q2xpZW50UG9zaXRpb246MH0sXCJ2ZXJ0aWNhbFwiPT09ZS50eXBlP24uYmluZGVkSGFuZGxlTW91c2VNb3ZlPW4uaGFuZGxlTW91c2VNb3ZlRm9yVmVydGljYWwuYmluZChuKTpuLmJpbmRlZEhhbmRsZU1vdXNlTW92ZT1uLmhhbmRsZU1vdXNlTW92ZUZvckhvcml6b250YWwuYmluZChuKSxuLmJpbmRlZEhhbmRsZU1vdXNlVXA9bi5oYW5kbGVNb3VzZVVwLmJpbmQobiksbn1yZXR1cm4gYSh0LGUpLHModCxbe2tleTpcImNvbXBvbmVudERpZE1vdW50XCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnByb3BzLm93bmVyRG9jdW1lbnQmJih0aGlzLnByb3BzLm93bmVyRG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLHRoaXMuYmluZGVkSGFuZGxlTW91c2VNb3ZlKSx0aGlzLnByb3BzLm93bmVyRG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIix0aGlzLmJpbmRlZEhhbmRsZU1vdXNlVXApKX19LHtrZXk6XCJjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzXCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5zZXRTdGF0ZSh0aGlzLmNhbGN1bGF0ZVN0YXRlKGUpKX19LHtrZXk6XCJjb21wb25lbnRXaWxsVW5tb3VudFwiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5wcm9wcy5vd25lckRvY3VtZW50JiYodGhpcy5wcm9wcy5vd25lckRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIix0aGlzLmJpbmRlZEhhbmRsZU1vdXNlTW92ZSksdGhpcy5wcm9wcy5vd25lckRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsdGhpcy5iaW5kZWRIYW5kbGVNb3VzZVVwKSl9fSx7a2V5OlwiY2FsY3VsYXRlRnJhY3Rpb25hbFBvc2l0aW9uXCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciBvPWUtdDtyZXR1cm4gMS0oby1uKS9vfX0se2tleTpcImNhbGN1bGF0ZVN0YXRlXCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5jYWxjdWxhdGVGcmFjdGlvbmFsUG9zaXRpb24oZS5yZWFsU2l6ZSxlLmNvbnRhaW5lclNpemUsZS5wb3NpdGlvbiksbj1lLmNvbnRhaW5lclNpemUqZS5jb250YWluZXJTaXplL2UucmVhbFNpemUsbz1uPGUubWluU2Nyb2xsU2l6ZT9lLm1pblNjcm9sbFNpemU6bixyPShlLmNvbnRhaW5lclNpemUtbykqdDtyZXR1cm57c2Nyb2xsU2l6ZTpvLHBvc2l0aW9uOk1hdGgucm91bmQocil9fX0se2tleTpcInJlbmRlclwiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMucHJvcHMsbj10LnNtb290aFNjcm9sbGluZyxvPXQuaXNEcmFnZ2luZyxyPXQudHlwZSxpPXQuc2Nyb2xsYmFyU3R5bGUsYT10LmNvbnRhaW5lclN0eWxlLHM9XCJob3Jpem9udGFsXCI9PT1yLHU9XCJ2ZXJ0aWNhbFwiPT09cixmPXRoaXMuY3JlYXRlU2Nyb2xsU3R5bGVzKCkscD1uPygwLGgubW9kaWZ5T2JqVmFsdWVzKShmLGZ1bmN0aW9uKGUpe3JldHVybigwLGQuc3ByaW5nKShlKX0pOmYseT1cInNjcm9sbGJhci1jb250YWluZXIgXCIrKG8/XCJhY3RpdmVcIjpcIlwiKStcIiBcIisocz9cImhvcml6b250YWxcIjpcIlwiKStcIiBcIisodT9cInZlcnRpY2FsXCI6XCJcIik7cmV0dXJuIGMuZGVmYXVsdC5jcmVhdGVFbGVtZW50KGQuTW90aW9uLHtzdHlsZTpwfSxmdW5jdGlvbih0KXtyZXR1cm4gYy5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIix7Y2xhc3NOYW1lOnksc3R5bGU6YSxvbk1vdXNlRG93bjplLmhhbmRsZVNjcm9sbEJhckNvbnRhaW5lckNsaWNrLmJpbmQoZSkscmVmOmZ1bmN0aW9uKHQpe3JldHVybiBlLnNjcm9sbGJhckNvbnRhaW5lcj10fX0sYy5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIix7Y2xhc3NOYW1lOlwic2Nyb2xsYmFyXCIsc3R5bGU6bCh7fSxpLHQpLG9uTW91c2VEb3duOmUuaGFuZGxlTW91c2VEb3duLmJpbmQoZSl9KSl9KX19LHtrZXk6XCJoYW5kbGVTY3JvbGxCYXJDb250YWluZXJDbGlja1wiLHZhbHVlOmZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKTt2YXIgdD10aGlzLmNvbXB1dGVNdWx0aXBsaWVyKCksbj10aGlzLmlzVmVydGljYWwoKT9lLmNsaWVudFk6ZS5jbGllbnRYLG89dGhpcy5zY3JvbGxiYXJDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkscj1vLnRvcCxpPW8ubGVmdCxhPXRoaXMuaXNWZXJ0aWNhbCgpP3I6aSxsPW4tYSxzPXRoaXMucHJvcHMuY29udGFpbmVyU2l6ZSp0aGlzLnByb3BzLmNvbnRhaW5lclNpemUvdGhpcy5wcm9wcy5yZWFsU2l6ZTt0aGlzLnNldFN0YXRlKHtpc0RyYWdnaW5nOiEwLGxhc3RDbGllbnRQb3NpdGlvbjpufSksdGhpcy5wcm9wcy5vblBvc2l0aW9uQ2hhbmdlKChsLXMvMikvdCl9fSx7a2V5OlwiaGFuZGxlTW91c2VNb3ZlRm9ySG9yaXpvbnRhbFwiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuY29tcHV0ZU11bHRpcGxpZXIoKTtpZih0aGlzLnN0YXRlLmlzRHJhZ2dpbmcpe2UucHJldmVudERlZmF1bHQoKTt2YXIgbj10aGlzLnN0YXRlLmxhc3RDbGllbnRQb3NpdGlvbi1lLmNsaWVudFg7dGhpcy5zZXRTdGF0ZSh7bGFzdENsaWVudFBvc2l0aW9uOmUuY2xpZW50WH0pLHRoaXMucHJvcHMub25Nb3ZlKDAsbi90KX19fSx7a2V5OlwiaGFuZGxlTW91c2VNb3ZlRm9yVmVydGljYWxcIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLmNvbXB1dGVNdWx0aXBsaWVyKCk7aWYodGhpcy5zdGF0ZS5pc0RyYWdnaW5nKXtlLnByZXZlbnREZWZhdWx0KCk7dmFyIG49dGhpcy5zdGF0ZS5sYXN0Q2xpZW50UG9zaXRpb24tZS5jbGllbnRZO3RoaXMuc2V0U3RhdGUoe2xhc3RDbGllbnRQb3NpdGlvbjplLmNsaWVudFl9KSx0aGlzLnByb3BzLm9uTW92ZShuL3QsMCl9fX0se2tleTpcImhhbmRsZU1vdXNlRG93blwiLHZhbHVlOmZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKSxlLnN0b3BQcm9wYWdhdGlvbigpO3ZhciB0PXRoaXMuaXNWZXJ0aWNhbCgpP2UuY2xpZW50WTplLmNsaWVudFg7dGhpcy5zZXRTdGF0ZSh7aXNEcmFnZ2luZzohMCxsYXN0Q2xpZW50UG9zaXRpb246dH0pLHRoaXMucHJvcHMub25Gb2N1cygpfX0se2tleTpcImhhbmRsZU1vdXNlVXBcIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLnN0YXRlLmlzRHJhZ2dpbmcmJihlLnByZXZlbnREZWZhdWx0KCksdGhpcy5zZXRTdGF0ZSh7aXNEcmFnZ2luZzohMX0pKX19LHtrZXk6XCJjcmVhdGVTY3JvbGxTdHlsZXNcIix2YWx1ZTpmdW5jdGlvbigpe3JldHVyblwidmVydGljYWxcIj09PXRoaXMucHJvcHMudHlwZT97aGVpZ2h0OnRoaXMuc3RhdGUuc2Nyb2xsU2l6ZSxtYXJnaW5Ub3A6dGhpcy5zdGF0ZS5wb3NpdGlvbn06e3dpZHRoOnRoaXMuc3RhdGUuc2Nyb2xsU2l6ZSxtYXJnaW5MZWZ0OnRoaXMuc3RhdGUucG9zaXRpb259fX0se2tleTpcImNvbXB1dGVNdWx0aXBsaWVyXCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wcm9wcy5jb250YWluZXJTaXplL3RoaXMucHJvcHMucmVhbFNpemV9fSx7a2V5OlwiaXNWZXJ0aWNhbFwiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuXCJ2ZXJ0aWNhbFwiPT09dGhpcy5wcm9wcy50eXBlfX1dKSx0fShjLmRlZmF1bHQuQ29tcG9uZW50KTt5LnByb3BUeXBlcz17b25Nb3ZlOnAuZGVmYXVsdC5mdW5jLG9uUG9zaXRpb25DaGFuZ2U6cC5kZWZhdWx0LmZ1bmMsb25Gb2N1czpwLmRlZmF1bHQuZnVuYyxyZWFsU2l6ZTpwLmRlZmF1bHQubnVtYmVyLGNvbnRhaW5lclNpemU6cC5kZWZhdWx0Lm51bWJlcixwb3NpdGlvbjpwLmRlZmF1bHQubnVtYmVyLGNvbnRhaW5lclN0eWxlOnAuZGVmYXVsdC5vYmplY3Qsc2Nyb2xsYmFyU3R5bGU6cC5kZWZhdWx0Lm9iamVjdCx0eXBlOnAuZGVmYXVsdC5vbmVPZihbXCJ2ZXJ0aWNhbFwiLFwiaG9yaXpvbnRhbFwiXSksb3duZXJEb2N1bWVudDpwLmRlZmF1bHQuYW55LHNtb290aFNjcm9sbGluZzpwLmRlZmF1bHQuYm9vbCxtaW5TY3JvbGxTaXplOnAuZGVmYXVsdC5udW1iZXJ9LHkuZGVmYXVsdFByb3BzPXt0eXBlOlwidmVydGljYWxcIixzbW9vdGhTY3JvbGxpbmc6ITF9LHQuZGVmYXVsdD15fSxmdW5jdGlvbihlLHQpe3ZhciBuPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gbj13aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSwobj9uKGUpOmUuY3VycmVudFN0eWxlKVt0LnJlcGxhY2UoLy0oXFx3KS9naSxmdW5jdGlvbihlLHQpe3JldHVybiB0LnRvVXBwZXJDYXNlKCl9KV19O2UuZXhwb3J0cz1ufSxmdW5jdGlvbihlLHQsbil7dD1lLmV4cG9ydHM9bigxNykoKSx0LnB1c2goW2UuaWQsXCIuc2Nyb2xsYXJlYS1jb250ZW50e21hcmdpbjowO3BhZGRpbmc6MDtvdmVyZmxvdzpoaWRkZW47cG9zaXRpb246cmVsYXRpdmV9LnNjcm9sbGFyZWEtY29udGVudDpmb2N1c3tvdXRsaW5lOjB9LnNjcm9sbGFyZWF7cG9zaXRpb246cmVsYXRpdmU7b3ZlcmZsb3c6aGlkZGVufS5zY3JvbGxhcmVhIC5zY3JvbGxiYXItY29udGFpbmVye3Bvc2l0aW9uOmFic29sdXRlO2JhY2tncm91bmQ6bm9uZTtvcGFjaXR5Oi4xO3otaW5kZXg6OTk5OTstd2Via2l0LXRyYW5zaXRpb246YWxsIC40czt0cmFuc2l0aW9uOmFsbCAuNHN9LnNjcm9sbGFyZWEgLnNjcm9sbGJhci1jb250YWluZXIuaG9yaXpvbnRhbHt3aWR0aDoxMDAlO2hlaWdodDoxMHB4O2xlZnQ6MDtib3R0b206MH0uc2Nyb2xsYXJlYSAuc2Nyb2xsYmFyLWNvbnRhaW5lci5ob3Jpem9udGFsIC5zY3JvbGxiYXJ7d2lkdGg6MjBweDtoZWlnaHQ6OHB4O2JhY2tncm91bmQ6IzAwMDttYXJnaW4tdG9wOjFweH0uc2Nyb2xsYXJlYSAuc2Nyb2xsYmFyLWNvbnRhaW5lci52ZXJ0aWNhbHt3aWR0aDoxMHB4O2hlaWdodDoxMDAlO3JpZ2h0OjA7dG9wOjB9LnNjcm9sbGFyZWEgLnNjcm9sbGJhci1jb250YWluZXIudmVydGljYWwgLnNjcm9sbGJhcnt3aWR0aDo4cHg7aGVpZ2h0OjIwcHg7YmFja2dyb3VuZDojMDAwO21hcmdpbi1sZWZ0OjFweH0uc2Nyb2xsYXJlYSAuc2Nyb2xsYmFyLWNvbnRhaW5lci5hY3RpdmUsLnNjcm9sbGFyZWEgLnNjcm9sbGJhci1jb250YWluZXI6aG92ZXJ7YmFja2dyb3VuZDpncmF5O29wYWNpdHk6LjYhaW1wb3J0YW50fS5zY3JvbGxhcmVhOmhvdmVyIC5zY3JvbGxiYXItY29udGFpbmVye29wYWNpdHk6LjN9XCIsXCJcIl0pfSxmdW5jdGlvbihlLHQpe2UuZXhwb3J0cz1mdW5jdGlvbigpe3ZhciBlPVtdO3JldHVybiBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPVtdLHQ9MDt0PHRoaXMubGVuZ3RoO3QrKyl7dmFyIG49dGhpc1t0XTtuWzJdP2UucHVzaChcIkBtZWRpYSBcIituWzJdK1wie1wiK25bMV0rXCJ9XCIpOmUucHVzaChuWzFdKX1yZXR1cm4gZS5qb2luKFwiXCIpfSxlLmk9ZnVuY3Rpb24odCxuKXtcInN0cmluZ1wiPT10eXBlb2YgdCYmKHQ9W1tudWxsLHQsXCJcIl1dKTtmb3IodmFyIG89e30scj0wO3I8dGhpcy5sZW5ndGg7cisrKXt2YXIgaT10aGlzW3JdWzBdO1wibnVtYmVyXCI9PXR5cGVvZiBpJiYob1tpXT0hMCl9Zm9yKHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIGE9dFtyXTtcIm51bWJlclwiPT10eXBlb2YgYVswXSYmb1thWzBdXXx8KG4mJiFhWzJdP2FbMl09bjpuJiYoYVsyXT1cIihcIithWzJdK1wiKSBhbmQgKFwiK24rXCIpXCIpLGUucHVzaChhKSl9fSxlfX0sZnVuY3Rpb24oZSx0LG4pe2Z1bmN0aW9uIG8oZSl7dmFyIHQ9cihlLFwibGluZS1oZWlnaHRcIiksbj1wYXJzZUZsb2F0KHQsMTApO2lmKHQ9PT1uK1wiXCIpe3ZhciBvPWUuc3R5bGUubGluZUhlaWdodDtlLnN0eWxlLmxpbmVIZWlnaHQ9dCtcImVtXCIsdD1yKGUsXCJsaW5lLWhlaWdodFwiKSxuPXBhcnNlRmxvYXQodCwxMCksbz9lLnN0eWxlLmxpbmVIZWlnaHQ9bzpkZWxldGUgZS5zdHlsZS5saW5lSGVpZ2h0fWlmKHQuaW5kZXhPZihcInB0XCIpIT09LTE/KG4qPTQsbi89Myk6dC5pbmRleE9mKFwibW1cIikhPT0tMT8obio9OTYsbi89MjUuNCk6dC5pbmRleE9mKFwiY21cIikhPT0tMT8obio9OTYsbi89Mi41NCk6dC5pbmRleE9mKFwiaW5cIikhPT0tMT9uKj05Njp0LmluZGV4T2YoXCJwY1wiKSE9PS0xJiYobio9MTYpLG49TWF0aC5yb3VuZChuKSxcIm5vcm1hbFwiPT09dCl7dmFyIGk9ZS5ub2RlTmFtZSxhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoaSk7YS5pbm5lckhUTUw9XCImbmJzcDtcIjt2YXIgbD1yKGUsXCJmb250LXNpemVcIik7YS5zdHlsZS5mb250U2l6ZT1sO3ZhciBzPWRvY3VtZW50LmJvZHk7cy5hcHBlbmRDaGlsZChhKTt2YXIgdT1hLm9mZnNldEhlaWdodDtuPXUscy5yZW1vdmVDaGlsZChhKX1yZXR1cm4gbn12YXIgcj1uKDE1KTtlLmV4cG9ydHM9b30sZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO3ZhciBvPW4oMjEpLHI9bigyMiksaT1uKDIwKTtlLmV4cG9ydHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCxuLG8sYSxsKXtsIT09aSYmcighMSxcIkNhbGxpbmcgUHJvcFR5cGVzIHZhbGlkYXRvcnMgZGlyZWN0bHkgaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgYHByb3AtdHlwZXNgIHBhY2thZ2UuIFVzZSBQcm9wVHlwZXMuY2hlY2tQcm9wVHlwZXMoKSB0byBjYWxsIHRoZW0uIFJlYWQgbW9yZSBhdCBodHRwOi8vZmIubWUvdXNlLWNoZWNrLXByb3AtdHlwZXNcIil9ZnVuY3Rpb24gdCgpe3JldHVybiBlfWUuaXNSZXF1aXJlZD1lO3ZhciBuPXthcnJheTplLGJvb2w6ZSxmdW5jOmUsbnVtYmVyOmUsb2JqZWN0OmUsc3RyaW5nOmUsc3ltYm9sOmUsYW55OmUsYXJyYXlPZjp0LGVsZW1lbnQ6ZSxpbnN0YW5jZU9mOnQsbm9kZTplLG9iamVjdE9mOnQsb25lT2Y6dCxvbmVPZlR5cGU6dCxzaGFwZTp0LGV4YWN0OnR9O3JldHVybiBuLmNoZWNrUHJvcFR5cGVzPW8sbi5Qcm9wVHlwZXM9bixufX0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjt2YXIgbj1cIlNFQ1JFVF9ET19OT1RfUEFTU19USElTX09SX1lPVV9XSUxMX0JFX0ZJUkVEXCI7ZS5leHBvcnRzPW59LGZ1bmN0aW9uKGUsdCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbihlKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gZX19dmFyIG89ZnVuY3Rpb24oKXt9O28udGhhdFJldHVybnM9bixvLnRoYXRSZXR1cm5zRmFsc2U9bighMSksby50aGF0UmV0dXJuc1RydWU9bighMCksby50aGF0UmV0dXJuc051bGw9bihudWxsKSxvLnRoYXRSZXR1cm5zVGhpcz1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxvLnRoYXRSZXR1cm5zQXJndW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LGUuZXhwb3J0cz1vfSxmdW5jdGlvbihlLHQsbil7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbyhlLHQsbixvLGksYSxsLHMpe2lmKHIodCksIWUpe3ZhciB1O2lmKHZvaWQgMD09PXQpdT1uZXcgRXJyb3IoXCJNaW5pZmllZCBleGNlcHRpb24gb2NjdXJyZWQ7IHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCBmb3IgdGhlIGZ1bGwgZXJyb3IgbWVzc2FnZSBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLlwiKTtlbHNle3ZhciBjPVtuLG8saSxhLGwsc10sZj0wO3U9bmV3IEVycm9yKHQucmVwbGFjZSgvJXMvZyxmdW5jdGlvbigpe3JldHVybiBjW2YrK119KSksdS5uYW1lPVwiSW52YXJpYW50IFZpb2xhdGlvblwifXRocm93IHUuZnJhbWVzVG9Qb3A9MSx1fX12YXIgcj1mdW5jdGlvbihlKXt9O2UuZXhwb3J0cz1vfSxmdW5jdGlvbihlLHQsbil7KGZ1bmN0aW9uKHQpeyhmdW5jdGlvbigpe3ZhciBuLG8scixpLGEsbDtcInVuZGVmaW5lZFwiIT10eXBlb2YgcGVyZm9ybWFuY2UmJm51bGwhPT1wZXJmb3JtYW5jZSYmcGVyZm9ybWFuY2Uubm93P2UuZXhwb3J0cz1mdW5jdGlvbigpe3JldHVybiBwZXJmb3JtYW5jZS5ub3coKX06XCJ1bmRlZmluZWRcIiE9dHlwZW9mIHQmJm51bGwhPT10JiZ0LmhydGltZT8oZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuKG4oKS1hKS8xZTZ9LG89dC5ocnRpbWUsbj1mdW5jdGlvbigpe3ZhciBlO3JldHVybiBlPW8oKSwxZTkqZVswXStlWzFdfSxpPW4oKSxsPTFlOSp0LnVwdGltZSgpLGE9aS1sKTpEYXRlLm5vdz8oZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubm93KCktcn0scj1EYXRlLm5vdygpKTooZS5leHBvcnRzPWZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCktcn0scj0obmV3IERhdGUpLmdldFRpbWUoKSl9KS5jYWxsKHRoaXMpfSkuY2FsbCh0LG4oMTApKX0sZnVuY3Rpb24oZSx0LG4pe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOntkZWZhdWx0OmV9fWZ1bmN0aW9uIHIoZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpfWZ1bmN0aW9uIGkoZSx0KXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiB0JiZudWxsIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIit0eXBlb2YgdCk7ZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0JiZ0LnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmUsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksdCYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YoZSx0KTplLl9fcHJvdG9fXz10KX10Ll9fZXNNb2R1bGU9ITA7dmFyIGE9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49YXJndW1lbnRzW3RdO2Zvcih2YXIgbyBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLG8pJiYoZVtvXT1uW29dKX1yZXR1cm4gZX0sbD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIG89dFtuXTtvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlfHwhMSxvLmNvbmZpZ3VyYWJsZT0hMCxcInZhbHVlXCJpbiBvJiYoby53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsby5rZXksbyl9fXJldHVybiBmdW5jdGlvbih0LG4sbyl7cmV0dXJuIG4mJmUodC5wcm90b3R5cGUsbiksbyYmZSh0LG8pLHR9fSgpLHM9big2KSx1PW8ocyksYz1uKDMpLGY9byhjKSxwPW4oOCksZD1vKHApLGg9big0KSx5PW8oaCksdj1uKDUpLG09byh2KSxiPW4oNyksUz1vKGIpLGc9bigxKSx3PW8oZyksUD1uKDIpLFQ9byhQKSxrPTFlMy82MCxPPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQobil7dmFyIG89dGhpcztyKHRoaXMsdCksZS5jYWxsKHRoaXMsbiksdGhpcy53YXNBbmltYXRpbmc9ITEsdGhpcy5hbmltYXRpb25JRD1udWxsLHRoaXMucHJldlRpbWU9MCx0aGlzLmFjY3VtdWxhdGVkVGltZT0wLHRoaXMudW5yZWFkUHJvcFN0eWxlPW51bGwsdGhpcy5jbGVhclVucmVhZFByb3BTdHlsZT1mdW5jdGlvbihlKXt2YXIgdD0hMSxuPW8uc3RhdGUscj1uLmN1cnJlbnRTdHlsZSxpPW4uY3VycmVudFZlbG9jaXR5LGw9bi5sYXN0SWRlYWxTdHlsZSxzPW4ubGFzdElkZWFsVmVsb2NpdHk7Zm9yKHZhciB1IGluIGUpaWYoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdSkpe3ZhciBjPWVbdV07XCJudW1iZXJcIj09dHlwZW9mIGMmJih0fHwodD0hMCxyPWEoe30sciksaT1hKHt9LGkpLGw9YSh7fSxsKSxzPWEoe30scykpLHJbdV09YyxpW3VdPTAsbFt1XT1jLHNbdV09MCl9dCYmby5zZXRTdGF0ZSh7Y3VycmVudFN0eWxlOnIsY3VycmVudFZlbG9jaXR5OmksbGFzdElkZWFsU3R5bGU6bCxsYXN0SWRlYWxWZWxvY2l0eTpzfSl9LHRoaXMuc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeT1mdW5jdGlvbigpe28uYW5pbWF0aW9uSUQ9bS5kZWZhdWx0KGZ1bmN0aW9uKGUpe3ZhciB0PW8ucHJvcHMuc3R5bGU7aWYoUy5kZWZhdWx0KG8uc3RhdGUuY3VycmVudFN0eWxlLHQsby5zdGF0ZS5jdXJyZW50VmVsb2NpdHkpKXJldHVybiBvLndhc0FuaW1hdGluZyYmby5wcm9wcy5vblJlc3QmJm8ucHJvcHMub25SZXN0KCksby5hbmltYXRpb25JRD1udWxsLG8ud2FzQW5pbWF0aW5nPSExLHZvaWQoby5hY2N1bXVsYXRlZFRpbWU9MCk7by53YXNBbmltYXRpbmc9ITA7dmFyIG49ZXx8eS5kZWZhdWx0KCkscj1uLW8ucHJldlRpbWU7aWYoby5wcmV2VGltZT1uLG8uYWNjdW11bGF0ZWRUaW1lPW8uYWNjdW11bGF0ZWRUaW1lK3Isby5hY2N1bXVsYXRlZFRpbWU+MTAqayYmKG8uYWNjdW11bGF0ZWRUaW1lPTApLDA9PT1vLmFjY3VtdWxhdGVkVGltZSlyZXR1cm4gby5hbmltYXRpb25JRD1udWxsLHZvaWQgby5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCk7dmFyIGk9KG8uYWNjdW11bGF0ZWRUaW1lLU1hdGguZmxvb3Ioby5hY2N1bXVsYXRlZFRpbWUvaykqaykvayxhPU1hdGguZmxvb3Ioby5hY2N1bXVsYXRlZFRpbWUvayksbD17fSxzPXt9LHU9e30sYz17fTtmb3IodmFyIGYgaW4gdClpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxmKSl7dmFyIHA9dFtmXTtpZihcIm51bWJlclwiPT10eXBlb2YgcCl1W2ZdPXAsY1tmXT0wLGxbZl09cCxzW2ZdPTA7ZWxzZXtmb3IodmFyIGg9by5zdGF0ZS5sYXN0SWRlYWxTdHlsZVtmXSx2PW8uc3RhdGUubGFzdElkZWFsVmVsb2NpdHlbZl0sbT0wO208YTttKyspe3ZhciBiPWQuZGVmYXVsdChrLzFlMyxoLHYscC52YWwscC5zdGlmZm5lc3MscC5kYW1waW5nLHAucHJlY2lzaW9uKTtoPWJbMF0sdj1iWzFdfXZhciBnPWQuZGVmYXVsdChrLzFlMyxoLHYscC52YWwscC5zdGlmZm5lc3MscC5kYW1waW5nLHAucHJlY2lzaW9uKSx3PWdbMF0sUD1nWzFdO3VbZl09aCsody1oKSppLGNbZl09disoUC12KSppLGxbZl09aCxzW2ZdPXZ9fW8uYW5pbWF0aW9uSUQ9bnVsbCxvLmFjY3VtdWxhdGVkVGltZS09YSprLG8uc2V0U3RhdGUoe2N1cnJlbnRTdHlsZTp1LGN1cnJlbnRWZWxvY2l0eTpjLGxhc3RJZGVhbFN0eWxlOmwsbGFzdElkZWFsVmVsb2NpdHk6c30pLG8udW5yZWFkUHJvcFN0eWxlPW51bGwsby5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCl9KX0sdGhpcy5zdGF0ZT10aGlzLmRlZmF1bHRTdGF0ZSgpfXJldHVybiBpKHQsZSksbCh0LG51bGwsW3trZXk6XCJwcm9wVHlwZXNcIix2YWx1ZTp7ZGVmYXVsdFN0eWxlOlQuZGVmYXVsdC5vYmplY3RPZihULmRlZmF1bHQubnVtYmVyKSxzdHlsZTpULmRlZmF1bHQub2JqZWN0T2YoVC5kZWZhdWx0Lm9uZU9mVHlwZShbVC5kZWZhdWx0Lm51bWJlcixULmRlZmF1bHQub2JqZWN0XSkpLmlzUmVxdWlyZWQsY2hpbGRyZW46VC5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCxvblJlc3Q6VC5kZWZhdWx0LmZ1bmN9LGVudW1lcmFibGU6ITB9XSksdC5wcm90b3R5cGUuZGVmYXVsdFN0YXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wcm9wcyx0PWUuZGVmYXVsdFN0eWxlLG49ZS5zdHlsZSxvPXR8fGYuZGVmYXVsdChuKSxyPXUuZGVmYXVsdChvKTtyZXR1cm57Y3VycmVudFN0eWxlOm8sY3VycmVudFZlbG9jaXR5OnIsbGFzdElkZWFsU3R5bGU6byxsYXN0SWRlYWxWZWxvY2l0eTpyfX0sdC5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQ9ZnVuY3Rpb24oKXt0aGlzLnByZXZUaW1lPXkuZGVmYXVsdCgpLHRoaXMuc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpfSx0LnByb3RvdHlwZS5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzPWZ1bmN0aW9uKGUpe251bGwhPXRoaXMudW5yZWFkUHJvcFN0eWxlJiZ0aGlzLmNsZWFyVW5yZWFkUHJvcFN0eWxlKHRoaXMudW5yZWFkUHJvcFN0eWxlKSx0aGlzLnVucmVhZFByb3BTdHlsZT1lLnN0eWxlLG51bGw9PXRoaXMuYW5pbWF0aW9uSUQmJih0aGlzLnByZXZUaW1lPXkuZGVmYXVsdCgpLHRoaXMuc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpKX0sdC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQ9ZnVuY3Rpb24oKXtudWxsIT10aGlzLmFuaW1hdGlvbklEJiYobS5kZWZhdWx0LmNhbmNlbCh0aGlzLmFuaW1hdGlvbklEKSx0aGlzLmFuaW1hdGlvbklEPW51bGwpfSx0LnByb3RvdHlwZS5yZW5kZXI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnByb3BzLmNoaWxkcmVuKHRoaXMuc3RhdGUuY3VycmVudFN0eWxlKTtyZXR1cm4gZSYmdy5kZWZhdWx0LkNoaWxkcmVuLm9ubHkoZSl9LHR9KHcuZGVmYXVsdC5Db21wb25lbnQpO3QuZGVmYXVsdD1PLGUuZXhwb3J0cz10LmRlZmF1bHR9LGZ1bmN0aW9uKGUsdCxuKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBvKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ZGVmYXVsdDplfX1mdW5jdGlvbiByKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgdCkpdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKX1mdW5jdGlvbiBpKGUsdCl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIrdHlwZW9mIHQpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLHQmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKGUsdCk6ZS5fX3Byb3RvX189dCl9ZnVuY3Rpb24gYShlLHQsbil7Zm9yKHZhciBvPTA7bzxlLmxlbmd0aDtvKyspaWYoIWcuZGVmYXVsdChlW29dLHRbb10sbltvXSkpcmV0dXJuITE7cmV0dXJuITB9dC5fX2VzTW9kdWxlPSEwO3ZhciBsPU9iamVjdC5hc3NpZ258fGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0Kyspe3ZhciBuPWFyZ3VtZW50c1t0XTtmb3IodmFyIG8gaW4gbilPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobixvKSYmKGVbb109bltvXSl9cmV0dXJuIGV9LHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCl7Zm9yKHZhciBuPTA7bjx0Lmxlbmd0aDtuKyspe3ZhciBvPXRbbl07by5lbnVtZXJhYmxlPW8uZW51bWVyYWJsZXx8ITEsby5jb25maWd1cmFibGU9ITAsXCJ2YWx1ZVwiaW4gbyYmKG8ud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLG8ua2V5LG8pfX1yZXR1cm4gZnVuY3Rpb24odCxuLG8pe3JldHVybiBuJiZlKHQucHJvdG90eXBlLG4pLG8mJmUodCxvKSx0fX0oKSx1PW4oNiksYz1vKHUpLGY9bigzKSxwPW8oZiksZD1uKDgpLGg9byhkKSx5PW4oNCksdj1vKHkpLG09big1KSxiPW8obSksUz1uKDcpLGc9byhTKSx3PW4oMSksUD1vKHcpLFQ9bigyKSxrPW8oVCksTz0xZTMvNjAsTT1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KG4pe3ZhciBvPXRoaXM7cih0aGlzLHQpLGUuY2FsbCh0aGlzLG4pLHRoaXMuYW5pbWF0aW9uSUQ9bnVsbCx0aGlzLnByZXZUaW1lPTAsdGhpcy5hY2N1bXVsYXRlZFRpbWU9MCx0aGlzLnVucmVhZFByb3BTdHlsZXM9bnVsbCx0aGlzLmNsZWFyVW5yZWFkUHJvcFN0eWxlPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1vLnN0YXRlLG49dC5jdXJyZW50U3R5bGVzLHI9dC5jdXJyZW50VmVsb2NpdGllcyxpPXQubGFzdElkZWFsU3R5bGVzLGE9dC5sYXN0SWRlYWxWZWxvY2l0aWVzLHM9ITEsdT0wO3U8ZS5sZW5ndGg7dSsrKXt2YXIgYz1lW3VdLGY9ITE7Zm9yKHZhciBwIGluIGMpaWYoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGMscCkpe3ZhciBkPWNbcF07XCJudW1iZXJcIj09dHlwZW9mIGQmJihmfHwoZj0hMCxzPSEwLG5bdV09bCh7fSxuW3VdKSxyW3VdPWwoe30sclt1XSksaVt1XT1sKHt9LGlbdV0pLGFbdV09bCh7fSxhW3VdKSksblt1XVtwXT1kLHJbdV1bcF09MCxpW3VdW3BdPWQsYVt1XVtwXT0wKX19cyYmby5zZXRTdGF0ZSh7Y3VycmVudFN0eWxlczpuLGN1cnJlbnRWZWxvY2l0aWVzOnIsbGFzdElkZWFsU3R5bGVzOmksbGFzdElkZWFsVmVsb2NpdGllczphfSl9LHRoaXMuc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeT1mdW5jdGlvbigpe28uYW5pbWF0aW9uSUQ9Yi5kZWZhdWx0KGZ1bmN0aW9uKGUpe1xudmFyIHQ9by5wcm9wcy5zdHlsZXMoby5zdGF0ZS5sYXN0SWRlYWxTdHlsZXMpO2lmKGEoby5zdGF0ZS5jdXJyZW50U3R5bGVzLHQsby5zdGF0ZS5jdXJyZW50VmVsb2NpdGllcykpcmV0dXJuIG8uYW5pbWF0aW9uSUQ9bnVsbCx2b2lkKG8uYWNjdW11bGF0ZWRUaW1lPTApO3ZhciBuPWV8fHYuZGVmYXVsdCgpLHI9bi1vLnByZXZUaW1lO2lmKG8ucHJldlRpbWU9bixvLmFjY3VtdWxhdGVkVGltZT1vLmFjY3VtdWxhdGVkVGltZStyLG8uYWNjdW11bGF0ZWRUaW1lPjEwKk8mJihvLmFjY3VtdWxhdGVkVGltZT0wKSwwPT09by5hY2N1bXVsYXRlZFRpbWUpcmV0dXJuIG8uYW5pbWF0aW9uSUQ9bnVsbCx2b2lkIG8uc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpO2Zvcih2YXIgaT0oby5hY2N1bXVsYXRlZFRpbWUtTWF0aC5mbG9vcihvLmFjY3VtdWxhdGVkVGltZS9PKSpPKS9PLGw9TWF0aC5mbG9vcihvLmFjY3VtdWxhdGVkVGltZS9PKSxzPVtdLHU9W10sYz1bXSxmPVtdLHA9MDtwPHQubGVuZ3RoO3ArKyl7dmFyIGQ9dFtwXSx5PXt9LG09e30sYj17fSxTPXt9O2Zvcih2YXIgZyBpbiBkKWlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkLGcpKXt2YXIgdz1kW2ddO2lmKFwibnVtYmVyXCI9PXR5cGVvZiB3KXlbZ109dyxtW2ddPTAsYltnXT13LFNbZ109MDtlbHNle2Zvcih2YXIgUD1vLnN0YXRlLmxhc3RJZGVhbFN0eWxlc1twXVtnXSxUPW8uc3RhdGUubGFzdElkZWFsVmVsb2NpdGllc1twXVtnXSxrPTA7azxsO2srKyl7dmFyIE09aC5kZWZhdWx0KE8vMWUzLFAsVCx3LnZhbCx3LnN0aWZmbmVzcyx3LmRhbXBpbmcsdy5wcmVjaXNpb24pO1A9TVswXSxUPU1bMV19dmFyIHg9aC5kZWZhdWx0KE8vMWUzLFAsVCx3LnZhbCx3LnN0aWZmbmVzcyx3LmRhbXBpbmcsdy5wcmVjaXNpb24pLEk9eFswXSxEPXhbMV07eVtnXT1QKyhJLVApKmksbVtnXT1UKyhELVQpKmksYltnXT1QLFNbZ109VH19Y1twXT15LGZbcF09bSxzW3BdPWIsdVtwXT1TfW8uYW5pbWF0aW9uSUQ9bnVsbCxvLmFjY3VtdWxhdGVkVGltZS09bCpPLG8uc2V0U3RhdGUoe2N1cnJlbnRTdHlsZXM6YyxjdXJyZW50VmVsb2NpdGllczpmLGxhc3RJZGVhbFN0eWxlczpzLGxhc3RJZGVhbFZlbG9jaXRpZXM6dX0pLG8udW5yZWFkUHJvcFN0eWxlcz1udWxsLG8uc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpfSl9LHRoaXMuc3RhdGU9dGhpcy5kZWZhdWx0U3RhdGUoKX1yZXR1cm4gaSh0LGUpLHModCxudWxsLFt7a2V5OlwicHJvcFR5cGVzXCIsdmFsdWU6e2RlZmF1bHRTdHlsZXM6ay5kZWZhdWx0LmFycmF5T2Yoay5kZWZhdWx0Lm9iamVjdE9mKGsuZGVmYXVsdC5udW1iZXIpKSxzdHlsZXM6ay5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCxjaGlsZHJlbjprLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkfSxlbnVtZXJhYmxlOiEwfV0pLHQucHJvdG90eXBlLmRlZmF1bHRTdGF0ZT1mdW5jdGlvbigpe3ZhciBlPXRoaXMucHJvcHMsdD1lLmRlZmF1bHRTdHlsZXMsbj1lLnN0eWxlcyxvPXR8fG4oKS5tYXAocC5kZWZhdWx0KSxyPW8ubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBjLmRlZmF1bHQoZSl9KTtyZXR1cm57Y3VycmVudFN0eWxlczpvLGN1cnJlbnRWZWxvY2l0aWVzOnIsbGFzdElkZWFsU3R5bGVzOm8sbGFzdElkZWFsVmVsb2NpdGllczpyfX0sdC5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQ9ZnVuY3Rpb24oKXt0aGlzLnByZXZUaW1lPXYuZGVmYXVsdCgpLHRoaXMuc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpfSx0LnByb3RvdHlwZS5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzPWZ1bmN0aW9uKGUpe251bGwhPXRoaXMudW5yZWFkUHJvcFN0eWxlcyYmdGhpcy5jbGVhclVucmVhZFByb3BTdHlsZSh0aGlzLnVucmVhZFByb3BTdHlsZXMpLHRoaXMudW5yZWFkUHJvcFN0eWxlcz1lLnN0eWxlcyh0aGlzLnN0YXRlLmxhc3RJZGVhbFN0eWxlcyksbnVsbD09dGhpcy5hbmltYXRpb25JRCYmKHRoaXMucHJldlRpbWU9di5kZWZhdWx0KCksdGhpcy5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCkpfSx0LnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudD1mdW5jdGlvbigpe251bGwhPXRoaXMuYW5pbWF0aW9uSUQmJihiLmRlZmF1bHQuY2FuY2VsKHRoaXMuYW5pbWF0aW9uSUQpLHRoaXMuYW5pbWF0aW9uSUQ9bnVsbCl9LHQucHJvdG90eXBlLnJlbmRlcj1mdW5jdGlvbigpe3ZhciBlPXRoaXMucHJvcHMuY2hpbGRyZW4odGhpcy5zdGF0ZS5jdXJyZW50U3R5bGVzKTtyZXR1cm4gZSYmUC5kZWZhdWx0LkNoaWxkcmVuLm9ubHkoZSl9LHR9KFAuZGVmYXVsdC5Db21wb25lbnQpO3QuZGVmYXVsdD1NLGUuZXhwb3J0cz10LmRlZmF1bHR9LGZ1bmN0aW9uKGUsdCxuKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBvKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ZGVmYXVsdDplfX1mdW5jdGlvbiByKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgdCkpdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKX1mdW5jdGlvbiBpKGUsdCl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIrdHlwZW9mIHQpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLHQmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKGUsdCk6ZS5fX3Byb3RvX189dCl9ZnVuY3Rpb24gYShlLHQsbil7dmFyIG89dDtyZXR1cm4gbnVsbD09bz9lLm1hcChmdW5jdGlvbihlLHQpe3JldHVybntrZXk6ZS5rZXksZGF0YTplLmRhdGEsc3R5bGU6blt0XX19KTplLm1hcChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj0wO3I8by5sZW5ndGg7cisrKWlmKG9bcl0ua2V5PT09ZS5rZXkpcmV0dXJue2tleTpvW3JdLmtleSxkYXRhOm9bcl0uZGF0YSxzdHlsZTpuW3RdfTtyZXR1cm57a2V5OmUua2V5LGRhdGE6ZS5kYXRhLHN0eWxlOm5bdF19fSl9ZnVuY3Rpb24gbChlLHQsbixvKXtpZihvLmxlbmd0aCE9PXQubGVuZ3RoKXJldHVybiExO2Zvcih2YXIgcj0wO3I8by5sZW5ndGg7cisrKWlmKG9bcl0ua2V5IT09dFtyXS5rZXkpcmV0dXJuITE7Zm9yKHZhciByPTA7cjxvLmxlbmd0aDtyKyspaWYoIWsuZGVmYXVsdChlW3JdLHRbcl0uc3R5bGUsbltyXSkpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gcyhlLHQsbixvLHIsaSxhLGwscyl7Zm9yKHZhciB1PWIuZGVmYXVsdChvLHIsZnVuY3Rpb24oZSxvKXt2YXIgcj10KG8pO3JldHVybiBudWxsPT1yPyhuKHtrZXk6by5rZXksZGF0YTpvLmRhdGF9KSxudWxsKTprLmRlZmF1bHQoaVtlXSxyLGFbZV0pPyhuKHtrZXk6by5rZXksZGF0YTpvLmRhdGF9KSxudWxsKTp7a2V5Om8ua2V5LGRhdGE6by5kYXRhLHN0eWxlOnJ9fSksYz1bXSxmPVtdLGQ9W10saD1bXSx5PTA7eTx1Lmxlbmd0aDt5Kyspe2Zvcih2YXIgdj11W3ldLG09bnVsbCxTPTA7UzxvLmxlbmd0aDtTKyspaWYob1tTXS5rZXk9PT12LmtleSl7bT1TO2JyZWFrfWlmKG51bGw9PW0pe3ZhciBnPWUodik7Y1t5XT1nLGRbeV09Zzt2YXIgdz1wLmRlZmF1bHQodi5zdHlsZSk7Zlt5XT13LGhbeV09d31lbHNlIGNbeV09aVttXSxkW3ldPWxbbV0sZlt5XT1hW21dLGhbeV09c1ttXX1yZXR1cm5bdSxjLGYsZCxoXX10Ll9fZXNNb2R1bGU9ITA7dmFyIHU9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49YXJndW1lbnRzW3RdO2Zvcih2YXIgbyBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLG8pJiYoZVtvXT1uW29dKX1yZXR1cm4gZX0sYz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIG89dFtuXTtvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlfHwhMSxvLmNvbmZpZ3VyYWJsZT0hMCxcInZhbHVlXCJpbiBvJiYoby53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsby5rZXksbyl9fXJldHVybiBmdW5jdGlvbih0LG4sbyl7cmV0dXJuIG4mJmUodC5wcm90b3R5cGUsbiksbyYmZSh0LG8pLHR9fSgpLGY9big2KSxwPW8oZiksZD1uKDMpLGg9byhkKSx5PW4oOCksdj1vKHkpLG09bigyNyksYj1vKG0pLFM9big0KSxnPW8oUyksdz1uKDUpLFA9byh3KSxUPW4oNyksaz1vKFQpLE89bigxKSxNPW8oTykseD1uKDIpLEk9byh4KSxEPTFlMy82MCxfPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQobil7dmFyIG89dGhpcztyKHRoaXMsdCksZS5jYWxsKHRoaXMsbiksdGhpcy51bm1vdW50aW5nPSExLHRoaXMuYW5pbWF0aW9uSUQ9bnVsbCx0aGlzLnByZXZUaW1lPTAsdGhpcy5hY2N1bXVsYXRlZFRpbWU9MCx0aGlzLnVucmVhZFByb3BTdHlsZXM9bnVsbCx0aGlzLmNsZWFyVW5yZWFkUHJvcFN0eWxlPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1zKG8ucHJvcHMud2lsbEVudGVyLG8ucHJvcHMud2lsbExlYXZlLG8ucHJvcHMuZGlkTGVhdmUsby5zdGF0ZS5tZXJnZWRQcm9wc1N0eWxlcyxlLG8uc3RhdGUuY3VycmVudFN0eWxlcyxvLnN0YXRlLmN1cnJlbnRWZWxvY2l0aWVzLG8uc3RhdGUubGFzdElkZWFsU3R5bGVzLG8uc3RhdGUubGFzdElkZWFsVmVsb2NpdGllcyksbj10WzBdLHI9dFsxXSxpPXRbMl0sYT10WzNdLGw9dFs0XSxjPTA7YzxlLmxlbmd0aDtjKyspe3ZhciBmPWVbY10uc3R5bGUscD0hMTtmb3IodmFyIGQgaW4gZilpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZixkKSl7dmFyIGg9ZltkXTtcIm51bWJlclwiPT10eXBlb2YgaCYmKHB8fChwPSEwLHJbY109dSh7fSxyW2NdKSxpW2NdPXUoe30saVtjXSksYVtjXT11KHt9LGFbY10pLGxbY109dSh7fSxsW2NdKSxuW2NdPXtrZXk6bltjXS5rZXksZGF0YTpuW2NdLmRhdGEsc3R5bGU6dSh7fSxuW2NdLnN0eWxlKX0pLHJbY11bZF09aCxpW2NdW2RdPTAsYVtjXVtkXT1oLGxbY11bZF09MCxuW2NdLnN0eWxlW2RdPWgpfX1vLnNldFN0YXRlKHtjdXJyZW50U3R5bGVzOnIsY3VycmVudFZlbG9jaXRpZXM6aSxtZXJnZWRQcm9wc1N0eWxlczpuLGxhc3RJZGVhbFN0eWxlczphLGxhc3RJZGVhbFZlbG9jaXRpZXM6bH0pfSx0aGlzLnN0YXJ0QW5pbWF0aW9uSWZOZWNlc3Nhcnk9ZnVuY3Rpb24oKXtvLnVubW91bnRpbmd8fChvLmFuaW1hdGlvbklEPVAuZGVmYXVsdChmdW5jdGlvbihlKXtpZighby51bm1vdW50aW5nKXt2YXIgdD1vLnByb3BzLnN0eWxlcyxuPVwiZnVuY3Rpb25cIj09dHlwZW9mIHQ/dChhKG8uc3RhdGUubWVyZ2VkUHJvcHNTdHlsZXMsby51bnJlYWRQcm9wU3R5bGVzLG8uc3RhdGUubGFzdElkZWFsU3R5bGVzKSk6dDtpZihsKG8uc3RhdGUuY3VycmVudFN0eWxlcyxuLG8uc3RhdGUuY3VycmVudFZlbG9jaXRpZXMsby5zdGF0ZS5tZXJnZWRQcm9wc1N0eWxlcykpcmV0dXJuIG8uYW5pbWF0aW9uSUQ9bnVsbCx2b2lkKG8uYWNjdW11bGF0ZWRUaW1lPTApO3ZhciByPWV8fGcuZGVmYXVsdCgpLGk9ci1vLnByZXZUaW1lO2lmKG8ucHJldlRpbWU9cixvLmFjY3VtdWxhdGVkVGltZT1vLmFjY3VtdWxhdGVkVGltZStpLG8uYWNjdW11bGF0ZWRUaW1lPjEwKkQmJihvLmFjY3VtdWxhdGVkVGltZT0wKSwwPT09by5hY2N1bXVsYXRlZFRpbWUpcmV0dXJuIG8uYW5pbWF0aW9uSUQ9bnVsbCx2b2lkIG8uc3RhcnRBbmltYXRpb25JZk5lY2Vzc2FyeSgpO2Zvcih2YXIgdT0oby5hY2N1bXVsYXRlZFRpbWUtTWF0aC5mbG9vcihvLmFjY3VtdWxhdGVkVGltZS9EKSpEKS9ELGM9TWF0aC5mbG9vcihvLmFjY3VtdWxhdGVkVGltZS9EKSxmPXMoby5wcm9wcy53aWxsRW50ZXIsby5wcm9wcy53aWxsTGVhdmUsby5wcm9wcy5kaWRMZWF2ZSxvLnN0YXRlLm1lcmdlZFByb3BzU3R5bGVzLG4sby5zdGF0ZS5jdXJyZW50U3R5bGVzLG8uc3RhdGUuY3VycmVudFZlbG9jaXRpZXMsby5zdGF0ZS5sYXN0SWRlYWxTdHlsZXMsby5zdGF0ZS5sYXN0SWRlYWxWZWxvY2l0aWVzKSxwPWZbMF0sZD1mWzFdLGg9ZlsyXSx5PWZbM10sbT1mWzRdLGI9MDtiPHAubGVuZ3RoO2IrKyl7dmFyIFM9cFtiXS5zdHlsZSx3PXt9LFA9e30sVD17fSxrPXt9O2Zvcih2YXIgTyBpbiBTKWlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChTLE8pKXt2YXIgTT1TW09dO2lmKFwibnVtYmVyXCI9PXR5cGVvZiBNKXdbT109TSxQW09dPTAsVFtPXT1NLGtbT109MDtlbHNle2Zvcih2YXIgeD15W2JdW09dLEk9bVtiXVtPXSxfPTA7XzxjO18rKyl7dmFyIGo9di5kZWZhdWx0KEQvMWUzLHgsSSxNLnZhbCxNLnN0aWZmbmVzcyxNLmRhbXBpbmcsTS5wcmVjaXNpb24pO3g9alswXSxJPWpbMV19dmFyIEM9di5kZWZhdWx0KEQvMWUzLHgsSSxNLnZhbCxNLnN0aWZmbmVzcyxNLmRhbXBpbmcsTS5wcmVjaXNpb24pLHo9Q1swXSxFPUNbMV07d1tPXT14Kyh6LXgpKnUsUFtPXT1JKyhFLUkpKnUsVFtPXT14LGtbT109SX19eVtiXT1ULG1bYl09ayxkW2JdPXcsaFtiXT1QfW8uYW5pbWF0aW9uSUQ9bnVsbCxvLmFjY3VtdWxhdGVkVGltZS09YypELG8uc2V0U3RhdGUoe2N1cnJlbnRTdHlsZXM6ZCxjdXJyZW50VmVsb2NpdGllczpoLGxhc3RJZGVhbFN0eWxlczp5LGxhc3RJZGVhbFZlbG9jaXRpZXM6bSxtZXJnZWRQcm9wc1N0eWxlczpwfSksby51bnJlYWRQcm9wU3R5bGVzPW51bGwsby5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCl9fSkpfSx0aGlzLnN0YXRlPXRoaXMuZGVmYXVsdFN0YXRlKCl9cmV0dXJuIGkodCxlKSxjKHQsbnVsbCxbe2tleTpcInByb3BUeXBlc1wiLHZhbHVlOntkZWZhdWx0U3R5bGVzOkkuZGVmYXVsdC5hcnJheU9mKEkuZGVmYXVsdC5zaGFwZSh7a2V5OkkuZGVmYXVsdC5zdHJpbmcuaXNSZXF1aXJlZCxkYXRhOkkuZGVmYXVsdC5hbnksc3R5bGU6SS5kZWZhdWx0Lm9iamVjdE9mKEkuZGVmYXVsdC5udW1iZXIpLmlzUmVxdWlyZWR9KSksc3R5bGVzOkkuZGVmYXVsdC5vbmVPZlR5cGUoW0kuZGVmYXVsdC5mdW5jLEkuZGVmYXVsdC5hcnJheU9mKEkuZGVmYXVsdC5zaGFwZSh7a2V5OkkuZGVmYXVsdC5zdHJpbmcuaXNSZXF1aXJlZCxkYXRhOkkuZGVmYXVsdC5hbnksc3R5bGU6SS5kZWZhdWx0Lm9iamVjdE9mKEkuZGVmYXVsdC5vbmVPZlR5cGUoW0kuZGVmYXVsdC5udW1iZXIsSS5kZWZhdWx0Lm9iamVjdF0pKS5pc1JlcXVpcmVkfSkpXSkuaXNSZXF1aXJlZCxjaGlsZHJlbjpJLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLHdpbGxFbnRlcjpJLmRlZmF1bHQuZnVuYyx3aWxsTGVhdmU6SS5kZWZhdWx0LmZ1bmMsZGlkTGVhdmU6SS5kZWZhdWx0LmZ1bmN9LGVudW1lcmFibGU6ITB9LHtrZXk6XCJkZWZhdWx0UHJvcHNcIix2YWx1ZTp7d2lsbEVudGVyOmZ1bmN0aW9uKGUpe3JldHVybiBoLmRlZmF1bHQoZS5zdHlsZSl9LHdpbGxMZWF2ZTpmdW5jdGlvbigpe3JldHVybiBudWxsfSxkaWRMZWF2ZTpmdW5jdGlvbigpe319LGVudW1lcmFibGU6ITB9XSksdC5wcm90b3R5cGUuZGVmYXVsdFN0YXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wcm9wcyx0PWUuZGVmYXVsdFN0eWxlcyxuPWUuc3R5bGVzLG89ZS53aWxsRW50ZXIscj1lLndpbGxMZWF2ZSxpPWUuZGlkTGVhdmUsYT1cImZ1bmN0aW9uXCI9PXR5cGVvZiBuP24odCk6bixsPXZvaWQgMDtsPW51bGw9PXQ/YTp0Lm1hcChmdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PGEubGVuZ3RoO3QrKylpZihhW3RdLmtleT09PWUua2V5KXJldHVybiBhW3RdO3JldHVybiBlfSk7dmFyIHU9bnVsbD09dD9hLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gaC5kZWZhdWx0KGUuc3R5bGUpfSk6dC5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGguZGVmYXVsdChlLnN0eWxlKX0pLGM9bnVsbD09dD9hLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gcC5kZWZhdWx0KGUuc3R5bGUpfSk6dC5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIHAuZGVmYXVsdChlLnN0eWxlKX0pLGY9cyhvLHIsaSxsLGEsdSxjLHUsYyksZD1mWzBdLHk9ZlsxXSx2PWZbMl0sbT1mWzNdLGI9Zls0XTtyZXR1cm57Y3VycmVudFN0eWxlczp5LGN1cnJlbnRWZWxvY2l0aWVzOnYsbGFzdElkZWFsU3R5bGVzOm0sbGFzdElkZWFsVmVsb2NpdGllczpiLG1lcmdlZFByb3BzU3R5bGVzOmR9fSx0LnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudD1mdW5jdGlvbigpe3RoaXMucHJldlRpbWU9Zy5kZWZhdWx0KCksdGhpcy5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCl9LHQucHJvdG90eXBlLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM9ZnVuY3Rpb24oZSl7dGhpcy51bnJlYWRQcm9wU3R5bGVzJiZ0aGlzLmNsZWFyVW5yZWFkUHJvcFN0eWxlKHRoaXMudW5yZWFkUHJvcFN0eWxlcyk7dmFyIHQ9ZS5zdHlsZXM7XCJmdW5jdGlvblwiPT10eXBlb2YgdD90aGlzLnVucmVhZFByb3BTdHlsZXM9dChhKHRoaXMuc3RhdGUubWVyZ2VkUHJvcHNTdHlsZXMsdGhpcy51bnJlYWRQcm9wU3R5bGVzLHRoaXMuc3RhdGUubGFzdElkZWFsU3R5bGVzKSk6dGhpcy51bnJlYWRQcm9wU3R5bGVzPXQsbnVsbD09dGhpcy5hbmltYXRpb25JRCYmKHRoaXMucHJldlRpbWU9Zy5kZWZhdWx0KCksdGhpcy5zdGFydEFuaW1hdGlvbklmTmVjZXNzYXJ5KCkpfSx0LnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudD1mdW5jdGlvbigpe3RoaXMudW5tb3VudGluZz0hMCxudWxsIT10aGlzLmFuaW1hdGlvbklEJiYoUC5kZWZhdWx0LmNhbmNlbCh0aGlzLmFuaW1hdGlvbklEKSx0aGlzLmFuaW1hdGlvbklEPW51bGwpfSx0LnByb3RvdHlwZS5yZW5kZXI9ZnVuY3Rpb24oKXt2YXIgZT1hKHRoaXMuc3RhdGUubWVyZ2VkUHJvcHNTdHlsZXMsdGhpcy51bnJlYWRQcm9wU3R5bGVzLHRoaXMuc3RhdGUuY3VycmVudFN0eWxlcyksdD10aGlzLnByb3BzLmNoaWxkcmVuKGUpO3JldHVybiB0JiZNLmRlZmF1bHQuQ2hpbGRyZW4ub25seSh0KX0sdH0oTS5kZWZhdWx0LkNvbXBvbmVudCk7dC5kZWZhdWx0PV8sZS5leHBvcnRzPXQuZGVmYXVsdH0sZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKGUsdCxuKXtmb3IodmFyIG89e30scj0wO3I8ZS5sZW5ndGg7cisrKW9bZVtyXS5rZXldPXI7Zm9yKHZhciBpPXt9LHI9MDtyPHQubGVuZ3RoO3IrKylpW3Rbcl0ua2V5XT1yO2Zvcih2YXIgYT1bXSxyPTA7cjx0Lmxlbmd0aDtyKyspYVtyXT10W3JdO2Zvcih2YXIgcj0wO3I8ZS5sZW5ndGg7cisrKWlmKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaSxlW3JdLmtleSkpe3ZhciBsPW4ocixlW3JdKTtudWxsIT1sJiZhLnB1c2gobCl9cmV0dXJuIGEuc29ydChmdW5jdGlvbihlLG4pe3ZhciByPWlbZS5rZXldLGE9aVtuLmtleV0sbD1vW2Uua2V5XSxzPW9bbi5rZXldO2lmKG51bGwhPXImJm51bGwhPWEpcmV0dXJuIGlbZS5rZXldLWlbbi5rZXldO2lmKG51bGwhPWwmJm51bGwhPXMpcmV0dXJuIG9bZS5rZXldLW9bbi5rZXldO2lmKG51bGwhPXIpe2Zvcih2YXIgdT0wO3U8dC5sZW5ndGg7dSsrKXt2YXIgYz10W3VdLmtleTtpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobyxjKSl7aWYocjxpW2NdJiZzPm9bY10pcmV0dXJuLTE7aWYocj5pW2NdJiZzPG9bY10pcmV0dXJuIDF9fXJldHVybiAxfWZvcih2YXIgdT0wO3U8dC5sZW5ndGg7dSsrKXt2YXIgYz10W3VdLmtleTtpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobyxjKSl7aWYoYTxpW2NdJiZsPm9bY10pcmV0dXJuIDE7aWYoYT5pW2NdJiZsPG9bY10pcmV0dXJuLTF9fXJldHVybi0xfSl9dC5fX2VzTW9kdWxlPSEwLHQuZGVmYXVsdD1uLGUuZXhwb3J0cz10LmRlZmF1bHR9LGZ1bmN0aW9uKGUsdCxuKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBvKCl7fXQuX19lc01vZHVsZT0hMCx0LmRlZmF1bHQ9bztlLmV4cG9ydHM9dC5kZWZhdWx0fSxmdW5jdGlvbihlLHQsbil7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbyhlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlP2U6e2RlZmF1bHQ6ZX19ZnVuY3Rpb24gcihlLHQpe3JldHVybiBpKHt9LHMsdCx7dmFsOmV9KX10Ll9fZXNNb2R1bGU9ITA7dmFyIGk9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49YXJndW1lbnRzW3RdO2Zvcih2YXIgbyBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLG8pJiYoZVtvXT1uW29dKX1yZXR1cm4gZX07dC5kZWZhdWx0PXI7dmFyIGE9bigxMSksbD1vKGEpLHM9aSh7fSxsLmRlZmF1bHQubm9Xb2JibGUse3ByZWNpc2lvbjouMDF9KTtlLmV4cG9ydHM9dC5kZWZhdWx0fSxmdW5jdGlvbihlLHQsbil7ZnVuY3Rpb24gbyhlLHQpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgbz1lW25dLHI9ZFtvLmlkXTtpZihyKXtyLnJlZnMrKztmb3IodmFyIGk9MDtpPHIucGFydHMubGVuZ3RoO2krKylyLnBhcnRzW2ldKG8ucGFydHNbaV0pO2Zvcig7aTxvLnBhcnRzLmxlbmd0aDtpKyspci5wYXJ0cy5wdXNoKHUoby5wYXJ0c1tpXSx0KSl9ZWxzZXtmb3IodmFyIGE9W10saT0wO2k8by5wYXJ0cy5sZW5ndGg7aSsrKWEucHVzaCh1KG8ucGFydHNbaV0sdCkpO2Rbby5pZF09e2lkOm8uaWQscmVmczoxLHBhcnRzOmF9fX19ZnVuY3Rpb24gcihlKXtmb3IodmFyIHQ9W10sbj17fSxvPTA7bzxlLmxlbmd0aDtvKyspe3ZhciByPWVbb10saT1yWzBdLGE9clsxXSxsPXJbMl0scz1yWzNdLHU9e2NzczphLG1lZGlhOmwsc291cmNlTWFwOnN9O25baV0/bltpXS5wYXJ0cy5wdXNoKHUpOnQucHVzaChuW2ldPXtpZDppLHBhcnRzOlt1XX0pfXJldHVybiB0fWZ1bmN0aW9uIGkoZSx0KXt2YXIgbj12KCksbz1TW1MubGVuZ3RoLTFdO2lmKFwidG9wXCI9PT1lLmluc2VydEF0KW8/by5uZXh0U2libGluZz9uLmluc2VydEJlZm9yZSh0LG8ubmV4dFNpYmxpbmcpOm4uYXBwZW5kQ2hpbGQodCk6bi5pbnNlcnRCZWZvcmUodCxuLmZpcnN0Q2hpbGQpLFMucHVzaCh0KTtlbHNle2lmKFwiYm90dG9tXCIhPT1lLmluc2VydEF0KXRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdmFsdWUgZm9yIHBhcmFtZXRlciAnaW5zZXJ0QXQnLiBNdXN0IGJlICd0b3AnIG9yICdib3R0b20nLlwiKTtuLmFwcGVuZENoaWxkKHQpfX1mdW5jdGlvbiBhKGUpe2UucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKTt2YXIgdD1TLmluZGV4T2YoZSk7dD49MCYmUy5zcGxpY2UodCwxKX1mdW5jdGlvbiBsKGUpe3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtyZXR1cm4gdC50eXBlPVwidGV4dC9jc3NcIixpKGUsdCksdH1mdW5jdGlvbiBzKGUpe3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIpO3JldHVybiB0LnJlbD1cInN0eWxlc2hlZXRcIixpKGUsdCksdH1mdW5jdGlvbiB1KGUsdCl7dmFyIG4sbyxyO2lmKHQuc2luZ2xldG9uKXt2YXIgaT1iKys7bj1tfHwobT1sKHQpKSxvPWMuYmluZChudWxsLG4saSwhMSkscj1jLmJpbmQobnVsbCxuLGksITApfWVsc2UgZS5zb3VyY2VNYXAmJlwiZnVuY3Rpb25cIj09dHlwZW9mIFVSTCYmXCJmdW5jdGlvblwiPT10eXBlb2YgVVJMLmNyZWF0ZU9iamVjdFVSTCYmXCJmdW5jdGlvblwiPT10eXBlb2YgVVJMLnJldm9rZU9iamVjdFVSTCYmXCJmdW5jdGlvblwiPT10eXBlb2YgQmxvYiYmXCJmdW5jdGlvblwiPT10eXBlb2YgYnRvYT8obj1zKHQpLG89cC5iaW5kKG51bGwsbikscj1mdW5jdGlvbigpe2Eobiksbi5ocmVmJiZVUkwucmV2b2tlT2JqZWN0VVJMKG4uaHJlZil9KToobj1sKHQpLG89Zi5iaW5kKG51bGwsbikscj1mdW5jdGlvbigpe2Eobil9KTtyZXR1cm4gbyhlKSxmdW5jdGlvbih0KXtpZih0KXtpZih0LmNzcz09PWUuY3NzJiZ0Lm1lZGlhPT09ZS5tZWRpYSYmdC5zb3VyY2VNYXA9PT1lLnNvdXJjZU1hcClyZXR1cm47byhlPXQpfWVsc2UgcigpfX1mdW5jdGlvbiBjKGUsdCxuLG8pe3ZhciByPW4/XCJcIjpvLmNzcztpZihlLnN0eWxlU2hlZXQpZS5zdHlsZVNoZWV0LmNzc1RleHQ9Zyh0LHIpO2Vsc2V7dmFyIGk9ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUociksYT1lLmNoaWxkTm9kZXM7YVt0XSYmZS5yZW1vdmVDaGlsZChhW3RdKSxhLmxlbmd0aD9lLmluc2VydEJlZm9yZShpLGFbdF0pOmUuYXBwZW5kQ2hpbGQoaSl9fWZ1bmN0aW9uIGYoZSx0KXt2YXIgbj10LmNzcyxvPXQubWVkaWE7aWYobyYmZS5zZXRBdHRyaWJ1dGUoXCJtZWRpYVwiLG8pLGUuc3R5bGVTaGVldCllLnN0eWxlU2hlZXQuY3NzVGV4dD1uO2Vsc2V7Zm9yKDtlLmZpcnN0Q2hpbGQ7KWUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTtlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG4pKX19ZnVuY3Rpb24gcChlLHQpe3ZhciBuPXQuY3NzLG89dC5zb3VyY2VNYXA7byYmKG4rPVwiXFxuLyojIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxcIitidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShvKSkpKStcIiAqL1wiKTt2YXIgcj1uZXcgQmxvYihbbl0se3R5cGU6XCJ0ZXh0L2Nzc1wifSksaT1lLmhyZWY7ZS5ocmVmPVVSTC5jcmVhdGVPYmplY3RVUkwociksaSYmVVJMLnJldm9rZU9iamVjdFVSTChpKX12YXIgZD17fSxoPWZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiBmdW5jdGlvbigpe3JldHVyblwidW5kZWZpbmVkXCI9PXR5cGVvZiB0JiYodD1lLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksdH19LHk9aChmdW5jdGlvbigpe3JldHVybi9tc2llIFs2LTldXFxiLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpfSksdj1oKGZ1bmN0aW9uKCl7cmV0dXJuIGRvY3VtZW50LmhlYWR8fGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXX0pLG09bnVsbCxiPTAsUz1bXTtlLmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXt0PXR8fHt9LFwidW5kZWZpbmVkXCI9PXR5cGVvZiB0LnNpbmdsZXRvbiYmKHQuc2luZ2xldG9uPXkoKSksXCJ1bmRlZmluZWRcIj09dHlwZW9mIHQuaW5zZXJ0QXQmJih0Lmluc2VydEF0PVwiYm90dG9tXCIpO3ZhciBuPXIoZSk7cmV0dXJuIG8obix0KSxmdW5jdGlvbihlKXtmb3IodmFyIGk9W10sYT0wO2E8bi5sZW5ndGg7YSsrKXt2YXIgbD1uW2FdLHM9ZFtsLmlkXTtzLnJlZnMtLSxpLnB1c2gocyl9aWYoZSl7dmFyIHU9cihlKTtvKHUsdCl9Zm9yKHZhciBhPTA7YTxpLmxlbmd0aDthKyspe3ZhciBzPWlbYV07aWYoMD09PXMucmVmcyl7Zm9yKHZhciBjPTA7YzxzLnBhcnRzLmxlbmd0aDtjKyspcy5wYXJ0c1tjXSgpO2RlbGV0ZSBkW3MuaWRdfX19fTt2YXIgZz1mdW5jdGlvbigpe3ZhciBlPVtdO3JldHVybiBmdW5jdGlvbih0LG4pe3JldHVybiBlW3RdPW4sZS5maWx0ZXIoQm9vbGVhbikuam9pbihcIlxcblwiKX19KCl9LGZ1bmN0aW9uKGUsdCxuKXt2YXIgbz1uKDE2KTtcInN0cmluZ1wiPT10eXBlb2YgbyYmKG89W1tlLmlkLG8sXCJcIl1dKTtuKDMwKShvLHt9KTtvLmxvY2FscyYmKGUuZXhwb3J0cz1vLmxvY2Fscyl9XSl9KTsiLCJcInVzZSBzdHJpY3RcIjtcbjtcbjtcbjtcbnZhciBpc1dlYlNvY2tldCA9IGZ1bmN0aW9uIChjb25zdHJ1Y3Rvcikge1xuICAgIHJldHVybiBjb25zdHJ1Y3RvciAmJiBjb25zdHJ1Y3Rvci5DTE9TSU5HID09PSAyO1xufTtcbnZhciBpc0dsb2JhbFdlYlNvY2tldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdHlwZW9mIFdlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNXZWJTb2NrZXQoV2ViU29ja2V0KTtcbn07XG52YXIgZ2V0RGVmYXVsdE9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAoe1xuICAgIGNvbnN0cnVjdG9yOiBpc0dsb2JhbFdlYlNvY2tldCgpID8gV2ViU29ja2V0IDogbnVsbCxcbiAgICBtYXhSZWNvbm5lY3Rpb25EZWxheTogMTAwMDAsXG4gICAgbWluUmVjb25uZWN0aW9uRGVsYXk6IDE1MDAsXG4gICAgcmVjb25uZWN0aW9uRGVsYXlHcm93RmFjdG9yOiAxLjMsXG4gICAgY29ubmVjdGlvblRpbWVvdXQ6IDQwMDAsXG4gICAgbWF4UmV0cmllczogSW5maW5pdHksXG4gICAgZGVidWc6IGZhbHNlLFxufSk7IH07XG52YXIgYnlwYXNzUHJvcGVydHkgPSBmdW5jdGlvbiAoc3JjLCBkc3QsIG5hbWUpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZHN0LCBuYW1lLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3JjW25hbWVdOyB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkgeyBzcmNbbmFtZV0gPSB2YWx1ZTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIH0pO1xufTtcbnZhciBpbml0UmVjb25uZWN0aW9uRGVsYXkgPSBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgcmV0dXJuIChjb25maWcubWluUmVjb25uZWN0aW9uRGVsYXkgKyBNYXRoLnJhbmRvbSgpICogY29uZmlnLm1pblJlY29ubmVjdGlvbkRlbGF5KTtcbn07XG52YXIgdXBkYXRlUmVjb25uZWN0aW9uRGVsYXkgPSBmdW5jdGlvbiAoY29uZmlnLCBwcmV2aW91c0RlbGF5KSB7XG4gICAgdmFyIG5ld0RlbGF5ID0gcHJldmlvdXNEZWxheSAqIGNvbmZpZy5yZWNvbm5lY3Rpb25EZWxheUdyb3dGYWN0b3I7XG4gICAgcmV0dXJuIChuZXdEZWxheSA+IGNvbmZpZy5tYXhSZWNvbm5lY3Rpb25EZWxheSlcbiAgICAgICAgPyBjb25maWcubWF4UmVjb25uZWN0aW9uRGVsYXlcbiAgICAgICAgOiBuZXdEZWxheTtcbn07XG52YXIgTEVWRUxfMF9FVkVOVFMgPSBbJ29ub3BlbicsICdvbmNsb3NlJywgJ29ubWVzc2FnZScsICdvbmVycm9yJ107XG52YXIgcmVhc3NpZ25FdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICh3cywgb2xkV3MsIGxpc3RlbmVycykge1xuICAgIE9iamVjdC5rZXlzKGxpc3RlbmVycykuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICBsaXN0ZW5lcnNbdHlwZV0uZm9yRWFjaChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IF9hWzBdLCBvcHRpb25zID0gX2FbMV07XG4gICAgICAgICAgICB3cy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgaWYgKG9sZFdzKSB7XG4gICAgICAgIExFVkVMXzBfRVZFTlRTLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHdzW25hbWVdID0gb2xkV3NbbmFtZV07XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG52YXIgUmVjb25uZWN0aW5nV2Vic29ja2V0ID0gZnVuY3Rpb24gKHVybCwgcHJvdG9jb2xzLCBvcHRpb25zKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIHZhciB3cztcbiAgICB2YXIgY29ubmVjdGluZ1RpbWVvdXQ7XG4gICAgdmFyIHJlY29ubmVjdERlbGF5ID0gMDtcbiAgICB2YXIgcmV0cmllc0NvdW50ID0gMDtcbiAgICB2YXIgc2hvdWxkUmV0cnkgPSB0cnVlO1xuICAgIHZhciBzYXZlZE9uQ2xvc2UgPSBudWxsO1xuICAgIHZhciBsaXN0ZW5lcnMgPSB7fTtcbiAgICAvLyByZXF1aXJlIG5ldyB0byBjb25zdHJ1Y3RcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUmVjb25uZWN0aW5nV2Vic29ja2V0KSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRmFpbGVkIHRvIGNvbnN0cnVjdCAnUmVjb25uZWN0aW5nV2ViU29ja2V0JzogUGxlYXNlIHVzZSB0aGUgJ25ldycgb3BlcmF0b3JcIik7XG4gICAgfVxuICAgIC8vIFNldCBjb25maWcuIE5vdCB1c2luZyBgT2JqZWN0LmFzc2lnbmAgYmVjYXVzZSBvZiBJRTExXG4gICAgdmFyIGNvbmZpZyA9IGdldERlZmF1bHRPcHRpb25zKCk7XG4gICAgT2JqZWN0LmtleXMoY29uZmlnKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoa2V5KTsgfSlcbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyByZXR1cm4gY29uZmlnW2tleV0gPSBvcHRpb25zW2tleV07IH0pO1xuICAgIGlmICghaXNXZWJTb2NrZXQoY29uZmlnLmNvbnN0cnVjdG9yKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIFdlYlNvY2tldCBjb25zdHJ1Y3Rvci4gU2V0IGBvcHRpb25zLmNvbnN0cnVjdG9yYCcpO1xuICAgIH1cbiAgICB2YXIgbG9nID0gY29uZmlnLmRlYnVnID8gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyYW1zID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBwYXJhbXNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgWydSV1M6J10uY29uY2F0KHBhcmFtcykpO1xuICAgIH0gOiBmdW5jdGlvbiAoKSB7IH07XG4gICAgLyoqXG4gICAgICogTm90IHVzaW5nIGRpc3BhdGNoRXZlbnQsIG90aGVyd2lzZSB3ZSBtdXN0IHVzZSBhIERPTSBFdmVudCBvYmplY3RcbiAgICAgKiBEZWZlcnJlZCBiZWNhdXNlIHdlIHdhbnQgdG8gaGFuZGxlIHRoZSBjbG9zZSBldmVudCBiZWZvcmUgdGhpc1xuICAgICAqL1xuICAgIHZhciBlbWl0RXJyb3IgPSBmdW5jdGlvbiAoY29kZSwgbXNnKSB7IHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcihtc2cpO1xuICAgICAgICBlcnIuY29kZSA9IGNvZGU7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxpc3RlbmVycy5lcnJvcikpIHtcbiAgICAgICAgICAgIGxpc3RlbmVycy5lcnJvci5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IF9hWzBdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmbihlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdzLm9uZXJyb3IpIHtcbiAgICAgICAgICAgIHdzLm9uZXJyb3IoZXJyKTtcbiAgICAgICAgfVxuICAgIH0sIDApOyB9O1xuICAgIHZhciBoYW5kbGVDbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9nKCdoYW5kbGVDbG9zZScsIHsgc2hvdWxkUmV0cnk6IHNob3VsZFJldHJ5IH0pO1xuICAgICAgICByZXRyaWVzQ291bnQrKztcbiAgICAgICAgbG9nKCdyZXRyaWVzIGNvdW50OicsIHJldHJpZXNDb3VudCk7XG4gICAgICAgIGlmIChyZXRyaWVzQ291bnQgPiBjb25maWcubWF4UmV0cmllcykge1xuICAgICAgICAgICAgZW1pdEVycm9yKCdFSE9TVERPV04nLCAnVG9vIG1hbnkgZmFpbGVkIGNvbm5lY3Rpb24gYXR0ZW1wdHMnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlY29ubmVjdERlbGF5KSB7XG4gICAgICAgICAgICByZWNvbm5lY3REZWxheSA9IGluaXRSZWNvbm5lY3Rpb25EZWxheShjb25maWcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVjb25uZWN0RGVsYXkgPSB1cGRhdGVSZWNvbm5lY3Rpb25EZWxheShjb25maWcsIHJlY29ubmVjdERlbGF5KTtcbiAgICAgICAgfVxuICAgICAgICBsb2coJ2hhbmRsZUNsb3NlIC0gcmVjb25uZWN0RGVsYXk6JywgcmVjb25uZWN0RGVsYXkpO1xuICAgICAgICBpZiAoc2hvdWxkUmV0cnkpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoY29ubmVjdCwgcmVjb25uZWN0RGVsYXkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgY29ubmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzaG91bGRSZXRyeSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxvZygnY29ubmVjdCcpO1xuICAgICAgICB2YXIgb2xkV3MgPSB3cztcbiAgICAgICAgdmFyIHdzVXJsID0gKHR5cGVvZiB1cmwgPT09ICdmdW5jdGlvbicpID8gdXJsKCkgOiB1cmw7XG4gICAgICAgIHdzID0gbmV3IGNvbmZpZy5jb25zdHJ1Y3Rvcih3c1VybCwgcHJvdG9jb2xzKTtcbiAgICAgICAgY29ubmVjdGluZ1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvZygndGltZW91dCcpO1xuICAgICAgICAgICAgd3MuY2xvc2UoKTtcbiAgICAgICAgICAgIGVtaXRFcnJvcignRVRJTUVET1VUJywgJ0Nvbm5lY3Rpb24gdGltZW91dCcpO1xuICAgICAgICB9LCBjb25maWcuY29ubmVjdGlvblRpbWVvdXQpO1xuICAgICAgICBsb2coJ2J5cGFzcyBwcm9wZXJ0aWVzJyk7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiB3cykge1xuICAgICAgICAgICAgLy8gQHRvZG8gbW92ZSB0byBjb25zdGFudFxuICAgICAgICAgICAgaWYgKFsnYWRkRXZlbnRMaXN0ZW5lcicsICdyZW1vdmVFdmVudExpc3RlbmVyJywgJ2Nsb3NlJywgJ3NlbmQnXS5pbmRleE9mKGtleSkgPCAwKSB7XG4gICAgICAgICAgICAgICAgYnlwYXNzUHJvcGVydHkod3MsIF90aGlzLCBrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoY29ubmVjdGluZ1RpbWVvdXQpO1xuICAgICAgICAgICAgbG9nKCdvcGVuJyk7XG4gICAgICAgICAgICByZWNvbm5lY3REZWxheSA9IGluaXRSZWNvbm5lY3Rpb25EZWxheShjb25maWcpO1xuICAgICAgICAgICAgbG9nKCdyZWNvbm5lY3REZWxheTonLCByZWNvbm5lY3REZWxheSk7XG4gICAgICAgICAgICByZXRyaWVzQ291bnQgPSAwO1xuICAgICAgICB9KTtcbiAgICAgICAgd3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBoYW5kbGVDbG9zZSk7XG4gICAgICAgIHJlYXNzaWduRXZlbnRMaXN0ZW5lcnMod3MsIG9sZFdzLCBsaXN0ZW5lcnMpO1xuICAgICAgICAvLyBiZWNhdXNlIHdoZW4gY2xvc2luZyB3aXRoIGZhc3RDbG9zZT10cnVlLCBpdCBpcyBzYXZlZCBhbmQgc2V0IHRvIG51bGwgdG8gYXZvaWQgZG91YmxlIGNhbGxzXG4gICAgICAgIHdzLm9uY2xvc2UgPSB3cy5vbmNsb3NlIHx8IHNhdmVkT25DbG9zZTtcbiAgICAgICAgc2F2ZWRPbkNsb3NlID0gbnVsbDtcbiAgICB9O1xuICAgIGxvZygnaW5pdCcpO1xuICAgIGNvbm5lY3QoKTtcbiAgICB0aGlzLmNsb3NlID0gZnVuY3Rpb24gKGNvZGUsIHJlYXNvbiwgX2EpIHtcbiAgICAgICAgaWYgKGNvZGUgPT09IHZvaWQgMCkgeyBjb2RlID0gMTAwMDsgfVxuICAgICAgICBpZiAocmVhc29uID09PSB2b2lkIDApIHsgcmVhc29uID0gJyc7IH1cbiAgICAgICAgdmFyIF9iID0gX2EgPT09IHZvaWQgMCA/IHt9IDogX2EsIF9jID0gX2Iua2VlcENsb3NlZCwga2VlcENsb3NlZCA9IF9jID09PSB2b2lkIDAgPyBmYWxzZSA6IF9jLCBfZCA9IF9iLmZhc3RDbG9zZSwgZmFzdENsb3NlID0gX2QgPT09IHZvaWQgMCA/IHRydWUgOiBfZCwgX2UgPSBfYi5kZWxheSwgZGVsYXkgPSBfZSA9PT0gdm9pZCAwID8gMCA6IF9lO1xuICAgICAgICBsb2coJ2Nsb3NlIC0gcGFyYW1zOicsIHsgcmVhc29uOiByZWFzb24sIGtlZXBDbG9zZWQ6IGtlZXBDbG9zZWQsIGZhc3RDbG9zZTogZmFzdENsb3NlLCBkZWxheTogZGVsYXksIHJldHJpZXNDb3VudDogcmV0cmllc0NvdW50LCBtYXhSZXRyaWVzOiBjb25maWcubWF4UmV0cmllcyB9KTtcbiAgICAgICAgc2hvdWxkUmV0cnkgPSAha2VlcENsb3NlZCAmJiByZXRyaWVzQ291bnQgPD0gY29uZmlnLm1heFJldHJpZXM7XG4gICAgICAgIGlmIChkZWxheSkge1xuICAgICAgICAgICAgcmVjb25uZWN0RGVsYXkgPSBkZWxheTtcbiAgICAgICAgfVxuICAgICAgICB3cy5jbG9zZShjb2RlLCByZWFzb24pO1xuICAgICAgICBpZiAoZmFzdENsb3NlKSB7XG4gICAgICAgICAgICB2YXIgZmFrZUNsb3NlRXZlbnRfMSA9IHtcbiAgICAgICAgICAgICAgICBjb2RlOiBjb2RlLFxuICAgICAgICAgICAgICAgIHJlYXNvbjogcmVhc29uLFxuICAgICAgICAgICAgICAgIHdhc0NsZWFuOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIGV4ZWN1dGUgY2xvc2UgbGlzdGVuZXJzIHNvb24gd2l0aCBhIGZha2UgY2xvc2VFdmVudFxuICAgICAgICAgICAgLy8gYW5kIHJlbW92ZSB0aGVtIGZyb20gdGhlIFdTIGluc3RhbmNlIHNvIHRoZXlcbiAgICAgICAgICAgIC8vIGRvbid0IGdldCBmaXJlZCBvbiB0aGUgcmVhbCBjbG9zZS5cbiAgICAgICAgICAgIGhhbmRsZUNsb3NlKCk7XG4gICAgICAgICAgICB3cy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbG9zZScsIGhhbmRsZUNsb3NlKTtcbiAgICAgICAgICAgIC8vIHJ1biBhbmQgcmVtb3ZlIGxldmVsMlxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGlzdGVuZXJzLmNsb3NlKSkge1xuICAgICAgICAgICAgICAgIGxpc3RlbmVycy5jbG9zZS5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBfYVswXSwgb3B0aW9ucyA9IF9hWzFdO1xuICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcihmYWtlQ2xvc2VFdmVudF8xKTtcbiAgICAgICAgICAgICAgICAgICAgd3MucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBsaXN0ZW5lciwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBydW4gYW5kIHJlbW92ZSBsZXZlbDBcbiAgICAgICAgICAgIGlmICh3cy5vbmNsb3NlKSB7XG4gICAgICAgICAgICAgICAgc2F2ZWRPbkNsb3NlID0gd3Mub25jbG9zZTtcbiAgICAgICAgICAgICAgICB3cy5vbmNsb3NlKGZha2VDbG9zZUV2ZW50XzEpO1xuICAgICAgICAgICAgICAgIHdzLm9uY2xvc2UgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnNlbmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB3cy5zZW5kKGRhdGEpO1xuICAgIH07XG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxpc3RlbmVyc1t0eXBlXSkpIHtcbiAgICAgICAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLnNvbWUoZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIGwgPSBfYVswXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbCA9PT0gbGlzdGVuZXI7XG4gICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKFtsaXN0ZW5lciwgb3B0aW9uc10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW1tsaXN0ZW5lciwgb3B0aW9uc11dO1xuICAgICAgICB9XG4gICAgICAgIHdzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxpc3RlbmVyc1t0eXBlXSkpIHtcbiAgICAgICAgICAgIGxpc3RlbmVyc1t0eXBlXSA9IGxpc3RlbmVyc1t0eXBlXS5maWx0ZXIoZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIGwgPSBfYVswXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbCAhPT0gbGlzdGVuZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB3cy5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKTtcbiAgICB9O1xufTtcbm1vZHVsZS5leHBvcnRzID0gUmVjb25uZWN0aW5nV2Vic29ja2V0O1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9weWRpbyA9IHJlcXVpcmUoJ3B5ZGlvJyk7XG5cbnZhciBfcHlkaW8yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW8pO1xuXG52YXIgX0NoYXRDbGllbnQgPSByZXF1aXJlKCcuL0NoYXRDbGllbnQnKTtcblxudmFyIF9DaGF0Q2xpZW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0NoYXRDbGllbnQpO1xuXG52YXIgX01lc3NhZ2UgPSByZXF1aXJlKCcuL01lc3NhZ2UnKTtcblxudmFyIF9NZXNzYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX01lc3NhZ2UpO1xuXG52YXIgX3ZpZXdzRW1wdHlTdGF0ZVZpZXcgPSByZXF1aXJlKCcuLi92aWV3cy9FbXB0eVN0YXRlVmlldycpO1xuXG52YXIgX3ZpZXdzRW1wdHlTdGF0ZVZpZXcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdmlld3NFbXB0eVN0YXRlVmlldyk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfQ2hhdFVzZXJzID0gcmVxdWlyZSgnLi9DaGF0VXNlcnMnKTtcblxudmFyIF9DaGF0VXNlcnMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQ2hhdFVzZXJzKTtcblxudmFyIF9QeWRpbyRyZXF1aXJlTGliID0gX3B5ZGlvMlsnZGVmYXVsdCddLnJlcXVpcmVMaWIoJ2Jvb3QnKTtcblxudmFyIFB5ZGlvQ29udGV4dENvbnN1bWVyID0gX1B5ZGlvJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG52YXIgbW9tZW50ID0gX1B5ZGlvJHJlcXVpcmVMaWIubW9tZW50O1xuXG52YXIgQ2hhdCA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhDaGF0LCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIENoYXQocHJvcHMpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENoYXQpO1xuXG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcyk7XG4gICAgICAgIHRoaXMuY2xpZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgbWVzc2FnZXM6IFtdLCByb29tOiBudWxsLCB2YWx1ZTogXCJcIiB9O1xuICAgICAgICB0aGlzLl9uZXdNZXNzYWdlTGlzdGVuZXIgPSB0aGlzLm9uTmV3TWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIENoYXQucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuam9pbih0aGlzLnByb3BzLnJvb21UeXBlLCB0aGlzLnByb3BzLnJvb21PYmplY3RJZCk7XG4gICAgfTtcblxuICAgIENoYXQucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgIH07XG5cbiAgICBDaGF0LnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzLCBwcmV2U3RhdGUpIHtcbiAgICAgICAgaWYgKHByZXZTdGF0ZS5tZXNzYWdlcy5sZW5ndGggPD0gdGhpcy5zdGF0ZS5tZXNzYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcy5jb21tZW50cy5zY3JvbGxUb3AgPSAxMDAwMDA7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2hhdC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIHZhciBweWRpbyA9IG5leHRQcm9wcy5weWRpbztcbiAgICAgICAgdmFyIHJvb21UeXBlID0gbmV4dFByb3BzLnJvb21UeXBlO1xuICAgICAgICB2YXIgcm9vbU9iamVjdElkID0gbmV4dFByb3BzLnJvb21PYmplY3RJZDtcblxuICAgICAgICBpZiAocm9vbVR5cGUgIT09IHRoaXMucHJvcHMucm9vbVR5cGUgfHwgcm9vbU9iamVjdElkICE9PSB0aGlzLnByb3BzLnJvb21PYmplY3RJZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2xpZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnQubGVhdmVSb29tKHRoaXMucHJvcHMucm9vbVR5cGUsIHRoaXMucHJvcHMucm9vbU9iamVjdElkLCB0aGlzLl9uZXdNZXNzYWdlTGlzdGVuZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG1lc3NhZ2VzOiBbXSwgcm9vbTogbnVsbCwgdmFsdWU6IFwiXCIgfSk7XG4gICAgICAgICAgICBpZiAocm9vbVR5cGUgJiYgcm9vbU9iamVjdElkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5qb2luKHJvb21UeXBlLCByb29tT2JqZWN0SWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIENoYXQucHJvdG90eXBlLm9uUm9vbU1lc3NhZ2UgPSBmdW5jdGlvbiBvblJvb21NZXNzYWdlKG1zZykge1xuICAgICAgICBpZiAobXNnKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgcm9vbTogbXNnWydSb29tJ10gfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2hhdC5wcm90b3R5cGUub25OZXdNZXNzYWdlID0gZnVuY3Rpb24gb25OZXdNZXNzYWdlKG1zZykge1xuICAgICAgICB2YXIgZGVsZXRlTXNnID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgaWYgKCFtc2cpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsZXRlTXNnKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbWVzc2FnZXM6IHRoaXMuc3RhdGUubWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtLlV1aWQgIT09IG1zZy5VdWlkO1xuICAgICAgICAgICAgICAgIH0pIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG1lc3NhZ2VzOiBbXS5jb25jYXQodGhpcy5zdGF0ZS5tZXNzYWdlcywgW21zZ10pIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIENoYXQucHJvdG90eXBlLmpvaW4gPSBmdW5jdGlvbiBqb2luKHJvb21UeXBlLCByb29tT2JqZWN0SWQpIHtcbiAgICAgICAgaWYgKCFyb29tT2JqZWN0SWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcHlkaW8gPSB0aGlzLnByb3BzLnB5ZGlvO1xuXG4gICAgICAgIHRoaXMuY2xpZW50ID0gX0NoYXRDbGllbnQyWydkZWZhdWx0J10uZ2V0SW5zdGFuY2UocHlkaW8pO1xuICAgICAgICB2YXIgcm9vbSA9IHRoaXMuY2xpZW50LmpvaW5Sb29tKHJvb21UeXBlLCByb29tT2JqZWN0SWQsIHRoaXMuX25ld01lc3NhZ2VMaXN0ZW5lciwgdGhpcy5vblJvb21NZXNzYWdlLmJpbmQodGhpcykpO1xuICAgICAgICBpZiAocm9vbSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHJvb206IHJvb20gfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGllbnQubG9hZEhpc3Rvcnkocm9vbVR5cGUsIHJvb21PYmplY3RJZCk7XG4gICAgfTtcblxuICAgIENoYXQucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiBzdG9wKCkge1xuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHJvb21UeXBlID0gX3Byb3BzLnJvb21UeXBlO1xuICAgICAgICB2YXIgcm9vbU9iamVjdElkID0gX3Byb3BzLnJvb21PYmplY3RJZDtcblxuICAgICAgICBpZiAodGhpcy5jbGllbnQpIHRoaXMuY2xpZW50LmxlYXZlUm9vbShyb29tVHlwZSwgcm9vbU9iamVjdElkLCB0aGlzLl9uZXdNZXNzYWdlTGlzdGVuZXIpO1xuICAgIH07XG5cbiAgICBDaGF0LnByb3RvdHlwZS5wb3N0TWVzc2FnZSA9IGZ1bmN0aW9uIHBvc3RNZXNzYWdlKCkge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUudmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcm9vbSA9IHRoaXMuc3RhdGUucm9vbTtcblxuICAgICAgICBpZiAoIXJvb20gfHwgIXJvb20uVXVpZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNhbm5vdCBmaW5kIGNlbGwgaW5mb1wiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbWVzc2FnZSA9IHtcbiAgICAgICAgICAgIFwiQHR5cGVcIjogXCJQT1NUXCIsXG4gICAgICAgICAgICBcIk1lc3NhZ2VcIjogeyBcIlJvb21VdWlkXCI6IHJvb20uVXVpZCwgXCJNZXNzYWdlXCI6IHRoaXMuc3RhdGUudmFsdWUgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsaWVudC5zZW5kKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiAnJyB9KTtcbiAgICB9O1xuXG4gICAgQ2hhdC5wcm90b3R5cGUuZGVsZXRlTWVzc2FnZSA9IGZ1bmN0aW9uIGRlbGV0ZU1lc3NhZ2UobXNnKSB7XG4gICAgICAgIHZhciByb29tID0gdGhpcy5zdGF0ZS5yb29tO1xuXG4gICAgICAgIGlmICghcm9vbSB8fCAhcm9vbS5VdWlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2Fubm90IGZpbmQgY2VsbCBpbmZvXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtZXNzYWdlID0ge1xuICAgICAgICAgICAgXCJAdHlwZVwiOiBcIkRFTEVURV9NU0dcIixcbiAgICAgICAgICAgIFwiTWVzc2FnZVwiOiBtc2dcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jbGllbnQuc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG4gICAgfTtcblxuICAgIENoYXQucHJvdG90eXBlLmtleURvd24gPSBmdW5jdGlvbiBrZXlEb3duKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLnBvc3RNZXNzYWdlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2hhdC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMyID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHN0eWxlID0gX3Byb3BzMi5zdHlsZTtcbiAgICAgICAgdmFyIG1zZ0NvbnRhaW5lclN0eWxlID0gX3Byb3BzMi5tc2dDb250YWluZXJTdHlsZTtcbiAgICAgICAgdmFyIGZpZWxkSGludCA9IF9wcm9wczIuZmllbGRIaW50O1xuICAgICAgICB2YXIgZW1wdHlTdGF0ZVByb3BzID0gX3Byb3BzMi5lbXB0eVN0YXRlUHJvcHM7XG4gICAgICAgIHZhciBweWRpbyA9IF9wcm9wczIucHlkaW87XG4gICAgICAgIHZhciBwdXNoTWVzc2FnZXNUb0JvdHRvbSA9IF9wcm9wczIucHVzaE1lc3NhZ2VzVG9Cb3R0b207XG4gICAgICAgIHZhciBjb21wdXRlUHJlc2VuY2VGcm9tQUNMcyA9IF9wcm9wczIuY29tcHV0ZVByZXNlbmNlRnJvbUFDTHM7XG4gICAgICAgIHZhciBfc3RhdGUgPSB0aGlzLnN0YXRlO1xuICAgICAgICB2YXIgbWVzc2FnZXMgPSBfc3RhdGUubWVzc2FnZXM7XG4gICAgICAgIHZhciByb29tID0gX3N0YXRlLnJvb207XG5cbiAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgdmFyIHByZXZpb3VzTURhdGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBwcmV2aW91c0F1dGhvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgbWVzc2FnZXMuZm9yRWFjaChmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgaWYgKG1bJ01lc3NhZ2UnXSkge1xuICAgICAgICAgICAgICAgIHZhciBtRGF0ZSA9IG1vbWVudChwYXJzZUZsb2F0KG0uVGltZXN0YW1wKSAqIDEwMDApLmZyb21Ob3coKTtcbiAgICAgICAgICAgICAgICB2YXIgaGlkZURhdGUgPSBwcmV2aW91c01EYXRlICYmIHByZXZpb3VzTURhdGUgPT09IG1EYXRlO1xuICAgICAgICAgICAgICAgIHZhciBzYW1lQXV0aG9yID0gcHJldmlvdXNBdXRob3IgJiYgcHJldmlvdXNBdXRob3IgPT09IG0uQXV0aG9yICYmIGhpZGVEYXRlO1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfTWVzc2FnZTJbJ2RlZmF1bHQnXSwgeyBrZXk6IG0uVXVpZCwgbWVzc2FnZTogbSwgaGlkZURhdGU6IGhpZGVEYXRlLCBzYW1lQXV0aG9yOiBzYW1lQXV0aG9yLCBvbkRlbGV0ZU1lc3NhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRlbGV0ZU1lc3NhZ2UobSk7XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICAgICAgICAgIHByZXZpb3VzTURhdGUgPSBtRGF0ZTtcbiAgICAgICAgICAgICAgICBwcmV2aW91c0F1dGhvciA9IG0uQXV0aG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHB1c2hTdHlsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIHB1c2hlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHB1c2hNZXNzYWdlc1RvQm90dG9tKSB7XG4gICAgICAgICAgICBwdXNoU3R5bGUgPSB7IGRpc3BsYXk6ICdmbGV4JywgZmxleERpcmVjdGlvbjogJ2NvbHVtbicgfTtcbiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcHVzaGVyID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IHN0eWxlOiB7IGZsZXg6IDEgfSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZW1wdHlTdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGVtcHR5U3RhdGVQcm9wcyAmJiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSkge1xuICAgICAgICAgICAgZW1wdHlTdGF0ZSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF92aWV3c0VtcHR5U3RhdGVWaWV3MlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7IHB5ZGlvOiBweWRpbyB9LCBlbXB0eVN0YXRlUHJvcHMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgc3R5bGU6IF9leHRlbmRzKHsgcGFkZGluZzogMCB9LCBzdHlsZSkgfSxcbiAgICAgICAgICAgIGNvbXB1dGVQcmVzZW5jZUZyb21BQ0xzICE9PSB1bmRlZmluZWQgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX0NoYXRVc2VyczJbJ2RlZmF1bHQnXSwgeyBweWRpbzogcHlkaW8sIEFDTHM6IGNvbXB1dGVQcmVzZW5jZUZyb21BQ0xzLCByb29tVXNlcnM6IHJvb20gPyByb29tLlVzZXJzIDogW10gfSksXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IHJlZjogJ2NvbW1lbnRzJywgY2xhc3NOYW1lOiAnY29tbWVudHNfZmVlZCcsIHN0eWxlOiBfZXh0ZW5kcyh7IG1heEhlaWdodDogMzAwLCBvdmVyZmxvd1k6ICdhdXRvJyB9LCBwdXNoU3R5bGUsIG1zZ0NvbnRhaW5lclN0eWxlKSB9LFxuICAgICAgICAgICAgICAgIHB1c2hlcixcbiAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgIGVtcHR5U3RhdGVcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGJhY2tncm91bmRDb2xvcjogJ3doaXRlJywgcGFkZGluZ0xlZnQ6IDE2LCBwYWRkaW5nUmlnaHQ6IDE2LCBib3JkZXJUb3A6ICcxcHggc29saWQgI2UwZTBlMCcgfSB9LFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLlRleHRGaWVsZCwge1xuICAgICAgICAgICAgICAgICAgICBoaW50VGV4dDogZmllbGRIaW50LFxuICAgICAgICAgICAgICAgICAgICBoaW50U3R5bGU6IHsgd2hpdGVTcGFjZTogJ25vd3JhcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZXZlbnQsIG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiBuZXdWYWx1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlMaW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZWY6ICduZXdfY29tbWVudCcsXG4gICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5rZXlEb3duLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lU2hvdzogZmFsc2VcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ2hhdDtcbn0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXG5DaGF0LlByb3BUeXBlcyA9IHtcbiAgICByb29tVHlwZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgcm9vbU9iamVjdElkOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZ1xufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gQ2hhdCA9IFB5ZGlvQ29udGV4dENvbnN1bWVyKENoYXQpO1xuZXhwb3J0c1snZGVmYXVsdCddID0gQ2hhdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcHlkaW9IdHRwV2Vic29ja2V0ID0gcmVxdWlyZSgncHlkaW8vaHR0cC93ZWJzb2NrZXQnKTtcblxudmFyIF9weWRpb0h0dHBXZWJzb2NrZXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9IdHRwV2Vic29ja2V0KTtcblxudmFyIF9yZWNvbm5lY3RpbmdXZWJzb2NrZXQgPSByZXF1aXJlKCdyZWNvbm5lY3Rpbmctd2Vic29ja2V0Jyk7XG5cbnZhciBfcmVjb25uZWN0aW5nV2Vic29ja2V0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlY29ubmVjdGluZ1dlYnNvY2tldCk7XG5cbnZhciBDaGF0Q2xpZW50ID0gKGZ1bmN0aW9uIChfUHlkaW9XZWJTb2NrZXQpIHtcbiAgICBfaW5oZXJpdHMoQ2hhdENsaWVudCwgX1B5ZGlvV2ViU29ja2V0KTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHB5ZGlvT2JqZWN0XG4gICAgICogQHJldHVybiB7Q2hhdENsaWVudH1cbiAgICAgKi9cblxuICAgIENoYXRDbGllbnQuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiBnZXRJbnN0YW5jZShweWRpb09iamVjdCkge1xuICAgICAgICBpZiAoQ2hhdENsaWVudC5faW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIENoYXRDbGllbnQuX2luc3RhbmNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgQ2hhdENsaWVudC5faW5zdGFuY2UgPSBuZXcgQ2hhdENsaWVudChweWRpb09iamVjdCk7XG4gICAgICAgICAgICByZXR1cm4gQ2hhdENsaWVudC5faW5zdGFuY2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHlkaW9PYmplY3Qge1B5ZGlvfVxuICAgICAqL1xuXG4gICAgZnVuY3Rpb24gQ2hhdENsaWVudChweWRpb09iamVjdCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2hhdENsaWVudCk7XG5cbiAgICAgICAgX1B5ZGlvV2ViU29ja2V0LmNhbGwodGhpcywgcHlkaW9PYmplY3QpO1xuICAgICAgICB0aGlzLmN1cnJlbnRSZXBvID0gcHlkaW9PYmplY3QucmVwb3NpdG9yeUlkO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5yb29tcyA9IHt9O1xuICAgICAgICB0aGlzLnJvb21JbmZvcyA9IHt9O1xuICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICB9XG5cbiAgICBDaGF0Q2xpZW50LnByb3RvdHlwZS5nZXRJZGVudGlmaWVyID0gZnVuY3Rpb24gZ2V0SWRlbnRpZmllcihyb29tVHlwZSwgb2JqZWN0SWQpIHtcbiAgICAgICAgcmV0dXJuIHJvb21UeXBlICsgJzonICsgb2JqZWN0SWQ7XG4gICAgfTtcblxuICAgIENoYXRDbGllbnQucHJvdG90eXBlLmdldFJvb21JbmZvRnJvbUlkZW50aWZpZXIgPSBmdW5jdGlvbiBnZXRSb29tSW5mb0Zyb21JZGVudGlmaWVyKGlkZW50aWZpZXIpIHtcbiAgICAgICAgdmFyIF9pZGVudGlmaWVyJHNwbGl0ID0gaWRlbnRpZmllci5zcGxpdCgnOicpO1xuXG4gICAgICAgIHZhciByb29tVHlwZSA9IF9pZGVudGlmaWVyJHNwbGl0WzBdO1xuICAgICAgICB2YXIgb2JqZWN0SWQgPSBfaWRlbnRpZmllciRzcGxpdFsxXTtcblxuICAgICAgICByZXR1cm4geyByb29tVHlwZTogcm9vbVR5cGUsIG9iamVjdElkOiBvYmplY3RJZCB9O1xuICAgIH07XG5cbiAgICBDaGF0Q2xpZW50LnByb3RvdHlwZS5vblJvb21NZXNzYWdlID0gZnVuY3Rpb24gb25Sb29tTWVzc2FnZShtc2cpIHtcbiAgICAgICAgaWYgKG1zZykge1xuICAgICAgICAgICAgdmFyIHJvb20gPSBtc2dbJ1Jvb20nXTtcbiAgICAgICAgICAgIHZhciBpZGVudGlmaWVyID0gdGhpcy5nZXRJZGVudGlmaWVyKHJvb20uVHlwZSwgcm9vbS5Sb29tVHlwZU9iamVjdCk7XG4gICAgICAgICAgICB0aGlzLnJvb21JbmZvc1tpZGVudGlmaWVyXSA9IHJvb207XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcm9vbVR5cGUgc3RyaW5nXG4gICAgICogQHBhcmFtIG9iamVjdElkIHN0cmluZ1xuICAgICAqIEBwYXJhbSBtZXNzYWdlSGFuZGxlciBGdW5jdGlvblxuICAgICAqIEBwYXJhbSByb29tVXBkYXRlSGFuZGxlciBGdW5jdGlvblxuICAgICAqIEBwYXJhbSByZXRyeSBOdW1iZXJcbiAgICAgKi9cblxuICAgIENoYXRDbGllbnQucHJvdG90eXBlLmpvaW5Sb29tID0gZnVuY3Rpb24gam9pblJvb20ocm9vbVR5cGUsIG9iamVjdElkLCBtZXNzYWdlSGFuZGxlciwgcm9vbVVwZGF0ZUhhbmRsZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgcmV0cnkgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDQgfHwgYXJndW1lbnRzWzRdID09PSB1bmRlZmluZWQgPyAwIDogYXJndW1lbnRzWzRdO1xuXG4gICAgICAgIHZhciBpZGVudGlmaWVyID0gdGhpcy5nZXRJZGVudGlmaWVyKHJvb21UeXBlLCBvYmplY3RJZCk7XG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl0pIHtcbiAgICAgICAgICAgIHZhciBhbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl0ubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYubWVzc2FnZUhhbmRsZXIgPT09IG1lc3NhZ2VIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGFscmVhZHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFhbHJlYWR5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zW2lkZW50aWZpZXJdLnB1c2goeyBtZXNzYWdlSGFuZGxlcjogbWVzc2FnZUhhbmRsZXIsIHJvb21VcGRhdGVIYW5kbGVyOiByb29tVXBkYXRlSGFuZGxlciB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJvb21JbmZvc1tpZGVudGlmaWVyXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW5nKSB7XG4gICAgICAgICAgICBpZiAocmV0cnkgPCAzKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0Nvbm5lY3Rpbmcgc3RhdGUuLi4gcmV0cnlpbmcgbm93Jywgb2JqZWN0SWQpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5qb2luUm9vbShyb29tVHlwZSwgb2JqZWN0SWQsIG1lc3NhZ2VIYW5kbGVyLCByb29tVXBkYXRlSGFuZGxlciwgcmV0cnkgKyAxKTtcbiAgICAgICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5jb25uT3Blbikge1xuICAgICAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdOb3Qgb3Blbi4uLiByZXRyeWluZyBub3cnLCBvYmplY3RJZCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuam9pblJvb20ocm9vbVR5cGUsIG9iamVjdElkLCBtZXNzYWdlSGFuZGxlciwgcm9vbVVwZGF0ZUhhbmRsZXIsIHJldHJ5ICsgMSk7XG4gICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vY29uc29sZS5sb2coJ05vdyBzdG9yaW5nIHN1YnNjcmlwdGlvbiBmb3IgJywgb2JqZWN0SWQpO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNbcm9vbVR5cGUgKyAnOicgKyBvYmplY3RJZF0gPSBbeyBtZXNzYWdlSGFuZGxlcjogbWVzc2FnZUhhbmRsZXIsIHJvb21VcGRhdGVIYW5kbGVyOiByb29tVXBkYXRlSGFuZGxlciB9XTtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IFwiQHR5cGVcIjogXCJKT0lOXCIsIFwiUm9vbVwiOiB7IFwiVHlwZVwiOiByb29tVHlwZSwgXCJSb29tVHlwZU9iamVjdFwiOiBvYmplY3RJZCB9IH07XG4gICAgICAgIHRoaXMud3Muc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb21JbmZvc1tpZGVudGlmaWVyXTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2VuZCBhIEhJU1RPUlkgcmVxdWVzdCB0byByZWNlaXZlIGV4aXN0aW5nIG1lc3NhZ2VzIGluIHJvb21cbiAgICAgKiBAcGFyYW0gcm9vbVR5cGVcbiAgICAgKiBAcGFyYW0gb2JqZWN0SWRcbiAgICAgKiBAcGFyYW0gcmV0cnkgaW50XG4gICAgICovXG5cbiAgICBDaGF0Q2xpZW50LnByb3RvdHlwZS5sb2FkSGlzdG9yeSA9IGZ1bmN0aW9uIGxvYWRIaXN0b3J5KHJvb21UeXBlLCBvYmplY3RJZCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgcmV0cnkgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyAwIDogYXJndW1lbnRzWzJdO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgIGlmIChyZXRyeSA8IDMpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLmxvYWRIaXN0b3J5KHJvb21UeXBlLCBvYmplY3RJZCwgcmV0cnkgKyAxKTtcbiAgICAgICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IFwiQHR5cGVcIjogXCJISVNUT1JZXCIsIFwiUm9vbVwiOiB7IFwiVHlwZVwiOiByb29tVHlwZSwgXCJSb29tVHlwZU9iamVjdFwiOiBvYmplY3RJZCB9IH07XG4gICAgICAgIHRoaXMud3Muc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHJvb21UeXBlXG4gICAgICogQHBhcmFtIG9iamVjdElkXG4gICAgICogQHBhcmFtIG1lc3NhZ2VIYW5kbGVyIEZ1bmN0aW9uXG4gICAgICovXG5cbiAgICBDaGF0Q2xpZW50LnByb3RvdHlwZS5sZWF2ZVJvb20gPSBmdW5jdGlvbiBsZWF2ZVJvb20ocm9vbVR5cGUsIG9iamVjdElkKSB7XG4gICAgICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBtZXNzYWdlSGFuZGxlciA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IGFyZ3VtZW50c1syXTtcblxuICAgICAgICB2YXIga2VlcCA9IGZhbHNlO1xuICAgICAgICB2YXIgaWRlbnRpZmllciA9IHRoaXMuZ2V0SWRlbnRpZmllcihyb29tVHlwZSwgb2JqZWN0SWQpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKCdMZWF2aW5nIHJvb206ICcgKyBvYmplY3RJZCk7XG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl0pIHtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlSGFuZGxlcikge1xuICAgICAgICAgICAgICAgIC8vIEp1c3QgcmVtb3ZlIHRoaXMgaGFuZGxlclxuICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc1tpZGVudGlmaWVyXSA9IHRoaXMuc3Vic2NyaXB0aW9uc1tpZGVudGlmaWVyXS5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYubWVzc2FnZUhhbmRsZXIgIT09IG1lc3NhZ2VIYW5kbGVyO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl0ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGtlZXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zdWJzY3JpcHRpb25zW2lkZW50aWZpZXJdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgha2VlcCkge1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5yb29tcykubWFwKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzMy5yb29tc1trXSA9PT0gaWRlbnRpZmllcikge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMzLnJvb21zW2tdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29ubk9wZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHsgXCJAdHlwZVwiOiBcIkxFQVZFXCIsIFwiUm9vbVwiOiB7IFwiVHlwZVwiOiByb29tVHlwZSwgXCJSb29tVHlwZU9iamVjdFwiOiBvYmplY3RJZCB9IH07XG4gICAgICAgICAgICAgICAgdGhpcy53cy5zZW5kKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtc2dcbiAgICAgKi9cblxuICAgIENoYXRDbGllbnQucHJvdG90eXBlLmhhbmRsZU1lc3NhZ2VSZWNlaXZlZCA9IGZ1bmN0aW9uIGhhbmRsZU1lc3NhZ2VSZWNlaXZlZChtc2cpIHtcbiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKG1zZ1snZGF0YSddKTtcbiAgICAgICAgaWYgKGRhdGFbXCJAdHlwZVwiXSA9PT0gJ1JPT01fVVBEQVRFJykge1xuICAgICAgICAgICAgdmFyIGlkZW50aWZpZXIgPSB0aGlzLmdldElkZW50aWZpZXIoZGF0YS5Sb29tLlR5cGUsIGRhdGEuUm9vbS5Sb29tVHlwZU9iamVjdCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zW2lkZW50aWZpZXJdKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvb21zW2RhdGEuUm9vbS5VdWlkXSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb21zW2RhdGEuUm9vbS5VdWlkXSA9IGlkZW50aWZpZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMub25Sb29tTWVzc2FnZShkYXRhKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaWRlbnRpZmllcl0ubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LnJvb21VcGRhdGVIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYucm9vbVVwZGF0ZUhhbmRsZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWxldGVNc2cgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgd3NNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhW1wiQHR5cGVcIl0gPT09ICdERUxFVEVfTVNHJykge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGVNc2cgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB3c01lc3NhZ2UgPSBkYXRhW1wiTWVzc2FnZVwiXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3c01lc3NhZ2UgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod3NNZXNzYWdlLlJvb21VdWlkICYmIF90aGlzNC5yb29tc1t3c01lc3NhZ2UuUm9vbVV1aWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWJzID0gX3RoaXM0LnN1YnNjcmlwdGlvbnNbX3RoaXM0LnJvb21zW3dzTWVzc2FnZS5Sb29tVXVpZF1dO1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2l0aFJvb21VcGRhdGVIYW5kbGVyID0gc3Vicy5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2LnJvb21VcGRhdGVIYW5kbGVyO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBzdWJzY3JpYmVyIHdpdGggYSByb29tVXBkYXRlSGFuZGxlciwgaXQgaXMgYW4gb3BlbiByb29tLFxuICAgICAgICAgICAgICAgICAgICAvLyBzbyBzZW5kIG1lc3NhZ2Ugb25seSB0byB0aGF0IG9uZS4gVGhlIG9uZXMgd2l0aG91dCBhcmUganVzdCBub3RpZmljYXRpb24gbGlzdGVuZXJzXG4gICAgICAgICAgICAgICAgICAgIGlmICh3aXRoUm9vbVVwZGF0ZUhhbmRsZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzID0gd2l0aFJvb21VcGRhdGVIYW5kbGVyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN1YnMubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYubWVzc2FnZUhhbmRsZXIod3NNZXNzYWdlLCBkZWxldGVNc2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge31cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtZXNzYWdlXG4gICAgICovXG5cbiAgICBDaGF0Q2xpZW50LnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gc2VuZChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMud3Muc2VuZChtZXNzYWdlKTtcbiAgICB9O1xuXG4gICAgQ2hhdENsaWVudC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRSZXBvKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHVybCA9IHRoaXMucHlkaW8uUGFyYW1ldGVycy5nZXQoXCJFTkRQT0lOVF9XRUJTT0NLRVRcIikucmVwbGFjZShcIi9ldmVudFwiLCBcIi9jaGF0XCIpO1xuICAgICAgICB0aGlzLndzID0gbmV3IF9yZWNvbm5lY3RpbmdXZWJzb2NrZXQyWydkZWZhdWx0J10odXJsLCBbXSwge1xuICAgICAgICAgICAgbWF4UmVjb25uZWN0aW9uRGVsYXk6IDYwMDAwLFxuICAgICAgICAgICAgcmVjb25uZWN0aW9uRGVsYXlHcm93RmFjdG9yOiAxLjYsXG4gICAgICAgICAgICBtYXhSZXRyaWVzOiAxMFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNvbm5lY3RpbmcgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9weWRpb0h0dHBXZWJzb2NrZXQyWydkZWZhdWx0J10uc3Vic2NyaWJlSldUKF90aGlzNS53cykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXM1LmNvbm5lY3RpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpczUuY29ubk9wZW4gPSB0cnVlO1xuICAgICAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzNS5jb25uZWN0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXM1LmNvbm5PcGVuID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgICAgICAgIF90aGlzNS5oYW5kbGVNZXNzYWdlUmVjZWl2ZWQobXNnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIF90aGlzNS5jb25uT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXM1LmNvbm5lY3RpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIF9weWRpb0h0dHBXZWJzb2NrZXQyWydkZWZhdWx0J10ubG9nQ2xvc2UoZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFSE9TVERPV04nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IG1heFJldHJpZXMgcmVhY2hlZCwgaG9zdCBpcyBkb3duIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2hhdENsaWVudC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSgpIHtcbiAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7XG5cbiAgICAgICAgaWYgKHRoaXMud3MgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnN1YnNjcmlwdGlvbnMpLm1hcChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgdmFyIF9nZXRSb29tSW5mb0Zyb21JZGVudGlmaWVyID0gX3RoaXM2LmdldFJvb21JbmZvRnJvbUlkZW50aWZpZXIoayk7XG5cbiAgICAgICAgICAgIHZhciByb29tVHlwZSA9IF9nZXRSb29tSW5mb0Zyb21JZGVudGlmaWVyLnJvb21UeXBlO1xuICAgICAgICAgICAgdmFyIG9iamVjdElkID0gX2dldFJvb21JbmZvRnJvbUlkZW50aWZpZXIub2JqZWN0SWQ7XG5cbiAgICAgICAgICAgIF90aGlzNi5sZWF2ZVJvb20ocm9vbVR5cGUsIG9iamVjdElkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud3MuY2xvc2UoMTAwMCwgJ0Nsb3NpbmcnLCB7IGtlZXBDbG9zZWQ6IHRydWUgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBDaGF0Q2xpZW50O1xufSkoX3B5ZGlvSHR0cFdlYnNvY2tldDJbJ2RlZmF1bHQnXSk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENoYXRDbGllbnQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX0NoYXRDbGllbnQgPSByZXF1aXJlKCcuL0NoYXRDbGllbnQnKTtcblxudmFyIF9DaGF0Q2xpZW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0NoYXRDbGllbnQpO1xuXG52YXIgQ2hhdEljb24gPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoQ2hhdEljb24sIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gQ2hhdEljb24ocHJvcHMpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENoYXRJY29uKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0geyBuZXdNZXNzYWdlczogMCB9O1xuICAgICAgICB0aGlzLl9tZXNzYWdlTGlzdGVuZXIgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIENoYXRJY29uLnByb3RvdHlwZS5vbk1lc3NhZ2UgPSBmdW5jdGlvbiBvbk1lc3NhZ2UobXNnKSB7XG4gICAgICAgIHZhciBkZWxldGVNc2cgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTtcblxuICAgICAgICBpZiAoZGVsZXRlTXNnKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbmV3TWVzc2FnZXM6IE1hdGgubWF4KDAsIHRoaXMuc3RhdGUubmV3TWVzc2FnZXMgLSAxKSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuZXdNZXNzYWdlczogdGhpcy5zdGF0ZS5uZXdNZXNzYWdlcyArIDEgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2hhdEljb24ucHJvdG90eXBlLmxpc3RlblRvUm9vbSA9IGZ1bmN0aW9uIGxpc3RlblRvUm9vbShyb29tVHlwZSwgb2JqZWN0SWQpIHtcbiAgICAgICAgdmFyIGNsaWVudCA9IF9DaGF0Q2xpZW50MlsnZGVmYXVsdCddLmdldEluc3RhbmNlKHRoaXMucHJvcHMucHlkaW8pO1xuICAgICAgICBjbGllbnQuam9pblJvb20ocm9vbVR5cGUsIG9iamVjdElkLCB0aGlzLl9tZXNzYWdlTGlzdGVuZXIsIG51bGwpO1xuICAgIH07XG5cbiAgICBDaGF0SWNvbi5wcm90b3R5cGUubGVhdmVSb29tID0gZnVuY3Rpb24gbGVhdmVSb29tKHJvb21UeXBlLCBvYmplY3RJZCkge1xuICAgICAgICB2YXIgY2xpZW50ID0gX0NoYXRDbGllbnQyWydkZWZhdWx0J10uZ2V0SW5zdGFuY2UodGhpcy5wcm9wcy5weWRpbyk7XG4gICAgICAgIGNsaWVudC5sZWF2ZVJvb20ocm9vbVR5cGUsIG9iamVjdElkLCB0aGlzLl9tZXNzYWdlTGlzdGVuZXIpO1xuICAgIH07XG5cbiAgICBDaGF0SWNvbi5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciByb29tVHlwZSA9IF9wcm9wcy5yb29tVHlwZTtcbiAgICAgICAgdmFyIG9iamVjdElkID0gX3Byb3BzLm9iamVjdElkO1xuXG4gICAgICAgIHRoaXMubGlzdGVuVG9Sb29tKHJvb21UeXBlLCBvYmplY3RJZCk7XG4gICAgfTtcblxuICAgIENoYXRJY29uLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB2YXIgX3Byb3BzMiA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciByb29tVHlwZSA9IF9wcm9wczIucm9vbVR5cGU7XG4gICAgICAgIHZhciBvYmplY3RJZCA9IF9wcm9wczIub2JqZWN0SWQ7XG5cbiAgICAgICAgdGhpcy5sZWF2ZVJvb20ocm9vbVR5cGUsIG9iamVjdElkKTtcbiAgICB9O1xuXG4gICAgQ2hhdEljb24ucHJvdG90eXBlLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHJvb21UeXBlID0gX3Byb3BzMy5yb29tVHlwZTtcbiAgICAgICAgdmFyIG9iamVjdElkID0gX3Byb3BzMy5vYmplY3RJZDtcblxuICAgICAgICBpZiAobmV4dFByb3BzLnJvb21UeXBlICE9PSByb29tVHlwZSB8fCBuZXh0UHJvcHMub2JqZWN0SWQgIT09IG9iamVjdElkKSB7XG4gICAgICAgICAgICB0aGlzLmxlYXZlUm9vbShyb29tVHlwZSwgb2JqZWN0SWQpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5ld01lc3NhZ2VzOiAwIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5saXN0ZW5Ub1Jvb20obmV4dFByb3BzLnJvb21UeXBlLCBuZXh0UHJvcHMub2JqZWN0SWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2hhdEljb24ucHJvdG90eXBlLm9uQ2xpY2sgPSBmdW5jdGlvbiBvbkNsaWNrKCkge1xuICAgICAgICB2YXIgcHlkaW8gPSB0aGlzLnByb3BzLnB5ZGlvO1xuXG4gICAgICAgIHB5ZGlvLkNvbnRyb2xsZXIuZmlyZUFjdGlvbigndG9nZ2xlX2NoYXRfcGFuZWwnKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5ld01lc3NhZ2VzOiAwIH0pO1xuICAgIH07XG5cbiAgICBDaGF0SWNvbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgbmV3TWVzc2FnZXMgPSB0aGlzLnN0YXRlLm5ld01lc3NhZ2VzO1xuXG4gICAgICAgIGlmIChuZXdNZXNzYWdlcyA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlZCA9ICcnO1xuICAgICAgICB2YXIgZ3JlZW4gPSAnIzhCQzM0QSc7XG4gICAgICAgIHZhciBzdHlsZSA9IHsgZGlzcGxheTogJ2lubGluZS1ibG9jaycsIHBhZGRpbmc6ICcwIDVweCcsIGZvbnRTaXplOiAxNSwgdGV4dEFsaWduOiAnY2VudGVyJyxcbiAgICAgICAgICAgIGNvbG9yOiBncmVlbiwgZm9udFdlaWdodDogNTAwLCBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9O1xuICAgICAgICB2YXIgaW5uZXJTdHlsZSA9IHsgZm9udFNpemU6IDEzLCBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywgcG9zaXRpb246ICdhYnNvbHV0ZScsIHRvcDogLTEsIG1hcmdpbkxlZnQ6IDIgfTtcbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgeyBvbkNsaWNrOiB0aGlzLm9uQ2xpY2suYmluZCh0aGlzKSwgY2xhc3NOYW1lOiAnbWRpIG1kaS1jb21tZW50Jywgc3R5bGU6IHN0eWxlIH0sXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogaW5uZXJTdHlsZSB9LFxuICAgICAgICAgICAgICAgIG5ld01lc3NhZ2VzXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiBDaGF0SWNvbjtcbn0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBDaGF0SWNvbjtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcHlkaW9Nb2RlbElkbU9iamVjdEhlbHBlciA9IHJlcXVpcmUoJ3B5ZGlvL21vZGVsL2lkbS1vYmplY3QtaGVscGVyJyk7XG5cbnZhciBfcHlkaW9Nb2RlbElkbU9iamVjdEhlbHBlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb01vZGVsSWRtT2JqZWN0SGVscGVyKTtcblxudmFyIENoYXRVc2VycyA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhDaGF0VXNlcnMsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gQ2hhdFVzZXJzKCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2hhdFVzZXJzKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgQ2hhdFVzZXJzLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgQUNMcyA9IF9wcm9wcy5BQ0xzO1xuICAgICAgICB2YXIgcm9vbVVzZXJzID0gX3Byb3BzLnJvb21Vc2VycztcbiAgICAgICAgdmFyIHB5ZGlvID0gX3Byb3BzLnB5ZGlvO1xuXG4gICAgICAgIHZhciBzdHlsZSA9IHsgdXNlcjoge1xuICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAxMFxuICAgICAgICAgICAgfSwgb25saW5lOiB7XG4gICAgICAgICAgICAgICAgY29sb3I6ICcjNENBRjUwJyxcbiAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiA1XG4gICAgICAgICAgICB9LCBvZmZsaW5lOiB7XG4gICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogNVxuICAgICAgICAgICAgfSB9O1xuXG4gICAgICAgIHZhciB1c2VycyA9IE9iamVjdC5rZXlzKEFDTHMpLm1hcChmdW5jdGlvbiAocm9sZUlkKSB7XG4gICAgICAgICAgICB2YXIgYWNsID0gQUNMc1tyb2xlSWRdO1xuICAgICAgICAgICAgdmFyIG9ubGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHZhciBsYWJlbCA9IF9weWRpb01vZGVsSWRtT2JqZWN0SGVscGVyMlsnZGVmYXVsdCddLmV4dHJhY3RMYWJlbChweWRpbywgYWNsKTtcbiAgICAgICAgICAgIGlmIChhY2wuVXNlcikge1xuICAgICAgICAgICAgICAgIGlmIChyb29tVXNlcnMgJiYgcm9vbVVzZXJzLmluZGV4T2YoYWNsLlVzZXIuTG9naW4pID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgb25saW5lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvbmxpbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlLnVzZXIgfSxcbiAgICAgICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgICAgICBvbmxpbmUgIT09IHVuZGVmaW5lZCAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiBcIm1kaSBtZGktY2hlY2tib3gtYmxhbmstY2lyY2xlXCIgKyAob25saW5lID8gXCJcIiA6IFwiLW91dGxpbmVcIiksIHN0eWxlOiBvbmxpbmUgPyBzdHlsZS5vbmxpbmUgOiBzdHlsZS5vZmZsaW5lIH0pLFxuICAgICAgICAgICAgICAgIG9ubGluZSA9PT0gdW5kZWZpbmVkICYmIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IFwibWRpIG1kaS1hY2NvdW50LW11bHRpcGxlLW91dGxpbmVcIiwgc3R5bGU6IHN0eWxlLm9mZmxpbmUgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBzdHlsZTogeyBwYWRkaW5nOiAxNiwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogJyM3NTc1NzUnIH0gfSxcbiAgICAgICAgICAgIHVzZXJzXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiBDaGF0VXNlcnM7XG59KShfcmVhY3QyWydkZWZhdWx0J10uQ29tcG9uZW50KTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gQ2hhdFVzZXJzO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX3B5ZGlvID0gcmVxdWlyZSgncHlkaW8nKTtcblxudmFyIF9weWRpbzIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpbyk7XG5cbnZhciBfdXNlcnNBdmF0YXJVc2VyQXZhdGFyID0gcmVxdWlyZSgnLi4vdXNlcnMvYXZhdGFyL1VzZXJBdmF0YXInKTtcblxudmFyIF91c2Vyc0F2YXRhclVzZXJBdmF0YXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXNlcnNBdmF0YXJVc2VyQXZhdGFyKTtcblxudmFyIF9tYXRlcmlhbFVpID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIF9weWRpb1V0aWxEb20gPSByZXF1aXJlKCdweWRpby91dGlsL2RvbScpO1xuXG52YXIgX3B5ZGlvVXRpbERvbTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb1V0aWxEb20pO1xuXG52YXIgX1B5ZGlvJHJlcXVpcmVMaWIgPSBfcHlkaW8yWydkZWZhdWx0J10ucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfUHlkaW8kcmVxdWlyZUxpYi5QeWRpb0NvbnRleHRDb25zdW1lcjtcbnZhciBtb21lbnQgPSBfUHlkaW8kcmVxdWlyZUxpYi5tb21lbnQ7XG5cbnZhciBNZXNzYWdlID0gKGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKE1lc3NhZ2UsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gTWVzc2FnZShwcm9wcykge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWVzc2FnZSk7XG5cbiAgICAgICAgX1JlYWN0JENvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgaG92ZXI6IGZhbHNlIH07XG4gICAgfVxuXG4gICAgTWVzc2FnZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IF9wcm9wcy5tZXNzYWdlO1xuICAgICAgICB2YXIgcHlkaW8gPSBfcHJvcHMucHlkaW87XG4gICAgICAgIHZhciBoaWRlRGF0ZSA9IF9wcm9wcy5oaWRlRGF0ZTtcbiAgICAgICAgdmFyIHNhbWVBdXRob3IgPSBfcHJvcHMuc2FtZUF1dGhvcjtcbiAgICAgICAgdmFyIG9uRGVsZXRlTWVzc2FnZSA9IF9wcm9wcy5vbkRlbGV0ZU1lc3NhZ2U7XG5cbiAgICAgICAgdmFyIG1EYXRlID0gbW9tZW50KHBhcnNlRmxvYXQobWVzc2FnZS5UaW1lc3RhbXApICogMTAwMCk7XG5cbiAgICAgICAgdmFyIHN0eWxlcyA9IHtcbiAgICAgICAgICAgIGRhdGU6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJ3JnYmEoMCwwLDAsLjIzKScsXG4gICAgICAgICAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiAnNXB4IDAnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0ZUxpbmU6IHtcbiAgICAgICAgICAgICAgICBmbGV4OiAxLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogJzEwcHggMjBweCcsXG4gICAgICAgICAgICAgICAgYm9yZGVyQm90dG9tOiAnMXB4IHNvbGlkICNlZWUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tbWVudDoge1xuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDgsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICAgICAgICAgIGFsaWduSXRlbXM6ICdmbGV4LXN0YXJ0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW1lbnRDb250ZW50OiB7XG4gICAgICAgICAgICAgICAgZmxleDogJzEnLFxuICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IDgsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogJzhweCAxMHB4JyxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZWVlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW1lbnREZWxldGVCb3g6IHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICB0b3A6IDUsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDUsXG4gICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAnIzQyNDI0MicsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBfcHlkaW9VdGlsRG9tMlsnZGVmYXVsdCddLmdldEJlemllcnNUcmFuc2l0aW9uKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYXV0aG9ySXNMb2dnZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHB5ZGlvLnVzZXIuaWQgPT09IG1lc3NhZ2UuQXV0aG9yKSB7XG4gICAgICAgICAgICBhdXRob3JJc0xvZ2dlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGF2YXRhciA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBzYW1lQXV0aG9yID8geyB2aXNpYmlsaXR5OiAnaGlkZGVuJyB9IDogeyBwYWRkaW5nVG9wOiAyIH0gfSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF91c2Vyc0F2YXRhclVzZXJBdmF0YXIyWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICBhdmF0YXJTaXplOiAzMCxcbiAgICAgICAgICAgICAgICBweWRpbzogcHlkaW8sXG4gICAgICAgICAgICAgICAgdXNlcklkOiBtZXNzYWdlLkF1dGhvcixcbiAgICAgICAgICAgICAgICBkaXNwbGF5TGFiZWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJpY2hPbkhvdmVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhckxldHRlcnM6IHRydWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIHZhciB0ZXh0U3R5bGUgPSBfZXh0ZW5kcyh7fSwgc3R5bGVzLmNvbW1lbnRDb250ZW50KTtcbiAgICAgICAgaWYgKGF1dGhvcklzTG9nZ2VkKSB7XG4gICAgICAgICAgICB0ZXh0U3R5bGUgPSBfZXh0ZW5kcyh7fSwgdGV4dFN0eWxlLCB7IG1hcmdpbkxlZnQ6IDAsIG1hcmdpblJpZ2h0OiA4IH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzYW1lQXV0aG9yKSB7XG4gICAgICAgICAgICB0ZXh0U3R5bGUgPSBfZXh0ZW5kcyh7fSwgdGV4dFN0eWxlLCB7IGJvcmRlclJhZGl1czogMCB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZGVsZXRlQm94ID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoYXV0aG9ySXNMb2dnZWQpIHtcbiAgICAgICAgICAgIHZhciBob3ZlciA9IHRoaXMuc3RhdGUuaG92ZXI7XG5cbiAgICAgICAgICAgIHZhciBkZWxldGVTdHlsZSA9IHN0eWxlcy5jb21tZW50RGVsZXRlQm94O1xuICAgICAgICAgICAgaWYgKGhvdmVyKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlU3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGVCb3ggPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiBvbkRlbGV0ZU1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnbWRpIG1kaS1jbG9zZScsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHN0eWxlcy5jb21tZW50RGVsZXRlQm94LFxuICAgICAgICAgICAgICAgIHRpdGxlOiBweWRpby5NZXNzYWdlSGFzaFsnNyddXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGV4dCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgX21hdGVyaWFsVWkuUGFwZXIsXG4gICAgICAgICAgICB7IHpEZXB0aDogMCwgc3R5bGU6IHRleHRTdHlsZSB9LFxuICAgICAgICAgICAgZGVsZXRlQm94LFxuICAgICAgICAgICAgbWVzc2FnZS5NZXNzYWdlXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBzYW1lQXV0aG9yID8geyBtYXJnaW5Ub3A6IC0xNiB9IDoge30sIG9uTW91c2VPdmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaG92ZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfSwgb25Nb3VzZU91dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGhvdmVyOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICB9IH0sXG4gICAgICAgICAgICAhaGlkZURhdGUgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLmRhdGUgfSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgc3R5bGU6IHN0eWxlcy5kYXRlTGluZSB9KSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICBtRGF0ZS5mcm9tTm93KClcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBzdHlsZTogc3R5bGVzLmRhdGVMaW5lIH0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgYXV0aG9ySXNMb2dnZWQgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLmNvbW1lbnQgfSxcbiAgICAgICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgICAgICcgJyxcbiAgICAgICAgICAgICAgICBhdmF0YXJcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICAhYXV0aG9ySXNMb2dnZWQgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLmNvbW1lbnQgfSxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgJyAnLFxuICAgICAgICAgICAgICAgIHRleHRcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE1lc3NhZ2U7XG59KShfcmVhY3QyWydkZWZhdWx0J10uQ29tcG9uZW50KTtcblxuTWVzc2FnZS5Qcm9wVHlwZXMgPSB7XG4gICAgbWVzc2FnZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3QsXG4gICAgaGlkZURhdGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbCxcbiAgICBzYW1lQXV0aG9yOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2xcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1lc3NhZ2UgPSBQeWRpb0NvbnRleHRDb25zdW1lcihNZXNzYWdlKTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1lc3NhZ2U7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbnZhciBfU3RvcmUgPSByZXF1aXJlKCcuL1N0b3JlJyk7XG5cbnZhciBfU3RvcmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU3RvcmUpO1xuXG52YXIgX0dyaWRCdWlsZGVyID0gcmVxdWlyZSgnLi9HcmlkQnVpbGRlcicpO1xuXG52YXIgX0dyaWRCdWlsZGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0dyaWRCdWlsZGVyKTtcblxuLyoqXG4gKiBBdXRvbWF0aWMgbGF5b3V0IGZvciBwcmVzZW50aW5nIGRyYWdnYWJsZSBjYXJkcyB0byB1c2Vycy4gVXNlZCBmb3IgdXNlciBhbmQgYWRtaW4gZGFzaGJvYXJkLlxuICovXG52YXIgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xudmFyIFB5ZGlvID0gcmVxdWlyZSgncHlkaW8nKTtcblxudmFyIF9yZXF1aXJlID0gcmVxdWlyZSgncmVhY3QtZ3JpZC1sYXlvdXQnKTtcblxudmFyIFJlc3BvbnNpdmUgPSBfcmVxdWlyZS5SZXNwb25zaXZlO1xudmFyIFdpZHRoUHJvdmlkZXIgPSBfcmVxdWlyZS5XaWR0aFByb3ZpZGVyO1xuXG52YXIgX1B5ZGlvJHJlcXVpcmVMaWIgPSBQeWRpby5yZXF1aXJlTGliKCdib290Jyk7XG5cbnZhciBQeWRpb0NvbnRleHRDb25zdW1lciA9IF9QeWRpbyRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xudmFyIENhcmRzR3JpZCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0NhcmRzR3JpZCcsXG5cbiAgICAvKipcbiAgICAgKiBTYXZlIGxheW91dHMgaW4gdGhlIHVzZXJzIHByZWZlcmVuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYWxsTGF5b3V0cyBSZXNwb25zaXZlIGxheW91dHMgcGFzc2VkIGZvciBzYXZpbmdcbiAgICAgKi9cbiAgICBzYXZlRnVsbExheW91dHM6IGZ1bmN0aW9uIHNhdmVGdWxsTGF5b3V0cyhhbGxMYXlvdXRzKSB7XG4gICAgICAgIHZhciBzYXZlZFByZWYgPSB0aGlzLnByb3BzLnN0b3JlLmdldFVzZXJQcmVmZXJlbmNlKCdMYXlvdXQnKTtcbiAgICAgICAgLy8gQ29tcGFyZSBKU09OIHZlcnNpb25zIHRvIGF2b2lkIHNhdmluZyB1bm5lY2Vzc2FyeSBjaGFuZ2VzXG4gICAgICAgIGlmIChzYXZlZFByZWYgJiYgdGhpcy5wcmV2aW91c0xheW91dCAmJiB0aGlzLnByZXZpb3VzTGF5b3V0ID09IEpTT04uc3RyaW5naWZ5KGFsbExheW91dHMpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcmV2aW91c0xheW91dCA9IEpTT04uc3RyaW5naWZ5KGFsbExheW91dHMpO1xuICAgICAgICB0aGlzLnByb3BzLnN0b3JlLnNhdmVVc2VyUHJlZmVyZW5jZSgnTGF5b3V0JywgYWxsTGF5b3V0cyk7XG4gICAgfSxcblxuICAgIG9uTGF5b3V0Q2hhbmdlOiBmdW5jdGlvbiBvbkxheW91dENoYW5nZShjdXJyZW50TGF5b3V0LCBhbGxMYXlvdXRzKSB7XG4gICAgICAgIGlmICh0aGlzLl9ibG9ja0xheW91dFNhdmUpIHJldHVybjtcbiAgICAgICAgdGhpcy5zYXZlRnVsbExheW91dHMoYWxsTGF5b3V0cyk7XG4gICAgfSxcblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5zdG9yZS5zdG9wT2JzZXJ2aW5nKFwiY2FyZHNcIiwgdGhpcy5fc3RvcmVPYnNlcnZlcik7XG4gICAgfSxcblxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzICYmIG5leHRQcm9wcy5lZGl0TW9kZSAhPT0gdGhpcy5wcm9wcy5lZGl0TW9kZSkge1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5yZWZzKS5mb3JFYWNoKChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVmc1trXS50b2dnbGVFZGl0TW9kZShuZXh0UHJvcHMuZWRpdE1vZGUpO1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvdWxkQ29tcG9uZW50VXBkYXRlOiBmdW5jdGlvbiBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzLCBuZXh0U3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvcmNlVXBkYXRlIHx8IGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5fc3RvcmVPYnNlcnZlciA9IChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5fZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgY2FyZHM6IHRoaXMucHJvcHMuc3RvcmUuZ2V0Q2FyZHMoKVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl9mb3JjZVVwZGF0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMucHJvcHMuc3RvcmUub2JzZXJ2ZShcImNhcmRzXCIsIHRoaXMuX3N0b3JlT2JzZXJ2ZXIpO1xuICAgICAgICByZXR1cm4geyBjYXJkczogdGhpcy5wcm9wcy5zdG9yZS5nZXRDYXJkcygpIH07XG4gICAgfSxcblxuICAgIHJlbW92ZUNhcmQ6IGZ1bmN0aW9uIHJlbW92ZUNhcmQoaXRlbUtleSkge1xuICAgICAgICB0aGlzLnByb3BzLnJlbW92ZUNhcmQoaXRlbUtleSk7XG4gICAgfSxcblxuICAgIGJ1aWxkQ2FyZHM6IGZ1bmN0aW9uIGJ1aWxkQ2FyZHMoY2FyZHMpIHtcblxuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICB2YXIgbGF5b3V0cyA9IHsgbGc6IFtdLCBtZDogW10sIHNtOiBbXSwgeHM6IFtdLCB4eHM6IFtdIH07XG4gICAgICAgIHZhciBpdGVtcyA9IFtdO1xuICAgICAgICB2YXIgYWRkaXRpb25hbE5hbWVzcGFjZXMgPSBbXTtcbiAgICAgICAgdmFyIHJhbmQgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB2YXIgc2F2ZWRMYXlvdXRzID0gdGhpcy5wcm9wcy5zdG9yZS5nZXRVc2VyUHJlZmVyZW5jZSgnTGF5b3V0Jyk7XG4gICAgICAgIHZhciBidWlsZExheW91dCA9IGZ1bmN0aW9uIGJ1aWxkTGF5b3V0KGNsYXNzT2JqZWN0LCBpdGVtS2V5LCBpdGVtLCB4LCB5KSB7XG4gICAgICAgICAgICB2YXIgbGF5b3V0ID0gY2xhc3NPYmplY3QuZ2V0R3JpZExheW91dCh4LCB5KTtcbiAgICAgICAgICAgIGxheW91dFsnaGFuZGxlJ10gPSAnaDQnO1xuICAgICAgICAgICAgaWYgKGl0ZW1bJ2dyaWRIYW5kbGUnXSkge1xuICAgICAgICAgICAgICAgIGxheW91dFsnaGFuZGxlJ10gPSBpdGVtWydncmlkSGFuZGxlJ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXlvdXRbJ2knXSA9IGl0ZW1LZXk7XG4gICAgICAgICAgICByZXR1cm4gbGF5b3V0O1xuICAgICAgICB9O1xuICAgICAgICBjYXJkcy5tYXAoKGZ1bmN0aW9uIChpdGVtKSB7XG5cbiAgICAgICAgICAgIHZhciBwYXJ0cyA9IGl0ZW0uY29tcG9uZW50Q2xhc3Muc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgdmFyIGNsYXNzTlMgPSBwYXJ0c1swXTtcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBwYXJ0c1sxXTtcbiAgICAgICAgICAgIHZhciBjbGFzc09iamVjdDtcbiAgICAgICAgICAgIGlmIChnbG9iYWxbY2xhc3NOU10gJiYgZ2xvYmFsW2NsYXNzTlNdW2NsYXNzTmFtZV0pIHtcbiAgICAgICAgICAgICAgICBjbGFzc09iamVjdCA9IGdsb2JhbFtjbGFzc05TXVtjbGFzc05hbWVdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIWdsb2JhbFtjbGFzc05TXSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsTmFtZXNwYWNlcy5wdXNoKGNsYXNzTlMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcHJvcHMgPSBfZXh0ZW5kcyh7fSwgaXRlbS5wcm9wcyk7XG4gICAgICAgICAgICB2YXIgaXRlbUtleSA9IHByb3BzWydrZXknXSA9IGl0ZW1bJ2lkJ10gfHwgJ2l0ZW1fJyArIGluZGV4O1xuICAgICAgICAgICAgcHJvcHMucmVmID0gaXRlbUtleTtcbiAgICAgICAgICAgIHByb3BzLnB5ZGlvID0gdGhpcy5wcm9wcy5weWRpbztcbiAgICAgICAgICAgIHByb3BzLm9uQ2xvc2VBY3Rpb24gPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2FyZChpdGVtS2V5KTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBwcm9wcy5wcmVmZXJlbmNlc1Byb3ZpZGVyID0gdGhpcy5wcm9wcy5zdG9yZTtcbiAgICAgICAgICAgIHZhciBkZWZhdWx0WCA9IDAsXG4gICAgICAgICAgICAgICAgZGVmYXVsdFkgPSAwO1xuICAgICAgICAgICAgaWYgKGl0ZW0uZGVmYXVsdFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdFggPSBpdGVtLmRlZmF1bHRQb3NpdGlvbi54O1xuICAgICAgICAgICAgICAgIGRlZmF1bHRZID0gaXRlbS5kZWZhdWx0UG9zaXRpb24ueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkZWZhdWx0TGF5b3V0ID0gYnVpbGRMYXlvdXQoY2xhc3NPYmplY3QsIGl0ZW1LZXksIGl0ZW0sIGRlZmF1bHRYLCBkZWZhdWx0WSk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGJyZWFrcG9pbnQgaW4gbGF5b3V0cykge1xuICAgICAgICAgICAgICAgIGlmICghbGF5b3V0cy5oYXNPd25Qcm9wZXJ0eShicmVha3BvaW50KSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgdmFyIGJyZWFrTGF5b3V0ID0gbGF5b3V0c1ticmVha3BvaW50XTtcbiAgICAgICAgICAgICAgICAvLyBGaW5kIGNvcnJlc3BvbmRpbmcgZWxlbWVudCBpbiBwcmVmZXJlbmNlXG4gICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nO1xuICAgICAgICAgICAgICAgIGlmIChzYXZlZExheW91dHMgJiYgc2F2ZWRMYXlvdXRzW2JyZWFrcG9pbnRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVkTGF5b3V0c1ticmVha3BvaW50XS5tYXAoZnVuY3Rpb24gKGdyaWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZERhdGFbJ2knXSA9PSBpdGVtS2V5ICYmIGdyaWREYXRhWydoJ10gPT0gZGVmYXVsdExheW91dFsnaCddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmcgPSBncmlkRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAgICAgICAgICAgICBicmVha0xheW91dC5wdXNoKGV4aXN0aW5nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGVmYXVsdExheW91dHMgJiYgaXRlbS5kZWZhdWx0TGF5b3V0c1ticmVha3BvaW50XSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3J0TGF5b3V0ID0gYnVpbGRMYXlvdXQoY2xhc3NPYmplY3QsIGl0ZW1LZXksIGl0ZW0sIGl0ZW0uZGVmYXVsdExheW91dHNbYnJlYWtwb2ludF0ueCwgaXRlbS5kZWZhdWx0TGF5b3V0c1ticmVha3BvaW50XS55KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtMYXlvdXQucHVzaChjcnRMYXlvdXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrTGF5b3V0LnB1c2goZGVmYXVsdExheW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIGl0ZW1zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChjbGFzc09iamVjdCwgcHJvcHMpKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgaWYgKGFkZGl0aW9uYWxOYW1lc3BhY2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fYmxvY2tMYXlvdXRTYXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIFJlc291cmNlc01hbmFnZXIubG9hZENsYXNzZXNBbmRBcHBseShhZGRpdGlvbmFsTmFtZXNwYWNlcywgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgYWRkaXRpb25hbE5hbWVzcGFjZXNMb2FkZWQ6IGFkZGl0aW9uYWxOYW1lc3BhY2VzIH0sIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Jsb2NrTGF5b3V0U2F2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgY2FyZHM6IGl0ZW1zLCBsYXlvdXRzOiBsYXlvdXRzIH07XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2J1aWxkQ2FyZHMgPSB0aGlzLmJ1aWxkQ2FyZHModGhpcy5zdGF0ZS5jYXJkcyk7XG5cbiAgICAgICAgdmFyIGNhcmRzID0gX2J1aWxkQ2FyZHMuY2FyZHM7XG4gICAgICAgIHZhciBsYXlvdXRzID0gX2J1aWxkQ2FyZHMubGF5b3V0cztcblxuICAgICAgICB2YXIgUmVzcG9uc2l2ZUdyaWRMYXlvdXQgPSBXaWR0aFByb3ZpZGVyKFJlc3BvbnNpdmUpO1xuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFJlc3BvbnNpdmVHcmlkTGF5b3V0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Rhc2hib2FyZC1sYXlvdXQnLFxuICAgICAgICAgICAgICAgIGNvbHM6IHRoaXMucHJvcHMuY29scyB8fCB7IGxnOiAxMCwgbWQ6IDgsIHNtOiA4LCB4czogNCwgeHhzOiAyIH0sXG4gICAgICAgICAgICAgICAgbGF5b3V0czogbGF5b3V0cyxcbiAgICAgICAgICAgICAgICByb3dIZWlnaHQ6IDUsXG4gICAgICAgICAgICAgICAgb25MYXlvdXRDaGFuZ2U6IHRoaXMub25MYXlvdXRDaGFuZ2UsXG4gICAgICAgICAgICAgICAgaXNEcmFnZ2FibGU6ICF0aGlzLnByb3BzLmRpc2FibGVEcmFnLFxuICAgICAgICAgICAgICAgIHN0eWxlOiB0aGlzLnByb3BzLnN0eWxlLFxuICAgICAgICAgICAgICAgIGF1dG9TaXplOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhcmRzXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcblxudmFyIER5bmFtaWNHcmlkID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnRHluYW1pY0dyaWQnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHN0b3JlTmFtZXNwYWNlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIGJ1aWxkZXJOYW1lc3BhY2VzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgICAgIGRlZmF1bHRDYXJkczogUmVhY3QuUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBweWRpbzogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoUHlkaW8pLFxuICAgICAgICBkaXNhYmxlRHJhZzogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIGRpc2FibGVFZGl0OiBSZWFjdC5Qcm9wVHlwZXMuYm9vbFxuICAgIH0sXG5cbiAgICByZW1vdmVDYXJkOiBmdW5jdGlvbiByZW1vdmVDYXJkKGNhcmRJZCkge1xuXG4gICAgICAgIHRoaXMuc3RhdGUuc3RvcmUucmVtb3ZlQ2FyZChjYXJkSWQpO1xuICAgIH0sXG5cbiAgICBhZGRDYXJkOiBmdW5jdGlvbiBhZGRDYXJkKGNhcmREZWZpbml0aW9uKSB7XG5cbiAgICAgICAgdGhpcy5zdGF0ZS5zdG9yZS5hZGRDYXJkKGNhcmREZWZpbml0aW9uKTtcbiAgICB9LFxuXG4gICAgcmVzZXRDYXJkc0FuZExheW91dDogZnVuY3Rpb24gcmVzZXRDYXJkc0FuZExheW91dCgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdG9yZS5zYXZlVXNlclByZWZlcmVuY2UoJ0xheW91dCcsIG51bGwpO1xuICAgICAgICB0aGlzLnN0YXRlLnN0b3JlLnNldENhcmRzKHRoaXMucHJvcHMuZGVmYXVsdENhcmRzKTtcbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHZhciBzdG9yZSA9IG5ldyBfU3RvcmUyWydkZWZhdWx0J10odGhpcy5wcm9wcy5zdG9yZU5hbWVzcGFjZSwgdGhpcy5wcm9wcy5kZWZhdWx0Q2FyZHMsIHRoaXMucHJvcHMucHlkaW8pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWRpdE1vZGU6IGZhbHNlLFxuICAgICAgICAgICAgc3RvcmU6IHN0b3JlXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHRvZ2dsZUVkaXRNb2RlOiBmdW5jdGlvbiB0b2dnbGVFZGl0TW9kZSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVkaXRNb2RlOiAhdGhpcy5zdGF0ZS5lZGl0TW9kZSB9KTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICAgIHZhciBtb25pdG9yV2lkZ2V0RWRpdGluZyA9IChmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgd2lkZ2V0RWRpdGluZzogc3RhdHVzIH0pO1xuICAgICAgICB9KS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHZhciBidWlsZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5idWlsZGVyTmFtZXNwYWNlcyAmJiB0aGlzLnN0YXRlLmVkaXRNb2RlKSB7XG4gICAgICAgICAgICBidWlsZGVyID0gUmVhY3QuY3JlYXRlRWxlbWVudChfR3JpZEJ1aWxkZXIyWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdhZG1pbi1oZWxwZXItcGFuZWwnLFxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZXM6IHRoaXMucHJvcHMuYnVpbGRlck5hbWVzcGFjZXMsXG4gICAgICAgICAgICAgICAgb25DcmVhdGVDYXJkOiB0aGlzLmFkZENhcmQsXG4gICAgICAgICAgICAgICAgb25SZXNldExheW91dDogdGhpcy5yZXNldENhcmRzQW5kTGF5b3V0LFxuICAgICAgICAgICAgICAgIG9uRWRpdFN0YXR1c0NoYW5nZTogbW9uaXRvcldpZGdldEVkaXRpbmcsXG4gICAgICAgICAgICAgICAgZ2V0TWVzc2FnZTogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/ICdhanhwX2FkbWluJyA6IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5wcm9wcy5nZXRNZXNzYWdlKGlkLCBucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHByb3BTdHlsZSA9IHRoaXMucHJvcHMuc3R5bGUgfHwge307XG4gICAgICAgIHZhciByZ2xTdHlsZSA9IHRoaXMucHJvcHMucmdsU3R5bGUgfHwge307XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcy5zdHlsZSwgeyB3aWR0aDogJzEwMCUnLCBmbGV4OiAnMScgfSksIGNsYXNzTmFtZTogdGhpcy5zdGF0ZS5lZGl0TW9kZSA/IFwiYnVpbGRlci1vcGVuXCIgOiBcIlwiIH0sXG4gICAgICAgICAgICAhdGhpcy5wcm9wcy5kaXNhYmxlRWRpdCAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcG9zaXRpb246ICdhYnNvbHV0ZScsIGJvdHRvbTogMzAsIHJpZ2h0OiAxOCwgekluZGV4OiAxMSB9IH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChNYXRlcmlhbFVJLkZsb2F0aW5nQWN0aW9uQnV0dG9uLCB7XG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgnaG9tZS40OScpLFxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnRvZ2dsZUVkaXRNb2RlLFxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiB0aGlzLnN0YXRlLmVkaXRNb2RlID8gXCJpY29uLW9rXCIgOiBcIm1kaSBtZGktcGVuY2lsXCIsXG4gICAgICAgICAgICAgICAgICAgIG1pbmk6IHRoaXMuc3RhdGUuZWRpdE1vZGUsXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0aGlzLnN0YXRlLmVkaXRNb2RlICYmIHRoaXMuc3RhdGUud2lkZ2V0RWRpdGluZ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgYnVpbGRlcixcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdob21lLWRhc2hib2FyZCcsIHN0eWxlOiB7IGhlaWdodDogJzEwMCUnIH0gfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENhcmRzR3JpZCwge1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlRHJhZzogdGhpcy5wcm9wcy5kaXNhYmxlRHJhZyxcbiAgICAgICAgICAgICAgICAgICAgY29sczogdGhpcy5wcm9wcy5jb2xzLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZTogdGhpcy5zdGF0ZS5zdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHJnbFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICBweWRpbzogdGhpcy5wcm9wcy5weWRpbyxcbiAgICAgICAgICAgICAgICAgICAgZWRpdE1vZGU6IHRoaXMuc3RhdGUuZWRpdE1vZGUsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUNhcmQ6IHRoaXMucmVtb3ZlQ2FyZFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gRHluYW1pY0dyaWQgPSBQeWRpb0NvbnRleHRDb25zdW1lcihEeW5hbWljR3JpZCk7XG5leHBvcnRzWydkZWZhdWx0J10gPSBEeW5hbWljR3JpZDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgUHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX1B5ZGlvJHJlcXVpcmVMaWIgPSBQeWRpby5yZXF1aXJlTGliKCdib290Jyk7XG5cbnZhciBQeWRpb0NvbnRleHRDb25zdW1lciA9IF9QeWRpbyRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xudmFyIEFzeW5jQ29tcG9uZW50ID0gX1B5ZGlvJHJlcXVpcmVMaWIuQXN5bmNDb21wb25lbnQ7XG5cbnZhciBHcmlkQnVpbGRlciA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0dyaWRCdWlsZGVyJyxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBuYW1lc3BhY2VzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgICAgIG9uQ3JlYXRlQ2FyZDogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIG9uRWRpdFN0YXR1c0NoYW5nZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmNcbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4OiAwLFxuICAgICAgICAgICAgYXZhaWxhYmxlV2lkZ2V0czogdGhpcy5saXN0QXZhaWxhYmxlV2lkZ2V0cygpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGxpc3RBdmFpbGFibGVXaWRnZXRzOiBmdW5jdGlvbiBsaXN0QXZhaWxhYmxlV2lkZ2V0cygpIHtcbiAgICAgICAgdmFyIHNlY29uZFBhc3MgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1swXTtcblxuICAgICAgICB2YXIgd2lkZ2V0cyA9IFtdO1xuICAgICAgICB2YXIgYWRkaXRpb25hbE5hbWVzcGFjZXMgPSBbXTtcbiAgICAgICAgdGhpcy5wcm9wcy5uYW1lc3BhY2VzLm1hcChmdW5jdGlvbiAobnMpIHtcbiAgICAgICAgICAgIGlmICghZ2xvYmFsW25zXSkge1xuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxOYW1lc3BhY2VzLnB1c2gobnMpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gZ2xvYmFsW25zXSkge1xuICAgICAgICAgICAgICAgIGlmIChnbG9iYWxbbnNdLmhhc093blByb3BlcnR5KGspKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRDbGFzcyA9IGdsb2JhbFtuc11ba107XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRDbGFzcy5oYXNCdWlsZGVyRmllbGRzICYmIHdpZGdldENsYXNzLmhhc0J1aWxkZXJGaWVsZHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKHsgcmVhY3RDbGFzczogd2lkZ2V0Q2xhc3MsIGZ1bGxOYW1lOiBucyArICcuJyArIHdpZGdldENsYXNzLmRpc3BsYXlOYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxOYW1lc3BhY2VzLmxlbmd0aCAmJiAhc2Vjb25kUGFzcykge1xuICAgICAgICAgICAgUmVzb3VyY2VzTWFuYWdlci5sb2FkQ2xhc3Nlc0FuZEFwcGx5KGFkZGl0aW9uYWxOYW1lc3BhY2VzLCAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVXaWRnZXRzOiB0aGlzLmxpc3RBdmFpbGFibGVXaWRnZXRzKHRydWUpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2lkZ2V0cztcbiAgICB9LFxuXG4gICAgb25Ecm9wRG93bkNoYW5nZTogZnVuY3Rpb24gb25Ecm9wRG93bkNoYW5nZShldmVudCwgaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZXMgPSB7fTtcbiAgICAgICAgaWYgKGluZGV4ICE9IDApIHtcbiAgICAgICAgICAgIGl0ZW0ucGF5bG9hZFsncmVhY3RDbGFzcyddLmdldEJ1aWxkZXJGaWVsZHMoKS5tYXAoZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgICAgICBpZiAoZlsnZGVmYXVsdCddKSBkZWZhdWx0VmFsdWVzW2YubmFtZV0gPSBmWydkZWZhdWx0J107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkVkaXRTdGF0dXNDaGFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25FZGl0U3RhdHVzQ2hhbmdlKGluZGV4ICE9IDApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogaW5kZXgsXG4gICAgICAgICAgICBzZWxlY3RlZFdpZGdldDogaXRlbS5wYXlsb2FkLFxuICAgICAgICAgICAgY3VycmVudEZvcm1WYWx1ZXM6IGRlZmF1bHRWYWx1ZXNcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkVkaXRTdGF0dXNDaGFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25FZGl0U3RhdHVzQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRJbmRleDogMCB9KTtcbiAgICB9LFxuXG4gICAgb25Gb3JtVmFsdWVDaGFuZ2U6IGZ1bmN0aW9uIG9uRm9ybVZhbHVlQ2hhbmdlKG5ld1ZhbHVlcykge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgY3VycmVudEZvcm1WYWx1ZXM6IG5ld1ZhbHVlcyB9KTtcbiAgICB9LFxuXG4gICAgb25Gb3JtU3VibWl0OiBmdW5jdGlvbiBvbkZvcm1TdWJtaXQoKSB7XG4gICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnN0YXRlLmN1cnJlbnRGb3JtVmFsdWVzO1xuICAgICAgICB2YXIgc2VsZWN0ZWRXaWRnZXQgPSB0aGlzLnN0YXRlLnNlbGVjdGVkV2lkZ2V0O1xuICAgICAgICB2YXIgdGl0bGUgPSB2YWx1ZXMudGl0bGUgPyB2YWx1ZXMudGl0bGUgOiB2YWx1ZXMubGVnZW5kO1xuICAgICAgICBpZiAoIXRpdGxlKSB0aXRsZSA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRXaWRnZXRbJ3JlYWN0Q2xhc3MnXS5idWlsZGVyRGlzcGxheU5hbWU7XG4gICAgICAgIHRoaXMucHJvcHMub25DcmVhdGVDYXJkKHtcbiAgICAgICAgICAgIGNvbXBvbmVudENsYXNzOiBzZWxlY3RlZFdpZGdldC5mdWxsTmFtZSxcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIHByb3BzOiB2YWx1ZXNcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgfSxcblxuICAgIHJlc2V0TGF5b3V0OiBmdW5jdGlvbiByZXNldExheW91dCgpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5jb25maXJtKHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgnaG9tZS41MScpKSkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vblJlc2V0TGF5b3V0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBnZXRNZXNzYWdlID0gdGhpcy5wcm9wcy5nZXRNZXNzYWdlO1xuXG4gICAgICAgIHZhciBzZWxlY3Rvckl0ZW1zID0gW3sgcGF5bG9hZDogMCwgdGV4dDogZ2V0TWVzc2FnZSgnaG9tZS41MCcpIH1dLmNvbmNhdCh0aGlzLnN0YXRlLmF2YWlsYWJsZVdpZGdldHMubWFwKGZ1bmN0aW9uICh3LCBpbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgcGF5bG9hZDogdywgdGV4dDogd1sncmVhY3RDbGFzcyddLmJ1aWxkZXJEaXNwbGF5TmFtZSB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdmFyIHNlbGVjdG9yID0gUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdE1VSS5Ecm9wRG93bk1lbnUsIHtcbiAgICAgICAgICAgIG1lbnVJdGVtczogc2VsZWN0b3JJdGVtcyxcbiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRHJvcERvd25DaGFuZ2UsXG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4OiB0aGlzLnN0YXRlLnNlbGVjdGVkSW5kZXgsXG4gICAgICAgICAgICBhdXRvV2lkdGg6IGZhbHNlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnd2lkZ2V0LXR5cGUtc2VsZWN0b3InXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBmb3JtLCBhZGQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNlbGVjdGVkSW5kZXggIT0gMCkge1xuICAgICAgICAgICAgdmFyIGZpZWxkcyA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRXaWRnZXRbJ3JlYWN0Q2xhc3MnXS5nZXRCdWlsZGVyRmllbGRzKCk7XG4gICAgICAgICAgICB2YXIgZGVmYXVsdFZhbHVlcyA9IHt9O1xuICAgICAgICAgICAgZmllbGRzLm1hcChmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgIGlmIChmWydkZWZhdWx0J10pIGRlZmF1bHRWYWx1ZXNbZi5uYW1lXSA9IGZbJ2RlZmF1bHQnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuY3VycmVudEZvcm1WYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWVzID0gTGFuZ1V0aWxzLm1lcmdlT2JqZWN0c1JlY3Vyc2l2ZShkZWZhdWx0VmFsdWVzLCB0aGlzLnN0YXRlLmN1cnJlbnRGb3JtVmFsdWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvcm0gPSBSZWFjdC5jcmVhdGVFbGVtZW50KEFzeW5jQ29tcG9uZW50LCB7XG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlOiAnUHlkaW9Gb3JtJyxcbiAgICAgICAgICAgICAgICBjb21wb25lbnROYW1lOiAnRm9ybVBhbmVsJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiBmaWVsZHMsXG4gICAgICAgICAgICAgICAgZGVwdGg6IC0xLFxuICAgICAgICAgICAgICAgIHZhbHVlczogZGVmYXVsdFZhbHVlcyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZvcm1WYWx1ZUNoYW5nZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhZGQgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgdGV4dEFsaWduOiAnY2VudGVyJywgcGFkZGluZ0JvdHRvbTogMTAwIH0gfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0TVVJLlJhaXNlZEJ1dHRvbiwgeyBsYWJlbDogZ2V0TWVzc2FnZSgnaG9tZS41MicpLCBvbkNsaWNrOiB0aGlzLm9uRm9ybVN1Ym1pdCB9KSxcbiAgICAgICAgICAgICAgICAnwqAnLFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3RNVUkuUmFpc2VkQnV0dG9uLCB7IGxhYmVsOiBnZXRNZXNzYWdlKCc1NCcsICcnKSwgb25DbGljazogdGhpcy5jYW5jZWwgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFJlYWN0TVVJLlBhcGVyLFxuICAgICAgICAgICAgX2V4dGVuZHMoe30sIHRoaXMucHJvcHMsIHtcbiAgICAgICAgICAgICAgICB6RGVwdGg6IDMgfSksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdoMycsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBnZXRNZXNzYWdlKCdob21lLjUzJylcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnbGVnZW5kJyB9LFxuICAgICAgICAgICAgICAgIGdldE1lc3NhZ2UoJ2hvbWUuNTQnKSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdicicsIG51bGwpLFxuICAgICAgICAgICAgICAgIGdldE1lc3NhZ2UoJ2hvbWUuNTUnKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHNlbGVjdG9yLFxuICAgICAgICAgICAgZm9ybSxcbiAgICAgICAgICAgIGFkZCxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgYm90dG9tOiAzMCwgbGVmdDogMTAgfSB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3RNVUkuRmxhdEJ1dHRvbiwgeyBkaXNhYmxlZDogdGhpcy5zdGF0ZS5zZWxlY3RlZEluZGV4ICE9IDAsIGxhYmVsOiBnZXRNZXNzYWdlKCdob21lLjU2JyksIHNlY29uZGFyeTogdHJ1ZSwgb25DbGljazogdGhpcy5yZXNldExheW91dCB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxufSk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEdyaWRCdWlsZGVyID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoR3JpZEJ1aWxkZXIpO1xuZXhwb3J0c1snZGVmYXVsdCddID0gR3JpZEJ1aWxkZXI7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSB7XG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgc2hvd0Nsb3NlQWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgb25DbG9zZUFjdGlvbjogUmVhY3QuUHJvcFR5cGVzLmZ1bmNcbiAgICB9LFxuXG4gICAgZm9jdXNJdGVtOiBmdW5jdGlvbiBmb2N1c0l0ZW0oKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBmb2N1czogdHJ1ZSB9KTtcbiAgICB9LFxuXG4gICAgYmx1ckl0ZW06IGZ1bmN0aW9uIGJsdXJJdGVtKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXM6IGZhbHNlIH0pO1xuICAgIH0sXG5cbiAgICBtZXJnZVN0eWxlV2l0aEZvY3VzOiBmdW5jdGlvbiBtZXJnZVN0eWxlV2l0aEZvY3VzKCkge1xuICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIHRoaXMucHJvcHMuc3R5bGUsIHsgekluZGV4OiB0aGlzLnN0YXRlLmZvY3VzID8gMSA6IG51bGwgfSk7XG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTYXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU2F0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHsgZm9jdXM6IGZhbHNlLCBzaG93Q2xvc2VBY3Rpb246IGZhbHNlIH07XG4gICAgfSxcblxuICAgIHRvZ2dsZUVkaXRNb2RlOiBmdW5jdGlvbiB0b2dnbGVFZGl0TW9kZSgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogYXJndW1lbnRzWzBdO1xuXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd0Nsb3NlQWN0aW9uOiAhKHRoaXMuc3RhdGUgJiYgdGhpcy5zdGF0ZS5zaG93Q2xvc2VBY3Rpb24pIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dDbG9zZUFjdGlvbjogdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0Q2xvc2VCdXR0b246IGZ1bmN0aW9uIGdldENsb3NlQnV0dG9uKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSAmJiB0aGlzLnN0YXRlLnNob3dDbG9zZUFjdGlvbikge1xuICAgICAgICAgICAgdmFyIGNsb3NlQWN0aW9uID0gdGhpcy5wcm9wcy5vbkNsb3NlQWN0aW9uIHx8IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgdmFyIG92ZXJsYXlTdHlsZSA9IHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDAsMCwwLDAuNTMpJyxcbiAgICAgICAgICAgICAgICB6SW5kZXg6IDEwLFxuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogMCxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgICAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogb3ZlcmxheVN0eWxlIH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChNYXRlcmlhbFVJLkZsYXRCdXR0b24sIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHB5ZGlvLk1lc3NhZ2VIYXNoWydhanhwX2FkbWluLmhvbWUuNDgnXSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2FyZC1jbG9zZS1idXR0b24nLFxuICAgICAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiBjbG9zZUFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgY29sb3I6ICd3aGl0ZScgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RhdGljczoge1xuICAgICAgICBnZXRHcmlkTGF5b3V0OiBmdW5jdGlvbiBnZXRHcmlkTGF5b3V0KHgsIHkpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogeCB8fCAwLFxuICAgICAgICAgICAgICAgIHk6IHkgfHwgMCxcbiAgICAgICAgICAgICAgICB3OiB0aGlzLmdyaWRXaWR0aCB8fCA0LFxuICAgICAgICAgICAgICAgIGg6IHRoaXMuZ3JpZEhlaWdodCB8fCAxMixcbiAgICAgICAgICAgICAgICBpc1Jlc2l6YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGhhc0J1aWxkZXJGaWVsZHM6IGZ1bmN0aW9uIGhhc0J1aWxkZXJGaWVsZHMoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZGVyRmllbGRzID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICBnZXRCdWlsZGVyRmllbGRzOiBmdW5jdGlvbiBnZXRCdWlsZGVyRmllbGRzKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRlckZpZWxkcztcbiAgICAgICAgfVxuICAgIH1cblxufTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgU3RvcmUgPSAoZnVuY3Rpb24gKF9PYnNlcnZhYmxlKSB7XG4gICAgX2luaGVyaXRzKFN0b3JlLCBfT2JzZXJ2YWJsZSk7XG5cbiAgICAvKipcbiAgICAgKiBJbml0IGEgY2FyZCBzdG9yZVxuICAgICAqIEBwYXJhbSBwcmVmTmFtZXNwYWNlIE5hbWVzcGFjZSBmb3IgZ2V0dGluZy9zZXR0aW5nIHVzZXIgcHJlZmVyZW5jZXNcbiAgICAgKiBAcGFyYW0gZGVmYXVsdENhcmRzIEFycmF5IG9mIGNhcmRzIHRvIGJlIGRpc3BsYXllZCBieSBkZWZhdWx0XG4gICAgICovXG5cbiAgICBmdW5jdGlvbiBTdG9yZShwcmVmTmFtZXNwYWNlLCBkZWZhdWx0Q2FyZHMsIHB5ZGlvT2JqZWN0KSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdG9yZSk7XG5cbiAgICAgICAgX09ic2VydmFibGUuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fbmFtZXNwYWNlID0gcHJlZk5hbWVzcGFjZTtcbiAgICAgICAgdGhpcy5fcHlkaW8gPSBweWRpb09iamVjdDtcbiAgICAgICAgdGhpcy5fY2FyZHMgPSB0aGlzLmdldFVzZXJQcmVmZXJlbmNlKFwiQ2FyZHNcIik7XG4gICAgICAgIGlmICghdGhpcy5fY2FyZHMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhcmRzID0gZGVmYXVsdENhcmRzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgU3RvcmUucHJvdG90eXBlLmdldFVzZXJQcmVmZXJlbmNlID0gZnVuY3Rpb24gZ2V0VXNlclByZWZlcmVuY2UocHJlZk5hbWUpIHtcbiAgICAgICAgdmFyIHByZWZLZXkgPSB0aGlzLl9uYW1lc3BhY2UgKyBwcmVmTmFtZTtcbiAgICAgICAgdmFyIGd1aVByZWZzID0gdGhpcy5fcHlkaW8udXNlci5nZXRQcmVmZXJlbmNlKCdndWlfcHJlZmVyZW5jZXMnLCB0cnVlKTtcbiAgICAgICAgaWYgKGd1aVByZWZzICYmIGd1aVByZWZzW3ByZWZLZXldKSB7XG4gICAgICAgICAgICByZXR1cm4gZ3VpUHJlZnNbcHJlZktleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBTdG9yZS5wcm90b3R5cGUuc2F2ZVVzZXJQcmVmZXJlbmNlID0gZnVuY3Rpb24gc2F2ZVVzZXJQcmVmZXJlbmNlKHByZWZOYW1lLCBwcmVmVmFsdWUpIHtcbiAgICAgICAgdmFyIHByZWZLZXkgPSB0aGlzLl9uYW1lc3BhY2UgKyBwcmVmTmFtZTtcbiAgICAgICAgdmFyIGd1aVByZWZzID0gdGhpcy5fcHlkaW8udXNlci5nZXRQcmVmZXJlbmNlKCdndWlfcHJlZmVyZW5jZXMnLCB0cnVlKTtcbiAgICAgICAgaWYgKCFndWlQcmVmcykgZ3VpUHJlZnMgPSB7fTtcbiAgICAgICAgZ3VpUHJlZnNbcHJlZktleV0gPSBwcmVmVmFsdWU7XG4gICAgICAgIHRoaXMuX3B5ZGlvLnVzZXIuc2V0UHJlZmVyZW5jZSgnZ3VpX3ByZWZlcmVuY2VzJywgZ3VpUHJlZnMsIHRydWUpO1xuICAgICAgICB0aGlzLl9weWRpby51c2VyLnNhdmVQcmVmZXJlbmNlKCdndWlfcHJlZmVyZW5jZXMnKTtcbiAgICB9O1xuXG4gICAgU3RvcmUucHJvdG90eXBlLnNhdmVDYXJkcyA9IGZ1bmN0aW9uIHNhdmVDYXJkcyhjYXJkcykge1xuICAgICAgICB0aGlzLnNhdmVVc2VyUHJlZmVyZW5jZSgnQ2FyZHMnLCBjYXJkcyk7XG4gICAgfTtcblxuICAgIFN0b3JlLnByb3RvdHlwZS5yZXNldENhcmRzID0gZnVuY3Rpb24gcmVzZXRDYXJkcygpIHtcbiAgICAgICAgdGhpcy5zYXZlVXNlclByZWZlcmVuY2UoJ0NhcmRzJywgbnVsbCk7XG4gICAgfTtcblxuICAgIFN0b3JlLnByb3RvdHlwZS5zZXRDYXJkcyA9IGZ1bmN0aW9uIHNldENhcmRzKG5ld0NhcmRzKSB7XG4gICAgICAgIHRoaXMuX2NhcmRzID0gbmV3Q2FyZHM7XG4gICAgICAgIHRoaXMubm90aWZ5KFwiY2FyZHNcIiwgdGhpcy5fY2FyZHMpO1xuICAgICAgICB0aGlzLnNhdmVDYXJkcyhuZXdDYXJkcyk7XG4gICAgfTtcblxuICAgIFN0b3JlLnByb3RvdHlwZS5nZXRDYXJkcyA9IGZ1bmN0aW9uIGdldENhcmRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2FyZHM7XG4gICAgfTtcblxuICAgIFN0b3JlLnByb3RvdHlwZS5yZW1vdmVDYXJkID0gZnVuY3Rpb24gcmVtb3ZlQ2FyZChjYXJkSWQpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICAgIHZhciBjdXJyZW50Q2FyZHMgPSB0aGlzLmdldENhcmRzKCk7XG4gICAgICAgIGN1cnJlbnRDYXJkcy5tYXAoZnVuY3Rpb24gKGNhcmQsIGFycmF5SW5kZXgpIHtcbiAgICAgICAgICAgIGlmIChjYXJkLmlkID09IGNhcmRJZCkgaW5kZXggPSBhcnJheUluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NhcmQgSUQgbm90IGZvdW5kLCB0aGlzIGlzIHN0cmFuZ2UuJywgY2FyZElkKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbmV3Q2FyZHM7XG4gICAgICAgIGlmIChpbmRleCA9PSAwKSBuZXdDYXJkcyA9IGN1cnJlbnRDYXJkcy5zbGljZSgxKTtlbHNlIGlmIChpbmRleCA9PSBjdXJyZW50Q2FyZHMubGVuZ3RoIC0gMSkgbmV3Q2FyZHMgPSBjdXJyZW50Q2FyZHMuc2xpY2UoMCwgLTEpO2Vsc2UgbmV3Q2FyZHMgPSBjdXJyZW50Q2FyZHMuc2xpY2UoMCwgaW5kZXgpLmNvbmNhdChjdXJyZW50Q2FyZHMuc2xpY2UoaW5kZXggKyAxKSk7XG4gICAgICAgIHRoaXMuc2V0Q2FyZHMobmV3Q2FyZHMpO1xuICAgIH07XG5cbiAgICBTdG9yZS5wcm90b3R5cGUuY3JlYXRlQ2FyZElkID0gZnVuY3Rpb24gY3JlYXRlQ2FyZElkKGNhcmREZWZpbml0aW9uKSB7XG4gICAgICAgIHZhciByYW5kb21pemUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTtcblxuICAgICAgICB2YXIgaWQgPSBMYW5nVXRpbHMuY29tcHV0ZVN0cmluZ1NsdWcoY2FyZERlZmluaXRpb25bJ3RpdGxlJ10pO1xuICAgICAgICBpZiAocmFuZG9taXplKSB7XG4gICAgICAgICAgICBpZCArPSAnLScgKyBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFscmVhZHlFeGlzdHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY2FyZHMubWFwKChmdW5jdGlvbiAoY2FyZCkge1xuICAgICAgICAgICAgaWYgKGNhcmQuaWQgPT0gaWQpIGFscmVhZHlFeGlzdHMgPSB0cnVlO1xuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgaWYgKGFscmVhZHlFeGlzdHMpIHtcbiAgICAgICAgICAgIGlkID0gdGhpcy5jcmVhdGVDYXJkSWQoY2FyZERlZmluaXRpb24sIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9O1xuXG4gICAgU3RvcmUucHJvdG90eXBlLmFkZENhcmQgPSBmdW5jdGlvbiBhZGRDYXJkKGNhcmREZWZpbml0aW9uKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coY2FyZERlZmluaXRpb24pO1xuXG4gICAgICAgIGNhcmREZWZpbml0aW9uWydpZCddID0gdGhpcy5jcmVhdGVDYXJkSWQoY2FyZERlZmluaXRpb24pO1xuICAgICAgICB0aGlzLnNldENhcmRzKHRoaXMuX2NhcmRzLmNvbmNhdChbY2FyZERlZmluaXRpb25dKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTdG9yZTtcbn0pKE9ic2VydmFibGUpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBTdG9yZTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlcXVpcmUgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgQ29tcG9uZW50ID0gX3JlcXVpcmUuQ29tcG9uZW50O1xudmFyIFByb3BUeXBlcyA9IF9yZXF1aXJlLlByb3BUeXBlcztcblxudmFyIF9yZXF1aXJlMiA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBGbGF0QnV0dG9uID0gX3JlcXVpcmUyLkZsYXRCdXR0b247XG5cbnZhciBfcmVxdWlyZTMgPSByZXF1aXJlKCdtYXRlcmlhbC11aS9zdHlsZXMnKTtcblxudmFyIG11aVRoZW1lYWJsZSA9IF9yZXF1aXJlMy5tdWlUaGVtZWFibGU7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChQeWRpb0NvbXBvbmVudCwgZGlzcGxheU5hbWUpIHtcbiAgICB2YXIgZ3JpZERpbWVuc2lvbiA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IHsgZ3JpZFdpZHRoOiA0LCBncmlkSGVpZ2h0OiAxMiB9IDogYXJndW1lbnRzWzJdO1xuICAgIHZhciBidWlsZGVyRmllbGRzID0gYXJndW1lbnRzLmxlbmd0aCA8PSAzIHx8IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogYXJndW1lbnRzWzNdO1xuXG4gICAgdmFyIG9yaWdpbmFsRGlzcGxheU5hbWUgPSBQeWRpb0NvbXBvbmVudC5kaXNwbGF5TmFtZSB8fCBQeWRpb0NvbXBvbmVudC5uYW1lO1xuICAgIFB5ZGlvQ29tcG9uZW50ID0gbXVpVGhlbWVhYmxlKCkoUHlkaW9Db21wb25lbnQpO1xuXG4gICAgdmFyIEdyaWRJdGVtID0gKGZ1bmN0aW9uIChfQ29tcG9uZW50KSB7XG4gICAgICAgIF9pbmhlcml0cyhHcmlkSXRlbSwgX0NvbXBvbmVudCk7XG5cbiAgICAgICAgZnVuY3Rpb24gR3JpZEl0ZW0ocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBHcmlkSXRlbSk7XG5cbiAgICAgICAgICAgIF9Db21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0geyBmb2N1czogZmFsc2UsIHNob3dDbG9zZUFjdGlvbjogZmFsc2UgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIEdyaWRJdGVtLnByb3RvdHlwZS5mb2N1c0l0ZW0gPSBmdW5jdGlvbiBmb2N1c0l0ZW0oKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgR3JpZEl0ZW0ucHJvdG90eXBlLmJsdXJJdGVtID0gZnVuY3Rpb24gYmx1ckl0ZW0oKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXM6IGZhbHNlIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEdyaWRJdGVtLnByb3RvdHlwZS5tZXJnZVN0eWxlV2l0aEZvY3VzID0gZnVuY3Rpb24gbWVyZ2VTdHlsZVdpdGhGb2N1cygpIHtcbiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcy5zdHlsZSwgeyB6SW5kZXg6IHRoaXMuc3RhdGUuZm9jdXMgPyAxIDogbnVsbCB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBHcmlkSXRlbS5wcm90b3R5cGUudG9nZ2xlRWRpdE1vZGUgPSBmdW5jdGlvbiB0b2dnbGVFZGl0TW9kZSgpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMCB8fCBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IGFyZ3VtZW50c1swXTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd0Nsb3NlQWN0aW9uOiAhKHRoaXMuc3RhdGUgJiYgdGhpcy5zdGF0ZS5zaG93Q2xvc2VBY3Rpb24pIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd0Nsb3NlQWN0aW9uOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBHcmlkSXRlbS5wcm90b3R5cGUuZ2V0Q2xvc2VCdXR0b24gPSBmdW5jdGlvbiBnZXRDbG9zZUJ1dHRvbigpIHtcbiAgICAgICAgICAgIHZhciBjbG9zZUFjdGlvbiA9IHRoaXMucHJvcHMub25DbG9zZUFjdGlvbiB8fCBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIHZhciBvdmVybGF5U3R5bGUgPSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgwLDAsMCwwLjUzKScsXG4gICAgICAgICAgICAgICAgekluZGV4OiAxMCxcbiAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICAgICAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IG92ZXJsYXlTdHlsZSB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRmxhdEJ1dHRvbiwge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy5weWRpby5NZXNzYWdlSGFzaFsnYWp4cF9hZG1pbi5ob21lLjQ4J10sXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NhcmQtY2xvc2UtYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogY2xvc2VBY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7IGNvbG9yOiAnd2hpdGUnIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBHcmlkSXRlbS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgICAgdmFyIHByb3BzID0gX2V4dGVuZHMoe30sIHRoaXMucHJvcHMsIHtcbiAgICAgICAgICAgICAgICBzdHlsZTogdGhpcy5tZXJnZVN0eWxlV2l0aEZvY3VzKCksXG4gICAgICAgICAgICAgICAgY2xvc2VCdXR0b246IHRoaXMuc3RhdGUuc2hvd0Nsb3NlQWN0aW9uID8gdGhpcy5nZXRDbG9zZUJ1dHRvbigpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvbkZvY3VzSXRlbTogdGhpcy5mb2N1c0l0ZW0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkJsdXJJdGVtOiB0aGlzLmJsdXJJdGVtLmJpbmQodGhpcylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUHlkaW9Db21wb25lbnQsIHByb3BzKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gR3JpZEl0ZW07XG4gICAgfSkoQ29tcG9uZW50KTtcblxuICAgIEdyaWRJdGVtLnByb3BUeXBlcyA9IHtcbiAgICAgICAgb25DbG9zZUFjdGlvbjogUHJvcFR5cGVzLmZ1bmNcbiAgICB9O1xuXG4gICAgR3JpZEl0ZW0uZGlzcGxheU5hbWUgPSBvcmlnaW5hbERpc3BsYXlOYW1lO1xuICAgIEdyaWRJdGVtLmJ1aWxkZXJEaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuXG4gICAgR3JpZEl0ZW0uZ2V0R3JpZExheW91dCA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB4OiB4IHx8IDAsXG4gICAgICAgICAgICB5OiB5IHx8IDAsXG4gICAgICAgICAgICB3OiBncmlkRGltZW5zaW9uLmdyaWRXaWR0aCB8fCA0LFxuICAgICAgICAgICAgaDogZ3JpZERpbWVuc2lvbi5ncmlkSGVpZ2h0IHx8IDEyLFxuICAgICAgICAgICAgaXNSZXNpemFibGU6IGZhbHNlXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIEdyaWRJdGVtLmhhc0J1aWxkZXJGaWVsZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBidWlsZGVyRmllbGRzICE9PSB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICBHcmlkSXRlbS5nZXRCdWlsZGVyRmllbGRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gYnVpbGRlckZpZWxkcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIEdyaWRJdGVtO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbi8qKlxuICogVHdvIGNvbHVtbnMgbGF5b3V0IHVzZWQgZm9yIFdvcmtzcGFjZXMgYW5kIFBsdWdpbnMgZWRpdG9yc1xuICovXG52YXIgUGFwZXJFZGl0b3JMYXlvdXQgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnUGFwZXJFZGl0b3JMYXlvdXQnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHRpdGxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFueSxcbiAgICAgICAgdGl0bGVBY3Rpb25CYXI6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYW55LFxuICAgICAgICBsZWZ0TmF2OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFueSxcbiAgICAgICAgY29udGVudEZpbGw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgY2xhc3NOYW1lOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICB0b2dnbGVNZW51OiBmdW5jdGlvbiB0b2dnbGVNZW51KCkge1xuICAgICAgICB2YXIgY3J0TGVmdE9wZW4gPSB0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuZm9yY2VMZWZ0T3BlbjtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvcmNlTGVmdE9wZW46ICFjcnRMZWZ0T3BlbiB9KTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG5cbiAgICAgICAgdmFyIHN0eWxlcyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzQ1NUE2NCcsXG4gICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnMnB4IDJweCAwIDAnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRpdGxlSDI6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJ3doaXRlJyxcbiAgICAgICAgICAgICAgICBmbGV4OiAxLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiAyNixcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAnMTRweCAxMnB4IDEwcHgnLFxuICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogMCxcbiAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAnbm93cmFwJyxcbiAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICAgICAgICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGl0bGVCYXI6IHtcbiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IDE1LFxuICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAxNlxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwicGFwZXItZWRpdG9yLWNvbnRlbnQgbGF5b3V0LWZpbGwgdmVydGljYWwtbGF5b3V0XCIgKyAodGhpcy5wcm9wcy5jbGFzc05hbWUgPyAnICcgKyB0aGlzLnByb3BzLmNsYXNzTmFtZSA6ICcnKSB9LFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdwYXBlci1lZGl0b3ItdGl0bGUnLCBzdHlsZTogc3R5bGVzLnRpdGxlIH0sXG4gICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdoMicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy50aXRsZUgyIH0sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICcgJyxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnbGVmdC1waWNrZXItdG9nZ2xlJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuSWNvbkJ1dHRvbiwgeyBpY29uQ2xhc3NOYW1lOiAnaWNvbi1jYXJldC1kb3duJywgb25DbGljazogdGhpcy50b2dnbGVNZW51IH0pXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLnRpdGxlQmFyIH0sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMudGl0bGVBY3Rpb25CYXJcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdsYXlvdXQtZmlsbCBtYWluLWxheW91dC1uYXYtdG8tc3RhY2snIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5sZWZ0TmF2ICYmIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwicGFwZXItZWRpdG9yLWxlZnRcIiArICh0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuZm9yY2VMZWZ0T3BlbiA/ICcgcGlja2VyLW9wZW4nIDogJycpLCBvbkNsaWNrOiB0aGlzLnRvZ2dsZU1lbnUgfSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5sZWZ0TmF2XG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImxheW91dC1maWxsIHBhcGVyLWVkaXRvci1yaWdodFwiICsgKHRoaXMucHJvcHMuY29udGVudEZpbGwgPyAnIHZlcnRpY2FsLWxheW91dCcgOiAnJyksIHN0eWxlOiB0aGlzLnByb3BzLmNvbnRlbnRGaWxsID8ge30gOiB7IG92ZXJmbG93WTogJ2F1dG8nIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlblxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG59KTtcbi8qKlxuICogTmF2aWdhdGlvbiBzdWJoZWFkZXIgdXNlZCBieSBQYXBlckVkaXRvckxheW91dFxuICovXG52YXIgUGFwZXJFZGl0b3JOYXZIZWFkZXIgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnUGFwZXJFZGl0b3JOYXZIZWFkZXInLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGxhYmVsOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcIm11aS1zdWJoZWFkZXJcIiwgc3R5bGU6IHsgZm9udFNpemU6IDEzLCBmb250V2VpZ2h0OiA1MDAsIGNvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjI1KScsIGxpbmVIZWlnaHQ6ICc0OHB4JywgcGFkZGluZ0xlZnQ6IDE2IH0gfSxcbiAgICAgICAgICAgIHRoaXMucHJvcHMuY2hpbGRyZW4sXG4gICAgICAgICAgICB0aGlzLnByb3BzLmxhYmVsXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcbi8qKlxuICogTmF2aWdhdGlvbiBlbnRyeSB1c2VkIGJ5IFBhcGVyRWRpdG9yTGF5b3V0LlxuICovXG52YXIgUGFwZXJFZGl0b3JOYXZFbnRyeSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdQYXBlckVkaXRvck5hdkVudHJ5JyxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBrZXlOYW1lOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBvbkNsaWNrOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgICAgbGFiZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBzZWxlY3RlZEtleTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGlzTGFzdDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICAvLyBEcm9wIERvd24gRGF0YVxuICAgICAgICBkcm9wRG93bjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICBkcm9wRG93bkRhdGE6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICBkcm9wRG93bkNoYW5nZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBkcm9wRG93bkRlZmF1bHRJdGVtczogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5hcnJheVxuICAgIH0sXG5cbiAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkge1xuICAgICAgICB0aGlzLnByb3BzLm9uQ2xpY2sodGhpcy5wcm9wcy5rZXlOYW1lKTtcbiAgICB9LFxuXG4gICAgY2FwdHVyZURyb3BEb3duQ2xpY2s6IGZ1bmN0aW9uIGNhcHR1cmVEcm9wRG93bkNsaWNrKCkge1xuICAgICAgICBpZiAodGhpcy5wcmV2ZW50Q2xpY2spIHtcbiAgICAgICAgICAgIHRoaXMucHJldmVudENsaWNrID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm9wcy5vbkNsaWNrKHRoaXMucHJvcHMua2V5TmFtZSk7XG4gICAgfSxcblxuICAgIGRyb3BEb3duQ2hhbmdlOiBmdW5jdGlvbiBkcm9wRG93bkNoYW5nZShldmVudCwgaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgdGhpcy5wcmV2ZW50Q2xpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnByb3BzLmRyb3BEb3duQ2hhbmdlKGl0ZW0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuZHJvcERvd24gfHwgIXRoaXMucHJvcHMuZHJvcERvd25EYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdtZW51LWVudHJ5JyArICh0aGlzLnByb3BzLmtleU5hbWUgPT0gdGhpcy5wcm9wcy5zZWxlY3RlZEtleSA/ICcgbWVudS1lbnRyeS1zZWxlY3RlZCcgOiAnJykgKyAodGhpcy5wcm9wcy5pc0xhc3QgPyAnIGxhc3QnIDogJycpLFxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLm9uQ2xpY2sgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMubGFiZWxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkcm9wRG93biAmIGRyb3BEb3duRGF0YSBhcmUgbG9hZGVkXG4gICAgICAgIHZhciBtZW51SXRlbXNUcGwgPSBbeyB0ZXh0OiB0aGlzLnByb3BzLmxhYmVsLCBwYXlsb2FkOiAnLTEnIH1dO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5kcm9wRG93bkRlZmF1bHRJdGVtcykge1xuICAgICAgICAgICAgbWVudUl0ZW1zVHBsID0gbWVudUl0ZW1zVHBsLmNvbmNhdCh0aGlzLnByb3BzLmRyb3BEb3duRGVmYXVsdEl0ZW1zKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByb3BzLmRyb3BEb3duRGF0YS5mb3JFYWNoKGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgICAgICAgICBtZW51SXRlbXNUcGwucHVzaCh7IHRleHQ6IHYubGFiZWwsIHBheWxvYWQ6IHYgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgb25DbGljazogdGhpcy5jYXB0dXJlRHJvcERvd25DbGljaywgY2xhc3NOYW1lOiAnbWVudS1lbnRyeS1kcm9wZG93bicgKyAodGhpcy5wcm9wcy5rZXlOYW1lID09IHRoaXMucHJvcHMuc2VsZWN0ZWRLZXkgPyAnIG1lbnUtZW50cnktc2VsZWN0ZWQnIDogJycpICsgKHRoaXMucHJvcHMuaXNMYXN0ID8gJyBsYXN0JyA6ICcnKSB9LFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRHJvcERvd25NZW51LCB7XG4gICAgICAgICAgICAgICAgbWVudUl0ZW1zOiBtZW51SXRlbXNUcGwsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tZnVsbC13aWR0aCcsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHsgd2lkdGg6IDI1NiB9LFxuICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogZmFsc2UsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMuZHJvcERvd25DaGFuZ2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxufSk7XG5cbmV4cG9ydHMuUGFwZXJFZGl0b3JMYXlvdXQgPSBQYXBlckVkaXRvckxheW91dDtcbmV4cG9ydHMuUGFwZXJFZGl0b3JOYXZFbnRyeSA9IFBhcGVyRWRpdG9yTmF2RW50cnk7XG5leHBvcnRzLlBhcGVyRWRpdG9yTmF2SGVhZGVyID0gUGFwZXJFZGl0b3JOYXZIZWFkZXI7XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cblwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIHByb3BUeXBlcyA9IHtcbiAgICBub2RlOiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihBanhwTm9kZSkuaXNSZXF1aXJlZCxcbiAgICByZWdpc3RyeTogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoUmVnaXN0cnkpLmlzUmVxdWlyZWQsXG4gICAgZWRpdG9yRGF0YTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGljb246IFJlYWN0LlByb3BUeXBlcy5ib29sXG59O1xuXG52YXIgZGVmYXVsdFByb3BzID0ge1xuICAgIGljb246IGZhbHNlXG59O1xuXG52YXIgUmVhY3RFZGl0b3JPcGVuZXIgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoUmVhY3RFZGl0b3JPcGVuZXIsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gUmVhY3RFZGl0b3JPcGVuZXIocHJvcHMpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlYWN0RWRpdG9yT3BlbmVyKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMpO1xuXG4gICAgICAgIHZhciBub2RlID0gcHJvcHMubm9kZTtcbiAgICAgICAgdmFyIGVkaXRvckRhdGEgPSBwcm9wcy5lZGl0b3JEYXRhO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICByZWFkeTogZmFsc2VcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBSZWFjdEVkaXRvck9wZW5lci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIGVkaXRvckRhdGEgPSBfcHJvcHMuZWRpdG9yRGF0YTtcbiAgICAgICAgdmFyIHJlZ2lzdHJ5ID0gX3Byb3BzLnJlZ2lzdHJ5O1xuXG4gICAgICAgIHJlZ2lzdHJ5LmxvYWRFZGl0b3JSZXNvdXJjZXMoZWRpdG9yRGF0YS5yZXNvdXJjZXNNYW5hZ2VyLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0U3RhdGUoeyByZWFkeTogdHJ1ZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIFJlYWN0RWRpdG9yT3BlbmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBlZGl0b3JEYXRhID0gdGhpcy5wcm9wcy5lZGl0b3JEYXRhO1xuICAgICAgICB2YXIgcmVhZHkgPSB0aGlzLnN0YXRlLnJlYWR5O1xuXG4gICAgICAgIGlmICghcmVhZHkpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHZhciBFZGl0b3JDbGFzcyA9IG51bGw7XG4gICAgICAgIGlmICghKEVkaXRvckNsYXNzID0gRnVuY1V0aWxzLmdldEZ1bmN0aW9uQnlOYW1lKGVkaXRvckRhdGEuZWRpdG9yQ2xhc3MsIHdpbmRvdykpKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgXCJDYW5ub3QgZmluZCBlZGl0b3IgY29tcG9uZW50IChcIiArIGVkaXRvckRhdGEuZWRpdG9yQ2xhc3MgKyBcIikhXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXR0aW5nIEhPQyBvZiB0aGUgY2xhc3NcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRWRpdG9yQ2xhc3MuRWRpdG9yLCB0aGlzLnByb3BzKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFJlYWN0RWRpdG9yT3BlbmVyO1xufSkoUmVhY3QuQ29tcG9uZW50KTtcblxuUmVhY3RFZGl0b3JPcGVuZXIucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuUmVhY3RFZGl0b3JPcGVuZXIuZGVmYXVsdFByb3BzID0gZGVmYXVsdFByb3BzO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IFJlYWN0RWRpdG9yT3BlbmVyO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzW1wiZGVmYXVsdFwiXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdDbGlwYm9hcmRUZXh0RmllbGQnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGZsb2F0aW5nTGFiZWxUZXh0OiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgICAgIGlucHV0VmFsdWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGlucHV0Q2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBnZXRNZXNzYWdlOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgaW5wdXRDb3B5TWVzc2FnZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHsgY29weU1lc3NhZ2U6IG51bGwgfTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLmF0dGFjaENsaXBib2FyZCgpO1xuICAgIH0sXG4gICAgY29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICAgIHRoaXMuYXR0YWNoQ2xpcGJvYXJkKCk7XG4gICAgfSxcblxuICAgIGF0dGFjaENsaXBib2FyZDogZnVuY3Rpb24gYXR0YWNoQ2xpcGJvYXJkKCkge1xuICAgICAgICBpZiAodGhpcy5fY2xpcCkge1xuICAgICAgICAgICAgdGhpcy5fY2xpcC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnJlZnNbJ2NvcHktYnV0dG9uJ10pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jbGlwID0gbmV3IENsaXBib2FyZCh0aGlzLnJlZnNbJ2NvcHktYnV0dG9uJ10sIHtcbiAgICAgICAgICAgIHRleHQ6IChmdW5jdGlvbiAodHJpZ2dlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmlucHV0VmFsdWU7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9jbGlwLm9uKCdzdWNjZXNzJywgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjb3B5TWVzc2FnZTogdGhpcy5wcm9wcy5nZXRNZXNzYWdlKHRoaXMucHJvcHMuaW5wdXRDb3B5TWVzc2FnZSB8fCAnMTkyJykgfSwgdGhpcy5jbGVhckNvcHlNZXNzYWdlKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuX2NsaXAub24oJ2Vycm9yJywgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb3B5TWVzc2FnZTtcbiAgICAgICAgICAgIGlmIChnbG9iYWwubmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJNYWNcIikgPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb3B5TWVzc2FnZSA9IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgnMTQ0Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvcHlNZXNzYWdlID0gdGhpcy5wcm9wcy5nZXRNZXNzYWdlKCcxNDMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVmc1snaW5wdXQnXS5mb2N1cygpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGNvcHlNZXNzYWdlOiBjb3B5TWVzc2FnZSB9LCB0aGlzLmNsZWFyQ29weU1lc3NhZ2UpO1xuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgY2xlYXJDb3B5TWVzc2FnZTogZnVuY3Rpb24gY2xlYXJDb3B5TWVzc2FnZSgpIHtcbiAgICAgICAgZ2xvYmFsLnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjb3B5TWVzc2FnZTogJycgfSk7XG4gICAgICAgIH0pLmJpbmQodGhpcyksIDMwMDApO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgICAgICB2YXIgc2VsZWN0ID0gZnVuY3Rpb24gc2VsZWN0KGUpIHtcbiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5zZWxlY3QoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29weU1lc3NhZ2UgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb3B5TWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyIHNldEh0bWwgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IF9faHRtbDogdGhpcy5zdGF0ZS5jb3B5TWVzc2FnZSB9O1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGNvcHlNZXNzYWdlID0gUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBzdHlsZTogeyBjb2xvcjogJ3JnYmEoMCwwLDAsMC4yMyknIH0sIGNsYXNzTmFtZTogJ2NvcHktbWVzc2FnZScsIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiBzZXRIdG1sKCkgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYnV0dG9uU3R5bGUgPSBfZXh0ZW5kcyh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIHJpZ2h0OiAtOCxcbiAgICAgICAgICAgIGJvdHRvbTogMTMsXG4gICAgICAgICAgICBmb250U2l6ZTogMTUsXG4gICAgICAgICAgICBjb2xvcjogdGhpcy5wcm9wcy5idXR0b25Db2xvciB8fCAncmdiYSgwLCAxNTAsIDEzNiwgMC41MiknLFxuICAgICAgICAgICAgaGVpZ2h0OiAyNixcbiAgICAgICAgICAgIHdpZHRoOiAyNixcbiAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyOHB4JyxcbiAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzUwJSdcbiAgICAgICAgfSwgdGhpcy5wcm9wcy5idXR0b25TdHlsZSk7XG5cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTWF0ZXJpYWxVSS5UZXh0RmllbGQsIHtcbiAgICAgICAgICAgICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZWY6ICdpbnB1dCcsXG4gICAgICAgICAgICAgICAgICAgIGZsb2F0aW5nTGFiZWxUZXh0OiB0aGlzLnByb3BzLmZsb2F0aW5nTGFiZWxUZXh0LFxuICAgICAgICAgICAgICAgICAgICBmbG9hdGluZ0xhYmVsU3R5bGU6IHsgd2hpdGVTcGFjZTogJ25vd3JhcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lU2hvdzogdGhpcy5wcm9wcy51bmRlcmxpbmVTaG93LFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IHRoaXMucHJvcHMuaW5wdXRWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmlucHV0Q2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aUxpbmU6IHRoaXMucHJvcHMubXVsdGlMaW5lLFxuICAgICAgICAgICAgICAgICAgICByb3dzOiB0aGlzLnByb3BzLnJvd3MsXG4gICAgICAgICAgICAgICAgICAgIHJvd3NNYXg6IHRoaXMucHJvcHMucm93c01heCxcbiAgICAgICAgICAgICAgICAgICAgcmVhZE9ubHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHNlbGVjdCxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgbWFyZ2luVG9wOiAtMTAsIHdpZHRoOiAnOTIlJywgZm9udFNpemU6IDE0IH1cbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyByZWY6ICdjb3B5LWJ1dHRvbicsIHN0eWxlOiBidXR0b25TdHlsZSwgdGl0bGU6IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgnMTkxJyksIGNsYXNzTmFtZTogJ2NvcHktYnV0dG9uIG1kaSBtZGktY29udGVudC1jb3B5JyB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGNvcHlNZXNzYWdlXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzWydkZWZhdWx0J10gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdMYWJlbFdpdGhUaXAnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGxhYmVsOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBsYWJlbEVsZW1lbnQ6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIHRvb2x0aXA6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHRvb2x0aXBDbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgc3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3RcbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB7IHNob3c6IGZhbHNlIH07XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93OiB0cnVlIH0pO1xuICAgIH0sXG4gICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3c6IGZhbHNlIH0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMudG9vbHRpcCkge1xuICAgICAgICAgICAgdmFyIHRvb2x0aXBTdHlsZSA9IHt9O1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMubGFiZWwgfHwgdGhpcy5wcm9wcy5sYWJlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93KSB7XG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXBTdHlsZSA9IHsgYm90dG9tOiAtMTAsIHRvcDogJ2luaGVyaXQnIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b29sdGlwU3R5bGUgPSB7IHBvc2l0aW9uOiAncmVsYXRpdmUnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGxhYmVsID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2VsbGlwc2lzLWxhYmVsJyB9LFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmxhYmVsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5sYWJlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBsYWJlbCA9IHRoaXMucHJvcHMubGFiZWxFbGVtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHN0eWxlID0gdGhpcy5wcm9wcy5zdHlsZSB8fCB7IHBvc2l0aW9uOiAncmVsYXRpdmUnIH07XG5cbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICB7IG9uTW91c2VFbnRlcjogdGhpcy5zaG93LCBvbk1vdXNlTGVhdmU6IHRoaXMuaGlkZSwgc3R5bGU6IHN0eWxlLCBjbGFzc05hbWU6IHRoaXMucHJvcHMuY2xhc3NOYW1lIH0sXG4gICAgICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlbixcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0TVVJLlRvb2x0aXAsIHsgbGFiZWw6IHRoaXMucHJvcHMudG9vbHRpcCwgc3R5bGU6IHRvb2x0aXBTdHlsZSwgY2xhc3NOYW1lOiB0aGlzLnByb3BzLnRvb2x0aXBDbGFzc05hbWUsIHNob3c6IHRoaXMuc3RhdGUuc2hvdyB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5sYWJlbFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMubGFiZWxFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMubGFiZWxFbGVtZW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSk7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuLyoqXG4gKiBTaW1wbGUgTXVpUGFwZXIgd2l0aCBhIGZpZ3VyZSBhbmQgYSBsZWdlbmRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0c1snZGVmYXVsdCddID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnU2ltcGxlRmlndXJlQmFkZ2UnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGNvbG9ySW5kaWNhdG9yOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBmaWd1cmU6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICAgICAgbGVnZW5kOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nXG4gICAgfSxcblxuICAgIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29sb3JJbmRpY2F0b3I6ICcnXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFJlYWN0TVVJLlBhcGVyLFxuICAgICAgICAgICAgeyBzdHlsZTogeyBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywgbWFyZ2luTGVmdDogMTYgfSB9LFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2ZpZ3VyZS1iYWRnZScsIHN0eWxlOiB0aGlzLnByb3BzLmNvbG9ySW5kaWNhdG9yID8geyBib3JkZXJMZWZ0Q29sb3I6IHRoaXMucHJvcHMuY29sb3JJbmRpY2F0b3IgfSA6IHt9IH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnZmlndXJlJyB9LFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmZpZ3VyZVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnbGVnZW5kJyB9LFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmxlZ2VuZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG59KTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9saXN0U29ydGFibGVMaXN0ID0gcmVxdWlyZSgnLi9saXN0L1NvcnRhYmxlTGlzdCcpO1xuXG52YXIgX2xpc3RTb3J0YWJsZUxpc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbGlzdFNvcnRhYmxlTGlzdCk7XG5cbnZhciBfbGlzdFNpbXBsZUxpc3QgPSByZXF1aXJlKCcuL2xpc3QvU2ltcGxlTGlzdCcpO1xuXG52YXIgX2xpc3RTaW1wbGVMaXN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2xpc3RTaW1wbGVMaXN0KTtcblxudmFyIF9saXN0Tm9kZUxpc3RDdXN0b21Qcm92aWRlciA9IHJlcXVpcmUoJy4vbGlzdC9Ob2RlTGlzdEN1c3RvbVByb3ZpZGVyJyk7XG5cbnZhciBfbGlzdE5vZGVMaXN0Q3VzdG9tUHJvdmlkZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbGlzdE5vZGVMaXN0Q3VzdG9tUHJvdmlkZXIpO1xuXG52YXIgX2xpc3RMaXN0RW50cnkgPSByZXF1aXJlKCcuL2xpc3QvTGlzdEVudHJ5Jyk7XG5cbnZhciBfbGlzdExpc3RQYWdpbmF0b3IgPSByZXF1aXJlKCcuL2xpc3QvTGlzdFBhZ2luYXRvcicpO1xuXG52YXIgX2xpc3RMaXN0UGFnaW5hdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2xpc3RMaXN0UGFnaW5hdG9yKTtcblxudmFyIF9saXN0TWF0ZXJpYWxUYWJsZSA9IHJlcXVpcmUoJy4vbGlzdC9NYXRlcmlhbFRhYmxlJyk7XG5cbnZhciBfbGlzdE1hdGVyaWFsVGFibGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbGlzdE1hdGVyaWFsVGFibGUpO1xuXG52YXIgX3ZpZXdzVHJlZVZpZXcgPSByZXF1aXJlKCcuL3ZpZXdzL1RyZWVWaWV3Jyk7XG5cbnZhciBfZWxlbWVudHNMYWJlbFdpdGhUaXAgPSByZXF1aXJlKCcuL2VsZW1lbnRzL0xhYmVsV2l0aFRpcCcpO1xuXG52YXIgX2VsZW1lbnRzTGFiZWxXaXRoVGlwMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2VsZW1lbnRzTGFiZWxXaXRoVGlwKTtcblxudmFyIF9lbGVtZW50c1NpbXBsZUZpZ3VyZUJhZGdlID0gcmVxdWlyZSgnLi9lbGVtZW50cy9TaW1wbGVGaWd1cmVCYWRnZScpO1xuXG52YXIgX2VsZW1lbnRzU2ltcGxlRmlndXJlQmFkZ2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZWxlbWVudHNTaW1wbGVGaWd1cmVCYWRnZSk7XG5cbnZhciBfZWxlbWVudHNDbGlwYm9hcmRUZXh0RmllbGQgPSByZXF1aXJlKCcuL2VsZW1lbnRzL0NsaXBib2FyZFRleHRGaWVsZCcpO1xuXG52YXIgX2VsZW1lbnRzQ2xpcGJvYXJkVGV4dEZpZWxkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2VsZW1lbnRzQ2xpcGJvYXJkVGV4dEZpZWxkKTtcblxudmFyIF92aWV3c0VtcHR5U3RhdGVWaWV3ID0gcmVxdWlyZSgnLi92aWV3cy9FbXB0eVN0YXRlVmlldycpO1xuXG52YXIgX3ZpZXdzRW1wdHlTdGF0ZVZpZXcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdmlld3NFbXB0eVN0YXRlVmlldyk7XG5cbnZhciBfdmlld3NNb2RhbEFwcEJhciA9IHJlcXVpcmUoJy4vdmlld3MvTW9kYWxBcHBCYXInKTtcblxudmFyIF92aWV3c01vZGFsQXBwQmFyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3ZpZXdzTW9kYWxBcHBCYXIpO1xuXG52YXIgX2VkaXRvclJlYWN0RWRpdG9yT3BlbmVyID0gcmVxdWlyZSgnLi9lZGl0b3IvUmVhY3RFZGl0b3JPcGVuZXInKTtcblxudmFyIF9lZGl0b3JSZWFjdEVkaXRvck9wZW5lcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9lZGl0b3JSZWFjdEVkaXRvck9wZW5lcik7XG5cbnZhciBfZWRpdG9yUGFwZXJFZGl0b3IgPSByZXF1aXJlKCcuL2VkaXRvci9QYXBlckVkaXRvcicpO1xuXG52YXIgX2R5bmFtaWNHcmlkRHluYW1pY0dyaWQgPSByZXF1aXJlKCcuL2R5bmFtaWMtZ3JpZC9EeW5hbWljR3JpZCcpO1xuXG52YXIgX2R5bmFtaWNHcmlkRHluYW1pY0dyaWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZHluYW1pY0dyaWREeW5hbWljR3JpZCk7XG5cbnZhciBfZHluYW1pY0dyaWRTdG9yZSA9IHJlcXVpcmUoJy4vZHluYW1pYy1ncmlkL1N0b3JlJyk7XG5cbnZhciBfZHluYW1pY0dyaWRTdG9yZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9keW5hbWljR3JpZFN0b3JlKTtcblxudmFyIF9keW5hbWljR3JpZEdyaWRJdGVtTWl4aW4gPSByZXF1aXJlKCcuL2R5bmFtaWMtZ3JpZC9HcmlkSXRlbU1peGluJyk7XG5cbnZhciBfZHluYW1pY0dyaWRHcmlkSXRlbU1peGluMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2R5bmFtaWNHcmlkR3JpZEl0ZW1NaXhpbik7XG5cbnZhciBfZHluYW1pY0dyaWRBc0dyaWRJdGVtID0gcmVxdWlyZSgnLi9keW5hbWljLWdyaWQvYXNHcmlkSXRlbScpO1xuXG52YXIgX2R5bmFtaWNHcmlkQXNHcmlkSXRlbTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9keW5hbWljR3JpZEFzR3JpZEl0ZW0pO1xuXG52YXIgX3V0aWxETkQgPSByZXF1aXJlKCcuL3V0aWwvRE5EJyk7XG5cbnZhciBfdXNlcnNBdmF0YXJVc2VyQXZhdGFyID0gcmVxdWlyZSgnLi91c2Vycy9hdmF0YXIvVXNlckF2YXRhcicpO1xuXG52YXIgX3VzZXJzQXZhdGFyVXNlckF2YXRhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91c2Vyc0F2YXRhclVzZXJBdmF0YXIpO1xuXG52YXIgX3VzZXJzVXNlcnNDb21wbGV0ZXIgPSByZXF1aXJlKCcuL3VzZXJzL1VzZXJzQ29tcGxldGVyJyk7XG5cbnZhciBfdXNlcnNVc2Vyc0NvbXBsZXRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91c2Vyc1VzZXJzQ29tcGxldGVyKTtcblxudmFyIF91c2Vyc1RlYW1DcmVhdGlvbkZvcm0gPSByZXF1aXJlKCcuL3VzZXJzL1RlYW1DcmVhdGlvbkZvcm0nKTtcblxudmFyIF91c2Vyc1RlYW1DcmVhdGlvbkZvcm0yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXNlcnNUZWFtQ3JlYXRpb25Gb3JtKTtcblxudmFyIF9tZW51QnV0dG9uTWVudSA9IHJlcXVpcmUoJy4vbWVudS9CdXR0b25NZW51Jyk7XG5cbnZhciBfbWVudUJ1dHRvbk1lbnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbWVudUJ1dHRvbk1lbnUpO1xuXG52YXIgX21lbnVDb250ZXh0TWVudSA9IHJlcXVpcmUoJy4vbWVudS9Db250ZXh0TWVudScpO1xuXG52YXIgX21lbnVDb250ZXh0TWVudTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tZW51Q29udGV4dE1lbnUpO1xuXG52YXIgX21lbnVJY29uQnV0dG9uTWVudSA9IHJlcXVpcmUoJy4vbWVudS9JY29uQnV0dG9uTWVudScpO1xuXG52YXIgX21lbnVJY29uQnV0dG9uTWVudTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tZW51SWNvbkJ1dHRvbk1lbnUpO1xuXG52YXIgX21lbnVUb29sYmFyID0gcmVxdWlyZSgnLi9tZW51L1Rvb2xiYXInKTtcblxudmFyIF9tZW51VG9vbGJhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tZW51VG9vbGJhcik7XG5cbnZhciBfdXNlcnNBZGRyZXNzYm9va0FkZHJlc3NCb29rID0gcmVxdWlyZSgnLi91c2Vycy9hZGRyZXNzYm9vay9BZGRyZXNzQm9vaycpO1xuXG52YXIgX3VzZXJzQWRkcmVzc2Jvb2tBZGRyZXNzQm9vazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91c2Vyc0FkZHJlc3Nib29rQWRkcmVzc0Jvb2spO1xuXG52YXIgX2NoYXRDaGF0Q2xpZW50ID0gcmVxdWlyZSgnLi9jaGF0L0NoYXRDbGllbnQnKTtcblxudmFyIF9jaGF0Q2hhdENsaWVudDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jaGF0Q2hhdENsaWVudCk7XG5cbnZhciBfY2hhdENoYXQgPSByZXF1aXJlKCcuL2NoYXQvQ2hhdCcpO1xuXG52YXIgX2NoYXRDaGF0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NoYXRDaGF0KTtcblxudmFyIF9jaGF0Q2hhdEljb24gPSByZXF1aXJlKCcuL2NoYXQvQ2hhdEljb24nKTtcblxudmFyIF9jaGF0Q2hhdEljb24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY2hhdENoYXRJY29uKTtcblxudmFyIF9wb2xpY2llc1Jlc291cmNlUG9saWNpZXNQYW5lbCA9IHJlcXVpcmUoJy4vcG9saWNpZXMvUmVzb3VyY2VQb2xpY2llc1BhbmVsJyk7XG5cbnZhciBfcG9saWNpZXNSZXNvdXJjZVBvbGljaWVzUGFuZWwyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcG9saWNpZXNSZXNvdXJjZVBvbGljaWVzUGFuZWwpO1xuXG52YXIgX3VzZXJzQXZhdGFyQ2VsbEFjdGlvbnNSZW5kZXJlciA9IHJlcXVpcmUoJy4vdXNlcnMvYXZhdGFyL0NlbGxBY3Rpb25zUmVuZGVyZXInKTtcblxudmFyIF91c2Vyc0F2YXRhckNlbGxBY3Rpb25zUmVuZGVyZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXNlcnNBdmF0YXJDZWxsQWN0aW9uc1JlbmRlcmVyKTtcblxudmFyIFB5ZGlvQ29tcG9uZW50cyA9IHtcblxuICAgIFNvcnRhYmxlTGlzdDogX2xpc3RTb3J0YWJsZUxpc3QyWydkZWZhdWx0J10sXG4gICAgU2ltcGxlTGlzdDogX2xpc3RTaW1wbGVMaXN0MlsnZGVmYXVsdCddLFxuICAgIE5vZGVMaXN0Q3VzdG9tUHJvdmlkZXI6IF9saXN0Tm9kZUxpc3RDdXN0b21Qcm92aWRlcjJbJ2RlZmF1bHQnXSxcbiAgICBMaXN0RW50cnk6IF9saXN0TGlzdEVudHJ5Lkxpc3RFbnRyeSxcbiAgICBMaXN0UGFnaW5hdG9yOiBfbGlzdExpc3RQYWdpbmF0b3IyWydkZWZhdWx0J10sXG4gICAgTWF0ZXJpYWxUYWJsZTogX2xpc3RNYXRlcmlhbFRhYmxlMlsnZGVmYXVsdCddLFxuXG4gICAgVHJlZVZpZXc6IF92aWV3c1RyZWVWaWV3LlRyZWVWaWV3LFxuICAgIERORFRyZWVWaWV3OiBfdmlld3NUcmVlVmlldy5ETkRUcmVlVmlldyxcbiAgICBGb2xkZXJzVHJlZTogX3ZpZXdzVHJlZVZpZXcuRm9sZGVyc1RyZWUsXG4gICAgQ2xpcGJvYXJkVGV4dEZpZWxkOiBfZWxlbWVudHNDbGlwYm9hcmRUZXh0RmllbGQyWydkZWZhdWx0J10sXG4gICAgTGFiZWxXaXRoVGlwOiBfZWxlbWVudHNMYWJlbFdpdGhUaXAyWydkZWZhdWx0J10sXG4gICAgRW1wdHlTdGF0ZVZpZXc6IF92aWV3c0VtcHR5U3RhdGVWaWV3MlsnZGVmYXVsdCddLFxuICAgIFNpbXBsZUZpZ3VyZUJhZGdlOiBfZWxlbWVudHNTaW1wbGVGaWd1cmVCYWRnZTJbJ2RlZmF1bHQnXSxcbiAgICBNb2RhbEFwcEJhcjogX3ZpZXdzTW9kYWxBcHBCYXIyWydkZWZhdWx0J10sXG5cbiAgICBSZWFjdEVkaXRvck9wZW5lcjogX2VkaXRvclJlYWN0RWRpdG9yT3BlbmVyMlsnZGVmYXVsdCddLFxuICAgIFBhcGVyRWRpdG9yTGF5b3V0OiBfZWRpdG9yUGFwZXJFZGl0b3IuUGFwZXJFZGl0b3JMYXlvdXQsXG4gICAgUGFwZXJFZGl0b3JOYXZFbnRyeTogX2VkaXRvclBhcGVyRWRpdG9yLlBhcGVyRWRpdG9yTmF2RW50cnksXG4gICAgUGFwZXJFZGl0b3JOYXZIZWFkZXI6IF9lZGl0b3JQYXBlckVkaXRvci5QYXBlckVkaXRvck5hdkhlYWRlcixcblxuICAgIER5bmFtaWNHcmlkOiBfZHluYW1pY0dyaWREeW5hbWljR3JpZDJbJ2RlZmF1bHQnXSxcbiAgICBEeW5hbWljR3JpZEl0ZW1NaXhpbjogX2R5bmFtaWNHcmlkR3JpZEl0ZW1NaXhpbjJbJ2RlZmF1bHQnXSxcbiAgICBhc0dyaWRJdGVtOiBfZHluYW1pY0dyaWRBc0dyaWRJdGVtMlsnZGVmYXVsdCddLFxuICAgIER5bmFtaWNHcmlkU3RvcmU6IF9keW5hbWljR3JpZFN0b3JlMlsnZGVmYXVsdCddLFxuXG4gICAgRE5EOiB7XG4gICAgICAgIFR5cGVzOiBfdXRpbERORC5UeXBlcywgY29sbGVjdDogX3V0aWxETkQuY29sbGVjdCwgY29sbGVjdERyb3A6IF91dGlsRE5ELmNvbGxlY3REcm9wLCBub2RlRHJhZ1NvdXJjZTogX3V0aWxETkQubm9kZURyYWdTb3VyY2UsIG5vZGVEcm9wVGFyZ2V0OiBfdXRpbERORC5ub2RlRHJvcFRhcmdldCwgRE5EQWN0aW9uUGFyYW1ldGVyOiBfdXRpbERORC5ETkRBY3Rpb25QYXJhbWV0ZXJcbiAgICB9LFxuICAgIEROREFjdGlvblBhcmFtZXRlcjogX3V0aWxETkQuRE5EQWN0aW9uUGFyYW1ldGVyLFxuXG4gICAgVXNlckF2YXRhcjogX3VzZXJzQXZhdGFyVXNlckF2YXRhcjJbJ2RlZmF1bHQnXSxcbiAgICBVc2Vyc0NvbXBsZXRlcjogX3VzZXJzVXNlcnNDb21wbGV0ZXIyWydkZWZhdWx0J10sXG4gICAgVGVhbUNyZWF0aW9uRm9ybTogX3VzZXJzVGVhbUNyZWF0aW9uRm9ybTJbJ2RlZmF1bHQnXSxcbiAgICBBZGRyZXNzQm9vazogX3VzZXJzQWRkcmVzc2Jvb2tBZGRyZXNzQm9vazJbJ2RlZmF1bHQnXSxcblxuICAgIENvbnRleHRNZW51OiBfbWVudUNvbnRleHRNZW51MlsnZGVmYXVsdCddLFxuICAgIFRvb2xiYXI6IF9tZW51VG9vbGJhcjJbJ2RlZmF1bHQnXSxcbiAgICBCdXR0b25NZW51OiBfbWVudUJ1dHRvbk1lbnUyWydkZWZhdWx0J10sXG4gICAgSWNvbkJ1dHRvbk1lbnU6IF9tZW51SWNvbkJ1dHRvbk1lbnUyWydkZWZhdWx0J10sXG5cbiAgICBDaGF0OiBfY2hhdENoYXQyWydkZWZhdWx0J10sXG4gICAgQ2hhdEljb246IF9jaGF0Q2hhdEljb24yWydkZWZhdWx0J10sXG4gICAgQ2hhdENsaWVudDogX2NoYXRDaGF0Q2xpZW50MlsnZGVmYXVsdCddLFxuICAgIFJlc291cmNlUG9saWNpZXNQYW5lbDogX3BvbGljaWVzUmVzb3VyY2VQb2xpY2llc1BhbmVsMlsnZGVmYXVsdCddLFxuICAgIENlbGxBY3Rpb25zUmVuZGVyZXI6IF91c2Vyc0F2YXRhckNlbGxBY3Rpb25zUmVuZGVyZXIyWydkZWZhdWx0J11cbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFB5ZGlvQ29tcG9uZW50cztcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluID0gcmVxdWlyZSgnLi9MaXN0RW50cnlOb2RlTGlzdGVuZXJNaXhpbicpO1xuXG52YXIgX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluKTtcblxudmFyIF9JbmxpbmVFZGl0b3IgPSByZXF1aXJlKCcuL0lubGluZUVkaXRvcicpO1xuXG52YXIgX0lubGluZUVkaXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9JbmxpbmVFZGl0b3IpO1xuXG52YXIgX0xpc3RFbnRyeSA9IHJlcXVpcmUoJy4vTGlzdEVudHJ5Jyk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbi8qKlxuICogQ2FsbGJhY2sgYmFzZWQgbWF0ZXJpYWwgbGlzdCBlbnRyeSB3aXRoIGN1c3RvbSBpY29uIHJlbmRlciwgZmlyc3RMaW5lLCBzZWNvbmRMaW5lLCBldGMuXG4gKi9cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdDb25maWd1cmFibGVMaXN0RW50cnknLFxuXG4gICAgbWl4aW5zOiBbX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluMlsnZGVmYXVsdCddXSxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBub2RlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmluc3RhbmNlT2YoQWp4cE5vZGUpLFxuICAgICAgICAvLyBTRUUgQUxTTyBMaXN0RW50cnkgUFJPUFNcbiAgICAgICAgcmVuZGVySWNvbjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICByZW5kZXJGaXJzdExpbmU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgcmVuZGVyU2Vjb25kTGluZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICByZW5kZXJUaGlyZExpbmU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgcmVuZGVyQWN0aW9uczogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBzdHlsZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3RcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIGljb24gPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBmaXJzdExpbmUgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBzZWNvbmRMaW5lID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgdGhpcmRMaW5lID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc3R5bGUgPSB0aGlzLnByb3BzLnN0eWxlIHx8IHt9O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5yZW5kZXJJY29uKSB7XG4gICAgICAgICAgICBpY29uID0gdGhpcy5wcm9wcy5yZW5kZXJJY29uKHRoaXMucHJvcHMubm9kZSwgdGhpcy5wcm9wcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMucHJvcHMubm9kZTtcbiAgICAgICAgICAgIHZhciBpY29uQ2xhc3MgPSBub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwiaWNvbl9jbGFzc1wiKSA/IG5vZGUuZ2V0TWV0YWRhdGEoKS5nZXQoXCJpY29uX2NsYXNzXCIpIDogbm9kZS5pc0xlYWYoKSA/IFwiaWNvbi1maWxlLWFsdFwiIDogXCJpY29uLWZvbGRlci1jbG9zZVwiO1xuICAgICAgICAgICAgaWNvbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZvbnRJY29uLCB7IGNsYXNzTmFtZTogaWNvbkNsYXNzIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMucmVuZGVyRmlyc3RMaW5lKSB7XG4gICAgICAgICAgICBmaXJzdExpbmUgPSB0aGlzLnByb3BzLnJlbmRlckZpcnN0TGluZSh0aGlzLnByb3BzLm5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlyc3RMaW5lID0gdGhpcy5wcm9wcy5ub2RlLmdldExhYmVsKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiYgdGhpcy5zdGF0ZS5pbmxpbmVFZGl0aW9uKSB7XG4gICAgICAgICAgICBmaXJzdExpbmUgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfSW5saW5lRWRpdG9yMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IHRoaXMucHJvcHMubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBpbmxpbmVFZGl0aW9uOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHRoaXMuc3RhdGUuaW5saW5lRWRpdGlvbkNhbGxiYWNrXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZmlyc3RMaW5lXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbmRlclNlY29uZExpbmUpIHtcbiAgICAgICAgICAgIHNlY29uZExpbmUgPSB0aGlzLnByb3BzLnJlbmRlclNlY29uZExpbmUodGhpcy5wcm9wcy5ub2RlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5yZW5kZXJUaGlyZExpbmUpIHtcbiAgICAgICAgICAgIHRoaXJkTGluZSA9IHRoaXMucHJvcHMucmVuZGVyVGhpcmRMaW5lKHRoaXMucHJvcHMubm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFjdGlvbnMgPSB0aGlzLnByb3BzLmFjdGlvbnM7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbmRlckFjdGlvbnMpIHtcbiAgICAgICAgICAgIGFjdGlvbnMgPSB0aGlzLnByb3BzLnJlbmRlckFjdGlvbnModGhpcy5wcm9wcy5ub2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfTGlzdEVudHJ5LkRyYWdEcm9wTGlzdEVudHJ5LCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywge1xuICAgICAgICAgICAgaWNvbkNlbGw6IGljb24sXG4gICAgICAgICAgICBmaXJzdExpbmU6IGZpcnN0TGluZSxcbiAgICAgICAgICAgIHNlY29uZExpbmU6IHNlY29uZExpbmUsXG4gICAgICAgICAgICB0aGlyZExpbmU6IHRoaXJkTGluZSxcbiAgICAgICAgICAgIGFjdGlvbnM6IGFjdGlvbnMsXG4gICAgICAgICAgICBzdHlsZTogc3R5bGVcbiAgICAgICAgfSkpO1xuICAgIH1cblxufSk7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbnZhciBQeWRpbyA9IHJlcXVpcmUoJ3B5ZGlvJyk7XG52YXIgQWp4cE5vZGUgPSByZXF1aXJlKCdweWRpby9tb2RlbC9ub2RlJyk7XG5cbnZhciBfUHlkaW8kcmVxdWlyZUxpYiA9IFB5ZGlvLnJlcXVpcmVMaWIoJ2Jvb3QnKTtcblxudmFyIFB5ZGlvQ29udGV4dENvbnN1bWVyID0gX1B5ZGlvJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBQYXBlciA9IF9yZXF1aXJlLlBhcGVyO1xudmFyIFRleHRGaWVsZCA9IF9yZXF1aXJlLlRleHRGaWVsZDtcbnZhciBGbGF0QnV0dG9uID0gX3JlcXVpcmUuRmxhdEJ1dHRvbjtcblxudmFyIElubGluZUVkaXRvciA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0lubGluZUVkaXRvcicsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgbm9kZTogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoQWp4cE5vZGUpLFxuICAgICAgICBjYWxsYmFjazogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIG9uQ2xvc2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBkZXRhY2hlZDogUmVhY3QuUHJvcFR5cGVzLmJvb2xcbiAgICB9LFxuXG4gICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZSB8fCAhdGhpcy5zdGF0ZS52YWx1ZSB8fCB0aGlzLnN0YXRlLnZhbHVlID09PSB0aGlzLnByb3BzLm5vZGUuZ2V0TGFiZWwoKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yU3RyaW5nOiAnUGxlYXNlIHVzZSBhIGRpZmZlcmVudCB2YWx1ZSBmb3IgcmVuYW1pbmchJyB9KTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZ2V0UHlkaW8oKS5kaXNwbGF5TWVzc2FnZSgnRVJST1InLCAnUGxlYXNlIHVzZSBhIGRpZmZlcmVudCB2YWx1ZSBmb3IgcmVuYW1pbmchJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmNhbGxiYWNrKHRoaXMuc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLnJlZnMudGV4dC5mb2N1cygpO1xuICAgIH0sXG5cbiAgICBjYXRjaENsaWNrczogZnVuY3Rpb24gY2F0Y2hDbGlja3MoZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0sXG5cbiAgICBvbktleURvd246IGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgdGhpcy5zdWJtaXQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3JTdHJpbmc6ICcnIH0pO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFBhcGVyLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwiaW5saW5lLWVkaXRvclwiICsgKHRoaXMucHJvcHMuZGV0YWNoZWQgPyBcIiBkZXRhY2hlZFwiIDogXCJcIiksIHN0eWxlOiB7IHBhZGRpbmc6IDggfSwgekRlcHRoOiAyIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRGaWVsZCwge1xuICAgICAgICAgICAgICAgIHJlZjogJ3RleHQnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogdGhpcy5wcm9wcy5ub2RlLmdldExhYmVsKCksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIChlLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXNbJ2NhdGNoJ10sIG9uRG91YmxlQ2xpY2s6IHRoaXMuY2F0Y2hDbGlja3MsXG4gICAgICAgICAgICAgICAgdGFiSW5kZXg6ICcwJywgb25LZXlEb3duOiB0aGlzLm9uS2V5RG93bixcbiAgICAgICAgICAgICAgICBlcnJvclRleHQ6IHRoaXMuc3RhdGUgPyB0aGlzLnN0YXRlLmVycm9yU3RyaW5nIDogbnVsbFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgdGV4dEFsaWduOiAncmlnaHQnLCBwYWRkaW5nVG9wOiA4IH0gfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEZsYXRCdXR0b24sIHsgbGFiZWw6ICdDYW5jZWwnLCBvbkNsaWNrOiB0aGlzLnByb3BzLm9uQ2xvc2UgfSksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChGbGF0QnV0dG9uLCB7IGxhYmVsOiAnU3VibWl0Jywgb25DbGljazogdGhpcy5zdWJtaXQgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbn0pO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBJbmxpbmVFZGl0b3IgPSBQeWRpb0NvbnRleHRDb25zdW1lcihJbmxpbmVFZGl0b3IpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBJbmxpbmVFZGl0b3I7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0RG9tID0gcmVxdWlyZSgncmVhY3QtZG9tJyk7XG5cbnZhciBfcmVhY3REb20yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3REb20pO1xuXG52YXIgX3V0aWxETkQgPSByZXF1aXJlKCcuLi91dGlsL0RORCcpO1xuXG52YXIgX3JlYWN0RG5kID0gcmVxdWlyZSgncmVhY3QtZG5kJyk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfbWF0ZXJpYWxVaVN0eWxlcyA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpL3N0eWxlcycpO1xuXG52YXIgX2NvbG9yID0gcmVxdWlyZSgnY29sb3InKTtcblxudmFyIF9jb2xvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb2xvcik7XG5cbi8qKlxuICogTWF0ZXJpYWwgTGlzdCBFbnRyeVxuICovXG5cbnZhciBMaXN0RW50cnkgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoTGlzdEVudHJ5LCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIExpc3RFbnRyeSgpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpc3RFbnRyeSk7XG5cbiAgICAgICAgX1JlYWN0JENvbXBvbmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIExpc3RFbnRyeS5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uIG9uQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuc2hvd1NlbGVjdG9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5zZWxlY3RvckRpc2FibGVkKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KHRoaXMucHJvcHMubm9kZSwgZXZlbnQpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMub25DbGljaykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNsaWNrKHRoaXMucHJvcHMubm9kZSwgZXZlbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIExpc3RFbnRyeS5wcm90b3R5cGUub25Eb3VibGVDbGljayA9IGZ1bmN0aW9uIG9uRG91YmxlQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Eb3VibGVDbGljaykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkRvdWJsZUNsaWNrKHRoaXMucHJvcHMubm9kZSwgZXZlbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIExpc3RFbnRyeS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBzZWxlY3RvciA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGljb24gPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBhZGRpdGlvbmFsQ2xhc3NOYW1lID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgbm9kZSA9IF9wcm9wcy5ub2RlO1xuICAgICAgICB2YXIgc2hvd1NlbGVjdG9yID0gX3Byb3BzLnNob3dTZWxlY3RvcjtcbiAgICAgICAgdmFyIHNlbGVjdGVkID0gX3Byb3BzLnNlbGVjdGVkO1xuICAgICAgICB2YXIgc2VsZWN0b3JEaXNhYmxlZCA9IF9wcm9wcy5zZWxlY3RvckRpc2FibGVkO1xuICAgICAgICB2YXIgZmlyc3RMaW5lID0gX3Byb3BzLmZpcnN0TGluZTtcbiAgICAgICAgdmFyIHNlY29uZExpbmUgPSBfcHJvcHMuc2Vjb25kTGluZTtcbiAgICAgICAgdmFyIHRoaXJkTGluZSA9IF9wcm9wcy50aGlyZExpbmU7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wcy5zdHlsZTtcbiAgICAgICAgdmFyIGFjdGlvbnMgPSBfcHJvcHMuYWN0aW9ucztcbiAgICAgICAgdmFyIGljb25DZWxsID0gX3Byb3BzLmljb25DZWxsO1xuICAgICAgICB2YXIgbWFpbkljb24gPSBfcHJvcHMubWFpbkljb247XG4gICAgICAgIHZhciBjbGFzc05hbWUgPSBfcHJvcHMuY2xhc3NOYW1lO1xuICAgICAgICB2YXIgY2FuRHJvcCA9IF9wcm9wcy5jYW5Ecm9wO1xuICAgICAgICB2YXIgaXNPdmVyID0gX3Byb3BzLmlzT3ZlcjtcbiAgICAgICAgdmFyIGNvbm5lY3REcmFnU291cmNlID0gX3Byb3BzLmNvbm5lY3REcmFnU291cmNlO1xuICAgICAgICB2YXIgY29ubmVjdERyb3BUYXJnZXQgPSBfcHJvcHMuY29ubmVjdERyb3BUYXJnZXQ7XG5cbiAgICAgICAgdmFyIG1haW5DbGFzc2VzID0gWydtYXRlcmlhbC1saXN0LWVudHJ5JywgJ21hdGVyaWFsLWxpc3QtZW50cnktJyArICh0aGlyZExpbmUgPyAzIDogc2Vjb25kTGluZSA/IDIgOiAxKSArICctbGluZXMnXTtcbiAgICAgICAgaWYgKGNsYXNzTmFtZSkgbWFpbkNsYXNzZXMucHVzaChjbGFzc05hbWUpO1xuXG4gICAgICAgIGlmIChzaG93U2VsZWN0b3IpIHtcbiAgICAgICAgICAgIHNlbGVjdG9yID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ21hdGVyaWFsLWxpc3Qtc2VsZWN0b3InIH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5DaGVja2JveCwgeyBjaGVja2VkOiBzZWxlY3RlZCwgcmVmOiAnc2VsZWN0b3InLCBkaXNhYmxlZDogc2VsZWN0b3JEaXNhYmxlZCB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpY29uQ2VsbCkge1xuICAgICAgICAgICAgaWNvbiA9IHRoaXMucHJvcHMuaWNvbkNlbGw7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5tYWluSWNvbikge1xuICAgICAgICAgICAgdmFyIF9zdHlsZSA9IHtcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTgsIGNvbG9yOiAnI0ZGRicsIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLCBtYXJnaW46IDE2LCBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2IoMTg5LCAxODksIDE4OSknLCBwYWRkaW5nOiAnN3B4IDNweCcsIHdpZHRoOiAzMywgaGVpZ2h0OiAzMywgdGV4dEFsaWduOiAnY2VudGVyJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGljb24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZvbnRJY29uLCB7IGNsYXNzTmFtZTogXCJtdWktZm9udC1pY29uIFwiICsgdGhpcy5wcm9wcy5tYWluSWNvbiwgc3R5bGU6IF9zdHlsZSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYW5Ecm9wICYmIGlzT3Zlcikge1xuICAgICAgICAgICAgbWFpbkNsYXNzZXMucHVzaCgnZHJvcHBhYmxlLWFjdGl2ZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgIG1haW5DbGFzc2VzLnB1c2goJ2xpc3RlbnRyeScgKyBub2RlLmdldFBhdGgoKS5yZXBsYWNlKC9cXC8vZywgJ18nKSk7XG4gICAgICAgICAgICBtYWluQ2xhc3Nlcy5wdXNoKCdhanhwX25vZGVfJyArIChub2RlLmlzTGVhZigpID8gJ2xlYWYnIDogJ2NvbGxlY3Rpb24nKSk7XG4gICAgICAgICAgICBpZiAobm9kZS5nZXRBanhwTWltZSgpKSB7XG4gICAgICAgICAgICAgICAgbWFpbkNsYXNzZXMucHVzaCgnYWp4cF9taW1lXycgKyBub2RlLmdldEFqeHBNaW1lKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFkZGl0aW9uYWxTdHlsZSA9IHtcbiAgICAgICAgICAgIC8qdHJhbnNpdGlvbjonYmFja2dyb3VuZC1jb2xvciAyNTBtcyBjdWJpYy1iZXppZXIoMC4yMywgMSwgMC4zMiwgMSkgMG1zLCBjb2xvciAyNTBtcyBjdWJpYy1iZXppZXIoMC4yMywgMSwgMC4zMiwgMSkgMG1zJyovXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuaG92ZXIgJiYgIXRoaXMucHJvcHMubm9Ib3Zlcikge1xuICAgICAgICAgICAgYWRkaXRpb25hbFN0eWxlID0gX2V4dGVuZHMoe30sIGFkZGl0aW9uYWxTdHlsZSwge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwwLDAsMC4wNSknLFxuICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbTogJzFweCBzb2xpZCB0cmFuc3BhcmVudCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdGlvbkNvbG9yID0gdGhpcy5wcm9wcy5tdWlUaGVtZS5wYWxldHRlLmFjY2VudDJDb2xvcjtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rpb25Db2xvckRhcmsgPSBfY29sb3IyWydkZWZhdWx0J10oc2VsZWN0aW9uQ29sb3IpLmRhcmsoKTtcbiAgICAgICAgICAgIGFkZGl0aW9uYWxTdHlsZSA9IF9leHRlbmRzKHt9LCBhZGRpdGlvbmFsU3R5bGUsIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHNlbGVjdGlvbkNvbG9yLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBzZWxlY3Rpb25Db2xvckRhcmsgPyAnd2hpdGUnIDogJ3JnYmEoMCwwLDAsLjg3KSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbWFpbkNsYXNzZXMucHVzaCgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIG1haW5DbGFzc2VzLnB1c2goJ3NlbGVjdGVkLScgKyAoc2VsZWN0aW9uQ29sb3JEYXJrID8gJ2RhcmsnIDogJ2xpZ2h0JykpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBDb250ZXh0TWVudVdyYXBwZXIsXG4gICAgICAgICAgICBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywge1xuICAgICAgICAgICAgICAgIHJlZjogZnVuY3Rpb24gKGluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gX3JlYWN0RG9tMlsnZGVmYXVsdCddLmZpbmRET01Ob2RlKGluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25uZWN0RHJvcFRhcmdldCA9PT0gJ2Z1bmN0aW9uJykgY29ubmVjdERyb3BUYXJnZXQobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29ubmVjdERyYWdTb3VyY2UgPT09ICdmdW5jdGlvbicpIGNvbm5lY3REcmFnU291cmNlKG5vZGUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5vbkNsaWNrLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgb25Eb3VibGVDbGljazogc2hvd1NlbGVjdG9yID8gbnVsbCA6IHRoaXMub25Eb3VibGVDbGljay5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogbWFpbkNsYXNzZXMuam9pbignICcpLFxuICAgICAgICAgICAgICAgIG9uTW91c2VPdmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaG92ZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbk1vdXNlT3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaG92ZXI6IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3R5bGU6IF9leHRlbmRzKHt9LCBzdHlsZSwgYWRkaXRpb25hbFN0eWxlKSB9KSxcbiAgICAgICAgICAgIHNlbGVjdG9yLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJtYXRlcmlhbC1saXN0LWljb25cIiArIChtYWluSWNvbiB8fCBpY29uQ2VsbCA/IFwiXCIgOiBcIiBtYXRlcmlhbC1saXN0LWljb24tbm9uZVwiKSB9LFxuICAgICAgICAgICAgICAgIGljb25cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnbWF0ZXJpYWwtbGlzdC10ZXh0JyB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IGtleTogJ2xpbmUtMScsIGNsYXNzTmFtZTogJ21hdGVyaWFsLWxpc3QtbGluZS0xJyB9LFxuICAgICAgICAgICAgICAgICAgICBmaXJzdExpbmVcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IGtleTogJ2xpbmUtMicsIGNsYXNzTmFtZTogJ21hdGVyaWFsLWxpc3QtbGluZS0yJyB9LFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRMaW5lXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBrZXk6ICdsaW5lLTMnLCBjbGFzc05hbWU6ICdtYXRlcmlhbC1saXN0LWxpbmUtMycgfSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcmRMaW5lXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdtYXRlcmlhbC1saXN0LWFjdGlvbnMnIH0sXG4gICAgICAgICAgICAgICAgYWN0aW9uc1xuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gTGlzdEVudHJ5O1xufSkoUmVhY3QuQ29tcG9uZW50KTtcblxudmFyIENvbnRleHRNZW51V3JhcHBlciA9IGZ1bmN0aW9uIENvbnRleHRNZW51V3JhcHBlcihwcm9wcykge1xuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCBwcm9wcyk7XG59O1xuQ29udGV4dE1lbnVXcmFwcGVyID0gUHlkaW9IT0NzLndpdGhDb250ZXh0TWVudShDb250ZXh0TWVudVdyYXBwZXIpO1xuXG5MaXN0RW50cnkucHJvcFR5cGVzID0ge1xuICAgIHNob3dTZWxlY3RvcjogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgc2VsZWN0ZWQ6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIHNlbGVjdG9yRGlzYWJsZWQ6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIG9uU2VsZWN0OiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICBvbkNsaWNrOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICBpY29uQ2VsbDogUmVhY3QuUHJvcFR5cGVzLmVsZW1lbnQsXG4gICAgbWFpbkljb246IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgZmlyc3RMaW5lOiBSZWFjdC5Qcm9wVHlwZXMubm9kZSxcbiAgICBzZWNvbmRMaW5lOiBSZWFjdC5Qcm9wVHlwZXMubm9kZSxcbiAgICB0aGlyZExpbmU6IFJlYWN0LlByb3BUeXBlcy5ub2RlLFxuICAgIGFjdGlvbnM6IFJlYWN0LlByb3BUeXBlcy5lbGVtZW50LFxuICAgIGFjdGl2ZURyb3BwYWJsZTogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgY2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIHN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIG5vSG92ZXI6IFJlYWN0LlByb3BUeXBlcy5ib29sXG59O1xuXG5leHBvcnRzLkxpc3RFbnRyeSA9IExpc3RFbnRyeSA9IF9tYXRlcmlhbFVpU3R5bGVzLm11aVRoZW1lYWJsZSgpKExpc3RFbnRyeSk7XG5cbnZhciBEcmFnRHJvcExpc3RFbnRyeSA9IF9yZWFjdERuZC5mbG93KF9yZWFjdERuZC5EcmFnU291cmNlKF91dGlsRE5ELlR5cGVzLk5PREVfUFJPVklERVIsIF91dGlsRE5ELm5vZGVEcmFnU291cmNlLCBfdXRpbERORC5jb2xsZWN0KSwgX3JlYWN0RG5kLkRyb3BUYXJnZXQoX3V0aWxETkQuVHlwZXMuTk9ERV9QUk9WSURFUiwgX3V0aWxETkQubm9kZURyb3BUYXJnZXQsIF91dGlsRE5ELmNvbGxlY3REcm9wKSkoTGlzdEVudHJ5KTtcblxuZXhwb3J0cy5EcmFnRHJvcExpc3RFbnRyeSA9IERyYWdEcm9wTGlzdEVudHJ5O1xuZXhwb3J0cy5MaXN0RW50cnkgPSBMaXN0RW50cnk7XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cblwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSB7XG5cbiAgICBhdHRhY2g6IGZ1bmN0aW9uIGF0dGFjaChub2RlKSB7XG4gICAgICAgIHRoaXMuX25vZGVMaXN0ZW5lciA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRldGFjaChub2RlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX2FjdGlvbkxpc3RlbmVyID0gKGZ1bmN0aW9uIChldmVudE1lbW8pIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc01vdW50ZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGV0YWNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChldmVudE1lbW8gJiYgZXZlbnRNZW1vLnR5cGUgPT09ICdwcm9tcHQtcmVuYW1lJyAmJiBldmVudE1lbW8uY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW5saW5lRWRpdGlvbjogdHJ1ZSwgaW5saW5lRWRpdGlvbkNhbGxiYWNrOiBldmVudE1lbW8uY2FsbGJhY2sgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSkuYmluZCh0aGlzKTtcbiAgICAgICAgbm9kZS5vYnNlcnZlKFwibm9kZV9yZXBsYWNlZFwiLCB0aGlzLl9ub2RlTGlzdGVuZXIpO1xuICAgICAgICBub2RlLm9ic2VydmUoXCJub2RlX2FjdGlvblwiLCB0aGlzLl9hY3Rpb25MaXN0ZW5lcik7XG4gICAgfSxcblxuICAgIGRldGFjaDogZnVuY3Rpb24gZGV0YWNoKG5vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX25vZGVMaXN0ZW5lcikge1xuICAgICAgICAgICAgbm9kZS5zdG9wT2JzZXJ2aW5nKFwibm9kZV9yZXBsYWNlZFwiLCB0aGlzLl9ub2RlTGlzdGVuZXIpO1xuICAgICAgICAgICAgbm9kZS5zdG9wT2JzZXJ2aW5nKFwibm9kZV9hY3Rpb25cIiwgdGhpcy5fYWN0aW9uTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5hdHRhY2godGhpcy5wcm9wcy5ub2RlKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLmRldGFjaCh0aGlzLnByb3BzLm5vZGUpO1xuICAgIH1cblxufTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4gPSByZXF1aXJlKCcuLi91dGlsL01lc3NhZ2VzQ29uc3VtZXJNaXhpbicpO1xuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbE1lc3NhZ2VzQ29uc3VtZXJNaXhpbik7XG5cbi8qKlxuICogUGFnaW5hdGlvbiBjb21wb25lbnQgcmVhZGluZyBtZXRhZGF0YSBcInBhZ2luYXRpb25EYXRhXCIgZnJvbSBjdXJyZW50IG5vZGUuXG4gKi9cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdMaXN0UGFnaW5hdG9yJyxcblxuICAgIG1peGluczogW191dGlsTWVzc2FnZXNDb25zdW1lck1peGluMlsnZGVmYXVsdCddXSxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBkYXRhTW9kZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihQeWRpb0RhdGFNb2RlbCkuaXNSZXF1aXJlZCxcbiAgICAgICAgbm9kZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5pbnN0YW5jZU9mKEFqeHBOb2RlKVxuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCF0aGlzLnByb3BzLm5vZGUpIHtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRtID0gX3RoaXMucHJvcHMuZGF0YU1vZGVsO1xuICAgICAgICAgICAgICAgIF90aGlzLl9kbU9ic2VydmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5vZGU6IGRtLmdldENvbnRleHROb2RlKCkgfSk7XG4gICAgICAgICAgICAgICAgfSkuYmluZChfdGhpcyk7XG4gICAgICAgICAgICAgICAgZG0ub2JzZXJ2ZShcImNvbnRleHRfY2hhbmdlZFwiLCBfdGhpcy5fZG1PYnNlcnZlcik7XG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBub2RlOiBkbS5nZXRDb250ZXh0Tm9kZSgpIH0pO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kbU9ic2VydmVyKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmRhdGFNb2RlbC5zdG9wT2JzZXJ2aW5nKFwiY29udGV4dF9jaGFuZ2VkXCIsIHRoaXMuX2RtT2JzZXJ2ZXIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgICAgICByZXR1cm4geyBub2RlOiB0aGlzLnByb3BzLm5vZGUgfTtcbiAgICB9LFxuXG4gICAgY2hhbmdlUGFnZTogZnVuY3Rpb24gY2hhbmdlUGFnZShldmVudCkge1xuICAgICAgICB0aGlzLnN0YXRlLm5vZGUuZ2V0TWV0YWRhdGEoKS5nZXQoXCJwYWdpbmF0aW9uRGF0YVwiKS5zZXQoXCJuZXdfcGFnZVwiLCBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1wYWdlJykpO1xuICAgICAgICB0aGlzLnByb3BzLmRhdGFNb2RlbC5yZXF1aXJlQ29udGV4dENoYW5nZSh0aGlzLnN0YXRlLm5vZGUpO1xuICAgIH0sXG5cbiAgICBvbk1lbnVDaGFuZ2U6IGZ1bmN0aW9uIG9uTWVudUNoYW5nZShldmVudCwgaW5kZXgsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUubm9kZS5nZXRNZXRhZGF0YSgpLmdldChcInBhZ2luYXRpb25EYXRhXCIpLnNldChcIm5ld19wYWdlXCIsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5wcm9wcy5kYXRhTW9kZWwucmVxdWlyZUNvbnRleHRDaGFuZ2UodGhpcy5zdGF0ZS5ub2RlKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5ub2RlIHx8ICF0aGlzLnN0YXRlLm5vZGUuZ2V0TWV0YWRhdGEoKS5nZXQoXCJwYWdpbmF0aW9uRGF0YVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBEYXRhID0gdGhpcy5zdGF0ZS5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwicGFnaW5hdGlvbkRhdGFcIik7XG4gICAgICAgIHZhciBjdXJyZW50ID0gcGFyc2VJbnQocERhdGEuZ2V0KFwiY3VycmVudFwiKSk7XG4gICAgICAgIHZhciB0b3RhbCA9IHBhcnNlSW50KHBEYXRhLmdldChcInRvdGFsXCIpKTtcbiAgICAgICAgdmFyIHBhZ2VzID0gW10sXG4gICAgICAgICAgICBuZXh0ID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgbGFzdCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHByZXZpb3VzID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgZmlyc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBwYWdlV29yZCA9IHRoaXMuY29udGV4dC5nZXRNZXNzYWdlID8gdGhpcy5jb250ZXh0LmdldE1lc3NhZ2UoJzMzMScsICcnKSA6IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgnMzMxJywgJycpO1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSB0b3RhbDsgaSsrKSB7XG4gICAgICAgICAgICBwYWdlcy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLk1lbnVJdGVtLCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGksXG4gICAgICAgICAgICAgICAgcHJpbWFyeVRleHQ6IHBhZ2VXb3JkICsgJyAnICsgaSArIChpID09PSBjdXJyZW50ID8gJyAvICcgKyB0b3RhbCA6ICcnKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlcy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlvdXMgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IG9uVG91Y2hUYXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczIub25NZW51Q2hhbmdlKG51bGwsIDAsIGN1cnJlbnQgLSAxKTtcbiAgICAgICAgICAgIH0sIGljb25DbGFzc05hbWU6IFwibWRpIG1kaS1jaGV2cm9uLWxlZnRcIiwgZGlzYWJsZWQ6IGN1cnJlbnQgPT09IDEgfSk7XG4gICAgICAgIG5leHQgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IG9uVG91Y2hUYXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczIub25NZW51Q2hhbmdlKG51bGwsIDAsIGN1cnJlbnQgKyAxKTtcbiAgICAgICAgICAgIH0sIGljb25DbGFzc05hbWU6IFwibWRpIG1kaS1jaGV2cm9uLXJpZ2h0XCIsIGRpc2FibGVkOiBjdXJyZW50ID09PSB0b3RhbCwgc3R5bGU6IHsgbWFyZ2luTGVmdDogLTIwIH0gfSk7XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IGlkOiB0aGlzLnByb3BzLmlkLCBzdHlsZTogX2V4dGVuZHMoeyBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInIH0sIHRoaXMucHJvcHMuc3R5bGUpIH0sXG4gICAgICAgICAgICBwcmV2aW91cyxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLkRyb3BEb3duTWVudSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7IHdpZHRoOiAxNTAsIG1hcmdpblRvcDogLTYgfSxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMub25NZW51Q2hhbmdlLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY3VycmVudCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lU3R5bGU6IHsgZGlzcGxheTogJ25vbmUnIH0sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsU3R5bGU6IHsgY29sb3I6ICd3aGl0ZScgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcGFnZXNcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXh0XG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfcHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvKTtcblxudmFyIF9QeWRpbyRyZXF1aXJlTGliID0gX3B5ZGlvMlsnZGVmYXVsdCddLnJlcXVpcmVMaWIoXCJib290XCIpO1xuXG52YXIgbW9tZW50ID0gX1B5ZGlvJHJlcXVpcmVMaWIubW9tZW50O1xuXG4vKipcbiAqIFNpbXBsZSBtYXRlcmlhbCB0YWJsZVxuICogY29sdW1ucyBhcmUgb2JqZWN0cyBvZiBzaGFwZSB7bmFtZSwgbGFiZWwsIHN0eWxlLCBoZWFkZXJTdHlsZX1cbiAqL1xuXG52YXIgTWF0ZXJpYWxUYWJsZSA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhNYXRlcmlhbFRhYmxlLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIE1hdGVyaWFsVGFibGUoKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYXRlcmlhbFRhYmxlKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgTWF0ZXJpYWxUYWJsZS5wcm90b3R5cGUub25Sb3dTZWxlY3Rpb24gPSBmdW5jdGlvbiBvblJvd1NlbGVjdGlvbihpbmRleGVzKSB7XG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgZGF0YSA9IF9wcm9wcy5kYXRhO1xuICAgICAgICB2YXIgb25TZWxlY3RSb3dzID0gX3Byb3BzLm9uU2VsZWN0Um93cztcblxuICAgICAgICBpZiAoIW9uU2VsZWN0Um93cykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbmRleGVzID09PSAnbm9uZScpIHtcbiAgICAgICAgICAgIG9uU2VsZWN0Um93cyhbXSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5kZXhlcyA9PT0gJ2FsbCcpIHtcbiAgICAgICAgICAgIG9uU2VsZWN0Um93cyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IFtdO1xuICAgICAgICAgICAgICAgIGluZGV4ZXMubWFwKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5wdXNoKGRhdGFbaV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG9uU2VsZWN0Um93cyhzZWxlY3Rpb24pO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBNYXRlcmlhbFRhYmxlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfcHJvcHMyID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIGNvbHVtbnMgPSBfcHJvcHMyLmNvbHVtbnM7XG4gICAgICAgIHZhciBkYXRhID0gX3Byb3BzMi5kYXRhO1xuICAgICAgICB2YXIgZGVzZWxlY3RPbkNsaWNrQXdheSA9IF9wcm9wczIuZGVzZWxlY3RPbkNsaWNrQXdheTtcbiAgICAgICAgdmFyIGVtcHR5U3RhdGVTdHJpbmcgPSBfcHJvcHMyLmVtcHR5U3RhdGVTdHJpbmc7XG4gICAgICAgIHZhciBvblNlbGVjdFJvd3MgPSBfcHJvcHMyLm9uU2VsZWN0Um93cztcbiAgICAgICAgdmFyIGNvbXB1dGVSb3dTdHlsZSA9IF9wcm9wczIuY29tcHV0ZVJvd1N0eWxlO1xuICAgICAgICB2YXIgc2hvd0NoZWNrYm94ZXMgPSB0aGlzLnByb3BzLnNob3dDaGVja2JveGVzO1xuXG4gICAgICAgIHZhciByb3dzID0gZGF0YS5tYXAoZnVuY3Rpb24gKG1vZGVsKSB7XG4gICAgICAgICAgICB2YXIgcm93U3R5bGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAoY29tcHV0ZVJvd1N0eWxlKSB7XG4gICAgICAgICAgICAgICAgcm93U3R5bGUgPSBjb21wdXRlUm93U3R5bGUobW9kZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRhYmxlUm93LFxuICAgICAgICAgICAgICAgIHsgc2VsZWN0YWJsZTogb25TZWxlY3RSb3dzICE9PSB1bmRlZmluZWQsIHN0eWxlOiByb3dTdHlsZSB9LFxuICAgICAgICAgICAgICAgIGNvbHVtbnMubWFwKGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbW9kZWxbY29sdW1uLm5hbWVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uLnVzZU1vbWVudCAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBtb21lbnQobmV3IERhdGUocGFyc2VJbnQodmFsdWUpICogMTAwMCkpLmZyb21Ob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2x1bW4ucmVuZGVyQ2VsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjb2x1bW4ucmVuZGVyQ2VsbChtb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuVGFibGVSb3dDb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiBjb2x1bW4uc3R5bGUgfHwge30sIHRpdGxlOiB2YWx1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBoZWFkZXJzID0gY29sdW1ucy5tYXAoZnVuY3Rpb24gKGNvbHVtbikge1xuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRhYmxlSGVhZGVyQ29sdW1uLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IGNvbHVtbi5oZWFkZXJTdHlsZSB8fCB7fSB9LFxuICAgICAgICAgICAgICAgIGNvbHVtbi5sYWJlbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlbXB0eVN0YXRlU3RyaW5nICYmICFyb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgc2hvd0NoZWNrYm94ZXMgPSBmYWxzZTtcbiAgICAgICAgICAgIHJvd3MgPSBbX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuVGFibGVSb3csXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuVGFibGVSb3dDb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIHsgY29sc3BhbjogY29sdW1ucy5sZW5ndGggfSxcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlTdGF0ZVN0cmluZ1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICldO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgX21hdGVyaWFsVWkuVGFibGUsXG4gICAgICAgICAgICB7IG9uUm93U2VsZWN0aW9uOiB0aGlzLm9uUm93U2VsZWN0aW9uLmJpbmQodGhpcyksIG11bHRpU2VsZWN0YWJsZTogc2hvd0NoZWNrYm94ZXMgfSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRhYmxlSGVhZGVyLFxuICAgICAgICAgICAgICAgIHsgZGlzcGxheVNlbGVjdEFsbDogc2hvd0NoZWNrYm94ZXMsIGFkanVzdEZvckNoZWNrYm94OiBzaG93Q2hlY2tib3hlcywgZW5hYmxlU2VsZWN0QWxsOiBzaG93Q2hlY2tib3hlcyB9LFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICBfbWF0ZXJpYWxVaS5UYWJsZVJvdyxcbiAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBfbWF0ZXJpYWxVaS5UYWJsZUJvZHksXG4gICAgICAgICAgICAgICAgeyBkZXNlbGVjdE9uQ2xpY2thd2F5OiBkZXNlbGVjdE9uQ2xpY2tBd2F5LCBkaXNwbGF5Um93Q2hlY2tib3g6IHNob3dDaGVja2JveGVzIH0sXG4gICAgICAgICAgICAgICAgcm93c1xuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gTWF0ZXJpYWxUYWJsZTtcbn0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXG5NYXRlcmlhbFRhYmxlLlByb3BUeXBlcyA9IHtcbiAgICBkYXRhOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgIGNvbHVtbnM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYXJyYXksXG4gICAgb25TZWxlY3RSb3dzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgZW1wdHlTdGF0ZVN0cmluZzogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmdcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1hdGVyaWFsVGFibGU7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IFwiZGVmYXVsdFwiOiBvYmogfTsgfVxuXG52YXIgX1NpbXBsZUxpc3QgPSByZXF1aXJlKCcuL1NpbXBsZUxpc3QnKTtcblxudmFyIF9TaW1wbGVMaXN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1NpbXBsZUxpc3QpO1xuXG4vKipcbiAqIFNpbXBsZSB0byB1c2UgbGlzdCBjb21wb25lbnQgZW5jYXBzdWxhdGVkIHdpdGggaXRzIG93biBxdWVyeSBtZWNoYW5pc21cbiAqIHVzaW5nIGEgc2V0IG9mIHByb3BlcnRpZXMgZm9yIHRoZSByZW1vdGUgbm9kZSBwcm92aWRlci5cbiAqL1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6IFwiTm9kZUxpc3RDdXN0b21Qcm92aWRlclwiLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIG5vZGVQcm92aWRlclByb3BlcnRpZXM6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIHByZXNldERhdGFNb2RlbDogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoUHlkaW9EYXRhTW9kZWwpLFxuICAgICAgICBhdXRvUmVmcmVzaDogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICAgICAgYWN0aW9uQmFyR3JvdXBzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgICAgIGhlaWdodEF1dG9XaXRoTWF4OiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLFxuICAgICAgICBlbGVtZW50SGVpZ2h0OiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gICAgICAgIG5vZGVDbGlja2VkOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgcmVsb2FkT25TZXJ2ZXJNZXNzYWdlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBlbnRyeVJlbmRlckFzQ2FyZDogUmVhY3QuUHJvcFR5cGVzLmZ1bmNcbiAgICB9LFxuXG4gICAgcmVsb2FkOiBmdW5jdGlvbiByZWxvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlZnMubGlzdCAmJiB0aGlzLmlzTW91bnRlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnMubGlzdC5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9zbU9icykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5weWRpby5zdG9wT2JzZXJ2aW5nKFwic2VydmVyX21lc3NhZ2VcIiwgdGhpcy5fc21PYnMpO1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5weWRpby5zdG9wT2JzZXJ2aW5nKFwic2VydmVyX21lc3NhZ2U6XCIgKyB0aGlzLnByb3BzLnJlbG9hZE9uU2VydmVyTWVzc2FnZSwgdGhpcy5yZWxvYWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm5vZGVQcm92aWRlclByb3BlcnRpZXMgJiYgdGhpcy5wcm9wcy5ub2RlUHJvdmlkZXJQcm9wZXJ0aWVzICE9PSBuZXh0UHJvcHMubm9kZVByb3ZpZGVyUHJvcGVydGllcykge1xuICAgICAgICAgICAgdmFyIF9zdGF0ZSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICB2YXIgZGF0YU1vZGVsID0gX3N0YXRlLmRhdGFNb2RlbDtcbiAgICAgICAgICAgIHZhciBub2RlID0gX3N0YXRlLm5vZGU7XG5cbiAgICAgICAgICAgIHZhciBwcm92aWRlciA9IG5ldyBSZW1vdGVOb2RlUHJvdmlkZXIobmV4dFByb3BzLm5vZGVQcm92aWRlclByb3BlcnRpZXMpO1xuICAgICAgICAgICAgZGF0YU1vZGVsLnNldEFqeHBOb2RlUHJvdmlkZXIocHJvdmlkZXIpO1xuICAgICAgICAgICAgbm9kZS51cGRhdGVQcm92aWRlcihwcm92aWRlcik7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZGF0YU1vZGVsOiBkYXRhTW9kZWwsIG5vZGU6IG5vZGUgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5wcmVzZXREYXRhTW9kZWwgIT09IG5leHRQcm9wcy5wcmVzZXREYXRhTW9kZWwpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGFNb2RlbDogbmV4dFByb3BzLnByZXNldERhdGFNb2RlbCxcbiAgICAgICAgICAgICAgICBub2RlOiBuZXh0UHJvcHMucHJlc2V0RGF0YU1vZGVsLmdldFJvb3ROb2RlKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuXG4gICAgICAgIHZhciBkYXRhTW9kZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnByZXNldERhdGFNb2RlbCkge1xuICAgICAgICAgICAgZGF0YU1vZGVsID0gdGhpcy5wcm9wcy5wcmVzZXREYXRhTW9kZWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXRhTW9kZWwgPSBQeWRpb0RhdGFNb2RlbC5SZW1vdGVEYXRhTW9kZWxGYWN0b3J5KHRoaXMucHJvcHMubm9kZVByb3ZpZGVyUHJvcGVydGllcyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJvb3ROb2RlID0gZGF0YU1vZGVsLmdldFJvb3ROb2RlKCk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm5vZGVDbGlja2VkKSB7XG4gICAgICAgICAgICAvLyBsZWFmXG4gICAgICAgICAgICB0aGlzLm9wZW5FZGl0b3IgPSAoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm5vZGVDbGlja2VkKG5vZGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgICAgICAvLyBkaXJcbiAgICAgICAgICAgIGRhdGFNb2RlbC5vYnNlcnZlKFwic2VsZWN0aW9uX2NoYW5nZWRcIiwgKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZE5vZGVzID0gZXZlbnQubWVtby5nZXRTZWxlY3RlZE5vZGVzKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMubm9kZUNsaWNrZWQoc2VsZWN0ZWROb2Rlc1swXSk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Lm1lbW8uc2V0U2VsZWN0ZWROb2RlcyhbXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMucmVsb2FkT25TZXJ2ZXJNZXNzYWdlICYmIHRoaXMucHJvcHMucHlkaW8pIHtcbiAgICAgICAgICAgIHRoaXMuX3NtT2JzID0gKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChYTUxVdGlscy5YUGF0aFNlbGVjdFNpbmdsZU5vZGUoZXZlbnQsIHRoaXMucHJvcHMucmVsb2FkT25TZXJ2ZXJNZXNzYWdlKSkgdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnB5ZGlvLm9ic2VydmUoXCJzZXJ2ZXJfbWVzc2FnZVwiLCB0aGlzLl9zbU9icyk7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnB5ZGlvLm9ic2VydmUoXCJzZXJ2ZXJfbWVzc2FnZTpcIiArIHRoaXMucHJvcHMucmVsb2FkT25TZXJ2ZXJNZXNzYWdlLCB0aGlzLnJlbG9hZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgbm9kZTogcm9vdE5vZGUsIGRhdGFNb2RlbDogZGF0YU1vZGVsIH07XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgbGVnZW5kO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5sZWdlbmQpIHtcbiAgICAgICAgICAgIGxlZ2VuZCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJzdWJ0aXRsZVwiIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5sZWdlbmRcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IHRoaXMucHJvcHMuaGVpZ2h0QXV0b1dpdGhNYXggPyBcIlwiIDogXCJsYXlvdXQtZmlsbCB2ZXJ0aWNhbC1sYXlvdXRcIiB9LFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfU2ltcGxlTGlzdDJbXCJkZWZhdWx0XCJdLCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywge1xuICAgICAgICAgICAgICAgIG9wZW5FZGl0b3I6IHRoaXMub3BlbkVkaXRvcixcbiAgICAgICAgICAgICAgICByZWY6IFwibGlzdFwiLFxuICAgICAgICAgICAgICAgIHN0eWxlOiBPYmplY3QuYXNzaWduKHsgaGVpZ2h0OiAnMTAwJScgfSwgdGhpcy5wcm9wcy5zdHlsZSB8fCB7fSksXG4gICAgICAgICAgICAgICAgbm9kZTogdGhpcy5zdGF0ZS5ub2RlLFxuICAgICAgICAgICAgICAgIGRhdGFNb2RlbDogdGhpcy5zdGF0ZS5kYXRhTW9kZWwsXG4gICAgICAgICAgICAgICAgYWN0aW9uQmFyR3JvdXBzOiB0aGlzLnByb3BzLmFjdGlvbkJhckdyb3VwcyxcbiAgICAgICAgICAgICAgICBza2lwUGFyZW50TmF2aWdhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBvYnNlcnZlTm9kZVJlbG9hZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBoaWRlVG9vbGJhcjogdHJ1ZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX3JlYWN0U2Nyb2xsYmFyID0gcmVxdWlyZSgncmVhY3Qtc2Nyb2xsYmFyJyk7XG5cbnZhciBfcmVhY3RTY3JvbGxiYXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3RTY3JvbGxiYXIpO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4gPSByZXF1aXJlKCcuLi91dGlsL01lc3NhZ2VzQ29uc3VtZXJNaXhpbicpO1xuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbE1lc3NhZ2VzQ29uc3VtZXJNaXhpbik7XG5cbnZhciBfTGlzdEVudHJ5ID0gcmVxdWlyZSgnLi9MaXN0RW50cnknKTtcblxudmFyIF9UYWJsZUxpc3RFbnRyeSA9IHJlcXVpcmUoJy4vVGFibGVMaXN0RW50cnknKTtcblxudmFyIF9UYWJsZUxpc3RFbnRyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9UYWJsZUxpc3RFbnRyeSk7XG5cbnZhciBfVGFibGVMaXN0SGVhZGVyID0gcmVxdWlyZSgnLi9UYWJsZUxpc3RIZWFkZXInKTtcblxudmFyIF9UYWJsZUxpc3RIZWFkZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfVGFibGVMaXN0SGVhZGVyKTtcblxudmFyIF9Db25maWd1cmFibGVMaXN0RW50cnkgPSByZXF1aXJlKCcuL0NvbmZpZ3VyYWJsZUxpc3RFbnRyeScpO1xuXG52YXIgX0NvbmZpZ3VyYWJsZUxpc3RFbnRyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Db25maWd1cmFibGVMaXN0RW50cnkpO1xuXG52YXIgX1NvcnRDb2x1bW5zID0gcmVxdWlyZSgnLi9Tb3J0Q29sdW1ucycpO1xuXG52YXIgX1NvcnRDb2x1bW5zMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1NvcnRDb2x1bW5zKTtcblxudmFyIF9MaXN0UGFnaW5hdG9yID0gcmVxdWlyZSgnLi9MaXN0UGFnaW5hdG9yJyk7XG5cbnZhciBfTGlzdFBhZ2luYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9MaXN0UGFnaW5hdG9yKTtcblxudmFyIF92aWV3c1NpbXBsZVJlYWN0QWN0aW9uQmFyID0gcmVxdWlyZSgnLi4vdmlld3MvU2ltcGxlUmVhY3RBY3Rpb25CYXInKTtcblxudmFyIF92aWV3c1NpbXBsZVJlYWN0QWN0aW9uQmFyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3ZpZXdzU2ltcGxlUmVhY3RBY3Rpb25CYXIpO1xuXG52YXIgX0lubGluZUVkaXRvciA9IHJlcXVpcmUoJy4vSW5saW5lRWRpdG9yJyk7XG5cbnZhciBfSW5saW5lRWRpdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0lubGluZUVkaXRvcik7XG5cbnZhciBfdmlld3NFbXB0eVN0YXRlVmlldyA9IHJlcXVpcmUoJy4uL3ZpZXdzL0VtcHR5U3RhdGVWaWV3Jyk7XG5cbnZhciBfdmlld3NFbXB0eVN0YXRlVmlldzIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF92aWV3c0VtcHR5U3RhdGVWaWV3KTtcblxudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbnZhciBJbmZpbml0ZSA9IHJlcXVpcmUoJ3JlYWN0LWluZmluaXRlJyk7XG5cbnZhciBET01VdGlscyA9IHJlcXVpcmUoJ3B5ZGlvL3V0aWwvZG9tJyk7XG52YXIgTGFuZ1V0aWxzID0gcmVxdWlyZSgncHlkaW8vdXRpbC9sYW5nJyk7XG52YXIgUHlkaW9EYXRhTW9kZWwgPSByZXF1aXJlKCdweWRpby9tb2RlbC9kYXRhLW1vZGVsJyk7XG52YXIgUGVyaW9kaWNhbEV4ZWN1dGVyID0gcmVxdWlyZSgncHlkaW8vdXRpbC9wZXJpb2RpY2FsLWV4ZWN1dGVyJyk7XG5cbi8qKlxuICogR2VuZXJpYyBMaXN0IGNvbXBvbmVudCwgdXNpbmcgSW5maW5pdGUgZm9yIGNlbGwgdmlydHVhbGl6YXRpb24sIHBhZ2luYXRpb24sIHZhcmlvdXNcbiAqIGRpc3BsYXlzLCBldGMuLi4gSXQgcHJvdmlkZXMgbWFueSBob29rcyBmb3IgcmVuZGVyaW5nIGNlbGxzIG9uLWRlbWFuZC5cbiAqL1xudmFyIFNpbXBsZUxpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdTaW1wbGVMaXN0JyxcblxuICAgIG1peGluczogW191dGlsTWVzc2FnZXNDb25zdW1lck1peGluMlsnZGVmYXVsdCddXSxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBpbmZpbml0ZVNsaWNlQ291bnQ6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG4gICAgICAgIGZpbHRlck5vZGVzOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgY3VzdG9tVG9vbGJhcjogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgdGFibGVLZXlzOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICBhdXRvUmVmcmVzaDogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICAgICAgcmVsb2FkQXRDdXJzb3I6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBjbGVhclNlbGVjdGlvbk9uUmVsb2FkOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgaGVpZ2h0QXV0b1dpdGhNYXg6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG4gICAgICAgIGNvbnRhaW5lckhlaWdodDogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICAgICAgb2JzZXJ2ZU5vZGVSZWxvYWQ6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBkZWZhdWx0R3JvdXBCeTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgZGVmYXVsdEdyb3VwQnlMYWJlbDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcblxuICAgICAgICBza2lwUGFyZW50TmF2aWdhdGlvbjogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHNraXBJbnRlcm5hbERhdGFNb2RlbDogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIGRlbGF5SW5pdGlhbExvYWQ6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG5cbiAgICAgICAgZW50cnlFbmFibGVTZWxlY3RvcjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIHJlbmRlckN1c3RvbUVudHJ5OiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgZW50cnlSZW5kZXJJY29uOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgZW50cnlSZW5kZXJBY3Rpb25zOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgZW50cnlSZW5kZXJGaXJzdExpbmU6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBlbnRyeVJlbmRlclNlY29uZExpbmU6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBlbnRyeVJlbmRlclRoaXJkTGluZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIGVudHJ5SGFuZGxlQ2xpY2tzOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgaGlkZVRvb2xiYXI6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBjb21wdXRlQWN0aW9uc0Zvck5vZGU6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBtdWx0aXBsZUFjdGlvbnM6IFJlYWN0LlByb3BUeXBlcy5hcnJheSxcblxuICAgICAgICBvcGVuRWRpdG9yOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgb3BlbkNvbGxlY3Rpb246IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuXG4gICAgICAgIGVsZW1lbnRTdHlsZTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgcGFzc1Njcm9sbGluZ1N0YXRlVG9DaGlsZHJlbjogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIGVsZW1lbnRIZWlnaHQ6IFJlYWN0LlByb3BUeXBlcy5vbmVPZlR5cGUoW1JlYWN0LlByb3BUeXBlcy5udW1iZXIsIFJlYWN0LlByb3BUeXBlcy5vYmplY3RdKS5pc1JlcXVpcmVkXG5cbiAgICB9LFxuXG4gICAgc3RhdGljczoge1xuICAgICAgICBIRUlHSFRfT05FX0xJTkU6IDUwLFxuICAgICAgICBIRUlHSFRfVFdPX0xJTkVTOiA3MyxcbiAgICAgICAgQ0xJQ0tfVFlQRV9TSU1QTEU6ICdzaW1wbGUnLFxuICAgICAgICBDTElDS19UWVBFX0RPVUJMRTogJ2RvdWJsZScsXG4gICAgICAgIFBBUkVOVF9GT0xERVJfSUNPTjogJ21kaSBtZGktY2hldnJvbi1sZWZ0J1xuICAgIH0sXG5cbiAgICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICAgICAgcmV0dXJuIHsgaW5maW5pdGVTbGljZUNvdW50OiAzMCwgY2xlYXJTZWxlY3Rpb25PblJlbG9hZDogdHJ1ZSB9O1xuICAgIH0sXG5cbiAgICBjbGlja1JvdzogZnVuY3Rpb24gY2xpY2tSb3coZ3JpZFJvdywgZXZlbnQpIHtcbiAgICAgICAgdmFyIG5vZGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChncmlkUm93LnByb3BzKSB7XG4gICAgICAgICAgICBub2RlID0gZ3JpZFJvdy5wcm9wcy5kYXRhLm5vZGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub2RlID0gZ3JpZFJvdztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5lbnRyeUhhbmRsZUNsaWNrcykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5lbnRyeUhhbmRsZUNsaWNrcyhub2RlLCBTaW1wbGVMaXN0LkNMSUNLX1RZUEVfU0lNUExFLCBldmVudCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUuaXNMZWFmKCkgJiYgdGhpcy5wcm9wcy5vcGVuRWRpdG9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5vcGVuRWRpdG9yKG5vZGUpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB1bmlxdWVTZWxlY3Rpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICB1bmlxdWVTZWxlY3Rpb24uc2V0KG5vZGUsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGlvbjogdW5pcXVlU2VsZWN0aW9uIH0sIHRoaXMucmVidWlsZExvYWRlZEVsZW1lbnRzKTtcbiAgICAgICAgfSBlbHNlIGlmICghbm9kZS5pc0xlYWYoKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub3BlbkNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm9wZW5Db2xsZWN0aW9uKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmRhdGFNb2RlbC5zZXRTZWxlY3RlZE5vZGVzKFtub2RlXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZG91YmxlQ2xpY2tSb3c6IGZ1bmN0aW9uIGRvdWJsZUNsaWNrUm93KGdyaWRSb3csIGV2ZW50KSB7XG4gICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoZ3JpZFJvdy5wcm9wcykge1xuICAgICAgICAgICAgbm9kZSA9IGdyaWRSb3cucHJvcHMuZGF0YS5ub2RlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9kZSA9IGdyaWRSb3c7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZW50cnlIYW5kbGVDbGlja3MpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZW50cnlIYW5kbGVDbGlja3Mobm9kZSwgU2ltcGxlTGlzdC5DTElDS19UWVBFX0RPVUJMRSwgZXZlbnQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uQ29sdW1uU29ydDogZnVuY3Rpb24gb25Db2x1bW5Tb3J0KGNvbHVtbikge1xuICAgICAgICB2YXIgc3RhdGVTZXRDYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgdmFyIHBhZ2luYXRpb24gPSB0aGlzLnByb3BzLm5vZGUuZ2V0TWV0YWRhdGEoKS5nZXQoJ3BhZ2luYXRpb25EYXRhJyk7XG4gICAgICAgIGlmIChwYWdpbmF0aW9uICYmIHBhZ2luYXRpb24uZ2V0KCd0b3RhbCcpID4gMSAmJiBwYWdpbmF0aW9uLmdldCgncmVtb3RlX29yZGVyJykpIHtcblxuICAgICAgICAgICAgdmFyIGRpciA9ICdhc2MnO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMubm9kZS5nZXRNZXRhZGF0YSgpLmdldCgncGFnaW5hdGlvbkRhdGEnKS5nZXQoJ2N1cnJlbnRPcmRlckRpcicpKSB7XG4gICAgICAgICAgICAgICAgZGlyID0gdGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KCdwYWdpbmF0aW9uRGF0YScpLmdldCgnY3VycmVudE9yZGVyRGlyJykgPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgb3JkZXJEYXRhID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgb3JkZXJEYXRhLnNldCgnb3JkZXJfY29sdW1uJywgY29sdW1uWydyZW1vdGVTb3J0QXR0cmlidXRlJ10gPyBjb2x1bW4ucmVtb3RlU29ydEF0dHJpYnV0ZSA6IGNvbHVtbi5uYW1lKTtcbiAgICAgICAgICAgIG9yZGVyRGF0YS5zZXQoJ29yZGVyX2RpcmVjdGlvbicsIGRpcik7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm5vZGUuZ2V0TWV0YWRhdGEoKS5zZXQoXCJyZW1vdGVfb3JkZXJcIiwgb3JkZXJEYXRhKTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLnJlcXVpcmVDb250ZXh0Q2hhbmdlKHRoaXMucHJvcHMubm9kZSwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHZhciBhdHQgPSBjb2x1bW5bJ3NvcnRBdHRyaWJ1dGUnXSA/IGNvbHVtblsnc29ydEF0dHJpYnV0ZSddIDogY29sdW1uLm5hbWU7XG4gICAgICAgICAgICB2YXIgc29ydGluZ0luZm8gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB2YXIgX3N0YXRlJHNvcnRpbmdJbmZvID0gdGhpcy5zdGF0ZS5zb3J0aW5nSW5mbztcbiAgICAgICAgICAgIHZhciBhdHRyaWJ1dGUgPSBfc3RhdGUkc29ydGluZ0luZm8uYXR0cmlidXRlO1xuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IF9zdGF0ZSRzb3J0aW5nSW5mby5kaXJlY3Rpb247XG5cbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUgPT09IGF0dCAmJiBkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnYXNjJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBTd2l0Y2ggZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIHNvcnRpbmdJbmZvID0geyBhdHRyaWJ1dGU6IGF0dCwgc29ydFR5cGU6IGNvbHVtbi5zb3J0VHlwZSwgZGlyZWN0aW9uOiAnZGVzYycgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBzb3J0aW5nXG4gICAgICAgICAgICAgICAgICAgIHNvcnRpbmdJbmZvID0gdGhpcy5wcm9wcy5kZWZhdWx0U29ydGluZ0luZm8gfHwge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5mbyA9IHsgYXR0cmlidXRlOiBhdHQsIHNvcnRUeXBlOiBjb2x1bW4uc29ydFR5cGUsIGRpcmVjdGlvbjogJ2FzYycgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzb3J0aW5nSW5mbzogc29ydGluZ0luZm8gfSwgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlYnVpbGRMb2FkZWRFbGVtZW50cygpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZVNldENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlU2V0Q2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wdXRlU2VsZWN0aW9uRnJvbUN1cnJlbnRQbHVzVGFyZ2V0Tm9kZTogZnVuY3Rpb24gY29tcHV0ZVNlbGVjdGlvbkZyb21DdXJyZW50UGx1c1RhcmdldE5vZGUoY3VycmVudFNlbGVjdGlvbiwgdGFyZ2V0Tm9kZSkge1xuXG4gICAgICAgIHZhciBjdXJyZW50SW5kZXhTdGFydCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGN1cnJlbnRJbmRleEVuZCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG5vZGVCZWZvcmUgPSBmYWxzZTtcbiAgICAgICAgaWYgKCF0aGlzLmluZGV4ZWRFbGVtZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBmaXJzdFNlbGVjdGVkID0gY3VycmVudFNlbGVjdGlvblswXTtcbiAgICAgICAgdmFyIGxhc3RTZWxlY3RlZCA9IGN1cnJlbnRTZWxlY3Rpb25bY3VycmVudFNlbGVjdGlvbi5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5ld1NlbGVjdGlvbiA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW5kZXhlZEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudEluZGV4U3RhcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5ld1NlbGVjdGlvbi5wdXNoKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldLm5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldLm5vZGUgPT09IHRhcmdldE5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEluZGV4U3RhcnQgIT09IHVuZGVmaW5lZCAmJiBjdXJyZW50SW5kZXhFbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXhFbmQgPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY3VycmVudEluZGV4U3RhcnQgPSBpO1xuICAgICAgICAgICAgICAgIG5vZGVCZWZvcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5ld1NlbGVjdGlvbi5wdXNoKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldLm5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldLm5vZGUgPT09IGZpcnN0U2VsZWN0ZWQgJiYgY3VycmVudEluZGV4U3RhcnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleFN0YXJ0ID0gaTtcbiAgICAgICAgICAgICAgICBuZXdTZWxlY3Rpb24ucHVzaCh0aGlzLmluZGV4ZWRFbGVtZW50c1tpXS5ub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmluZGV4ZWRFbGVtZW50c1tpXS5ub2RlID09PSBsYXN0U2VsZWN0ZWQgJiYgbm9kZUJlZm9yZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleEVuZCA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld1NlbGVjdGlvbjtcbiAgICB9LFxuXG4gICAgb25LZXlEb3duOiBmdW5jdGlvbiBvbktleURvd24oZSkge1xuICAgICAgICB2YXIgY3VycmVudEluZGV4U3RhcnQgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBjdXJyZW50SW5kZXhFbmQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBjb250ZXh0SG9sZGVyID0gd2luZG93LnB5ZGlvLmdldENvbnRleHRIb2xkZXIoKTtcbiAgICAgICAgdmFyIGVsZW1lbnRzUGVyTGluZSA9IHRoaXMucHJvcHMuZWxlbWVudHNQZXJMaW5lIHx8IDE7XG4gICAgICAgIHZhciBzaGlmdEtleSA9IGUuc2hpZnRLZXk7XG4gICAgICAgIHZhciBrZXkgPSBlLmtleTtcblxuICAgICAgICBpZiAoY29udGV4dEhvbGRlci5pc0VtcHR5KCkgfHwgIXRoaXMuaW5kZXhlZEVsZW1lbnRzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRvd25LZXlzID0gWydBcnJvd0Rvd24nLCAnQXJyb3dSaWdodCcsICdQYWdlRG93bicsICdFbmQnXTtcblxuICAgICAgICB2YXIgcG9zaXRpb24gPSBzaGlmdEtleSAmJiBkb3duS2V5cy5pbmRleE9mKGtleSkgPiAtMSA/ICdmaXJzdCcgOiAnbGFzdCc7XG4gICAgICAgIHZhciBjdXJyZW50U2VsZWN0aW9uID0gY29udGV4dEhvbGRlci5nZXRTZWxlY3RlZE5vZGVzKCk7XG5cbiAgICAgICAgdmFyIGZpcnN0U2VsZWN0ZWQgPSBjdXJyZW50U2VsZWN0aW9uWzBdO1xuICAgICAgICB2YXIgbGFzdFNlbGVjdGVkID0gY3VycmVudFNlbGVjdGlvbltjdXJyZW50U2VsZWN0aW9uLmxlbmd0aCAtIDFdO1xuXG4gICAgICAgIGlmIChrZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICAgIHRoaXMuZG91YmxlQ2xpY2tSb3coZmlyc3RTZWxlY3RlZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PT0gJ0RlbGV0ZScgJiYgZ2xvYmFsLnB5ZGlvLkNvbnRyb2xsZXIuZmlyZUFjdGlvbkJ5S2V5KCdrZXlfZGVsZXRlJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pbmRleGVkRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmluZGV4ZWRFbGVtZW50c1tpXS5ub2RlID09PSBmaXJzdFNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudEluZGV4U3RhcnQgPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldLm5vZGUgPT09IGxhc3RTZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleEVuZCA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNlbGVjdGlvbkluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgICB2YXIgbWF4SW5kZXggPSB0aGlzLmluZGV4ZWRFbGVtZW50cy5sZW5ndGggLSAxO1xuICAgICAgICB2YXIgaW5jcmVtZW50ID0ga2V5ID09PSAnUGFnZURvd24nIHx8IGtleSA9PT0gJ1BhZ2VVcCcgPyAxMCA6IDE7XG4gICAgICAgIGlmIChrZXkgPT09ICdBcnJvd0Rvd24nIHx8IGtleSA9PT0gJ1BhZ2VEb3duJykge1xuICAgICAgICAgICAgc2VsZWN0aW9uSW5kZXggPSBNYXRoLm1pbihjdXJyZW50SW5kZXhFbmQgKyBlbGVtZW50c1BlckxpbmUgKiBpbmNyZW1lbnQsIG1heEluZGV4KTtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdBcnJvd1VwJyB8fCBrZXkgPT09ICdQYWdlVXAnKSB7XG4gICAgICAgICAgICBzZWxlY3Rpb25JbmRleCA9IE1hdGgubWF4KGN1cnJlbnRJbmRleFN0YXJ0IC0gZWxlbWVudHNQZXJMaW5lICogaW5jcmVtZW50LCAwKTtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdIb21lJykge1xuICAgICAgICAgICAgc2VsZWN0aW9uSW5kZXggPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ0VuZCcpIHtcbiAgICAgICAgICAgIHNlbGVjdGlvbkluZGV4ID0gbWF4SW5kZXg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnRzUGVyTGluZSA+IDEpIHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICdBcnJvd1JpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbkluZGV4ID0gY3VycmVudEluZGV4RW5kICsgMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnQXJyb3dMZWZ0Jykge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbkluZGV4ID0gY3VycmVudEluZGV4U3RhcnQgLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNoaWZ0S2V5ICYmIHNlbGVjdGlvbkluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBtaW4gPSBNYXRoLm1pbihjdXJyZW50SW5kZXhTdGFydCwgY3VycmVudEluZGV4RW5kLCBzZWxlY3Rpb25JbmRleCk7XG4gICAgICAgICAgICB2YXIgbWF4ID0gTWF0aC5tYXgoY3VycmVudEluZGV4U3RhcnQsIGN1cnJlbnRJbmRleEVuZCwgc2VsZWN0aW9uSW5kZXgpO1xuICAgICAgICAgICAgaWYgKG1pbiAhPT0gbWF4KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBtaW47IGkgPCBtYXggKyAxOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXhlZEVsZW1lbnRzW2ldKSBzZWxlY3Rpb24ucHVzaCh0aGlzLmluZGV4ZWRFbGVtZW50c1tpXS5ub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGV4dEhvbGRlci5zZXRTZWxlY3RlZE5vZGVzKHNlbGVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pbmRleGVkRWxlbWVudHNbc2VsZWN0aW9uSW5kZXhdICYmIHRoaXMuaW5kZXhlZEVsZW1lbnRzW3NlbGVjdGlvbkluZGV4XS5ub2RlKSB7XG4gICAgICAgICAgICBjb250ZXh0SG9sZGVyLnNldFNlbGVjdGVkTm9kZXMoW3RoaXMuaW5kZXhlZEVsZW1lbnRzW3NlbGVjdGlvbkluZGV4XS5ub2RlXSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uc0NhY2hlID0geyBtdWx0aXBsZTogbmV3IE1hcCgpIH07XG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5za2lwSW50ZXJuYWxEYXRhTW9kZWwpIHtcbiAgICAgICAgICAgIHRoaXMuZG0gPSBuZXcgUHlkaW9EYXRhTW9kZWwoKTtcbiAgICAgICAgICAgIHRoaXMuZG0uc2V0Um9vdE5vZGUodGhpcy5wcm9wcy5kYXRhTW9kZWwuZ2V0Q29udGV4dE5vZGUoKSk7XG4gICAgICAgICAgICB0aGlzLmRtLnNldENvbnRleHROb2RlKHRoaXMucHJvcHMuZGF0YU1vZGVsLmdldENvbnRleHROb2RlKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kbSA9IHRoaXMucHJvcHMuZGF0YU1vZGVsO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdGF0ZSA9IHtcbiAgICAgICAgICAgIGxvYWRlZDogdGhpcy5wcm9wcy5ub2RlLmlzTG9hZGVkKCksXG4gICAgICAgICAgICBsb2FkaW5nOiAhdGhpcy5wcm9wcy5ub2RlLmlzTG9hZGVkKCksXG4gICAgICAgICAgICBzaG93U2VsZWN0b3I6IGZhbHNlLFxuICAgICAgICAgICAgZWxlbWVudHM6IHRoaXMucHJvcHMubm9kZS5pc0xvYWRlZCgpID8gdGhpcy5idWlsZEVsZW1lbnRzKDAsIHRoaXMucHJvcHMuaW5maW5pdGVTbGljZUNvdW50KSA6IFtdLFxuICAgICAgICAgICAgY29udGFpbmVySGVpZ2h0OiB0aGlzLnByb3BzLmNvbnRhaW5lckhlaWdodCA/IHRoaXMucHJvcHMuY29udGFpbmVySGVpZ2h0IDogdGhpcy5wcm9wcy5oZWlnaHRBdXRvV2l0aE1heCA/IDAgOiA1MDAsXG4gICAgICAgICAgICBzb3J0aW5nSW5mbzogdGhpcy5wcm9wcy5kZWZhdWx0U29ydGluZ0luZm8gfHwgbnVsbFxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5lbGVtZW50SGVpZ2h0IGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICBzdGF0ZS5lbGVtZW50SGVpZ2h0ID0gdGhpcy5jb21wdXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBzdGF0ZS5pbmZpbml0ZUxvYWRCZWdpbkJvdHRvbU9mZnNldCA9IDIwMDtcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH0sXG5cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuaW5kZXhlZEVsZW1lbnRzID0gbnVsbDtcbiAgICAgICAgdmFyIGN1cnJlbnRMZW5ndGggPSBNYXRoLm1heCh0aGlzLnN0YXRlLmVsZW1lbnRzLmxlbmd0aCwgbmV4dFByb3BzLmluZmluaXRlU2xpY2VDb3VudCk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbG9hZGVkOiBuZXh0UHJvcHMubm9kZS5pc0xvYWRlZCgpLFxuICAgICAgICAgICAgbG9hZGluZzogIW5leHRQcm9wcy5ub2RlLmlzTG9hZGVkKCksXG4gICAgICAgICAgICBzaG93U2VsZWN0b3I6IGZhbHNlLFxuICAgICAgICAgICAgZWxlbWVudHM6IG5leHRQcm9wcy5ub2RlLmlzTG9hZGVkKCkgPyB0aGlzLmJ1aWxkRWxlbWVudHMoMCwgY3VycmVudExlbmd0aCwgbmV4dFByb3BzLm5vZGUpIDogW10sXG4gICAgICAgICAgICBpbmZpbml0ZUxvYWRCZWdpbkJvdHRvbU9mZnNldDogMjAwLFxuICAgICAgICAgICAgc29ydGluZ0luZm86IHRoaXMuc3RhdGUuc29ydGluZ0luZm8gfHwgbmV4dFByb3BzLmRlZmF1bHRTb3J0aW5nSW5mbyB8fCBudWxsXG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChuZXh0UHJvcHMubm9kZS5pc0xvYWRlZCgpKSBfdGhpcy51cGRhdGVJbmZpbml0ZUNvbnRhaW5lckhlaWdodCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFuZXh0UHJvcHMuYXV0b1JlZnJlc2ggJiYgdGhpcy5yZWZyZXNoSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMucmVmcmVzaEludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaEludGVydmFsID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChuZXh0UHJvcHMuYXV0b1JlZnJlc2ggJiYgIXRoaXMucmVmcmVzaEludGVydmFsKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCh0aGlzLnJlbG9hZCwgbmV4dFByb3BzLmF1dG9SZWZyZXNoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhdGNoSW5maW5pdGVHcmlkKG5leHRQcm9wcy5lbGVtZW50c1BlckxpbmUpO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5ub2RlICYmIG5leHRQcm9wcy5ub2RlICE9PSB0aGlzLnByb3BzLm5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZU5vZGVDaGlsZHJlbih0aGlzLnByb3BzLm5vZGUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9tYW51YWxTY3JvbGxQZSkge1xuICAgICAgICAgICAgdGhpcy5fbWFudWFsU2Nyb2xsUGUuc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5fbWFudWFsU2Nyb2xsUGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9ic2VydmVOb2RlQ2hpbGRyZW46IGZ1bmN0aW9uIG9ic2VydmVOb2RlQ2hpbGRyZW4obm9kZSkge1xuICAgICAgICB2YXIgc3RvcCA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzFdO1xuXG4gICAgICAgIGlmIChzdG9wICYmICF0aGlzLl9jaGlsZHJlbk9ic2VydmVyKSByZXR1cm47XG5cbiAgICAgICAgaWYgKCF0aGlzLl9jaGlsZHJlbk9ic2VydmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlbk9ic2VydmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4ZWRFbGVtZW50cyA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWJ1aWxkTG9hZGVkRWxlbWVudHMoKTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9jaGlsZHJlbkFjdGlvbnNPYnNlcnZlcikge1xuICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5BY3Rpb25zT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKGV2ZW50TWVtbykge1xuICAgICAgICAgICAgICAgIGlmIChldmVudE1lbW8udHlwZSA9PT0gJ3Byb21wdC1yZW5hbWUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpbmxpbmVFZGl0aW9uRm9yTm9kZTogZXZlbnRNZW1vLmNoaWxkLCBpbmxpbmVFZGl0aW9uQ2FsbGJhY2s6IGV2ZW50TWVtby5jYWxsYmFjayB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdG9wKSB7XG4gICAgICAgICAgICBub2RlLnN0b3BPYnNlcnZpbmcoXCJjaGlsZF9hZGRlZFwiLCB0aGlzLl9jaGlsZHJlbk9ic2VydmVyKTtcbiAgICAgICAgICAgIG5vZGUuc3RvcE9ic2VydmluZyhcImNoaWxkX3JlbW92ZWRcIiwgdGhpcy5fY2hpbGRyZW5PYnNlcnZlcik7XG4gICAgICAgICAgICBub2RlLnN0b3BPYnNlcnZpbmcoXCJjaGlsZF9ub2RlX2FjdGlvblwiLCB0aGlzLl9jaGlsZHJlbkFjdGlvbnNPYnNlcnZlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub2RlLm9ic2VydmUoXCJjaGlsZF9hZGRlZFwiLCB0aGlzLl9jaGlsZHJlbk9ic2VydmVyKTtcbiAgICAgICAgICAgIG5vZGUub2JzZXJ2ZShcImNoaWxkX3JlbW92ZWRcIiwgdGhpcy5fY2hpbGRyZW5PYnNlcnZlcik7XG4gICAgICAgICAgICBub2RlLm9ic2VydmUoXCJjaGlsZF9ub2RlX2FjdGlvblwiLCB0aGlzLl9jaGlsZHJlbkFjdGlvbnNPYnNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2xvYWROb2RlSWZOb3RMb2FkZWQ6IGZ1bmN0aW9uIF9sb2FkTm9kZUlmTm90TG9hZGVkKCkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMucHJvcHMubm9kZTtcblxuICAgICAgICBpZiAoIW5vZGUuaXNMb2FkZWQoKSkge1xuICAgICAgICAgICAgbm9kZS5vYnNlcnZlT25jZShcImxvYWRlZFwiLCAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc01vdW50ZWQoKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm5vZGUgPT09IG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYnNlcnZlTm9kZUNoaWxkcmVuKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHM6IHRoaXMuYnVpbGRFbGVtZW50cygwLCB0aGlzLnByb3BzLmluZmluaXRlU2xpY2VDb3VudClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmhlaWdodEF1dG9XaXRoTWF4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIG5vZGUubG9hZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vYnNlcnZlTm9kZUNoaWxkcmVuKG5vZGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9sb2FkaW5nTGlzdGVuZXI6IGZ1bmN0aW9uIF9sb2FkaW5nTGlzdGVuZXIoKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZU5vZGVDaGlsZHJlbih0aGlzLnByb3BzLm5vZGUsIHRydWUpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGVkOiBmYWxzZSwgbG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5pbmRleGVkRWxlbWVudHMgPSBudWxsO1xuICAgIH0sXG4gICAgX2xvYWRlZExpc3RlbmVyOiBmdW5jdGlvbiBfbG9hZGVkTGlzdGVuZXIoKSB7XG4gICAgICAgIHZhciBjdXJyZW50TGVuZ3RoID0gTWF0aC5tYXgodGhpcy5zdGF0ZS5lbGVtZW50cy5sZW5ndGgsIHRoaXMucHJvcHMuaW5maW5pdGVTbGljZUNvdW50KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGVsZW1lbnRzOiB0aGlzLmJ1aWxkRWxlbWVudHMoMCwgY3VycmVudExlbmd0aCwgdGhpcy5wcm9wcy5ub2RlKVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaGVpZ2h0QXV0b1dpdGhNYXgpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9ic2VydmVOb2RlQ2hpbGRyZW4odGhpcy5wcm9wcy5ub2RlKTtcbiAgICB9LFxuXG4gICAgcmVsb2FkOiBmdW5jdGlvbiByZWxvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbG9hZEF0Q3Vyc29yICYmIHRoaXMuX2N1cnJlbnRDdXJzb3IpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFN0YXJ0aW5nQXRDdXJzb3IoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5jbGVhclNlbGVjdGlvbk9uUmVsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmRhdGFNb2RlbC5zZXRTZWxlY3RlZE5vZGVzKFtdKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9sb2FkaW5nTGlzdGVuZXIoKTtcbiAgICAgICAgdGhpcy5wcm9wcy5ub2RlLm9ic2VydmVPbmNlKFwibG9hZGVkXCIsIHRoaXMuX2xvYWRlZExpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5wcm9wcy5ub2RlLnJlbG9hZCgpO1xuICAgIH0sXG5cbiAgICBsb2FkU3RhcnRpbmdBdEN1cnNvcjogZnVuY3Rpb24gbG9hZFN0YXJ0aW5nQXRDdXJzb3IoKSB7XG4gICAgICAgIHRoaXMuX2xvYWRpbmdMaXN0ZW5lcigpO1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMucHJvcHMubm9kZTtcbiAgICAgICAgdmFyIGNhY2hlZENoaWxkcmVuID0gbm9kZS5nZXRDaGlsZHJlbigpO1xuICAgICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBbXTtcbiAgICAgICAgbm9kZS5vYnNlcnZlT25jZShcImxvYWRlZFwiLCAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlb3JkZXJlZENoaWxkcmVuID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgbmV3Q2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgcmVvcmRlcmVkQ2hpbGRyZW4uc2V0KGMuZ2V0UGF0aCgpLCBjKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FjaGVkQ2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgICAgIHJlb3JkZXJlZENoaWxkcmVuLnNldChjLmdldFBhdGgoKSwgYyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5vZGUuX2NoaWxkcmVuID0gcmVvcmRlcmVkQ2hpbGRyZW47XG4gICAgICAgICAgICB0aGlzLl9sb2FkZWRMaXN0ZW5lcigpO1xuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgbm9kZS5zZXRMb2FkZWQoZmFsc2UpO1xuICAgICAgICBub2RlLm9ic2VydmUoXCJjaGlsZF9hZGRlZFwiLCBmdW5jdGlvbiAobmV3Q2hpbGQpIHtcbiAgICAgICAgICAgIG5ld0NoaWxkcmVuLnB1c2gobm9kZS5fY2hpbGRyZW4uZ2V0KG5ld0NoaWxkKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnByb3BzLm5vZGUubG9hZChudWxsLCB7IGN1cnNvcjogdGhpcy5fY3VycmVudEN1cnNvciB9KTtcbiAgICB9LFxuXG4gICAgd2lyZVJlbG9hZExpc3RlbmVyczogZnVuY3Rpb24gd2lyZVJlbG9hZExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy53cmFwcGVkTG9hZGluZyA9IHRoaXMuX2xvYWRpbmdMaXN0ZW5lcjtcbiAgICAgICAgdGhpcy53cmFwcGVkTG9hZGVkID0gdGhpcy5fbG9hZGVkTGlzdGVuZXI7XG4gICAgICAgIHRoaXMucHJvcHMubm9kZS5vYnNlcnZlKFwibG9hZGluZ1wiLCB0aGlzLndyYXBwZWRMb2FkaW5nKTtcbiAgICAgICAgdGhpcy5wcm9wcy5ub2RlLm9ic2VydmUoXCJsb2FkZWRcIiwgdGhpcy53cmFwcGVkTG9hZGVkKTtcbiAgICB9LFxuICAgIHN0b3BSZWxvYWRMaXN0ZW5lcnM6IGZ1bmN0aW9uIHN0b3BSZWxvYWRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMucHJvcHMubm9kZS5zdG9wT2JzZXJ2aW5nKFwibG9hZGluZ1wiLCB0aGlzLndyYXBwZWRMb2FkaW5nKTtcbiAgICAgICAgdGhpcy5wcm9wcy5ub2RlLnN0b3BPYnNlcnZpbmcoXCJsb2FkZWRcIiwgdGhpcy53cmFwcGVkTG9hZGVkKTtcbiAgICB9LFxuXG4gICAgdG9nZ2xlU2VsZWN0b3I6IGZ1bmN0aW9uIHRvZ2dsZVNlbGVjdG9yKCkge1xuICAgICAgICAvLyBGb3JjZSByZWJ1aWxkIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2hvd1NlbGVjdG9yOiAhdGhpcy5zdGF0ZS5zaG93U2VsZWN0b3IsXG4gICAgICAgICAgICBzZWxlY3Rpb246IG5ldyBNYXAoKVxuICAgICAgICB9LCB0aGlzLnJlYnVpbGRMb2FkZWRFbGVtZW50cyk7XG4gICAgfSxcblxuICAgIHRvZ2dsZVNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlU2VsZWN0aW9uKG5vZGUpIHtcbiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuc3RhdGUuc2VsZWN0aW9uIHx8IG5ldyBNYXAoKTtcbiAgICAgICAgaWYgKHNlbGVjdGlvbi5nZXQobm9kZSkpIHNlbGVjdGlvblsnZGVsZXRlJ10obm9kZSk7ZWxzZSBzZWxlY3Rpb24uc2V0KG5vZGUsIHRydWUpO1xuICAgICAgICBpZiAodGhpcy5yZWZzLmFsbF9zZWxlY3RvcikgdGhpcy5yZWZzLmFsbF9zZWxlY3Rvci5zZXRDaGVja2VkKGZhbHNlKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvblxuICAgICAgICB9LCB0aGlzLnJlYnVpbGRMb2FkZWRFbGVtZW50cyk7XG4gICAgfSxcblxuICAgIHNlbGVjdEFsbDogZnVuY3Rpb24gc2VsZWN0QWxsKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5yZWZzLmFsbF9zZWxlY3RvciAmJiAhdGhpcy5yZWZzLmFsbF9zZWxlY3Rvci5pc0NoZWNrZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGlvbjogbmV3IE1hcCgpIH0sIHRoaXMucmVidWlsZExvYWRlZEVsZW1lbnRzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IG5ldyBNYXAoKTtcbiAgICAgICAgICAgICAgICBfdGhpczIucHJvcHMubm9kZS5nZXRDaGlsZHJlbigpLmZvckVhY2goKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5maWx0ZXJOb2RlcyAmJiAhdGhpcy5wcm9wcy5maWx0ZXJOb2RlcyhjaGlsZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaXNMZWFmKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5zZXQoY2hpbGQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuYmluZChfdGhpczIpKTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLnJlZnMuYWxsX3NlbGVjdG9yKSBfdGhpczIucmVmcy5hbGxfc2VsZWN0b3Iuc2V0Q2hlY2tlZCh0cnVlKTtcbiAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzZWxlY3Rpb246IHNlbGVjdGlvbiB9LCBfdGhpczIucmVidWlsZExvYWRlZEVsZW1lbnRzKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXBwbHlNdWx0aXBsZUFjdGlvbjogZnVuY3Rpb24gYXBwbHlNdWx0aXBsZUFjdGlvbihldikge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuc2VsZWN0aW9uIHx8ICF0aGlzLnN0YXRlLnNlbGVjdGlvbi5zaXplKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFjdGlvbk5hbWUgPSBldi5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1hY3Rpb24nKTtcbiAgICAgICAgdmFyIGRtID0gdGhpcy5kbSB8fCBuZXcgUHlkaW9EYXRhTW9kZWwoKTtcbiAgICAgICAgZG0uc2V0Q29udGV4dE5vZGUodGhpcy5wcm9wcy5ub2RlKTtcbiAgICAgICAgdmFyIHNlbE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0aW9uLmZvckVhY2goZnVuY3Rpb24gKHYsIG5vZGUpIHtcbiAgICAgICAgICAgIHNlbE5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBkbS5zZXRTZWxlY3RlZE5vZGVzKHNlbE5vZGVzKTtcbiAgICAgICAgdmFyIGEgPSB0aGlzLnByb3BzLnB5ZGlvLkNvbnRyb2xsZXIuZ2V0QWN0aW9uQnlOYW1lKGFjdGlvbk5hbWUpO1xuICAgICAgICBhLmZpcmVDb250ZXh0Q2hhbmdlKGRtLCB0cnVlLCB0aGlzLnByb3BzLnB5ZGlvLnVzZXIpO1xuICAgICAgICBhLmFwcGx5KFtkbV0pO1xuXG4gICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sXG5cbiAgICBnZXRBY3Rpb25zRm9yTm9kZTogZnVuY3Rpb24gZ2V0QWN0aW9uc0Zvck5vZGUoZG0sIG5vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnByb3BzLmNvbXB1dGVBY3Rpb25zRm9yTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjYWNoZUtleSA9IG5vZGUuaXNMZWFmKCkgPyAnZmlsZS0nICsgbm9kZS5nZXRBanhwTWltZSgpIDogJ2ZvbGRlcic7XG4gICAgICAgIHZhciBzZWxlY3Rpb25UeXBlID0gbm9kZS5pc0xlYWYoKSA/ICdmaWxlJyA6ICdkaXInO1xuICAgICAgICB2YXIgbm9kZUFjdGlvbnMgPSBbXTtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uc0NhY2hlW2NhY2hlS2V5XSkge1xuICAgICAgICAgICAgbm9kZUFjdGlvbnMgPSB0aGlzLmFjdGlvbnNDYWNoZVtjYWNoZUtleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkbS5zZXRTZWxlY3RlZE5vZGVzKFtub2RlXSk7XG4gICAgICAgICAgICB3aW5kb3cucHlkaW8uQ29udHJvbGxlci5hY3Rpb25zLmZvckVhY2goKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgYS5maXJlQ29udGV4dENoYW5nZShkbSwgdHJ1ZSwgd2luZG93LnB5ZGlvLnVzZXIpO1xuICAgICAgICAgICAgICAgIGlmIChhLmNvbnRleHQuc2VsZWN0aW9uICYmIGEuY29udGV4dC5hY3Rpb25CYXIgJiYgYS5zZWxlY3Rpb25Db250ZXh0W3NlbGVjdGlvblR5cGVdICYmICFhLmRlbnkgJiYgYS5vcHRpb25zLmljb25fY2xhc3MgJiYgKCF0aGlzLnByb3BzLmFjdGlvbkJhckdyb3VwcyB8fCB0aGlzLnByb3BzLmFjdGlvbkJhckdyb3Vwcy5pbmRleE9mKGEuY29udGV4dC5hY3Rpb25CYXJHcm91cCkgIT09IC0xKSAmJiAoIWEuc2VsZWN0aW9uQ29udGV4dC5hbGxvd2VkTWltZXMubGVuZ3RoIHx8IGEuc2VsZWN0aW9uQ29udGV4dC5hbGxvd2VkTWltZXMuaW5kZXhPZihub2RlLmdldEFqeHBNaW1lKCkpICE9PSAtMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZUFjdGlvbnMucHVzaChhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaXNMZWFmKCkgJiYgYS5zZWxlY3Rpb25Db250ZXh0LnVuaXF1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc0NhY2hlLm11bHRpcGxlLnNldChhLm9wdGlvbnMubmFtZSwgYSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uc0NhY2hlW2NhY2hlS2V5XSA9IG5vZGVBY3Rpb25zO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlQWN0aW9ucztcbiAgICB9LFxuXG4gICAgdXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQ6IGZ1bmN0aW9uIHVwZGF0ZUluZmluaXRlQ29udGFpbmVySGVpZ2h0KCkge1xuICAgICAgICB2YXIgcmV0cmllcyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMCB8fCBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzBdO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmNvbnRhaW5lckhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuY29udGFpbmVySGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5yZWZzLmluZmluaXRlUGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbnRhaW5lckhlaWdodCA9IHRoaXMucmVmcy5pbmZpbml0ZVBhcmVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmhlaWdodEF1dG9XaXRoTWF4KSB7XG4gICAgICAgICAgICB2YXIgbnVtYmVyID0gdGhpcy5pbmRleGVkRWxlbWVudHMgPyB0aGlzLmluZGV4ZWRFbGVtZW50cy5sZW5ndGggOiB0aGlzLnByb3BzLm5vZGUuZ2V0Q2hpbGRyZW4oKS5zaXplO1xuICAgICAgICAgICAgdmFyIGVsZW1lbnRIZWlnaHQgPSB0aGlzLnN0YXRlLmVsZW1lbnRIZWlnaHQgPyB0aGlzLnN0YXRlLmVsZW1lbnRIZWlnaHQgOiB0aGlzLnByb3BzLmVsZW1lbnRIZWlnaHQ7XG4gICAgICAgICAgICBjb250YWluZXJIZWlnaHQgPSBNYXRoLm1pbihudW1iZXIgKiBlbGVtZW50SGVpZ2h0LCB0aGlzLnByb3BzLmhlaWdodEF1dG9XaXRoTWF4KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRhaW5lckhlaWdodCAmJiAhcmV0cmllcykge1xuICAgICAgICAgICAgZ2xvYmFsLnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUluZmluaXRlQ29udGFpbmVySGVpZ2h0KHRydWUpO1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSwgNTApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjb250YWluZXJIZWlnaHQ6IGNvbnRhaW5lckhlaWdodCB9KTtcbiAgICB9LFxuXG4gICAgY29tcHV0ZUVsZW1lbnRIZWlnaHRSZXNwb25zaXZlOiBmdW5jdGlvbiBjb21wdXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUoKSB7XG4gICAgICAgIHZhciBicmVha3MgPSB0aGlzLnByb3BzLmVsZW1lbnRIZWlnaHQ7XG4gICAgICAgIGlmICghKGJyZWFrcyBpbnN0YW5jZW9mIE9iamVjdCkpIHtcbiAgICAgICAgICAgIGJyZWFrcyA9IHtcbiAgICAgICAgICAgICAgICBcIm1pbi13aWR0aDo0ODBweFwiOiB0aGlzLnByb3BzLmVsZW1lbnRIZWlnaHQsXG4gICAgICAgICAgICAgICAgXCJtYXgtd2lkdGg6NDgwcHhcIjogT2JqZWN0LmtleXModGhpcy5wcm9wcy50YWJsZUtleXMpLmxlbmd0aCAqIDI0ICsgMzNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBrIGluIGJyZWFrcykge1xuICAgICAgICAgICAgICAgIGlmIChicmVha3MuaGFzT3duUHJvcGVydHkoaykgJiYgd2luZG93Lm1hdGNoTWVkaWEoJygnICsgayArICcpJykubWF0Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJlYWtzW2tdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IERPTVV0aWxzLmdldFZpZXdwb3J0V2lkdGgoKTtcbiAgICAgICAgICAgIGlmICh3aWR0aCA8IDQ4MCkgcmV0dXJuIGJyZWFrc1tcIm1heC13aWR0aDo0ODBweFwiXTtlbHNlIHJldHVybiBicmVha3NbXCJtYXgtd2lkdGg6NDgwcHhcIl07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDUwO1xuICAgIH0sXG5cbiAgICB1cGRhdGVFbGVtZW50SGVpZ2h0UmVzcG9uc2l2ZTogZnVuY3Rpb24gdXBkYXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUoKSB7XG4gICAgICAgIHZhciBuZXdIID0gdGhpcy5jb21wdXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUoKTtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlIHx8ICF0aGlzLnN0YXRlLmVsZW1lbnRIZWlnaHQgfHwgdGhpcy5zdGF0ZS5lbGVtZW50SGVpZ2h0ICE9IG5ld0gpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlbGVtZW50SGVpZ2h0OiBuZXdIIH0sIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuaGVpZ2h0QXV0b1dpdGhNYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbmZpbml0ZUNvbnRhaW5lckhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBhdGNoSW5maW5pdGVHcmlkOiBmdW5jdGlvbiBwYXRjaEluZmluaXRlR3JpZChlbHMpIHtcbiAgICAgICAgaWYgKHRoaXMucmVmcy5pbmZpbml0ZSAmJiBlbHMgPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnMuaW5maW5pdGUuc3RhdGUuaW5maW5pdGVDb21wdXRlci5fX3Byb3RvX18uZ2V0RGlzcGxheUluZGV4U3RhcnQgPSBmdW5jdGlvbiAod2luZG93VG9wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVscyAqIE1hdGguZmxvb3Iod2luZG93VG9wIC8gdGhpcy5oZWlnaHREYXRhIC8gZWxzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnJlZnMuaW5maW5pdGUuc3RhdGUuaW5maW5pdGVDb21wdXRlci5fX3Byb3RvX18uZ2V0RGlzcGxheUluZGV4RW5kID0gZnVuY3Rpb24gKHdpbmRvd0JvdHRvbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbHMgKiBNYXRoLmNlaWwod2luZG93Qm90dG9tIC8gdGhpcy5oZWlnaHREYXRhIC8gZWxzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5kZWxheUluaXRpYWxMb2FkKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczMuX2xvYWROb2RlSWZOb3RMb2FkZWQoKTtcbiAgICAgICAgICAgIH0sIHRoaXMucHJvcHMuZGVsYXlJbml0aWFsTG9hZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sb2FkTm9kZUlmTm90TG9hZGVkKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wYXRjaEluZmluaXRlR3JpZCh0aGlzLnByb3BzLmVsZW1lbnRzUGVyTGluZSk7XG4gICAgICAgIGlmICh0aGlzLnJlZnMuaW5maW5pdGVQYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQoKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5wcm9wcy5oZWlnaHRBdXRvV2l0aE1heCAmJiAhdGhpcy5wcm9wcy5leHRlcm5hbFJlc2l6ZSkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy51cGRhdGVJbmZpbml0ZUNvbnRhaW5lckhlaWdodCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmF0dGFjaEV2ZW50KCdvbnJlc2l6ZScsIHRoaXMudXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5hdXRvUmVmcmVzaCkge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoSW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwodGhpcy5yZWxvYWQsIHRoaXMucHJvcHMuYXV0b1JlZnJlc2gpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9ic2VydmVOb2RlUmVsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLndpcmVSZWxvYWRMaXN0ZW5lcnMoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5lbGVtZW50SGVpZ2h0IGluc3RhbmNlb2YgT2JqZWN0IHx8IHRoaXMucHJvcHMudGFibGVLZXlzKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy51cGRhdGVFbGVtZW50SGVpZ2h0UmVzcG9uc2l2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb25yZXNpemUnLCB0aGlzLnVwZGF0ZUVsZW1lbnRIZWlnaHRSZXNwb25zaXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByb3BzLmRhdGFNb2RlbC5vYnNlcnZlKCdyb290X25vZGVfY2hhbmdlZCcsIGZ1bmN0aW9uIChyb290Tm9kZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jvb3Qgbm9kZSBjaGFuZ2VkJywgcm9vdE5vZGUsIF90aGlzMy5wcm9wcy5ub2RlKTtcbiAgICAgICAgICAgIF90aGlzMy5yb290Tm9kZUNoYW5nZWRGbGFnID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLm9ic2VydmUoJ3NlbGVjdGlvbl9jaGFuZ2VkJywgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHJldHVybjtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWROb2RlcyA9IHRoaXMucHJvcHMuZGF0YU1vZGVsLmdldFNlbGVjdGVkTm9kZXMoKTtcbiAgICAgICAgICAgIHNlbGVjdGVkTm9kZXMubWFwKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uLnNldChuLCB0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGlvbjogc2VsZWN0aW9uIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczQucmVidWlsZExvYWRlZEVsZW1lbnRzKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTm9kZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzNC5zY3JvbGxUb1ZpZXcoc2VsZWN0ZWROb2Rlc1swXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5oZWlnaHRBdXRvV2l0aE1heCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMudXBkYXRlSW5maW5pdGVDb250YWluZXJIZWlnaHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZGV0YWNoRXZlbnQoJ29ucmVzaXplJywgdGhpcy51cGRhdGVJbmZpbml0ZUNvbnRhaW5lckhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZWxlbWVudEhlaWdodCBpbnN0YW5jZW9mIE9iamVjdCB8fCB0aGlzLnByb3BzLnRhYmxlS2V5cykge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMudXBkYXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZGV0YWNoRXZlbnQoJ3Jlc2l6ZScsIHRoaXMudXBkYXRlRWxlbWVudEhlaWdodFJlc3BvbnNpdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlZnJlc2hJbnRlcnZhbCkge1xuICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5yZWZyZXNoSW50ZXJ2YWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9ic2VydmVOb2RlUmVsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BSZWxvYWRMaXN0ZW5lcnMoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5ub2RlKSB7XG4gICAgICAgICAgICB0aGlzLm9ic2VydmVOb2RlQ2hpbGRyZW4odGhpcy5wcm9wcy5ub2RlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMsIHByZXZTdGF0ZSkge1xuICAgICAgICBpZiAoIXRoaXMucm9vdE5vZGVDaGFuZ2VkRmxhZyAmJiBwcmV2UHJvcHMubm9kZSAmJiB0aGlzLnByb3BzLm5vZGUgJiYgcHJldlByb3BzLm5vZGUuZ2V0UGF0aCgpID09PSB0aGlzLnByb3BzLm5vZGUuZ2V0UGF0aCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbG9hZE5vZGVJZk5vdExvYWRlZCgpO1xuICAgICAgICB0aGlzLnJvb3ROb2RlQ2hhbmdlZEZsYWcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgb25TY3JvbGw6IGZ1bmN0aW9uIG9uU2Nyb2xsKHNjcm9sbFRvcCkge1xuXG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5wYXNzU2Nyb2xsaW5nU3RhdGVUb0NoaWxkcmVuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFpbnRhaW5zIGEgc2VyaWVzIG9mIHRpbWVvdXRzIHRvIHNldCB0aGlzLnN0YXRlLmlzU2Nyb2xsaW5nXG4gICAgICAgIC8vIHRvIGJlIHRydWUgd2hlbiB0aGUgZWxlbWVudCBpcyBzY3JvbGxpbmcuXG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2Nyb2xsVGltZW91dCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc3RhdGUuc2Nyb2xsVGltZW91dCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXMsXG4gICAgICAgICAgICBzY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBpc1Njcm9sbGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2Nyb2xsVGltZW91dDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTUwKTtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzU2Nyb2xsaW5nOiB0cnVlLFxuICAgICAgICAgICAgc2Nyb2xsVGltZW91dDogc2Nyb2xsVGltZW91dFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2Nyb2xsVG9MYXN0OiBmdW5jdGlvbiBzY3JvbGxUb0xhc3QoKSB7XG4gICAgICAgIGlmICh0aGlzLmluZGV4ZWRFbGVtZW50cyAmJiB0aGlzLmluZGV4ZWRFbGVtZW50c1t0aGlzLmluZGV4ZWRFbGVtZW50cy5sZW5ndGggLSAxXS5ub2RlKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvVmlldyh0aGlzLmluZGV4ZWRFbGVtZW50c1t0aGlzLmluZGV4ZWRFbGVtZW50cy5sZW5ndGggLSAxXS5ub2RlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzY3JvbGxUb1ZpZXc6IGZ1bmN0aW9uIHNjcm9sbFRvVmlldyhub2RlKSB7XG4gICAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhpcy5pbmRleGVkRWxlbWVudHMgfHwgIXRoaXMucmVmcy5pbmZpbml0ZSB8fCAhdGhpcy5yZWZzLmluZmluaXRlLnNjcm9sbGFibGUpIHJldHVybjtcbiAgICAgICAgdmFyIHNjcm9sbGFibGUgPSB0aGlzLnJlZnMuaW5maW5pdGUuc2Nyb2xsYWJsZTtcbiAgICAgICAgdmFyIHZpc2libGVGcmFtZSA9IHtcbiAgICAgICAgICAgIHRvcDogc2Nyb2xsYWJsZS5zY3JvbGxUb3AgKyB0aGlzLnByb3BzLmVsZW1lbnRIZWlnaHQgLyAyLFxuICAgICAgICAgICAgYm90dG9tOiBzY3JvbGxhYmxlLnNjcm9sbFRvcCArIHRoaXMuc3RhdGUuY29udGFpbmVySGVpZ2h0IC0gdGhpcy5wcm9wcy5lbGVtZW50SGVpZ2h0IC8gMlxuICAgICAgICB9O1xuICAgICAgICB2YXIgcmVhbE1heFNjcm9sbFRvcCA9IHRoaXMuaW5kZXhlZEVsZW1lbnRzLmxlbmd0aCAqIHRoaXMucHJvcHMuZWxlbWVudEhlaWdodCAtIHRoaXMuc3RhdGUuY29udGFpbmVySGVpZ2h0O1xuXG4gICAgICAgIHZhciBwb3NpdGlvbiA9IC0xO1xuICAgICAgICB0aGlzLmluZGV4ZWRFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlLCBrKSB7XG4gICAgICAgICAgICBpZiAoZS5ub2RlICYmIGUubm9kZSA9PT0gbm9kZSkgcG9zaXRpb24gPSBrO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAtMSkgcmV0dXJuO1xuICAgICAgICB2YXIgZWxlbWVudEhlaWdodCA9IHRoaXMucHJvcHMuZWxlbWVudEhlaWdodDtcbiAgICAgICAgdmFyIHNjcm9sbFRhcmdldCA9IHBvc2l0aW9uICogZWxlbWVudEhlaWdodDtcblxuICAgICAgICBpZiAoc2Nyb2xsVGFyZ2V0ID4gdmlzaWJsZUZyYW1lLnRvcCAmJiBzY3JvbGxUYXJnZXQgPCB2aXNpYmxlRnJhbWUuYm90dG9tKSB7XG4gICAgICAgICAgICAvLyBhbHJlYWR5IHZpc2libGU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsVGFyZ2V0ID49IHZpc2libGVGcmFtZS5ib3R0b20pIHtcbiAgICAgICAgICAgIHNjcm9sbFRhcmdldCAtPSB0aGlzLnN0YXRlLmNvbnRhaW5lckhlaWdodCAtIGVsZW1lbnRIZWlnaHQgKiAyO1xuICAgICAgICB9XG4gICAgICAgIHNjcm9sbFRhcmdldCA9IE1hdGgubWluKHNjcm9sbFRhcmdldCwgcmVhbE1heFNjcm9sbFRvcCk7XG4gICAgICAgIHNjcm9sbGFibGUuc2Nyb2xsVG9wID0gc2Nyb2xsVGFyZ2V0O1xuICAgICAgICBpZiAodGhpcy5fbWFudWFsU2Nyb2xsUGUpIHRoaXMuX21hbnVhbFNjcm9sbFBlLnN0b3AoKTtcbiAgICAgICAgaWYgKHNjcm9sbGFibGUuc2Nyb2xsSGVpZ2h0IDwgc2Nyb2xsVGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLl9tYW51YWxTY3JvbGxQZSA9IG5ldyBQZXJpb2RpY2FsRXhlY3V0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNjcm9sbGFibGUuc2Nyb2xsVG9wID0gc2Nyb2xsVGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmIChzY3JvbGxhYmxlLnNjcm9sbEhlaWdodCA+PSBzY3JvbGxUYXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXM1Ll9tYW51YWxTY3JvbGxQZS5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzNS5fbWFudWFsU2Nyb2xsUGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIC4yNSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYnVpbGRFbGVtZW50c0Zyb21Ob2RlRW50cmllczogZnVuY3Rpb24gYnVpbGRFbGVtZW50c0Zyb21Ob2RlRW50cmllcyhub2RlRW50cmllcywgc2hvd1NlbGVjdG9yKSB7XG5cbiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBbXSxcbiAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgdmFyIG5vZGVFbnRyaWVzTGVuZ3RoID0gbm9kZUVudHJpZXMubGVuZ3RoO1xuICAgICAgICBub2RlRW50cmllcy5mb3JFYWNoKChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKGVudHJ5LnBhcmVudCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IGVudHJ5Lm5vZGUsXG4gICAgICAgICAgICAgICAgICAgIGtleTogZW50cnkubm9kZS5nZXRQYXRoKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBlbnRyeS5ub2RlLmdldFBhdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgbWFpbkljb246IFNpbXBsZUxpc3QuUEFSRU5UX0ZPTERFUl9JQ09OLFxuICAgICAgICAgICAgICAgICAgICBmaXJzdExpbmU6IFwiLi5cIixcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImxpc3QtcGFyZW50LW5vZGVcIixcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kTGluZTogdGhpcy5jb250ZXh0LmdldE1lc3NhZ2UoJ3JlYWN0LjEnKSxcbiAgICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5jbGlja1JvdyxcbiAgICAgICAgICAgICAgICAgICAgb25Eb3VibGVDbGljazogdGhpcy5kb3VibGVDbGlja1JvdyxcbiAgICAgICAgICAgICAgICAgICAgc2hvd1NlbGVjdG9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3JEaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbm9Ib3ZlcjogZmFsc2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmVudHJ5UmVuZGVyUGFyZW50SWNvbiAmJiAhdGhpcy5wcm9wcy50YWJsZUtleXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVsnaWNvbkNlbGwnXSA9IHRoaXMucHJvcHMuZW50cnlSZW5kZXJQYXJlbnRJY29uKGVudHJ5Lm5vZGUsIGVudHJ5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkYXRhWydtYWluSWNvbiddID0gU2ltcGxlTGlzdC5QQVJFTlRfRk9MREVSX0lDT047XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmVsZW1lbnRTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhWydzdHlsZSddID0gdGhpcy5wcm9wcy5lbGVtZW50U3R5bGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLnBhc3NTY3JvbGxpbmdTdGF0ZVRvQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVsncGFyZW50SXNTY3JvbGxpbmcnXSA9IHRoaXMuc3RhdGUuaXNTY3JvbGxpbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KF9MaXN0RW50cnkuTGlzdEVudHJ5LCBkYXRhKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5Lmdyb3VwSGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gZW50cnkuZ3JvdXBIZWFkZXIsXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TGluZSA9IGVudHJ5Lmdyb3VwSGVhZGVyTGFiZWw7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuZW50cnlSZW5kZXJHcm91cEhlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdExpbmUgPSB0aGlzLnByb3BzLmVudHJ5UmVuZGVyR3JvdXBIZWFkZXIoaWQsIGZpcnN0TGluZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGtleTogZW50cnkuZ3JvdXBIZWFkZXIsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgbWFpbkljb246IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TGluZTogZmlyc3RMaW5lLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdsaXN0LWdyb3VwLWhlYWRlcicsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHNob3dTZWxlY3RvcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yRGlzYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG5vSG92ZXI6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLnBhc3NTY3JvbGxpbmdTdGF0ZVRvQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVsncGFyZW50SXNTY3JvbGxpbmcnXSA9IHRoaXMuc3RhdGUuaXNTY3JvbGxpbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KF9MaXN0RW50cnkuTGlzdEVudHJ5LCBkYXRhKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IGVudHJ5Lm5vZGUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuY2xpY2tSb3csXG4gICAgICAgICAgICAgICAgICAgIG9uRG91YmxlQ2xpY2s6IHRoaXMuZG91YmxlQ2xpY2tSb3csXG4gICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0OiB0aGlzLnRvZ2dsZVNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAga2V5OiBlbnRyeS5ub2RlLmdldFBhdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGVudHJ5Lm5vZGUuZ2V0UGF0aCgpLFxuICAgICAgICAgICAgICAgICAgICByZW5kZXJJY29uOiB0aGlzLnByb3BzLmVudHJ5UmVuZGVySWNvbixcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyRmlyc3RMaW5lOiB0aGlzLnByb3BzLmVudHJ5UmVuZGVyRmlyc3RMaW5lLFxuICAgICAgICAgICAgICAgICAgICByZW5kZXJTZWNvbmRMaW5lOiB0aGlzLnByb3BzLmVudHJ5UmVuZGVyU2Vjb25kTGluZSxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyVGhpcmRMaW5lOiB0aGlzLnByb3BzLmVudHJ5UmVuZGVyVGhpcmRMaW5lLFxuICAgICAgICAgICAgICAgICAgICByZW5kZXJBY3Rpb25zOiB0aGlzLnByb3BzLmVudHJ5UmVuZGVyQWN0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgc2hvd1NlbGVjdG9yOiBzaG93U2VsZWN0b3IsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuc2VsZWN0aW9uID8gdGhpcy5zdGF0ZS5zZWxlY3Rpb24uZ2V0KGVudHJ5Lm5vZGUpIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFJlYWN0LmNyZWF0ZUVsZW1lbnQoX3ZpZXdzU2ltcGxlUmVhY3RBY3Rpb25CYXIyWydkZWZhdWx0J10sIHsgbm9kZTogZW50cnkubm9kZSwgYWN0aW9uczogZW50cnkuYWN0aW9ucywgZGF0YU1vZGVsOiB0aGlzLmRtIH0pLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RvckRpc2FibGVkOiAhKHRoaXMucHJvcHMuZW50cnlFbmFibGVTZWxlY3RvciA/IHRoaXMucHJvcHMuZW50cnlFbmFibGVTZWxlY3RvcihlbnRyeS5ub2RlKSA6IGVudHJ5Lm5vZGUuaXNMZWFmKCkpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkYXRhWydpc0ZpcnN0J10gPSBpbmRleCA9PT0gMDtcbiAgICAgICAgICAgICAgICBkYXRhWydpc0xhc3QnXSA9IGluZGV4ID09PSBub2RlRW50cmllc0xlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5lbGVtZW50U3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVsnc3R5bGUnXSA9IHRoaXMucHJvcHMuZWxlbWVudFN0eWxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5wYXNzU2Nyb2xsaW5nU3RhdGVUb0NoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbJ3BhcmVudElzU2Nyb2xsaW5nJ10gPSB0aGlzLnN0YXRlLmlzU2Nyb2xsaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5yZW5kZXJDdXN0b21FbnRyeSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaCh0aGlzLnByb3BzLnJlbmRlckN1c3RvbUVudHJ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMudGFibGVLZXlzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuZGVmYXVsdEdyb3VwQnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbJ3RhYmxlS2V5cyddID0gTGFuZ1V0aWxzLmRlZXBDb3B5KHRoaXMucHJvcHMudGFibGVLZXlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhWyd0YWJsZUtleXMnXVt0aGlzLnByb3BzLmRlZmF1bHRHcm91cEJ5XTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbJ3RhYmxlS2V5cyddID0gdGhpcy5wcm9wcy50YWJsZUtleXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoX1RhYmxlTGlzdEVudHJ5MlsnZGVmYXVsdCddLCBkYXRhKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChfQ29uZmlndXJhYmxlTGlzdEVudHJ5MlsnZGVmYXVsdCddLCBkYXRhKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcblxuICAgICAgICByZXR1cm4gY29tcG9uZW50cztcbiAgICB9LFxuXG4gICAgYnVpbGRFbGVtZW50czogZnVuY3Rpb24gYnVpbGRFbGVtZW50cyhzdGFydCwgZW5kLCBub2RlLCBzaG93U2VsZWN0b3IpIHtcbiAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHRoZU5vZGUgPSB0aGlzLnByb3BzLm5vZGU7XG4gICAgICAgIGlmIChub2RlKSB0aGVOb2RlID0gbm9kZTtcbiAgICAgICAgdmFyIHRoZVNob3dTZWxlY3RvciA9IHRoaXMuc3RhdGUgJiYgdGhpcy5zdGF0ZS5zaG93U2VsZWN0b3I7XG4gICAgICAgIGlmIChzaG93U2VsZWN0b3IgIT09IHVuZGVmaW5lZCkgdGhlU2hvd1NlbGVjdG9yID0gc2hvd1NlbGVjdG9yO1xuXG4gICAgICAgIGlmICghdGhpcy5pbmRleGVkRWxlbWVudHMgfHwgdGhpcy5pbmRleGVkRWxlbWVudHMubGVuZ3RoICE9PSB0aGVOb2RlLmdldENoaWxkcmVuKCkuc2l6ZSkge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczYuaW5kZXhlZEVsZW1lbnRzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGdyb3VwQnkgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwQnlMYWJlbCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBncm91cEtleXMgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwTGFiZWxzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChfdGhpczYucHJvcHMuZGVmYXVsdEdyb3VwQnkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBCeSA9IF90aGlzNi5wcm9wcy5kZWZhdWx0R3JvdXBCeTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBCeUxhYmVsID0gX3RoaXM2LnByb3BzLmdyb3VwQnlMYWJlbCB8fCBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzID0ge30sIGdyb3VwS2V5cyA9IFtdLCBncm91cExhYmVscyA9IHt9O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghX3RoaXM2LnByb3BzLnNraXBQYXJlbnROYXZpZ2F0aW9uICYmIHRoZU5vZGUuZ2V0UGFyZW50KCkgJiYgKF90aGlzNi5wcm9wcy5kYXRhTW9kZWwuZ2V0Q29udGV4dE5vZGUoKSAhPT0gdGhlTm9kZSB8fCBfdGhpczYucHJvcHMuc2tpcEludGVybmFsRGF0YU1vZGVsKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpczYuaW5kZXhlZEVsZW1lbnRzLnB1c2goeyBub2RlOiB0aGVOb2RlLmdldFBhcmVudCgpLCBwYXJlbnQ6IHRydWUsIGFjdGlvbnM6IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhlTm9kZS5nZXRDaGlsZHJlbigpLmZvckVhY2goKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZ2V0TWV0YWRhdGEoKS5oYXMoJ2N1cnNvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRDdXJzb3IgPSBwYXJzZUludChjaGlsZC5nZXRNZXRhZGF0YSgpLmdldCgnY3Vyc29yJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEN1cnNvciA9IE1hdGgubWF4KHRoaXMuX2N1cnJlbnRDdXJzb3IgPyB0aGlzLl9jdXJyZW50Q3Vyc29yIDogMCwgY2hpbGRDdXJzb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmZpbHRlck5vZGVzICYmICF0aGlzLnByb3BzLmZpbHRlck5vZGVzKGNoaWxkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBub2RlQWN0aW9ucyA9IHRoaXMuZ2V0QWN0aW9uc0Zvck5vZGUodGhpcy5kbSwgY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBCeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwVmFsdWUgPSBjaGlsZC5nZXRNZXRhZGF0YSgpLmdldChncm91cEJ5KSB8fCAnTi9BJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZ3JvdXBzW2dyb3VwVmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2dyb3VwVmFsdWVdID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBLZXlzLnB1c2goZ3JvdXBWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBCeUxhYmVsICYmIGNoaWxkLmdldE1ldGFkYXRhKCkuaGFzKGdyb3VwQnlMYWJlbCkgJiYgIWdyb3VwTGFiZWxzW2dyb3VwVmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBMYWJlbHNbZ3JvdXBWYWx1ZV0gPSBjaGlsZC5nZXRNZXRhZGF0YSgpLmdldChncm91cEJ5TGFiZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2dyb3VwVmFsdWVdLnB1c2goeyBub2RlOiBjaGlsZCwgcGFyZW50OiBmYWxzZSwgYWN0aW9uczogbm9kZUFjdGlvbnMgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4ZWRFbGVtZW50cy5wdXNoKHsgbm9kZTogY2hpbGQsIHBhcmVudDogZmFsc2UsIGFjdGlvbnM6IG5vZGVBY3Rpb25zIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuYmluZChfdGhpczYpKTtcblxuICAgICAgICAgICAgICAgIGlmIChncm91cEJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwS2V5cyA9IGdyb3VwS2V5cy5zb3J0KCk7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwS2V5cy5tYXAoKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3VwTGFiZWxzW2tdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSBncm91cExhYmVsc1trXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5yZW5kZXJHcm91cExhYmVscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gdGhpcy5wcm9wcy5yZW5kZXJHcm91cExhYmVscyhncm91cEJ5LCBrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXhlZEVsZW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXI6IGssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXJMYWJlbDogbGFiZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zOiBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXhlZEVsZW1lbnRzID0gdGhpcy5pbmRleGVkRWxlbWVudHMuY29uY2F0KGdyb3Vwc1trXSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmJpbmQoX3RoaXM2KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuc29ydGluZ0luZm8gJiYgIXRoaXMucmVtb3RlU29ydGluZ0luZm8oKSkge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3N0YXRlJHNvcnRpbmdJbmZvMiA9IF90aGlzNi5zdGF0ZS5zb3J0aW5nSW5mbztcbiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gX3N0YXRlJHNvcnRpbmdJbmZvMi5hdHRyaWJ1dGU7XG4gICAgICAgICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IF9zdGF0ZSRzb3J0aW5nSW5mbzIuZGlyZWN0aW9uO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0VHlwZSA9IF9zdGF0ZSRzb3J0aW5nSW5mbzIuc29ydFR5cGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgc29ydEZ1bmN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChzb3J0VHlwZSA9PT0gJ2ZpbGUtbmF0dXJhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEZ1bmN0aW9uID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLnBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVBID0gYS5ub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVCID0gYi5ub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjeWNsZSBhbHdheXMgbGFzdFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVBLmlzUmVjeWNsZSgpKSByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlQi5pc1JlY3ljbGUoKSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9sZGVycyBmaXJzdFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFMZWFmID0gbm9kZUEuaXNMZWFmKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYkxlYWYgPSBub2RlQi5pc0xlYWYoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBhTGVhZiAmJiAhYkxlYWYgPyAxIDogIWFMZWFmICYmIGJMZWFmID8gLTEgOiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyAhPT0gMCkgcmV0dXJuIHJlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IG5vZGVBLmdldExhYmVsKCkubG9jYWxlQ29tcGFyZShub2RlQi5nZXRMYWJlbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEZ1bmN0aW9uID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhTWV0YSA9IGEubm9kZS5nZXRNZXRhZGF0YSgpLmdldChhdHRyaWJ1dGUpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYk1ldGEgPSBiLm5vZGUuZ2V0TWV0YWRhdGEoKS5nZXQoYXR0cmlidXRlKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3J0VHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhTWV0YSA9IHBhcnNlRmxvYXQoYU1ldGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJNZXRhID0gcGFyc2VGbG9hdChiTWV0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gZGlyZWN0aW9uID09PSAnYXNjJyA/IGFNZXRhIC0gYk1ldGEgOiBiTWV0YSAtIGFNZXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzb3J0VHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBkaXJlY3Rpb24gPT09ICdhc2MnID8gYU1ldGEubG9jYWxlQ29tcGFyZShiTWV0YSkgOiBiTWV0YS5sb2NhbGVDb21wYXJlKGFNZXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNvcnQgYnkgbGFiZWwgdG8gbWFrZSBpdCBzdGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFiQ29tcCA9IGEubm9kZS5nZXRMYWJlbCgpLmxvY2FsZUNvbXBhcmUoYi5ub2RlLmdldExhYmVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IGRpcmVjdGlvbiA9PT0gJ2FzYycgPyBsYWJDb21wIDogLWxhYkNvbXA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpczYuaW5kZXhlZEVsZW1lbnRzLnNvcnQoc29ydEZ1bmN0aW9uKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5lbGVtZW50UGVyTGluZSA+IDEpIHtcbiAgICAgICAgICAgIGVuZCA9IGVuZCAqIHRoaXMucHJvcHMuZWxlbWVudFBlckxpbmU7XG4gICAgICAgICAgICBzdGFydCA9IHN0YXJ0ICogdGhpcy5wcm9wcy5lbGVtZW50UGVyTGluZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleGVkRWxlbWVudHMuc2xpY2Uoc3RhcnQsIGVuZCk7XG4gICAgfSxcblxuICAgIHJlYnVpbGRMb2FkZWRFbGVtZW50czogZnVuY3Rpb24gcmVidWlsZExvYWRlZEVsZW1lbnRzKCkge1xuICAgICAgICB2YXIgbmV3RWxlbWVudHMgPSB0aGlzLmJ1aWxkRWxlbWVudHMoMCwgTWF0aC5tYXgodGhpcy5zdGF0ZS5lbGVtZW50cy5sZW5ndGgsIHRoaXMucHJvcHMuaW5maW5pdGVTbGljZUNvdW50KSk7XG4gICAgICAgIHZhciBpbmZpbml0ZUxvYWRCZWdpbkJvdHRvbU9mZnNldCA9IG5ld0VsZW1lbnRzLmxlbmd0aCA/IDIwMCA6IDA7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZWxlbWVudHM6IG5ld0VsZW1lbnRzLFxuICAgICAgICAgICAgaW5maW5pdGVMb2FkQmVnaW5Cb3R0b21PZmZzZXQ6IGluZmluaXRlTG9hZEJlZ2luQm90dG9tT2Zmc2V0XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnVwZGF0ZUluZmluaXRlQ29udGFpbmVySGVpZ2h0KCk7XG4gICAgfSxcblxuICAgIGhhbmRsZUluZmluaXRlTG9hZDogZnVuY3Rpb24gaGFuZGxlSW5maW5pdGVMb2FkKCkge1xuICAgICAgICB2YXIgZWxlbUxlbmd0aCA9IHRoaXMuc3RhdGUuZWxlbWVudHMubGVuZ3RoO1xuICAgICAgICB2YXIgbmV3RWxlbWVudHMgPSB0aGlzLmJ1aWxkRWxlbWVudHMoZWxlbUxlbmd0aCwgZWxlbUxlbmd0aCArIHRoaXMucHJvcHMuaW5maW5pdGVTbGljZUNvdW50KTtcbiAgICAgICAgdmFyIGluZmluaXRlTG9hZEJlZ2luQm90dG9tT2Zmc2V0ID0gbmV3RWxlbWVudHMubGVuZ3RoID8gMjAwIDogMDtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc0luZmluaXRlTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBlbGVtZW50czogdGhpcy5zdGF0ZS5lbGVtZW50cy5jb25jYXQobmV3RWxlbWVudHMpLFxuICAgICAgICAgICAgaW5maW5pdGVMb2FkQmVnaW5Cb3R0b21PZmZzZXQ6IGluZmluaXRlTG9hZEJlZ2luQm90dG9tT2Zmc2V0XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0IHJlbW90ZSBzb3J0aW5nIGluZm8gZnJvbSBjdXJyZW50IG5vZGUgbWV0YWRhdGFcbiAgICAgKi9cbiAgICByZW1vdGVTb3J0aW5nSW5mbzogZnVuY3Rpb24gcmVtb3RlU29ydGluZ0luZm8oKSB7XG4gICAgICAgIHZhciBtZXRhID0gdGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KCdwYWdpbmF0aW9uRGF0YScpO1xuICAgICAgICBpZiAobWV0YSAmJiBtZXRhLmdldCgndG90YWwnKSA+IDEgJiYgbWV0YS5oYXMoJ3JlbW90ZV9vcmRlcicpKSB7XG4gICAgICAgICAgICB2YXIgY29sID0gbWV0YS5nZXQoJ2N1cnJlbnRPcmRlckNvbCcpO1xuICAgICAgICAgICAgdmFyIGRpciA9IG1ldGEuZ2V0KCdjdXJyZW50T3JkZXJEaXInKTtcbiAgICAgICAgICAgIGlmIChjb2wgJiYgZGlyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGU6IGNvbCxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBkaXJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICByZW5kZXJUb29sYmFyOiBmdW5jdGlvbiByZW5kZXJUb29sYmFyKCkge1xuICAgICAgICB2YXIgX3RoaXM3ID0gdGhpcztcblxuICAgICAgICB2YXIgcmlnaHRCdXR0b25zID0gW1JlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRm9udEljb24sIHtcbiAgICAgICAgICAgIGtleTogMSxcbiAgICAgICAgICAgIHRvb2x0aXA6ICdSZWxvYWQnLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcIm1kaSBtZGktcmVsb2FkXCIgKyAodGhpcy5zdGF0ZS5sb2FkaW5nID8gXCIgcm90YXRpbmdcIiA6IFwiXCIpLFxuICAgICAgICAgICAgb25DbGljazogdGhpcy5yZWxvYWRcbiAgICAgICAgfSldO1xuICAgICAgICB2YXIgaSA9IDI7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnNvcnRLZXlzKSB7XG5cbiAgICAgICAgICAgIHZhciBzb3J0aW5nSW5mbyA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZW1vdGVTb3J0aW5nSW5mbyA9IHRoaXMucmVtb3RlU29ydGluZ0luZm8oKTtcbiAgICAgICAgICAgIGlmIChyZW1vdGVTb3J0aW5nSW5mbykge1xuICAgICAgICAgICAgICAgIHNvcnRpbmdJbmZvID0gcmVtb3RlU29ydGluZ0luZm87XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNvcnRpbmdJbmZvID0gdGhpcy5zdGF0ZSA/IHRoaXMuc3RhdGUuc29ydGluZ0luZm8gOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmlnaHRCdXR0b25zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChfU29ydENvbHVtbnMyWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICBrZXk6IGksXG4gICAgICAgICAgICAgICAgZGlzcGxheU1vZGU6ICdtZW51JyxcbiAgICAgICAgICAgICAgICB0YWJsZUtleXM6IHRoaXMucHJvcHMuc29ydEtleXMsXG4gICAgICAgICAgICAgICAgY29sdW1uQ2xpY2tlZDogdGhpcy5vbkNvbHVtblNvcnQsXG4gICAgICAgICAgICAgICAgc29ydGluZ0luZm86IHNvcnRpbmdJbmZvXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuYWRkaXRpb25hbEFjdGlvbnMpIHtcbiAgICAgICAgICAgIHJpZ2h0QnV0dG9ucy5wdXNoKHRoaXMucHJvcHMuYWRkaXRpb25hbEFjdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxlZnRUb29sYmFyID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGFnaW5hdG9yID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwicGFnaW5hdGlvbkRhdGFcIikgJiYgdGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwicGFnaW5hdGlvbkRhdGFcIikuZ2V0KCd0b3RhbCcpID4gMSkge1xuICAgICAgICAgICAgcGFnaW5hdG9yID0gUmVhY3QuY3JlYXRlRWxlbWVudChfTGlzdFBhZ2luYXRvcjJbJ2RlZmF1bHQnXSwgeyBkYXRhTW9kZWw6IHRoaXMuZG0sIG5vZGU6IHRoaXMucHJvcHMubm9kZSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmxpc3RUaXRsZSkge1xuICAgICAgICAgICAgbGVmdFRvb2xiYXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRvb2xiYXJHcm91cCxcbiAgICAgICAgICAgICAgICB7IGtleTogMCwgZmxvYXQ6ICdsZWZ0JyB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2xpc3QtdGl0bGUnIH0sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMubGlzdFRpdGxlXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnNlYXJjaFJlc3VsdERhdGEpIHtcblxuICAgICAgICAgICAgbGVmdFRvb2xiYXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRvb2xiYXJHcm91cCxcbiAgICAgICAgICAgICAgICB7IGtleTogMCwgZmxvYXQ6ICdsZWZ0JyB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGZvbnRTaXplOiAxNSwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogJyM5ZTllOWUnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmdldE1lc3NhZ2UoJ3JlYWN0LjMnKS5yZXBsYWNlKCclcycsIHRoaXMucHJvcHMuc2VhcmNoUmVzdWx0RGF0YS50ZXJtKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByaWdodEJ1dHRvbnMgPSBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLlJhaXNlZEJ1dHRvbiwgeyBrZXk6IDEsIGxhYmVsOiB0aGlzLmNvbnRleHQuZ2V0TWVzc2FnZSgncmVhY3QuNCcpLCBwcmltYXJ5OiB0cnVlLCBvblRvdWNoVGFwOiB0aGlzLnByb3BzLnNlYXJjaFJlc3VsdERhdGEudG9nZ2xlU3RhdGUsIHN0eWxlOiB7IG1hcmdpblJpZ2h0OiAtMTAgfSB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFjdGlvbnNDYWNoZS5tdWx0aXBsZS5zaXplIHx8IHRoaXMucHJvcHMubXVsdGlwbGVBY3Rpb25zKSB7XG4gICAgICAgICAgICB2YXIgYnVsa0xhYmVsID0gdGhpcy5jb250ZXh0LmdldE1lc3NhZ2UoJ3JlYWN0LjInKTtcbiAgICAgICAgICAgIHZhciBoaWRkZW5TdHlsZSA9IHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC04MHB4KSdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgY2JTdHlsZSA9IF9leHRlbmRzKHsgd2lkdGg6IDI0IH0sIGhpZGRlblN0eWxlKTtcbiAgICAgICAgICAgIHZhciBidXR0b25TdHlsZSA9IF9leHRlbmRzKHt9LCBoaWRkZW5TdHlsZSk7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93U2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICBjYlN0eWxlID0geyB3aWR0aDogMjQsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTEycHgpJyB9O1xuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlID0geyB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC00MHB4KScgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnNlbGVjdGlvbiAmJiB0aGlzLnN0YXRlLnNob3dTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgIGJ1bGtMYWJlbCArPSBcIiAoXCIgKyB0aGlzLnN0YXRlLnNlbGVjdGlvbi5zaXplICsgXCIpXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZWZ0VG9vbGJhciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuVG9vbGJhckdyb3VwLFxuICAgICAgICAgICAgICAgIHsga2V5OiAwLCBmbG9hdDogJ2xlZnQnLCBjbGFzc05hbWU6ICdoaWRlLW9uLXZlcnRpY2FsLWxheW91dCcgfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkNoZWNrYm94LCB7IHJlZjogJ2FsbF9zZWxlY3RvcicsIG9uQ2xpY2s6IHRoaXMuc2VsZWN0QWxsLCBzdHlsZTogY2JTdHlsZSB9KSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZsYXRCdXR0b24sIHsgbGFiZWw6IGJ1bGtMYWJlbCwgb25DbGljazogdGhpcy50b2dnbGVTZWxlY3Rvciwgc3R5bGU6IGJ1dHRvblN0eWxlIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93U2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByaWdodEJ1dHRvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbnMgPSBfdGhpczcucHJvcHMubXVsdGlwbGVBY3Rpb25zIHx8IF90aGlzNy5hY3Rpb25zQ2FjaGUubXVsdGlwbGU7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnMuZm9yRWFjaCgoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0QnV0dG9ucy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuUmFpc2VkQnV0dG9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogYS5vcHRpb25zLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtYWN0aW9uJzogYS5vcHRpb25zLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5hcHBseU11bHRpcGxlQWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnk6IHRydWUgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9KS5iaW5kKF90aGlzNykpO1xuICAgICAgICAgICAgICAgICAgICByaWdodEJ1dHRvbnMgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0QnV0dG9uc1xuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRvb2xiYXIsXG4gICAgICAgICAgICB7IHN0eWxlOiB0aGlzLnByb3BzLnRvb2xiYXJTdHlsZSB9LFxuICAgICAgICAgICAgbGVmdFRvb2xiYXIsXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlRvb2xiYXJHcm91cCxcbiAgICAgICAgICAgICAgICB7IGtleTogMSwgZmxvYXQ6ICdyaWdodCcgfSxcbiAgICAgICAgICAgICAgICBwYWdpbmF0b3IsXG4gICAgICAgICAgICAgICAgcmlnaHRCdXR0b25zXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXM4ID0gdGhpcztcblxuICAgICAgICB2YXIgY29udGFpbmVyQ2xhc3NlcyA9IFwibWF0ZXJpYWwtbGlzdCB2ZXJ0aWNhbC1sYXlvdXQgbGF5b3V0LWZpbGxcIjtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICBjb250YWluZXJDbGFzc2VzICs9IFwiIFwiICsgdGhpcy5wcm9wcy5jbGFzc05hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2hvd1NlbGVjdG9yKSB7XG4gICAgICAgICAgICBjb250YWluZXJDbGFzc2VzICs9IFwiIGxpc3Qtc2hvdy1zZWxlY3RvcnNcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy50YWJsZUtleXMpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lckNsYXNzZXMgKz0gXCIgdGFibGUtbW9kZVwiO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b29sYmFyID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy50YWJsZUtleXMpIHtcbiAgICAgICAgICAgIHZhciB0YWJsZUtleXMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5kZWZhdWx0R3JvdXBCeSkge1xuICAgICAgICAgICAgICAgIHRhYmxlS2V5cyA9IExhbmdVdGlscy5kZWVwQ29weSh0aGlzLnByb3BzLnRhYmxlS2V5cyk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRhYmxlS2V5c1t0aGlzLnByb3BzLmRlZmF1bHRHcm91cEJ5XTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFibGVLZXlzID0gdGhpcy5wcm9wcy50YWJsZUtleXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc29ydGluZ0luZm8gPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVtb3RlU29ydGluZ0luZm8gPSB0aGlzLnJlbW90ZVNvcnRpbmdJbmZvKCk7XG4gICAgICAgICAgICBpZiAocmVtb3RlU29ydGluZ0luZm8pIHtcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5mbyA9IHJlbW90ZVNvcnRpbmdJbmZvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5mbyA9IHRoaXMuc3RhdGUgPyB0aGlzLnN0YXRlLnNvcnRpbmdJbmZvIDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvb2xiYXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KF9UYWJsZUxpc3RIZWFkZXIyWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICB0YWJsZUtleXM6IHRhYmxlS2V5cyxcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiB0aGlzLnN0YXRlLmxvYWRpbmcsXG4gICAgICAgICAgICAgICAgcmVsb2FkOiB0aGlzLnJlbG9hZCxcbiAgICAgICAgICAgICAgICByZWY6ICdsb2FkaW5nX2luZGljYXRvcicsXG4gICAgICAgICAgICAgICAgZG06IHRoaXMucHJvcHMuZGF0YU1vZGVsLFxuICAgICAgICAgICAgICAgIG5vZGU6IHRoaXMucHJvcHMubm9kZSxcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQWN0aW9uczogdGhpcy5wcm9wcy5hZGRpdGlvbmFsQWN0aW9ucyxcbiAgICAgICAgICAgICAgICBvbkhlYWRlckNsaWNrOiB0aGlzLm9uQ29sdW1uU29ydCxcbiAgICAgICAgICAgICAgICBzb3J0aW5nSW5mbzogc29ydGluZ0luZm9cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG9vbGJhciA9IHRoaXMucHJvcHMuY3VzdG9tVG9vbGJhciA/IHRoaXMucHJvcHMuY3VzdG9tVG9vbGJhciA6ICF0aGlzLnByb3BzLmhpZGVUb29sYmFyID8gdGhpcy5yZW5kZXJUb29sYmFyKCkgOiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlubGluZUVkaXRvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5saW5lRWRpdGlvbkZvck5vZGUpIHtcbiAgICAgICAgICAgIGlubGluZUVkaXRvciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoX0lubGluZUVkaXRvcjJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgIGRldGFjaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIG5vZGU6IHRoaXMuc3RhdGUuaW5saW5lRWRpdGlvbkZvck5vZGUsXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IHRoaXMuc3RhdGUuaW5saW5lRWRpdGlvbkNhbGxiYWNrLFxuICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNldFN0YXRlKHsgaW5saW5lRWRpdGlvbkZvck5vZGU6IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZW1wdHlTdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBlbXB0eVN0YXRlUHJvcHMgPSBfcHJvcHMuZW1wdHlTdGF0ZVByb3BzO1xuICAgICAgICB2YXIgbm9kZSA9IF9wcm9wcy5ub2RlO1xuXG4gICAgICAgIGlmIChlbXB0eVN0YXRlUHJvcHMgJiYgdGhpcy5wcm9wcy5ub2RlLmlzTG9hZGVkKCkgJiYgIXRoaXMucHJvcHMubm9kZS5pc0xvYWRpbmcoKSAmJiAoIXRoaXMuc3RhdGUuZWxlbWVudHMubGVuZ3RoIHx8IHRoaXMuc3RhdGUuZWxlbWVudHMubGVuZ3RoID09PSAxICYmIHRoaXMuc3RhdGUuZWxlbWVudHNbMF0ucGFyZW50KSkge1xuXG4gICAgICAgICAgICB2YXIgYWN0aW9uUHJvcHMgPSB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmVsZW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0aGlzLnN0YXRlLmVsZW1lbnRzWzBdLnBhcmVudCkge1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnROb2RlID0gX3RoaXM4LnN0YXRlLmVsZW1lbnRzWzBdLm5vZGU7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvblByb3BzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTGFiZWxJZDogJ3JlYWN0LjEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSWNvbkNsYXNzTmFtZTogU2ltcGxlTGlzdC5QQVJFTlRfRk9MREVSX0lDT04sXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25DYWxsYmFjazogZnVuY3Rpb24gYWN0aW9uQ2FsbGJhY2soZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczgucHJvcHMuZW50cnlIYW5kbGVDbGlja3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnByb3BzLmVudHJ5SGFuZGxlQ2xpY2tzKHBhcmVudE5vZGUsIFNpbXBsZUxpc3QuQ0xJQ0tfVFlQRV9ET1VCTEUsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZW1wdHlTdGF0ZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoX3ZpZXdzRW1wdHlTdGF0ZVZpZXcyWydkZWZhdWx0J10sIF9leHRlbmRzKHt9LCBlbXB0eVN0YXRlUHJvcHMsIGFjdGlvblByb3BzKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZW1wdHlTdGF0ZVByb3BzICYmIGVtcHR5U3RhdGVQcm9wcy5jaGVja0VtcHR5U3RhdGUgJiYgZW1wdHlTdGF0ZVByb3BzLmNoZWNrRW1wdHlTdGF0ZSh0aGlzLnByb3BzLm5vZGUpKSB7XG5cbiAgICAgICAgICAgIGVtcHR5U3RhdGUgPSBSZWFjdC5jcmVhdGVFbGVtZW50KF92aWV3c0VtcHR5U3RhdGVWaWV3MlsnZGVmYXVsdCddLCBlbXB0eVN0YXRlUHJvcHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5idWlsZEVsZW1lbnRzRnJvbU5vZGVFbnRyaWVzKHRoaXMuc3RhdGUuZWxlbWVudHMsIHRoaXMuc3RhdGUuc2hvd1NlbGVjdG9yKTtcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IGNvbnRhaW5lckNsYXNzZXMsIG9uQ29udGV4dE1lbnU6IHRoaXMuY29udGV4dE1lbnVSZXNwb25kZXIsIHRhYkluZGV4OiAnMCcsIG9uS2V5RG93bjogdGhpcy5vbktleURvd24sIHN0eWxlOiB0aGlzLnByb3BzLnN0eWxlIH0sXG4gICAgICAgICAgICB0b29sYmFyLFxuICAgICAgICAgICAgaW5saW5lRWRpdG9yLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogdGhpcy5wcm9wcy5oZWlnaHRBdXRvV2l0aE1heCA/IFwiaW5maW5pdGUtcGFyZW50LXNtb290aC1oZWlnaHRcIiA6IGVtcHR5U3RhdGUgPyBcImxheW91dC1maWxsIHZlcnRpY2FsX2xheW91dFwiIDogXCJsYXlvdXQtZmlsbFwiLCByZWY6ICdpbmZpbml0ZVBhcmVudCcgfSxcbiAgICAgICAgICAgICAgICAhZW1wdHlTdGF0ZSAmJiAhdGhpcy5wcm9wcy52ZXJ0aWNhbFNjcm9sbGVyICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIEluZmluaXRlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50SGVpZ2h0OiB0aGlzLnN0YXRlLmVsZW1lbnRIZWlnaHQgPyB0aGlzLnN0YXRlLmVsZW1lbnRIZWlnaHQgOiB0aGlzLnByb3BzLmVsZW1lbnRIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IHRoaXMuc3RhdGUuY29udGFpbmVySGVpZ2h0ID8gdGhpcy5zdGF0ZS5jb250YWluZXJIZWlnaHQgOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5maW5pdGVMb2FkQmVnaW5FZGdlT2Zmc2V0OiB0aGlzLnN0YXRlLmluZmluaXRlTG9hZEJlZ2luQm90dG9tT2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgb25JbmZpbml0ZUxvYWQ6IHRoaXMuaGFuZGxlSW5maW5pdGVMb2FkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlU2Nyb2xsOiB0aGlzLm9uU2Nyb2xsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmOiAnaW5maW5pdGUnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAhZW1wdHlTdGF0ZSAmJiB0aGlzLnByb3BzLnZlcnRpY2FsU2Nyb2xsZXIgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0U2Nyb2xsYmFyMlsnZGVmYXVsdCddLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlZDogMC44LFxuICAgICAgICAgICAgICAgICAgICAgICAgaG9yaXpvbnRhbFNjcm9sbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogeyBoZWlnaHQ6IHRoaXMuc3RhdGUuY29udGFpbmVySGVpZ2h0IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbFNjcm9sbGJhclN0eWxlOiB7IGJvcmRlclJhZGl1czogMTAsIHdpZHRoOiA2IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbENvbnRhaW5lclN0eWxlOiB7IHdpZHRoOiA4IH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGVtcHR5U3RhdGVcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbn0pO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBTaW1wbGVMaXN0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX21lbnVJY29uQnV0dG9uTWVudSA9IHJlcXVpcmUoJy4uL21lbnUvSWNvbkJ1dHRvbk1lbnUnKTtcblxudmFyIF9tZW51SWNvbkJ1dHRvbk1lbnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbWVudUljb25CdXR0b25NZW51KTtcblxudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbnZhciBQeWRpbyA9IHJlcXVpcmUoJ3B5ZGlvJyk7XG5cbnZhciBfUHlkaW8kcmVxdWlyZUxpYiA9IFB5ZGlvLnJlcXVpcmVMaWIoJ2Jvb3QnKTtcblxudmFyIFB5ZGlvQ29udGV4dENvbnN1bWVyID0gX1B5ZGlvJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpLWxlZ2FjeScpO1xuXG52YXIgVG9vbGJhckdyb3VwID0gX3JlcXVpcmUuVG9vbGJhckdyb3VwO1xuXG52YXIgU29ydENvbHVtbnMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdTb3J0Q29sdW1ucycsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgdGFibGVLZXlzOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgICAgIGNvbHVtbkNsaWNrZWQ6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBzb3J0aW5nSW5mbzogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgZGlzcGxheU1vZGU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmdcbiAgICB9LFxuXG4gICAgb25NZW51Q2xpY2tlZDogZnVuY3Rpb24gb25NZW51Q2xpY2tlZChvYmplY3QpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5jb2x1bW5DbGlja2VkKG9iamVjdC5wYXlsb2FkKTtcbiAgICB9LFxuXG4gICAgb25IZWFkZXJDbGljazogZnVuY3Rpb24gb25IZWFkZXJDbGljayhrZXksIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5wcm9wcy50YWJsZUtleXNba2V5XTtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YVsnc29ydFR5cGUnXSAmJiB0aGlzLnByb3BzLmNvbHVtbkNsaWNrZWQpIHtcbiAgICAgICAgICAgIGRhdGFbJ25hbWUnXSA9IGtleTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuY29sdW1uQ2xpY2tlZChkYXRhLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0Q29sdW1uc0l0ZW1zOiBmdW5jdGlvbiBnZXRDb2x1bW5zSXRlbXMoZGlzcGxheU1vZGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgY29udHJvbGxlciA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIHZhciBfY2FsbGJhY2sgPSBmdW5jdGlvbiBfY2FsbGJhY2soKSB7XG4gICAgICAgICAgICBpZiAoY29udHJvbGxlcikge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIubm90aWZ5KCdhY3Rpb25zX3JlZnJlc2hlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMucHJvcHMudGFibGVLZXlzLmhhc093blByb3BlcnR5KGtleSkpIHJldHVybiAnY29udGludWUnO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBfdGhpcy5wcm9wcy50YWJsZUtleXNba2V5XTtcbiAgICAgICAgICAgIHZhciBzdHlsZSA9IGRhdGFbJ3dpZHRoJ10gPyB7IHdpZHRoOiBkYXRhWyd3aWR0aCddIH0gOiBudWxsO1xuICAgICAgICAgICAgdmFyIGljb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJ2NlbGwgaGVhZGVyX2NlbGwgY2VsbC0nICsga2V5O1xuICAgICAgICAgICAgaWYgKGRhdGFbJ3NvcnRUeXBlJ10pIHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgKz0gJyBzb3J0YWJsZSc7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnByb3BzLnNvcnRpbmdJbmZvICYmIChfdGhpcy5wcm9wcy5zb3J0aW5nSW5mby5hdHRyaWJ1dGUgPT09IGtleSB8fCBfdGhpcy5wcm9wcy5zb3J0aW5nSW5mby5hdHRyaWJ1dGUgPT09IGRhdGFbJ3NvcnRBdHRyaWJ1dGUnXSB8fCBfdGhpcy5wcm9wcy5zb3J0aW5nSW5mby5hdHRyaWJ1dGUgPT09IGRhdGFbJ3JlbW90ZVNvcnRBdHRyaWJ1dGUnXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbiA9IF90aGlzLnByb3BzLnNvcnRpbmdJbmZvLmRpcmVjdGlvbiA9PT0gJ2FzYycgPyAnbWRpIG1kaS1hcnJvdy11cCcgOiAnbWRpIG1kaS1hcnJvdy1kb3duJztcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lICs9ICcgYWN0aXZlLXNvcnQtJyArIF90aGlzLnByb3BzLnNvcnRpbmdJbmZvLmRpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlzcGxheU1vZGUgPT09ICdtZW51Jykge1xuICAgICAgICAgICAgICAgIGRhdGFbJ25hbWUnXSA9IGtleTtcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogZGF0YVsnbGFiZWwnXSxcbiAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogaWNvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkaXNwbGF5TW9kZSA9PT0gJ21lbnVfZGF0YScpIHtcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZGF0YVsnbGFiZWwnXSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIGNhbGxiYWNrKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub25IZWFkZXJDbGljayhrZXksIF9jYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGljb25fY2xhc3M6IGljb24gfHwgJ19fSU5TRVRfXydcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogc3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub25IZWFkZXJDbGljayhrZXksIF9jYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbJ2xhYmVsJ11cbiAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5wcm9wcy50YWJsZUtleXMpIHtcbiAgICAgICAgICAgIHZhciBfcmV0ID0gX2xvb3Aoa2V5KTtcblxuICAgICAgICAgICAgaWYgKF9yZXQgPT09ICdjb250aW51ZScpIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtcztcbiAgICB9LFxuXG4gICAgYnVpbGRTb3J0aW5nTWVudUl0ZW1zOiBmdW5jdGlvbiBidWlsZFNvcnRpbmdNZW51SXRlbXMoY29udHJvbGxlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2x1bW5zSXRlbXMoJ21lbnVfZGF0YScsIGNvbnRyb2xsZXIpO1xuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG5cbiAgICAgICAgdmFyIHNvcnRBY3Rpb24gPSBuZXcgQWN0aW9uKHtcbiAgICAgICAgICAgIG5hbWU6ICdzb3J0X2FjdGlvbicsXG4gICAgICAgICAgICBpY29uX2NsYXNzOiAnbWRpIG1kaS1zb3J0LWRlc2NlbmRpbmcnLFxuICAgICAgICAgICAgdGV4dF9pZDogNDUwLFxuICAgICAgICAgICAgdGl0bGVfaWQ6IDQ1MCxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSg0NTApLFxuICAgICAgICAgICAgdGl0bGU6IHRoaXMucHJvcHMuZ2V0TWVzc2FnZSg0NTApLFxuICAgICAgICAgICAgaGFzQWNjZXNzS2V5OiBmYWxzZSxcbiAgICAgICAgICAgIHN1Yk1lbnU6IHRydWUsXG4gICAgICAgICAgICBzdWJNZW51VXBkYXRlSW1hZ2U6IHRydWVcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIGRpcjogdHJ1ZSxcbiAgICAgICAgICAgIGFjdGlvbkJhcjogdHJ1ZSxcbiAgICAgICAgICAgIGFjdGlvbkJhckdyb3VwOiAnZGlzcGxheV90b29sYmFyJyxcbiAgICAgICAgICAgIGNvbnRleHRNZW51OiBmYWxzZSxcbiAgICAgICAgICAgIGluZm9QYW5lbDogZmFsc2VcbiAgICAgICAgfSwge30sIHt9LCB7XG4gICAgICAgICAgICBkeW5hbWljQnVpbGRlcjogdGhpcy5idWlsZFNvcnRpbmdNZW51SXRlbXNcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBidXR0b25zID0gbmV3IE1hcCgpO1xuICAgICAgICBidXR0b25zLnNldCgnc29ydF9hY3Rpb24nLCBzb3J0QWN0aW9uKTtcbiAgICAgICAgdGhpcy5wcm9wcy5weWRpby5nZXRDb250cm9sbGVyKCkudXBkYXRlR3VpQWN0aW9ucyhidXR0b25zKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLnByb3BzLnB5ZGlvLmdldENvbnRyb2xsZXIoKS5kZWxldGVGcm9tR3VpQWN0aW9ucygnc29ydF9hY3Rpb24nKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmRpc3BsYXlNb2RlID09PSAnbWVudScpIHtcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KF9tZW51SWNvbkJ1dHRvbk1lbnUyWydkZWZhdWx0J10sIHsgYnV0dG9uVGl0bGU6ICdTb3J0IGJ5Li4uJywgYnV0dG9uQ2xhc3NOYW1lOiAnbWRpIG1kaS1zb3J0LWRlc2NlbmRpbmcnLCBtZW51SXRlbXM6IHRoaXMuZ2V0Q29sdW1uc0l0ZW1zKCdtZW51JywgdGhpcy5wcm9wcy5weWRpby5nZXRDb250cm9sbGVyKCkpLCBvbk1lbnVDbGlja2VkOiB0aGlzLm9uTWVudUNsaWNrZWQgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBUb29sYmFyR3JvdXAsXG4gICAgICAgICAgICAgICAgeyBmbG9hdDogJ2xlZnQnIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDb2x1bW5zSXRlbXMoJ2hlYWRlcicsIHRoaXMucHJvcHMucHlkaW8uZ2V0Q29udHJvbGxlcigpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBTb3J0Q29sdW1ucyA9IFB5ZGlvQ29udGV4dENvbnN1bWVyKFNvcnRDb2x1bW5zKTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFNvcnRDb2x1bW5zO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cblwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX3V0aWxETkQgPSByZXF1aXJlKCcuLi91dGlsL0RORCcpO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyogUkVBQ1QgRE5EIFNPUlRBQkxFIExJU1RcbiAvKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFNwZWNpZmllcyB0aGUgZHJhZyBzb3VyY2UgY29udHJhY3QuXG4gKiBPbmx5IGBiZWdpbkRyYWdgIGZ1bmN0aW9uIGlzIHJlcXVpcmVkLlxuICovXG52YXIgc29ydGFibGVJdGVtU291cmNlID0ge1xuICAgIGJlZ2luRHJhZzogZnVuY3Rpb24gYmVnaW5EcmFnKHByb3BzKSB7XG4gICAgICAgIC8vIFJldHVybiB0aGUgZGF0YSBkZXNjcmliaW5nIHRoZSBkcmFnZ2VkIGl0ZW1cbiAgICAgICAgcmV0dXJuIHsgaWQ6IHByb3BzLmlkIH07XG4gICAgfSxcbiAgICBlbmREcmFnOiBmdW5jdGlvbiBlbmREcmFnKHByb3BzKSB7XG4gICAgICAgIHByb3BzLmVuZFN3aXRjaGluZygpO1xuICAgIH1cbn07XG5cbnZhciBzb3J0YWJsZUl0ZW1UYXJnZXQgPSB7XG5cbiAgICBob3ZlcjogZnVuY3Rpb24gaG92ZXIocHJvcHMsIG1vbml0b3IpIHtcbiAgICAgICAgdmFyIGRyYWdnZWRJZCA9IG1vbml0b3IuZ2V0SXRlbSgpLmlkO1xuICAgICAgICBpZiAoZHJhZ2dlZElkICE9PSBwcm9wcy5pZCkge1xuICAgICAgICAgICAgcHJvcHMuc3dpdGNoSXRlbXMoZHJhZ2dlZElkLCBwcm9wcy5pZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn07XG5cbnZhciBzb3J0YWJsZUl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6IFwic29ydGFibGVJdGVtXCIsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgY29ubmVjdERyYWdTb3VyY2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgICAgIGNvbm5lY3REcm9wVGFyZ2V0OiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgICBpc0RyYWdnaW5nOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgICAgICBpZDogUmVhY3QuUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkLFxuICAgICAgICBsYWJlbDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBzd2l0Y2hJdGVtczogUmVhY3QuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgICAgcmVtb3ZhYmxlOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgb25SZW1vdmU6IFJlYWN0LlByb3BUeXBlcy5mdW5jXG4gICAgfSxcblxuICAgIHJlbW92ZUNsaWNrZWQ6IGZ1bmN0aW9uIHJlbW92ZUNsaWNrZWQoKSB7XG4gICAgICAgIHRoaXMucHJvcHMub25SZW1vdmUodGhpcy5wcm9wcy5pZCk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAvLyBZb3VyIGNvbXBvbmVudCByZWNlaXZlcyBpdHMgb3duIHByb3BzIGFzIHVzdWFsXG4gICAgICAgIHZhciBpZCA9IHRoaXMucHJvcHMuaWQ7XG5cbiAgICAgICAgLy8gVGhlc2UgdHdvIHByb3BzIGFyZSBpbmplY3RlZCBieSBSZWFjdCBEbkQsXG4gICAgICAgIC8vIGFzIGRlZmluZWQgYnkgeW91ciBgY29sbGVjdGAgZnVuY3Rpb24gYWJvdmU6XG4gICAgICAgIHZhciBpc0RyYWdnaW5nID0gdGhpcy5wcm9wcy5pc0RyYWdnaW5nO1xuICAgICAgICB2YXIgY29ubmVjdERyYWdTb3VyY2UgPSB0aGlzLnByb3BzLmNvbm5lY3REcmFnU291cmNlO1xuICAgICAgICB2YXIgY29ubmVjdERyb3BUYXJnZXQgPSB0aGlzLnByb3BzLmNvbm5lY3REcm9wVGFyZ2V0O1xuXG4gICAgICAgIHZhciByZW1vdmU7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbW92YWJsZSkge1xuICAgICAgICAgICAgcmVtb3ZlID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiYnV0dG9uIG1kaSBtZGktY2xvc2VcIiwgb25DbGljazogdGhpcy5yZW1vdmVDbGlja2VkIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgUmVhY3RNVUkuUGFwZXIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVmOiBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdERyb3BUYXJnZXQoUmVhY3RET00uZmluZERPTU5vZGUoaW5zdGFuY2UpKTtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdERyYWdTb3VyY2UoUmVhY3RET00uZmluZERPTU5vZGUoaW5zdGFuY2UpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHpEZXB0aDogMSxcbiAgICAgICAgICAgICAgICBzdHlsZTogeyBvcGFjaXR5OiBpc0RyYWdnaW5nID8gMCA6IDEgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogdGhpcy5wcm9wcy5jbGFzc05hbWUgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmxhYmVsLFxuICAgICAgICAgICAgICAgIHJlbW92ZVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cbn0pO1xuXG52YXIgTm9uRHJhZ2dhYmxlTGlzdEl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6IFwiTm9uRHJhZ2dhYmxlTGlzdEl0ZW1cIixcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgcmVtb3ZlO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5yZW1vdmFibGUpIHtcbiAgICAgICAgICAgIHJlbW92ZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImJ1dHRvbiBtZGkgbWRpLWNsb3NlXCIsIG9uQ2xpY2s6IHRoaXMucmVtb3ZlQ2xpY2tlZCB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFJlYWN0TVVJLlBhcGVyLFxuICAgICAgICAgICAgeyB6RGVwdGg6IDEgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogdGhpcy5wcm9wcy5jbGFzc05hbWUgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmxhYmVsLFxuICAgICAgICAgICAgICAgIHJlbW92ZVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cbn0pO1xuXG52YXIgRHJhZ2dhYmxlTGlzdEl0ZW07XG5pZiAod2luZG93LlJlYWN0RE5EKSB7XG4gICAgRHJhZ2dhYmxlTGlzdEl0ZW0gPSBSZWFjdERORC5mbG93KFJlYWN0RE5ELkRyYWdTb3VyY2UoX3V0aWxETkQuVHlwZXMuU09SVEFCTEVfTElTVF9JVEVNLCBzb3J0YWJsZUl0ZW1Tb3VyY2UsIF91dGlsRE5ELmNvbGxlY3QpLCBSZWFjdERORC5Ecm9wVGFyZ2V0KF91dGlsRE5ELlR5cGVzLlNPUlRBQkxFX0xJU1RfSVRFTSwgc29ydGFibGVJdGVtVGFyZ2V0LCBfdXRpbERORC5jb2xsZWN0RHJvcCkpKHNvcnRhYmxlSXRlbSk7XG59IGVsc2Uge1xuICAgIERyYWdnYWJsZUxpc3RJdGVtID0gTm9uRHJhZ2dhYmxlTGlzdEl0ZW07XG59XG5cbnZhciBTb3J0YWJsZUxpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6IFwiU29ydGFibGVMaXN0XCIsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgdmFsdWVzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICAgICAgb25PcmRlclVwZGF0ZWQ6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICByZW1vdmFibGU6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBvblJlbW92ZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIGNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgaXRlbUNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHsgdmFsdWVzOiB0aGlzLnByb3BzLnZhbHVlcyB9O1xuICAgIH0sXG4gICAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wczogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhwcm9wcykge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWVzOiBwcm9wcy52YWx1ZXMsIHN3aXRjaERhdGE6IG51bGwgfSk7XG4gICAgfSxcblxuICAgIGZpbmRJdGVtSW5kZXg6IGZ1bmN0aW9uIGZpbmRJdGVtSW5kZXgoaXRlbUlkLCBkYXRhKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGRhdGFbaV1bJ3BheWxvYWQnXSA9PSBpdGVtSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzd2l0Y2hJdGVtczogZnVuY3Rpb24gc3dpdGNoSXRlbXMob2xkSWQsIG5ld0lkKSB7XG4gICAgICAgIHZhciBvbGRJbmRleCA9IHRoaXMuZmluZEl0ZW1JbmRleChvbGRJZCwgdGhpcy5zdGF0ZS52YWx1ZXMpO1xuICAgICAgICB2YXIgb2xkSXRlbSA9IHRoaXMuc3RhdGUudmFsdWVzW29sZEluZGV4XTtcbiAgICAgICAgdmFyIG5ld0luZGV4ID0gdGhpcy5maW5kSXRlbUluZGV4KG5ld0lkLCB0aGlzLnN0YXRlLnZhbHVlcyk7XG4gICAgICAgIHZhciBuZXdJdGVtID0gdGhpcy5zdGF0ZS52YWx1ZXNbbmV3SW5kZXhdO1xuXG4gICAgICAgIHZhciBjdXJyZW50VmFsdWVzID0gdGhpcy5zdGF0ZS52YWx1ZXMuc2xpY2UoKTtcbiAgICAgICAgY3VycmVudFZhbHVlc1tvbGRJbmRleF0gPSBuZXdJdGVtO1xuICAgICAgICBjdXJyZW50VmFsdWVzW25ld0luZGV4XSA9IG9sZEl0ZW07XG5cbiAgICAgICAgLy8gQ2hlY2sgdGhhdCBpdCBkaWQgbm90IGNvbWUgYmFjayB0byBvcmlnaW5hbCBzdGF0ZVxuICAgICAgICB2YXIgb2xkUHJldmlvdXMgPSB0aGlzLmZpbmRJdGVtSW5kZXgob2xkSWQsIHRoaXMucHJvcHMudmFsdWVzKTtcbiAgICAgICAgdmFyIG5ld1ByZXZpb3VzID0gdGhpcy5maW5kSXRlbUluZGV4KG5ld0lkLCB0aGlzLnByb3BzLnZhbHVlcyk7XG4gICAgICAgIGlmIChvbGRQcmV2aW91cyA9PSBuZXdJbmRleCAmJiBuZXdQcmV2aW91cyA9PSBvbGRJbmRleCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlczogY3VycmVudFZhbHVlcywgc3dpdGNoRGF0YTogbnVsbCB9KTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJubyBtb3JlIG1vdmVzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZXM6IGN1cnJlbnRWYWx1ZXMsIHN3aXRjaERhdGE6IHsgb2xkSWQ6IG9sZElkLCBuZXdJZDogbmV3SWQgfSB9KTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHtvbGRJZDpvbGRJbmRleCwgbmV3SWQ6bmV3SW5kZXh9KTtcbiAgICAgICAgICAgIH1cbiAgICB9LFxuXG4gICAgZW5kU3dpdGNoaW5nOiBmdW5jdGlvbiBlbmRTd2l0Y2hpbmcoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnN3aXRjaERhdGEpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgaXQgZGlkIG5vdCBjb21lIGJhY2sgdG8gb3JpZ2luYWwgc3RhdGVcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uT3JkZXJVcGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vbk9yZGVyVXBkYXRlZCh0aGlzLnN0YXRlLnN3aXRjaERhdGEub2xkSWQsIHRoaXMuc3RhdGUuc3dpdGNoRGF0YS5uZXdJZCwgdGhpcy5zdGF0ZS52YWx1ZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzd2l0Y2hEYXRhOiBudWxsIH0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIHN3aXRjaEl0ZW1zID0gdGhpcy5zd2l0Y2hJdGVtcztcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IHRoaXMucHJvcHMuY2xhc3NOYW1lIH0sXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlcy5tYXAoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRHJhZ2dhYmxlTGlzdEl0ZW0sIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0ucGF5bG9hZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiBpdGVtLnBheWxvYWQsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaEl0ZW1zOiBzd2l0Y2hJdGVtcyxcbiAgICAgICAgICAgICAgICAgICAgZW5kU3dpdGNoaW5nOiB0aGlzLmVuZFN3aXRjaGluZyxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZhYmxlOiB0aGlzLnByb3BzLnJlbW92YWJsZSxcbiAgICAgICAgICAgICAgICAgICAgb25SZW1vdmU6IHRoaXMucHJvcHMub25SZW1vdmUsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5pdGVtQ2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKVxuICAgICAgICApO1xuICAgIH1cbn0pO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IFNvcnRhYmxlTGlzdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluID0gcmVxdWlyZSgnLi9MaXN0RW50cnlOb2RlTGlzdGVuZXJNaXhpbicpO1xuXG52YXIgX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluKTtcblxudmFyIF9MaXN0RW50cnkgPSByZXF1aXJlKCcuL0xpc3RFbnRyeScpO1xuXG52YXIgX0lubGluZUVkaXRvciA9IHJlcXVpcmUoJy4vSW5saW5lRWRpdG9yJyk7XG5cbnZhciBfSW5saW5lRWRpdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0lubGluZUVkaXRvcik7XG5cbnZhciBfcHlkaW9VdGlsUGF0aCA9IHJlcXVpcmUoJ3B5ZGlvL3V0aWwvcGF0aCcpO1xuXG52YXIgX3B5ZGlvVXRpbFBhdGgyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9VdGlsUGF0aCk7XG5cbnZhciBfcmVxdWlyZSRyZXF1aXJlTGliID0gcmVxdWlyZSgncHlkaW8nKS5yZXF1aXJlTGliKCdib290Jyk7XG5cbnZhciBtb21lbnQgPSBfcmVxdWlyZSRyZXF1aXJlTGliLm1vbWVudDtcblxuLyoqXG4gKiBTcGVjaWZpYyBsaXN0IGVudHJ5IHJlbmRlcmVkIGFzIGEgdGFibGUgcm93LiBOb3QgYSByZWFsIHRhYmxlLCBDU1MgdXNlZC5cbiAqL1xuZXhwb3J0c1snZGVmYXVsdCddID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnVGFibGVMaXN0RW50cnknLFxuXG4gICAgbWl4aW5zOiBbX0xpc3RFbnRyeU5vZGVMaXN0ZW5lck1peGluMlsnZGVmYXVsdCddXSxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBub2RlOiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihBanhwTm9kZSksXG4gICAgICAgIHRhYmxlS2V5czogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgICAgICByZW5kZXJBY3Rpb25zOiBSZWFjdC5Qcm9wVHlwZXMuZnVuY1xuICAgICAgICAvLyBTZWUgYWxzbyBMaXN0RW50cnkgbm9kZXNcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIGFjdGlvbnMgPSB0aGlzLnByb3BzLmFjdGlvbnM7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbmRlckFjdGlvbnMpIHtcbiAgICAgICAgICAgIGFjdGlvbnMgPSB0aGlzLnByb3BzLnJlbmRlckFjdGlvbnModGhpcy5wcm9wcy5ub2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjZWxscyA9IFtdO1xuICAgICAgICB2YXIgZmlyc3RLZXkgPSB0cnVlO1xuICAgICAgICB2YXIgbWV0YSA9IHRoaXMucHJvcHMubm9kZS5nZXRNZXRhZGF0YSgpO1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5wcm9wcy50YWJsZUtleXMpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5wcm9wcy50YWJsZUtleXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMucHJvcHMudGFibGVLZXlzW2tleV07XG4gICAgICAgICAgICB2YXIgc3R5bGUgPSBkYXRhWyd3aWR0aCddID8geyB3aWR0aDogZGF0YVsnd2lkdGgnXSB9IDogbnVsbDtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByYXdWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmIChkYXRhLnJlbmRlckNlbGwpIHtcbiAgICAgICAgICAgICAgICBkYXRhWyduYW1lJ10gPSBrZXk7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhLnJlbmRlckNlbGwodGhpcy5wcm9wcy5ub2RlLCBkYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnYWp4cF9tb2RpZnRpbWUnKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1EYXRlID0gbW9tZW50KHBhcnNlRmxvYXQobWV0YS5nZXQoJ2FqeHBfbW9kaWZ0aW1lJykpICogMTAwMCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGVTdHJpbmcgPSBtRGF0ZS5jYWxlbmRhcigpO1xuICAgICAgICAgICAgICAgIGlmIChkYXRlU3RyaW5nLmluZGV4T2YoJy8nKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGVTdHJpbmcgPSBtRGF0ZS5mcm9tTm93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0ZVN0cmluZztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnYnl0ZXNpemUnKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBfcHlkaW9VdGlsUGF0aDJbJ2RlZmF1bHQnXS5yb3VuZEZpbGVTaXplKHBhcnNlSW50KG1ldGEuZ2V0KGtleSkpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBtZXRhLmdldChrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmF3VmFsdWUgPSBtZXRhLmdldChrZXkpO1xuICAgICAgICAgICAgdmFyIGlubGluZUVkaXRvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUuaW5saW5lRWRpdGlvbiAmJiBmaXJzdEtleSkge1xuICAgICAgICAgICAgICAgIGlubGluZUVkaXRvciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoX0lubGluZUVkaXRvcjJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgICAgICBub2RlOiB0aGlzLnByb3BzLm5vZGUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaW5saW5lRWRpdGlvbjogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB0aGlzLnN0YXRlLmlubGluZUVkaXRpb25DYWxsYmFja1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBfc3R5bGUgPSB0aGlzLnByb3BzLnN0eWxlIHx8IHt9O1xuICAgICAgICAgICAgICAgIF9zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5zdHlsZSA9IF9zdHlsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNlbGxzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgeyBrZXk6IGtleSwgY2xhc3NOYW1lOiAnY2VsbCBjZWxsLScgKyBrZXksIHRpdGxlOiByYXdWYWx1ZSwgc3R5bGU6IHN0eWxlLCAnZGF0YS1sYWJlbCc6IGRhdGFbJ2xhYmVsJ10gfSxcbiAgICAgICAgICAgICAgICBpbmxpbmVFZGl0b3IsXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgZmlyc3RLZXkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KF9MaXN0RW50cnkuRHJhZ0Ryb3BMaXN0RW50cnksIF9leHRlbmRzKHt9LCB0aGlzLnByb3BzLCB7XG4gICAgICAgICAgICBpY29uQ2VsbDogbnVsbCxcbiAgICAgICAgICAgIGZpcnN0TGluZTogY2VsbHMsXG4gICAgICAgICAgICBhY3Rpb25zOiBhY3Rpb25zXG4gICAgICAgIH0pKTtcbiAgICB9XG5cbn0pO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4gPSByZXF1aXJlKCcuLi91dGlsL01lc3NhZ2VzQ29uc3VtZXJNaXhpbicpO1xuXG52YXIgX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbE1lc3NhZ2VzQ29uc3VtZXJNaXhpbik7XG5cbnZhciBfU29ydENvbHVtbnMgPSByZXF1aXJlKCcuL1NvcnRDb2x1bW5zJyk7XG5cbnZhciBfU29ydENvbHVtbnMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU29ydENvbHVtbnMpO1xuXG52YXIgX0xpc3RQYWdpbmF0b3IgPSByZXF1aXJlKCcuL0xpc3RQYWdpbmF0b3InKTtcblxudmFyIF9MaXN0UGFnaW5hdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xpc3RQYWdpbmF0b3IpO1xuXG4vKipcbiAqIFNwZWNpZmljIGhlYWRlciBmb3IgVGFibGUgbGF5b3V0LCByZWFkaW5nIG1ldGFkYXRhIGZyb20gbm9kZSBhbmQgdXNpbmcga2V5c1xuICovXG5leHBvcnRzWydkZWZhdWx0J10gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdUYWJsZUxpc3RIZWFkZXInLFxuXG4gICAgbWl4aW5zOiBbX3V0aWxNZXNzYWdlc0NvbnN1bWVyTWl4aW4yWydkZWZhdWx0J11dLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHRhYmxlS2V5czogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgICAgICBsb2FkaW5nOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgcmVsb2FkOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgZG06IFJlYWN0LlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvRGF0YU1vZGVsKSxcbiAgICAgICAgbm9kZTogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoQWp4cE5vZGUpLFxuICAgICAgICBvbkhlYWRlckNsaWNrOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgc29ydGluZ0luZm86IFJlYWN0LlByb3BUeXBlcy5vYmplY3RcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBoZWFkZXJzID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGFnaW5hdG9yID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwicGFnaW5hdGlvbkRhdGFcIikgJiYgdGhpcy5wcm9wcy5ub2RlLmdldE1ldGFkYXRhKCkuZ2V0KFwicGFnaW5hdGlvbkRhdGFcIikuZ2V0KCd0b3RhbCcpID4gMSkge1xuICAgICAgICAgICAgcGFnaW5hdG9yID0gUmVhY3QuY3JlYXRlRWxlbWVudChfTGlzdFBhZ2luYXRvcjJbJ2RlZmF1bHQnXSwgeyBkYXRhTW9kZWw6IHRoaXMucHJvcHMuZG0sIG5vZGU6IHRoaXMucHJvcHMubm9kZSB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFJlYWN0TVVJLlRvb2xiYXIsXG4gICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3Rvb2xiYXJUYWJsZUhlYWRlcicgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX1NvcnRDb2x1bW5zMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7IGRpc3BsYXlNb2RlOiAndGFibGVIZWFkZXInIH0sIHRoaXMucHJvcHMsIHsgY29sdW1uQ2xpY2tlZDogdGhpcy5wcm9wcy5vbkhlYWRlckNsaWNrIH0pKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgUmVhY3RNVUkuVG9vbGJhckdyb3VwLFxuICAgICAgICAgICAgICAgIHsgZmxvYXQ6ICdyaWdodCcgfSxcbiAgICAgICAgICAgICAgICBwYWdpbmF0b3IsXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdE1VSS5Gb250SWNvbiwge1xuICAgICAgICAgICAgICAgICAgICBrZXk6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHRoaXMuY29udGV4dC5nZXRNZXNzYWdlKCcxNDknLCAnJyksXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJpY29uLXJlZnJlc2hcIiArICh0aGlzLnByb3BzLmxvYWRpbmcgPyBcIiByb3RhdGluZ1wiIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucHJvcHMucmVsb2FkXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5hZGRpdGlvbmFsQWN0aW9uc1xuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cbn0pO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxOCBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvIENlbGxzLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIgPSByZXF1aXJlKCcuL01lbnVJdGVtc0NvbnN1bWVyJyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTWVudUl0ZW1zQ29uc3VtZXIpO1xuXG52YXIgX3JlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdERvbSA9IHJlcXVpcmUoXCJyZWFjdC1kb21cIik7XG5cbnZhciBfcmVhY3REb20yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3REb20pO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKFwibWF0ZXJpYWwtdWlcIik7XG5cbnZhciBCdXR0b25Db21wb3NlZCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdCdXR0b25Db21wb3NlZCcsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgYnV0dG9uVGl0bGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub25lT2ZUeXBlKFtfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZywgX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3RdKS5pc1JlcXVpcmVkLFxuICAgICAgICBtYXN0ZXJBY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgICBtZW51SXRlbXM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICAgICAgY2xhc3NOYW1lOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgcmFpc2VkOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIGRpcmVjdGlvbjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vbmVPZihbJ2xlZnQnLCAncmlnaHQnXSlcbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9wZW5PbkV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnB5ZGlvLm9ic2VydmUodGhpcy5wcm9wcy5vcGVuT25FdmVudCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnNob3dNZW51KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHsgc2hvd01lbnU6IGZhbHNlIH07XG4gICAgfSxcblxuICAgIHNob3dNZW51OiBmdW5jdGlvbiBzaG93TWVudShldmVudCkge1xuICAgICAgICB2YXIgYW5jaG9yID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGFuY2hvciA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbmNob3IgPSB0aGlzLl9idXR0b25ET007XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaG93TWVudTogdHJ1ZSxcbiAgICAgICAgICAgIGFuY2hvcjogYW5jaG9yXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBtZW51Q2xpY2tlZDogZnVuY3Rpb24gbWVudUNsaWNrZWQoZXZlbnQsIGluZGV4LCBvYmplY3QpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dNZW51OiBmYWxzZSB9KTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICAgIHZhciBtYXN0ZXJCdXR0b24gPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBhcnJvd0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBpZCA9IF9wcm9wcy5pZDtcbiAgICAgICAgdmFyIG1hc3RlckFjdGlvbiA9IF9wcm9wcy5tYXN0ZXJBY3Rpb247XG4gICAgICAgIHZhciBidXR0b25UaXRsZSA9IF9wcm9wcy5idXR0b25UaXRsZTtcbiAgICAgICAgdmFyIHByaW1hcnkgPSBfcHJvcHMucHJpbWFyeTtcbiAgICAgICAgdmFyIHNlY29uZGFyeSA9IF9wcm9wcy5zZWNvbmRhcnk7XG4gICAgICAgIHZhciBkaXNhYmxlZCA9IF9wcm9wcy5kaXNhYmxlZDtcbiAgICAgICAgdmFyIHJhaXNlZCA9IF9wcm9wcy5yYWlzZWQ7XG4gICAgICAgIHZhciBtZW51SXRlbXMgPSBfcHJvcHMubWVudUl0ZW1zO1xuICAgICAgICB2YXIgYnV0dG9uU3R5bGUgPSBfcHJvcHMuYnV0dG9uU3R5bGU7XG4gICAgICAgIHZhciBidXR0b25MYWJlbFN0eWxlID0gX3Byb3BzLmJ1dHRvbkxhYmVsU3R5bGU7XG4gICAgICAgIHZhciBjbGFzc05hbWUgPSBfcHJvcHMuY2xhc3NOYW1lO1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gX3Byb3BzLmRpcmVjdGlvbjtcblxuICAgICAgICB2YXIgbWFzdGVyUHJvcHMgPSB7XG4gICAgICAgICAgICBwcmltYXJ5OiBwcmltYXJ5LFxuICAgICAgICAgICAgc2Vjb25kYXJ5OiBzZWNvbmRhcnksXG4gICAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgICAgICBsYWJlbDogYnV0dG9uVGl0bGUsXG4gICAgICAgICAgICBzdHlsZTogYnV0dG9uU3R5bGUsXG4gICAgICAgICAgICBsYWJlbFN0eWxlOiBfZXh0ZW5kcyh7fSwgYnV0dG9uTGFiZWxTdHlsZSwgeyBwYWRkaW5nUmlnaHQ6IDggfSksXG4gICAgICAgICAgICBvblRvdWNoVGFwOiBtYXN0ZXJBY3Rpb24sXG4gICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGFycm93UHJvcHMgPSB7XG4gICAgICAgICAgICBwcmltYXJ5OiBwcmltYXJ5LFxuICAgICAgICAgICAgc2Vjb25kYXJ5OiBzZWNvbmRhcnksXG4gICAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgICAgICBsYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogXCJtZGkgbWRpLW1lbnUtZG93blwiIH0pLFxuICAgICAgICAgICAgb25Ub3VjaFRhcDogdGhpcy5zaG93TWVudSxcbiAgICAgICAgICAgIHN0eWxlOiBfZXh0ZW5kcyh7fSwgYnV0dG9uU3R5bGUsIHsgbWluV2lkdGg6IDE2IH0pLFxuICAgICAgICAgICAgbGFiZWxTdHlsZTogX2V4dGVuZHMoe30sIGJ1dHRvbkxhYmVsU3R5bGUsIHsgcGFkZGluZ0xlZnQ6IDgsIHBhZGRpbmdSaWdodDogOCB9KSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgX3N0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdmFyIHNob3dNZW51ID0gX3N0YXRlLnNob3dNZW51O1xuICAgICAgICB2YXIgYW5jaG9yID0gX3N0YXRlLmFuY2hvcjtcbiAgICAgICAgdmFyIG92ZXIgPSBfc3RhdGUub3ZlcjtcblxuICAgICAgICBpZiAobWVudUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHJhaXNlZCkge1xuICAgICAgICAgICAgICAgIGFycm93QnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuUmFpc2VkQnV0dG9uLCBfZXh0ZW5kcyh7fSwgYXJyb3dQcm9wcywgeyByZWY6IGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX2J1dHRvbkRPTSA9IF9yZWFjdERvbTJbJ2RlZmF1bHQnXS5maW5kRE9NTm9kZShiKTtcbiAgICAgICAgICAgICAgICAgICAgfSB9KSk7XG4gICAgICAgICAgICAgICAgbWFzdGVyQnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuUmFpc2VkQnV0dG9uLCBtYXN0ZXJQcm9wcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFycm93QnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRmxhdEJ1dHRvbiwgX2V4dGVuZHMoe30sIGFycm93UHJvcHMsIHsgcmVmOiBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9idXR0b25ET00gPSBfcmVhY3REb20yWydkZWZhdWx0J10uZmluZERPTU5vZGUoYik7XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICAgICAgICAgIG1hc3RlckJ1dHRvbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZsYXRCdXR0b24sIG1hc3RlclByb3BzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICB7IGlkOiBpZCwgY2xhc3NOYW1lOiBjbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgb25Nb3VzZU92ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgb3ZlcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LCBvbk1vdXNlT3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IG92ZXI6IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3R5bGU6IG92ZXIgfHwgc2hvd01lbnUgPyB7IGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTUzLCAxNTMsIDE1MywgMC4yKScsIHdoaXRlU3BhY2U6ICdub3dyYXAnIH0gOiB7IHdoaXRlU3BhY2U6ICdub3dyYXAnIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXN0ZXJCdXR0b24sXG4gICAgICAgICAgICBhcnJvd0J1dHRvbixcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlBvcG92ZXIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdtZW51UG9wb3ZlcicsXG4gICAgICAgICAgICAgICAgICAgIG9wZW46IHNob3dNZW51LFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogYW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JPcmlnaW46IHsgaG9yaXpvbnRhbDogZGlyZWN0aW9uIHx8ICdsZWZ0JywgdmVydGljYWw6ICdib3R0b20nIH0sXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldE9yaWdpbjogeyBob3Jpem9udGFsOiBkaXJlY3Rpb24gfHwgJ2xlZnQnLCB2ZXJ0aWNhbDogJ3RvcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgb25SZXF1ZXN0Q2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IHNob3dNZW51OiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgbWFyZ2luVG9wOiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZUxheWVyRm9yQ2xpY2tBd2F5OiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgX1V0aWxzMlsnZGVmYXVsdCddLml0ZW1zVG9NZW51KG1lbnVJdGVtcywgdGhpcy5tZW51Q2xpY2tlZClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbn0pO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBfTWVudUl0ZW1zQ29uc3VtZXIyWydkZWZhdWx0J10oQnV0dG9uQ29tcG9zZWQpO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxOCBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvIENlbGxzLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIgPSByZXF1aXJlKCcuL01lbnVJdGVtc0NvbnN1bWVyJyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTWVudUl0ZW1zQ29uc3VtZXIpO1xuXG52YXIgX3JlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblxudmFyIF9yZWFjdERvbSA9IHJlcXVpcmUoXCJyZWFjdC1kb21cIik7XG5cbnZhciBfcmVhY3REb20yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3REb20pO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKFwibWF0ZXJpYWwtdWlcIik7XG5cbnZhciBCdXR0b25NZW51ID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0J1dHRvbk1lbnUnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGJ1dHRvblRpdGxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9uZU9mVHlwZShbX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsIF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0XSkuaXNSZXF1aXJlZCxcbiAgICAgICAgbWVudUl0ZW1zOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG4gICAgICAgIGNsYXNzTmFtZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHJhaXNlZDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICBkaXJlY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub25lT2YoWydsZWZ0JywgJ3JpZ2h0J10pXG4gICAgfSxcblxuICAgIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vcGVuT25FdmVudCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5weWRpby5vYnNlcnZlKHRoaXMucHJvcHMub3Blbk9uRXZlbnQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zaG93TWVudSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB7IHNob3dNZW51OiBmYWxzZSB9O1xuICAgIH0sXG5cbiAgICBzaG93TWVudTogZnVuY3Rpb24gc2hvd01lbnUoZXZlbnQpIHtcbiAgICAgICAgdmFyIGFuY2hvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICBhbmNob3IgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYW5jaG9yID0gdGhpcy5fYnV0dG9uRE9NO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2hvd01lbnU6IHRydWUsXG4gICAgICAgICAgICBhbmNob3I6IGFuY2hvclxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgbWVudUNsaWNrZWQ6IGZ1bmN0aW9uIG1lbnVDbGlja2VkKGV2ZW50LCBpbmRleCwgb2JqZWN0KSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93TWVudTogZmFsc2UgfSk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgX3N0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdmFyIHNob3dNZW51ID0gX3N0YXRlLnNob3dNZW51O1xuICAgICAgICB2YXIgYW5jaG9yID0gX3N0YXRlLmFuY2hvcjtcblxuICAgICAgICB2YXIgbGFiZWwgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgIHsgc3R5bGU6IHsgd2hpdGVTcGFjZTogJ25vd3JhcCcgfSB9LFxuICAgICAgICAgICAgdGhpcy5wcm9wcy5idXR0b25UaXRsZSxcbiAgICAgICAgICAgICcgJyxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICdtZGkgbWRpLW1lbnUtZG93bicgfSlcbiAgICAgICAgKTtcbiAgICAgICAgdmFyIGJ1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIHByb3BzID0ge1xuICAgICAgICAgICAgcHJpbWFyeTogdGhpcy5wcm9wcy5wcmltYXJ5LFxuICAgICAgICAgICAgc2Vjb25kYXJ5OiB0aGlzLnByb3BzLnNlY29uZGFyeSxcbiAgICAgICAgICAgIGRpc2FibGVkOiB0aGlzLnByb3BzLmRpc2FiZWxkLFxuICAgICAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICAgICAgb25Ub3VjaFRhcDogdGhpcy5zaG93TWVudSxcbiAgICAgICAgICAgIGxhYmVsU3R5bGU6IF9leHRlbmRzKHt9LCB0aGlzLnByb3BzLmJ1dHRvbkxhYmVsU3R5bGUsIHsgcGFkZGluZ1JpZ2h0OiAxMCB9KSxcbiAgICAgICAgICAgIHN0eWxlOiBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcy5idXR0b25TdHlsZSwgeyBiYWNrZ3JvdW5kQ29sb3I6IHNob3dNZW51ID8gJ3JnYmEoMTUzLDE1MywxNTMsLjIpJyA6ICcnIH0pLFxuICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljayhlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBtZW51SXRlbXMgPSB0aGlzLnByb3BzLm1lbnVJdGVtcztcblxuICAgICAgICBpZiAobWVudUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMucmFpc2VkKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuUmFpc2VkQnV0dG9uLCBfZXh0ZW5kcyh7fSwgcHJvcHMsIHsgcmVmOiBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9idXR0b25ET00gPSBfcmVhY3REb20yWydkZWZhdWx0J10uZmluZERPTU5vZGUoYik7XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b24gPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5GbGF0QnV0dG9uLCBfZXh0ZW5kcyh7fSwgcHJvcHMsIHsgcmVmOiBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9idXR0b25ET00gPSBfcmVhY3REb20yWydkZWZhdWx0J10uZmluZERPTU5vZGUoYik7XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgIHsgaWQ6IHRoaXMucHJvcHMuaWQsIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5jbGFzc05hbWUgfSxcbiAgICAgICAgICAgIGJ1dHRvbixcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlBvcG92ZXIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdtZW51UG9wb3ZlcicsXG4gICAgICAgICAgICAgICAgICAgIG9wZW46IHNob3dNZW51LFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogYW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JPcmlnaW46IHsgaG9yaXpvbnRhbDogdGhpcy5wcm9wcy5kaXJlY3Rpb24gfHwgJ2xlZnQnLCB2ZXJ0aWNhbDogJ2JvdHRvbScgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6IHRoaXMucHJvcHMuZGlyZWN0aW9uIHx8ICdsZWZ0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzaG93TWVudTogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7IG1hcmdpblRvcDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VMYXllckZvckNsaWNrQXdheTogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF9VdGlsczJbJ2RlZmF1bHQnXS5pdGVtc1RvTWVudShtZW51SXRlbXMsIHRoaXMubWVudUNsaWNrZWQpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG59KTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gX01lbnVJdGVtc0NvbnN1bWVyMlsnZGVmYXVsdCddKEJ1dHRvbk1lbnUpO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9weWRpb01vZGVsQ29udGV4dE1lbnUgPSByZXF1aXJlKCdweWRpby9tb2RlbC9jb250ZXh0LW1lbnUnKTtcblxudmFyIF9weWRpb01vZGVsQ29udGV4dE1lbnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9Nb2RlbENvbnRleHRNZW51KTtcblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBfUG9wdXBNZW51ID0gcmVxdWlyZSgnLi9Qb3B1cE1lbnUnKTtcblxudmFyIF9Qb3B1cE1lbnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfUG9wdXBNZW51KTtcblxudmFyIF9yZXF1aXJlID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIENvbXBvbmVudCA9IF9yZXF1aXJlLkNvbXBvbmVudDtcblxudmFyIGRpbXMgPSB7XG4gICAgTUVOVV9JVEVNX0hFSUdIVDogMzIsIC8vNDggaWYgbm90IGRpc3BsYXk6Y29tcGFjdFxuICAgIE1FTlVfU0VQX0hFSUdIVDogMTYsXG4gICAgTUVOVV9WRVJUSUNBTF9QQURESU5HOiA4LFxuICAgIE1FTlVfV0lEVEg6IDI1MCxcbiAgICBPRkZTRVRfVkVSVElDQUw6IDgsXG4gICAgT0ZGU0VUX0hPUklaT05UQUw6IDhcbn07XG5cbnZhciBDb250ZXh0TWVudSA9IChmdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhDb250ZXh0TWVudSwgX0NvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBDb250ZXh0TWVudSgpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRleHRNZW51KTtcblxuICAgICAgICBfQ29tcG9uZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgQ29udGV4dE1lbnUucHJvdG90eXBlLm1vZGVsT3BlbiA9IGZ1bmN0aW9uIG1vZGVsT3Blbihub2RlKSB7XG4gICAgICAgIHZhciBwb3NpdGlvbiA9IF9weWRpb01vZGVsQ29udGV4dE1lbnUyWydkZWZhdWx0J10uZ2V0SW5zdGFuY2UoKS5nZXRQb3NpdGlvbigpO1xuICAgICAgICB2YXIgaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICB2YXIgZG0gPSBweWRpby5nZXRDb250ZXh0SG9sZGVyKCk7XG4gICAgICAgICAgICBpZiAoZG0uZ2V0U2VsZWN0ZWROb2RlcygpLmluZGV4T2Yobm9kZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuTWVudSgnc2VsZWN0aW9uQ29udGV4dCcsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHlkaW8ub2JzZXJ2ZU9uY2UoXCJhY3Rpb25zX3JlZnJlc2hlZFwiLCAoZnVuY3Rpb24gKGRhdGFNb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5NZW51KCdzZWxlY3Rpb25Db250ZXh0JywgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIGRtLnNldFNlbGVjdGVkTm9kZXMoW25vZGVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3Blbk1lbnUoJ2dlbmVyaWNDb250ZXh0JywgcG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIENvbnRleHRNZW51LnByb3RvdHlwZS5vcGVuTWVudSA9IGZ1bmN0aW9uIG9wZW5NZW51KGNvbnRleHQsIHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMuY29tcHV0ZU1lbnVJdGVtcyhjb250ZXh0KTtcbiAgICAgICAgdGhpcy5faXRlbXMgPSBpdGVtcztcbiAgICAgICAgdmFyIG1vYmlsZSA9IHRoaXMucHJvcHMucHlkaW8uVUkuTU9CSUxFX0VYVEVOU0lPTlM7XG4gICAgICAgIGlmICghbW9iaWxlKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuY29tcHV0ZVZpc2libGVQb3NpdGlvbihwb3NpdGlvbiwgaXRlbXMpO1xuICAgICAgICAgICAgdGhpcy5yZWZzWydtZW51J10uc2hvd01lbnUoe1xuICAgICAgICAgICAgICAgIHRvcDogcG9zaXRpb24ueSxcbiAgICAgICAgICAgICAgICBsZWZ0OiBwb3NpdGlvbi54XG4gICAgICAgICAgICB9LCBpdGVtcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlZnNbJ21lbnUnXS5zaG93TWVudSh7XG4gICAgICAgICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAyMDAsXG4gICAgICAgICAgICAgICAgekluZGV4OiAxMDAwMCxcbiAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJ1xuICAgICAgICAgICAgfSwgaXRlbXMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIENvbnRleHRNZW51LnByb3RvdHlwZS5jb21wdXRlTWVudUl0ZW1zID0gZnVuY3Rpb24gY29tcHV0ZU1lbnVJdGVtcyhjb250ZXh0KSB7XG4gICAgICAgIHZhciBhY3Rpb25zID0gdGhpcy5wcm9wcy5weWRpby5Db250cm9sbGVyLmdldENvbnRleHRBY3Rpb25zKGNvbnRleHQsIFsnaW5saW5lJywgJ2luZm9fcGFuZWwnLCAnaW5mb19wYW5lbF9zaGFyZSddKTtcbiAgICAgICAgcmV0dXJuIF9VdGlsczJbJ2RlZmF1bHQnXS5weWRpb0FjdGlvbnNUb0l0ZW1zKGFjdGlvbnMpO1xuICAgIH07XG5cbiAgICBDb250ZXh0TWVudS5wcm90b3R5cGUuY29tcHV0ZVZpc2libGVQb3NpdGlvbiA9IGZ1bmN0aW9uIGNvbXB1dGVWaXNpYmxlUG9zaXRpb24ocG9zaXRpb24sIGl0ZW1zKSB7XG4gICAgICAgIHZhciBtZW51SGVpZ2h0ID0gZGltcy5NRU5VX1ZFUlRJQ0FMX1BBRERJTkcgKiAyO1xuICAgICAgICBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0KSB7XG4gICAgICAgICAgICBpZiAoaXQuc2VwYXJhdG9yKSBtZW51SGVpZ2h0ICs9IGRpbXMuTUVOVV9TRVBfSEVJR0hUO2Vsc2UgbWVudUhlaWdodCArPSBkaW1zLk1FTlVfSVRFTV9IRUlHSFQ7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbWVudVdpZHRoID0gZGltcy5NRU5VX1dJRFRIO1xuICAgICAgICB2YXIgd2luZG93VyA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgd2luZG93LmlubmVyV2lkdGggfHwgMCk7XG4gICAgICAgIHZhciB3aW5kb3dIID0gTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0IHx8IDApO1xuICAgICAgICBpZiAocG9zaXRpb24ueCArIG1lbnVXaWR0aCA+IHdpbmRvd1cpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uLnggPSBNYXRoLm1heChwb3NpdGlvbi54IC0gbWVudVdpZHRoLCAxMCkgLSBkaW1zLk9GRlNFVF9IT1JJWk9OVEFMO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcG9zaXRpb24ueCArPSBkaW1zLk9GRlNFVF9IT1JJWk9OVEFMO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwb3NpdGlvbi55ICsgbWVudUhlaWdodCA+IHdpbmRvd0gpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uLnkgPSBNYXRoLm1heChwb3NpdGlvbi55IC0gbWVudUhlaWdodCwgMTApIC0gZGltcy5PRkZTRVRfVkVSVElDQUw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwb3NpdGlvbi55ICs9IGRpbXMuT0ZGU0VUX1ZFUlRJQ0FMO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICB9O1xuXG4gICAgQ29udGV4dE1lbnUucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuX21vZGVsT3BlbiA9IHRoaXMubW9kZWxPcGVuLmJpbmQodGhpcyk7XG4gICAgICAgIF9weWRpb01vZGVsQ29udGV4dE1lbnUyWydkZWZhdWx0J10uZ2V0SW5zdGFuY2UoKS5vYnNlcnZlKFwib3BlblwiLCB0aGlzLl9tb2RlbE9wZW4pO1xuICAgIH07XG5cbiAgICBDb250ZXh0TWVudS5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgX3B5ZGlvTW9kZWxDb250ZXh0TWVudTJbJ2RlZmF1bHQnXS5nZXRJbnN0YW5jZSgpLnN0b3BPYnNlcnZpbmcoXCJvcGVuXCIsIHRoaXMuX21vZGVsT3Blbik7XG4gICAgfTtcblxuICAgIENvbnRleHRNZW51LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBtb2JpbGUgPSB0aGlzLnByb3BzLnB5ZGlvLlVJLk1PQklMRV9FWFRFTlNJT05TO1xuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChfUG9wdXBNZW51MlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICByZWY6ICdtZW51JyxcbiAgICAgICAgICAgIG1lbnVJdGVtczogdGhpcy5faXRlbXMgfHwgW10sXG4gICAgICAgICAgICBvbk1lbnVDbG9zZWQ6IHRoaXMucHJvcHMub25NZW51Q2xvc2VkLFxuICAgICAgICAgICAgbWVudVByb3BzOiBtb2JpbGUgPyB7IHdpZHRoOiA2MDAsIGF1dG9XaWR0aDogZmFsc2UsIGRlc2t0b3A6IGZhbHNlIH0gOiB7fSxcbiAgICAgICAgICAgIHpEZXB0aDogbW9iaWxlID8gMiA6IDFcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb250ZXh0TWVudTtcbn0pKENvbXBvbmVudCk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENvbnRleHRNZW51O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIgPSByZXF1aXJlKCcuL01lbnVJdGVtc0NvbnN1bWVyJyk7XG5cbnZhciBfTWVudUl0ZW1zQ29uc3VtZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTWVudUl0ZW1zQ29uc3VtZXIpO1xuXG52YXIgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgX3JlcXVpcmUgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgSWNvbkJ1dHRvbiA9IF9yZXF1aXJlLkljb25CdXR0b247XG52YXIgUG9wb3ZlciA9IF9yZXF1aXJlLlBvcG92ZXI7XG5cbnZhciBJY29uQnV0dG9uTWVudSA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhJY29uQnV0dG9uTWVudSwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBJY29uQnV0dG9uTWVudShwcm9wcywgY29udGV4dCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWNvbkJ1dHRvbk1lbnUpO1xuXG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IHNob3dNZW51OiBmYWxzZSB9O1xuICAgIH1cblxuICAgIEljb25CdXR0b25NZW51LnByb3RvdHlwZS5zaG93TWVudSA9IGZ1bmN0aW9uIHNob3dNZW51KGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2hvd01lbnU6IHRydWUsXG4gICAgICAgICAgICBhbmNob3I6IGV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIEljb25CdXR0b25NZW51LnByb3RvdHlwZS5jbG9zZU1lbnUgPSBmdW5jdGlvbiBjbG9zZU1lbnUoZXZlbnQsIGluZGV4LCBtZW51SXRlbSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd01lbnU6IGZhbHNlIH0pO1xuICAgIH07XG5cbiAgICBJY29uQnV0dG9uTWVudS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgbWVudUl0ZW1zID0gX3Byb3BzLm1lbnVJdGVtcztcbiAgICAgICAgdmFyIGNsYXNzTmFtZSA9IF9wcm9wcy5jbGFzc05hbWU7XG4gICAgICAgIHZhciBidXR0b25UaXRsZSA9IF9wcm9wcy5idXR0b25UaXRsZTtcbiAgICAgICAgdmFyIGJ1dHRvbkNsYXNzTmFtZSA9IF9wcm9wcy5idXR0b25DbGFzc05hbWU7XG4gICAgICAgIHZhciBidXR0b25TdHlsZSA9IF9wcm9wcy5idXR0b25TdHlsZTtcbiAgICAgICAgdmFyIHBvcG92ZXJEaXJlY3Rpb24gPSBfcHJvcHMucG9wb3ZlckRpcmVjdGlvbjtcbiAgICAgICAgdmFyIHBvcG92ZXJUYXJnZXRQb3NpdGlvbiA9IF9wcm9wcy5wb3BvdmVyVGFyZ2V0UG9zaXRpb247XG4gICAgICAgIHZhciBtZW51UHJvcHMgPSBfcHJvcHMubWVudVByb3BzO1xuXG4gICAgICAgIGlmICghbWVudUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJ0b29sYmFycy1idXR0b24tbWVudSBcIiArIChjbGFzc05hbWUgPyBjbGFzc05hbWUgOiAnJykgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbkJ1dHRvbiwge1xuICAgICAgICAgICAgICAgIHJlZjogJ21lbnVCdXR0b24nLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IGJ1dHRvblRpdGxlLFxuICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU6IGJ1dHRvbkNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiB0aGlzLnNob3dNZW51LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgaWNvblN0eWxlOiBidXR0b25TdHlsZVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFBvcG92ZXIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcGVuOiB0aGlzLnN0YXRlLnNob3dNZW51LFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogdGhpcy5zdGF0ZS5hbmNob3IsXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvck9yaWdpbjogeyBob3Jpem9udGFsOiBwb3BvdmVyRGlyZWN0aW9uIHx8ICdyaWdodCcsIHZlcnRpY2FsOiBwb3BvdmVyVGFyZ2V0UG9zaXRpb24gfHwgJ2JvdHRvbScgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6IHBvcG92ZXJEaXJlY3Rpb24gfHwgJ3JpZ2h0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dNZW51OiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlTGF5ZXJGb3JDbGlja0F3YXk6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBfVXRpbHMyWydkZWZhdWx0J10uaXRlbXNUb01lbnUobWVudUl0ZW1zLCB0aGlzLmNsb3NlTWVudS5iaW5kKHRoaXMpLCBmYWxzZSwgbWVudVByb3BzIHx8IHVuZGVmaW5lZClcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEljb25CdXR0b25NZW51O1xufSkoUmVhY3QuQ29tcG9uZW50KTtcblxuSWNvbkJ1dHRvbk1lbnUucHJvcFR5cGVzID0ge1xuICAgIGJ1dHRvblRpdGxlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgYnV0dG9uQ2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgY2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBvcG92ZXJEaXJlY3Rpb246IFJlYWN0LlByb3BUeXBlcy5vbmVPZihbJ3JpZ2h0JywgJ2xlZnQnXSksXG4gICAgcG9wb3ZlclBvc2l0aW9uOiBSZWFjdC5Qcm9wVHlwZXMub25lT2YoWyd0b3AnLCAnYm90dG9tJ10pLFxuICAgIG1lbnVQcm9wczogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtZW51SXRlbXM6IFJlYWN0LlByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBfTWVudUl0ZW1zQ29uc3VtZXIyWydkZWZhdWx0J10oSWNvbkJ1dHRvbk1lbnUpO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBJY29uQnV0dG9uID0gX3JlcXVpcmUuSWNvbkJ1dHRvbjtcbnZhciBQb3BvdmVyID0gX3JlcXVpcmUuUG9wb3ZlcjtcblxudmFyIEljb25CdXR0b25Qb3BvdmVyID0gKGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKEljb25CdXR0b25Qb3BvdmVyLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIEljb25CdXR0b25Qb3BvdmVyKHByb3BzLCBjb250ZXh0KSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJY29uQnV0dG9uUG9wb3Zlcik7XG5cbiAgICAgICAgX1JlYWN0JENvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzLCBjb250ZXh0KTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgc2hvd1BvcG92ZXI6IGZhbHNlIH07XG4gICAgfVxuXG4gICAgSWNvbkJ1dHRvblBvcG92ZXIucHJvdG90eXBlLnNob3dQb3BvdmVyID0gZnVuY3Rpb24gc2hvd1BvcG92ZXIoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaG93UG9wb3ZlcjogdHJ1ZSxcbiAgICAgICAgICAgIGFuY2hvcjogZXZlbnQuY3VycmVudFRhcmdldFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgSWNvbkJ1dHRvblBvcG92ZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcInRvb2xiYXJzLWJ1dHRvbi1tZW51IFwiICsgKHRoaXMucHJvcHMuY2xhc3NOYW1lID8gdGhpcy5wcm9wcy5jbGFzc05hbWUgOiAnJykgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbkJ1dHRvbiwge1xuICAgICAgICAgICAgICAgIHJlZjogJ21lbnVCdXR0b24nLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IHRoaXMucHJvcHMuYnV0dG9uVGl0bGUsXG4gICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogdGhpcy5wcm9wcy5idXR0b25DbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogdGhpcy5zaG93UG9wb3Zlci5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgIGljb25TdHlsZTogdGhpcy5wcm9wcy5idXR0b25TdHlsZVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFBvcG92ZXIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcGVuOiB0aGlzLnN0YXRlLnNob3dQb3BvdmVyLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogdGhpcy5zdGF0ZS5hbmNob3IsXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvck9yaWdpbjogeyBob3Jpem9udGFsOiB0aGlzLnByb3BzLmRpcmVjdGlvbiB8fCAncmlnaHQnLCB2ZXJ0aWNhbDogJ2JvdHRvbScgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6IHRoaXMucHJvcHMuZGlyZWN0aW9uIHx8ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9LFxuICAgICAgICAgICAgICAgICAgICBvblJlcXVlc3RDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaG93UG9wb3ZlcjogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZUxheWVyRm9yQ2xpY2tBd2F5OiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5wb3BvdmVyQ29udGVudFxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gSWNvbkJ1dHRvblBvcG92ZXI7XG59KShSZWFjdC5Db21wb25lbnQpO1xuXG5JY29uQnV0dG9uUG9wb3Zlci5wcm9wVHlwZXMgPSB7XG4gICAgYnV0dG9uVGl0bGU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBidXR0b25DbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgZGlyZWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMub25lT2YoWydyaWdodCcsICdsZWZ0J10pLFxuICAgIHBvcG92ZXJDb250ZW50OiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWRcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEljb25CdXR0b25Qb3BvdmVyO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgQ29udHJvbGxlciA9IHJlcXVpcmUoJ3B5ZGlvL21vZGVsL2NvbnRyb2xsZXInKTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gZnVuY3Rpb24gKENvbXBvbmVudCkge1xuICAgIHZhciBXcmFwcGVkID0gKGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgICAgIF9pbmhlcml0cyhXcmFwcGVkLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAgICAgICBmdW5jdGlvbiBXcmFwcGVkKHByb3BzLCBjb250ZXh0KSB7XG4gICAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV3JhcHBlZCk7XG5cbiAgICAgICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgICAgIG1lbnVJdGVtczogdGhpcy5wcm9wcy5tZW51SXRlbXMgfHwgW11cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBXcmFwcGVkLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuY29udHJvbGxlciAmJiAhdGhpcy5wcm9wcy5tZW51SXRlbXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbnMgPSBfdGhpcy5wcm9wcy5jb250cm9sbGVyLmdldENvbnRleHRBY3Rpb25zKCdnZW5lcmljQ29udGV4dCcsIG51bGwsIF90aGlzLnByb3BzLnRvb2xiYXJzKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lbnVJdGVtcyA9IF9VdGlsczJbJ2RlZmF1bHQnXS5weWRpb0FjdGlvbnNUb0l0ZW1zKGFjdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IG1lbnVJdGVtczogbWVudUl0ZW1zIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuY29udHJvbGxlciA9PT0gdGhpcy5wcm9wcy5weWRpby5Db250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucHlkaW8ub2JzZXJ2ZShcImFjdGlvbnNfcmVmcmVzaGVkXCIsIHRoaXMuX29ic2VydmVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNvbnRyb2xsZXIub2JzZXJ2ZShcImFjdGlvbnNfcmVmcmVzaGVkXCIsIHRoaXMuX29ic2VydmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fb2JzZXJ2ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBXcmFwcGVkLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX29ic2VydmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuY29udHJvbGxlciA9PT0gdGhpcy5wcm9wcy5weWRpby5Db250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucHlkaW8uc3RvcE9ic2VydmluZyhcImFjdGlvbnNfcmVmcmVzaGVkXCIsIHRoaXMuX29ic2VydmVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmNvbnRyb2xsZXIuc3RvcE9ic2VydmluZyhcImFjdGlvbnNfcmVmcmVzaGVkXCIsIHRoaXMuX29ic2VydmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgV3JhcHBlZC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgICAgICBpZiAobmV4dFByb3BzLm1lbnVJdGVtcyAmJiBuZXh0UHJvcHMubWVudUl0ZW1zICE9PSB0aGlzLnByb3BzLm1lbnVJdGVtcykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBtZW51SXRlbXM6IG5leHRQcm9wcy5tZW51SXRlbXMgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgV3JhcHBlZC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywgeyBtZW51SXRlbXM6IHRoaXMuc3RhdGUubWVudUl0ZW1zIH0pKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gV3JhcHBlZDtcbiAgICB9KShSZWFjdC5Db21wb25lbnQpO1xuXG4gICAgV3JhcHBlZC5wcm9wVHlwZXMgPSB7XG4gICAgICAgIG1lbnVJdGVtczogUmVhY3QuUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICB0b29sYmFyczogUmVhY3QuUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBjb250cm9sbGVyOiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihDb250cm9sbGVyKSxcbiAgICAgICAgcHlkaW86IFJlYWN0LlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvKVxuICAgIH07XG5cbiAgICByZXR1cm4gV3JhcHBlZDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9VdGlscyA9IHJlcXVpcmUoJy4vVXRpbHMnKTtcblxudmFyIF9VdGlsczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9VdGlscyk7XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgUmVhY3RET00gPSByZXF1aXJlKCdyZWFjdC1kb20nKTtcblxudmFyIF9yZXF1aXJlID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIE1lbnUgPSBfcmVxdWlyZS5NZW51O1xudmFyIFBhcGVyID0gX3JlcXVpcmUuUGFwZXI7XG5leHBvcnRzWydkZWZhdWx0J10gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdQb3B1cE1lbnUnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIG1lbnVJdGVtczogUmVhY3QuUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG4gICAgICAgIG9uRXh0ZXJuYWxDbGlja0NoZWNrRWxlbWVudHM6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICBvbk1lbnVDbG9zZWQ6IFJlYWN0LlByb3BUeXBlcy5mdW5jXG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgICAgICByZXR1cm4geyBzaG93TWVudTogZmFsc2UsIG1lbnVJdGVtczogdGhpcy5wcm9wcy5tZW51SXRlbXMgfTtcbiAgICB9LFxuICAgIHNob3dNZW51OiBmdW5jdGlvbiBzaG93TWVudSgpIHtcbiAgICAgICAgdmFyIHN0eWxlID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGFyZ3VtZW50c1swXTtcbiAgICAgICAgdmFyIG1lbnVJdGVtcyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaG93TWVudTogdHJ1ZSxcbiAgICAgICAgICAgIHN0eWxlOiBzdHlsZSxcbiAgICAgICAgICAgIG1lbnVJdGVtczogbWVudUl0ZW1zID8gbWVudUl0ZW1zIDogdGhpcy5zdGF0ZS5tZW51SXRlbXNcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBoaWRlTWVudTogZnVuY3Rpb24gaGlkZU1lbnUoZXZlbnQpIHtcbiAgICAgICAgaWYgKCFldmVudCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dNZW51OiBmYWxzZSB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uTWVudUNsb3NlZCkgdGhpcy5wcm9wcy5vbk1lbnVDbG9zZWQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBGaXJlZm94IHRyaWdnZXIgYSBjbGljayBldmVudCB3aGVuIHlvdSBtb3VzZSB1cCBvbiBjb250ZXh0bWVudSBldmVudFxuICAgICAgICBpZiAodHlwZW9mIGV2ZW50ICE9PSAndW5kZWZpbmVkJyAmJiBldmVudC5idXR0b24gPT09IDIgJiYgZXZlbnQudHlwZSAhPT0gJ2NvbnRleHRtZW51Jykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBub2RlID0gUmVhY3RET00uZmluZERPTU5vZGUodGhpcy5yZWZzLm1lbnVDb250YWluZXIpO1xuICAgICAgICBpZiAobm9kZS5jb250YWlucyhldmVudC50YXJnZXQpIHx8IG5vZGUgPT09IGV2ZW50LnRhcmdldCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dNZW51OiBmYWxzZSB9KTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25NZW51Q2xvc2VkKSB0aGlzLnByb3BzLm9uTWVudUNsb3NlZCgpO1xuICAgIH0sXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLl9vYnNlcnZlciA9IHRoaXMuaGlkZU1lbnU7XG4gICAgfSxcbiAgICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb2JzZXJ2ZXIsIGZhbHNlKTtcbiAgICB9LFxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmIChuZXh0UHJvcHMubWVudUl0ZW1zKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbWVudUl0ZW1zOiBuZXh0UHJvcHMubWVudUl0ZW1zIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMsIG5leHRQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93TWVudSkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vYnNlcnZlciwgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vYnNlcnZlciwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG1lbnVDbGlja2VkOiBmdW5jdGlvbiBtZW51Q2xpY2tlZChldmVudCwgaW5kZXgsIG1lbnVJdGVtKSB7XG4gICAgICAgIHRoaXMuaGlkZU1lbnUoKTtcbiAgICB9LFxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuXG4gICAgICAgIHZhciBzdHlsZSA9IHRoaXMuc3RhdGUuc3R5bGUgfHwge307XG4gICAgICAgIHN0eWxlID0gX2V4dGVuZHMoe30sIHN0eWxlLCB7IHpJbmRleDogMTAwMCB9KTtcbiAgICAgICAgdmFyIG1lbnUgPSBfVXRpbHMyWydkZWZhdWx0J10uaXRlbXNUb01lbnUodGhpcy5zdGF0ZS5tZW51SXRlbXMsIHRoaXMubWVudUNsaWNrZWQsIGZhbHNlLCBfZXh0ZW5kcyh7IGRlc2t0b3A6IHRydWUsIGRpc3BsYXk6ICdyaWdodCcsIHdpZHRoOiAyNTAgfSwgdGhpcy5wcm9wcy5tZW51UHJvcHMpKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2hvd01lbnUpIHtcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFBhcGVyLFxuICAgICAgICAgICAgICAgIHsgekRlcHRoOiB0aGlzLnByb3BzLnpEZXB0aCB8fCAxLCByZWY6ICdtZW51Q29udGFpbmVyJywgY2xhc3NOYW1lOiAnbWVudS1wb3NpdGlvbmVyJywgc3R5bGU6IHN0eWxlIH0sXG4gICAgICAgICAgICAgICAgbWVudVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG59KTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX1V0aWxzID0gcmVxdWlyZSgnLi9VdGlscycpO1xuXG52YXIgX1V0aWxzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1V0aWxzKTtcblxudmFyIF9JY29uQnV0dG9uTWVudSA9IHJlcXVpcmUoJy4vSWNvbkJ1dHRvbk1lbnUnKTtcblxudmFyIF9JY29uQnV0dG9uTWVudTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9JY29uQnV0dG9uTWVudSk7XG5cbnZhciBfQnV0dG9uTWVudSA9IHJlcXVpcmUoJy4vQnV0dG9uTWVudScpO1xuXG52YXIgX0J1dHRvbk1lbnUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQnV0dG9uTWVudSk7XG5cbnZhciBfQnV0dG9uQ29tcG9zZWQgPSByZXF1aXJlKCcuL0J1dHRvbkNvbXBvc2VkJyk7XG5cbnZhciBfQnV0dG9uQ29tcG9zZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQnV0dG9uQ29tcG9zZWQpO1xuXG52YXIgX0ljb25CdXR0b25Qb3BvdmVyID0gcmVxdWlyZSgnLi9JY29uQnV0dG9uUG9wb3ZlcicpO1xuXG52YXIgX0ljb25CdXR0b25Qb3BvdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0ljb25CdXR0b25Qb3BvdmVyKTtcblxudmFyIF9tYXRlcmlhbFVpID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ1Rvb2xiYXInLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHRvb2xiYXJzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBncm91cE90aGVyTGlzdDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5hcnJheSxcbiAgICAgICAgcmVuZGVyaW5nVHlwZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGNvbnRyb2xsZXI6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihDb250cm9sbGVyKSxcbiAgICAgICAgdG9vbGJhclN0eWxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgYnV0dG9uU3R5bGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICBmYWJBY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBidXR0b25NZW51Tm9MYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sXG4gICAgfSxcblxuICAgIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTW91bnRlZCgpKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBncm91cHM6IHRoaXMucHJvcHMuY29udHJvbGxlci5nZXRUb29sYmFyc0FjdGlvbnModGhpcy5wcm9wcy50b29sYmFycywgdGhpcy5wcm9wcy5ncm91cE90aGVyTGlzdClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS5iaW5kKHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5jb250cm9sbGVyID09PSBweWRpby5Db250cm9sbGVyKSB7XG4gICAgICAgICAgICBweWRpby5vYnNlcnZlKFwiYWN0aW9uc19yZWZyZXNoZWRcIiwgdGhpcy5fb2JzZXJ2ZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5jb250cm9sbGVyLm9ic2VydmUoXCJhY3Rpb25zX3JlZnJlc2hlZFwiLCB0aGlzLl9vYnNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5jb250cm9sbGVyID09PSBweWRpby5Db250cm9sbGVyKSB7XG4gICAgICAgICAgICBweWRpby5zdG9wT2JzZXJ2aW5nKFwiYWN0aW9uc19yZWZyZXNoZWRcIiwgdGhpcy5fb2JzZXJ2ZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5jb250cm9sbGVyLnN0b3BPYnNlcnZpbmcoXCJhY3Rpb25zX3JlZnJlc2hlZFwiLCB0aGlzLl9vYnNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wczogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgICAgaWYgKG5leHRQcm9wcy50b29sYmFycyAhPT0gdGhpcy5wcm9wcy50b29sYmFycykge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgZ3JvdXBzOiB0aGlzLnByb3BzLmNvbnRyb2xsZXIuZ2V0VG9vbGJhcnNBY3Rpb25zKG5leHRQcm9wcy50b29sYmFycywgbmV4dFByb3BzLmdyb3VwT3RoZXJMaXN0KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBncm91cHM6IHRoaXMucHJvcHMuY29udHJvbGxlci5nZXRUb29sYmFyc0FjdGlvbnModGhpcy5wcm9wcy50b29sYmFycywgdGhpcy5wcm9wcy5ncm91cE90aGVyTGlzdClcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0RGVmYXVsdFByb3BzOiBmdW5jdGlvbiBnZXREZWZhdWx0UHJvcHMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiBnbG9iYWwucHlkaW8uQ29udHJvbGxlcixcbiAgICAgICAgICAgIHJlbmRlcmluZ1R5cGU6ICdidXR0b24nLFxuICAgICAgICAgICAgZ3JvdXBPdGhlckxpc3Q6IFtdXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgZ3JvdXBzID0gdGhpcy5zdGF0ZS5ncm91cHM7XG5cbiAgICAgICAgdmFyIGFjdGlvbnMgPSBbXTtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciB0b29sYmFycyA9IF9wcm9wcy50b29sYmFycztcbiAgICAgICAgdmFyIHJlbmRlcmluZ1R5cGUgPSBfcHJvcHMucmVuZGVyaW5nVHlwZTtcbiAgICAgICAgdmFyIGdyb3VwT3RoZXJMaXN0ID0gX3Byb3BzLmdyb3VwT3RoZXJMaXN0O1xuICAgICAgICB2YXIgYnV0dG9uU3R5bGUgPSBfcHJvcHMuYnV0dG9uU3R5bGU7XG4gICAgICAgIHZhciB0b29sdGlwUG9zaXRpb24gPSBfcHJvcHMudG9vbHRpcFBvc2l0aW9uO1xuICAgICAgICB2YXIgY29udHJvbGxlciA9IF9wcm9wcy5jb250cm9sbGVyO1xuICAgICAgICB2YXIgZmFiQWN0aW9uID0gX3Byb3BzLmZhYkFjdGlvbjtcbiAgICAgICAgdmFyIHRvb2xiYXJTdHlsZSA9IF9wcm9wcy50b29sYmFyU3R5bGU7XG4gICAgICAgIHZhciBidXR0b25NZW51Tm9MYWJlbCA9IF9wcm9wcy5idXR0b25NZW51Tm9MYWJlbDtcbiAgICAgICAgdmFyIGJ1dHRvbk1lbnVQb3BvdmVyRGlyZWN0aW9uID0gX3Byb3BzLmJ1dHRvbk1lbnVQb3BvdmVyRGlyZWN0aW9uO1xuICAgICAgICB2YXIgZmxhdEJ1dHRvblN0eWxlID0gX3Byb3BzLmZsYXRCdXR0b25TdHlsZTtcblxuICAgICAgICB2YXIgYWxsVG9vbGJhcnMgPSBbXS5jb25jYXQodG9vbGJhcnMpO1xuICAgICAgICBpZiAoZ3JvdXBPdGhlckxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICBhbGxUb29sYmFycyA9IGFsbFRvb2xiYXJzLmNvbmNhdChbJ01PUkVfQUNUSU9OJ10pO1xuICAgICAgICB9XG4gICAgICAgIGFsbFRvb2xiYXJzLm1hcChmdW5jdGlvbiAoYmFyTmFtZSkge1xuICAgICAgICAgICAgaWYgKCFncm91cHMuaGFzKGJhck5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ3JvdXBzLmdldChiYXJOYW1lKS5tYXAoZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uZGVueSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBtZW51SXRlbXMgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHBvcG92ZXJDb250ZW50ID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBtZW51VGl0bGUgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIG1lbnVJY29uID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBtZW51SXRlbXNVc2VNYXN0ZXJBY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbk5hbWUgPSBhY3Rpb24ub3B0aW9ucy5uYW1lO1xuXG4gICAgICAgICAgICAgICAgbWVudVRpdGxlID0gcHlkaW8uTWVzc2FnZUhhc2hbYWN0aW9uLm9wdGlvbnMudGV4dF9pZF0gfHwgYWN0aW9uLm9wdGlvbnMudGV4dDtcbiAgICAgICAgICAgICAgICBtZW51SWNvbiA9IGFjdGlvbi5vcHRpb25zLmljb25fY2xhc3M7XG5cbiAgICAgICAgICAgICAgICBpZiAoYmFyTmFtZSA9PT0gJ01PUkVfQUNUSU9OJykge1xuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Ykl0ZW1zID0gYWN0aW9uLnN1Yk1lbnVJdGVtcy5keW5hbWljSXRlbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ykl0ZW1zLm1hcChmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zZXBhcmF0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChvYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLmFjdGlvbklkICYmICFvYmouYWN0aW9uSWQuZGVueSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKG9iai5hY3Rpb25JZC5nZXRNZW51RGF0YSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVJdGVtcyA9IF9VdGlsczJbJ2RlZmF1bHQnXS5weWRpb0FjdGlvbnNUb0l0ZW1zKGl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVJY29uID0gXCJtZGkgbWRpLWRvdHMtdmVydGljYWxcIjtcbiAgICAgICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5zdWJNZW51SXRlbXMuc3RhdGljSXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudUl0ZW1zID0gX1V0aWxzMlsnZGVmYXVsdCddLnB5ZGlvQWN0aW9uc1RvSXRlbXMoYWN0aW9uLnN1Yk1lbnVJdGVtcy5zdGF0aWNJdGVtcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uc3ViTWVudUl0ZW1zLmR5bmFtaWNCdWlsZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnVJdGVtcyA9IF9VdGlsczJbJ2RlZmF1bHQnXS5weWRpb0FjdGlvbnNUb0l0ZW1zKGFjdGlvbi5zdWJNZW51SXRlbXMuZHluYW1pY0J1aWxkZXIoY29udHJvbGxlcikpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLnN1Yk1lbnVJdGVtcy5wb3BvdmVyQ29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICBwb3BvdmVyQ29udGVudCA9IGFjdGlvbi5zdWJNZW51SXRlbXMucG9wb3ZlckNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZW51SXRlbXMgJiYgYWN0aW9uLnN1Yk1lbnVJdGVtcy5tYXN0ZXJBY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXN0ZXJBY3Rpb24gPSBjb250cm9sbGVyLmdldEFjdGlvbkJ5TmFtZShhY3Rpb24uc3ViTWVudUl0ZW1zLm1hc3RlckFjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFzdGVyQWN0aW9uICYmICFtYXN0ZXJBY3Rpb24uZGVueSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVJdGVtc1VzZU1hc3RlckFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyQWN0aW9uLmFwcGx5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gJ2FjdGlvbi0nICsgYWN0aW9uLm9wdGlvbnMubmFtZTtcbiAgICAgICAgICAgICAgICBpZiAocmVuZGVyaW5nVHlwZSA9PT0gJ2J1dHRvbi1pY29uJykge1xuICAgICAgICAgICAgICAgICAgICBtZW51VGl0bGUgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAnYnV0dG9uLWljb24nIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiBcImJ1dHRvbi1pY29uLWljb24gXCIgKyBtZW51SWNvbiB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2J1dHRvbi1pY29uLWxhYmVsJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVUaXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVudUl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZW5kZXJpbmdUeXBlID09PSAnYnV0dG9uJyB8fCByZW5kZXJpbmdUeXBlID09PSAnYnV0dG9uLWljb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVudUl0ZW1zVXNlTWFzdGVyQWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9CdXR0b25Db21wb3NlZDJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblRpdGxlOiBtZW51VGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVJdGVtczogbWVudUl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXN0ZXJBY3Rpb246IG1lbnVJdGVtc1VzZU1hc3RlckFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uTGFiZWxTdHlsZTogYnV0dG9uU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogYnV0dG9uTWVudVBvcG92ZXJEaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfQnV0dG9uTWVudTJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblRpdGxlOiBidXR0b25NZW51Tm9MYWJlbCA/ICcnIDogbWVudVRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51SXRlbXM6IG1lbnVJdGVtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uTGFiZWxTdHlsZTogYnV0dG9uU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogYnV0dG9uTWVudVBvcG92ZXJEaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX0ljb25CdXR0b25NZW51MlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBhY3Rpb25OYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25NZW51Q2xpY2tlZDogZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucGF5bG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ2xhc3NOYW1lOiBtZW51SWNvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25UaXRsZTogbWVudVRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVJdGVtczogbWVudUl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlOiBidXR0b25TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3BvdmVyRGlyZWN0aW9uOiBidXR0b25NZW51UG9wb3ZlckRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3BvdmVyQ29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX0ljb25CdXR0b25Qb3BvdmVyMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ2xhc3NOYW1lOiBtZW51SWNvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblRpdGxlOiBtZW51VGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25TdHlsZTogYnV0dG9uU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3BvdmVyQ29udGVudDogcG9wb3ZlckNvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGljayA9IGZ1bmN0aW9uIGNsaWNrKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLmFwcGx5KCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWJBY3Rpb24gJiYgZmFiQWN0aW9uID09PSBhY3Rpb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRmxvYXRpbmdBY3Rpb25CdXR0b24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogY2xpY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogbWVudUljb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluaTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRvb2xiYXJTdHlsZS5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgcG9zaXRpb246ICdhYnNvbHV0ZScsIHRvcDogLTIwLCBsZWZ0OiAxMCB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVuZGVyaW5nVHlwZSA9PT0gJ2J1dHRvbi1pY29uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFJlYWN0TVVJLkZsYXRCdXR0b24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGFjdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiBjbGljayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbWVudVRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsU3R5bGU6IGJ1dHRvblN0eWxlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVuZGVyaW5nVHlwZSA9PT0gJ2J1dHRvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5GbGF0QnV0dG9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBhY3Rpb25OYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogY2xpY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IG1lbnVUaXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFN0eWxlOiBidXR0b25TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogZmxhdEJ1dHRvblN0eWxlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuSWNvbkJ1dHRvbiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogYWN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBtZW51SWNvbiArICcgJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25TdHlsZTogYnV0dG9uU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogY2xpY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogbWVudVRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXBQb3NpdGlvbjogdG9vbHRpcFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBjTmFtZSA9IHRoaXMucHJvcHMuY2xhc3NOYW1lID8gdGhpcy5wcm9wcy5jbGFzc05hbWUgOiAnJztcbiAgICAgICAgY05hbWUgKz0gJyAnICsgJ3Rvb2xiYXInO1xuICAgICAgICBpZiAoIWFjdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjTmFtZSArPSAnIGVtcHR5LXRvb2xiYXInO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdHlsZSA9IF9leHRlbmRzKHt9LCB0b29sYmFyU3R5bGUpO1xuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBjTmFtZSwgc3R5bGU6IHN0eWxlLCBpZDogdGhpcy5wcm9wcy5pZCB9LFxuICAgICAgICAgICAgYWN0aW9uc1xuICAgICAgICApO1xuICAgIH1cblxufSk7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG52YXIgX3JlcXVpcmUgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgRGl2aWRlciA9IF9yZXF1aXJlLkRpdmlkZXI7XG52YXIgTWVudSA9IF9yZXF1aXJlLk1lbnU7XG52YXIgTWVudUl0ZW0gPSBfcmVxdWlyZS5NZW51SXRlbTtcbnZhciBGb250SWNvbiA9IF9yZXF1aXJlLkZvbnRJY29uO1xuXG5mdW5jdGlvbiBweWRpb0FjdGlvbnNUb0l0ZW1zKCkge1xuICAgIHZhciBhY3Rpb25zID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gW10gOiBhcmd1bWVudHNbMF07XG5cbiAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICB2YXIgbGFzdElzU2VwYXJhdG9yID0gZmFsc2U7XG4gICAgYWN0aW9ucy5tYXAoKGZ1bmN0aW9uIChhY3Rpb24sIGluZGV4KSB7XG4gICAgICAgIGlmIChhY3Rpb24uc2VwYXJhdG9yKSB7XG4gICAgICAgICAgICBpZiAobGFzdElzU2VwYXJhdG9yKSByZXR1cm47XG4gICAgICAgICAgICBpdGVtcy5wdXNoKGFjdGlvbik7XG4gICAgICAgICAgICBsYXN0SXNTZXBhcmF0b3IgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxhc3RJc1NlcGFyYXRvciA9IGZhbHNlO1xuICAgICAgICB2YXIgbGFiZWwgPSBhY3Rpb24ucmF3X25hbWUgPyBhY3Rpb24ucmF3X25hbWUgOiBhY3Rpb24ubmFtZTtcbiAgICAgICAgdmFyIGljb25DbGFzcyA9IGFjdGlvbi5pY29uX2NsYXNzO1xuICAgICAgICB2YXIgcGF5bG9hZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGFjdGlvbi5zdWJNZW51KSB7XG4gICAgICAgICAgICB2YXIgc3ViSXRlbXMgPSBhY3Rpb24uc3ViTWVudUJlZm9yZVNob3cgPyBweWRpb0FjdGlvbnNUb0l0ZW1zKGFjdGlvbi5zdWJNZW51QmVmb3JlU2hvdygpKSA6IGFjdGlvbi5zdWJNZW51O1xuICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgdGV4dDogbGFiZWwsXG4gICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZTogaWNvbkNsYXNzLFxuICAgICAgICAgICAgICAgIHN1Ykl0ZW1zOiBzdWJJdGVtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBsYWJlbCxcbiAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBpY29uQ2xhc3MsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYWN0aW9uLmNhbGxiYWNrXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pLmJpbmQodGhpcykpO1xuICAgIGlmIChsYXN0SXNTZXBhcmF0b3IpIHtcbiAgICAgICAgaXRlbXMgPSBpdGVtcy5zbGljZSgwLCBpdGVtcy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgaWYgKGl0ZW1zLmxlbmd0aCAmJiBpdGVtc1swXSAmJiBpdGVtc1swXS5zZXBhcmF0b3IpIHtcbiAgICAgICAgaXRlbXMuc2hpZnQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1zO1xufVxuXG5mdW5jdGlvbiBpdGVtc1RvTWVudShpdGVtcywgY2xvc2VNZW51Q2FsbGJhY2spIHtcbiAgICB2YXIgc3ViSXRlbXNPbmx5ID0gYXJndW1lbnRzLmxlbmd0aCA8PSAyIHx8IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMl07XG4gICAgdmFyIG1lbnVQcm9wcyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMyB8fCBhcmd1bWVudHNbM10gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzNdO1xuXG4gICAgbWVudVByb3BzID0gX2V4dGVuZHMoe1xuICAgICAgICBkaXNwbGF5OiAnbm9ybWFsJyxcbiAgICAgICAgd2lkdGg6IDIxNixcbiAgICAgICAgZGVza3RvcDogdHJ1ZSxcbiAgICAgICAgYXV0b1dpZHRoOiBmYWxzZVxuICAgIH0sIG1lbnVQcm9wcyk7XG5cbiAgICB2YXIgbWVudUl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xuXG4gICAgICAgIGlmIChpdGVtLnNlcGFyYXRvcikgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRGl2aWRlciwgeyBrZXk6IFwiZGl2aWRlclwiICsgaW5kZXggfSk7XG5cbiAgICAgICAgdmFyIHN1Ykl0ZW1zID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGF5bG9hZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGl0ZW0uc3ViSXRlbXMpIHtcbiAgICAgICAgICAgIHN1Ykl0ZW1zID0gaXRlbXNUb01lbnUoaXRlbS5zdWJJdGVtcywgY2xvc2VNZW51Q2FsbGJhY2ssIHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0ucGF5bG9hZCkge1xuICAgICAgICAgICAgcGF5bG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpdGVtLnBheWxvYWQoKTtcbiAgICAgICAgICAgICAgICBjbG9zZU1lbnVDYWxsYmFjaygpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsZWZ0SWNvbiA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHJpZ2h0SWNvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIGljb25DbGFzc05hbWUgPSBpdGVtLmljb25DbGFzc05hbWU7dmFyIGluc2V0ID0gZmFsc2U7XG4gICAgICAgIGlmIChpY29uQ2xhc3NOYW1lID09PSAnX19JTlNFVF9fJykge1xuICAgICAgICAgICAgaWNvbkNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgaW5zZXQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1lbnVQcm9wcy5kaXNwbGF5ID09PSAnbm9ybWFsJykge1xuICAgICAgICAgICAgbGVmdEljb24gPSBpY29uQ2xhc3NOYW1lID8gUmVhY3QuY3JlYXRlRWxlbWVudChGb250SWNvbiwgeyBjbGFzc05hbWU6IGl0ZW0uaWNvbkNsYXNzTmFtZSArICcgbWVudS1pY29ucycsIHN0eWxlOiB7IGZvbnRTaXplOiAxNiwgcGFkZGluZzogNSB9IH0pIDogbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChtZW51UHJvcHMuZGlzcGxheSA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgcmlnaHRJY29uID0gaWNvbkNsYXNzTmFtZSA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoRm9udEljb24sIHsgY2xhc3NOYW1lOiBpdGVtLmljb25DbGFzc05hbWUgKyAnIG1lbnUtaWNvbnMnLCBzdHlsZTogeyBmb250U2l6ZTogMTYsIHBhZGRpbmc6IDUgfSB9KSA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmlnaHRJY29uID0gc3ViSXRlbXMgJiYgc3ViSXRlbXMubGVuZ3RoID8gUmVhY3QuY3JlYXRlRWxlbWVudChGb250SWNvbiwgeyBjbGFzc05hbWU6ICdtZGkgbWRpLW1lbnUtcmlnaHQgbWVudS1pY29ucycgfSkgOiByaWdodEljb247XG5cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTWVudUl0ZW0sIHtcbiAgICAgICAgICAgIGtleTogaXRlbS50ZXh0LFxuICAgICAgICAgICAgcHJpbWFyeVRleHQ6IGl0ZW0udGV4dCxcbiAgICAgICAgICAgIGluc2V0Q2hpbGRyZW46IGluc2V0LFxuICAgICAgICAgICAgbGVmdEljb246IGxlZnRJY29uLFxuICAgICAgICAgICAgcmlnaHRJY29uOiByaWdodEljb24sXG4gICAgICAgICAgICBvblRvdWNoVGFwOiBwYXlsb2FkLFxuICAgICAgICAgICAgbWVudUl0ZW1zOiBzdWJJdGVtc1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChzdWJJdGVtc09ubHkpIHtcbiAgICAgICAgcmV0dXJuIG1lbnVJdGVtcztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIE1lbnUsXG4gICAgICAgICAgICBtZW51UHJvcHMsXG4gICAgICAgICAgICBtZW51SXRlbXNcbiAgICAgICAgKTtcbiAgICB9XG59XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IHsgcHlkaW9BY3Rpb25zVG9JdGVtczogcHlkaW9BY3Rpb25zVG9JdGVtcywgaXRlbXNUb01lbnU6IGl0ZW1zVG9NZW51IH07XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE4IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfbWF0ZXJpYWxVaVN0eWxlcyA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpL3N0eWxlcycpO1xuXG52YXIgX3B5ZGlvSHR0cFBvbGljaWVzID0gcmVxdWlyZSgncHlkaW8vaHR0cC9wb2xpY2llcycpO1xuXG52YXIgX3B5ZGlvSHR0cFBvbGljaWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvSHR0cFBvbGljaWVzKTtcblxudmFyIF9weWRpb0h0dHBVc2Vyc0FwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvdXNlcnMtYXBpJyk7XG5cbnZhciBfcHlkaW9IdHRwUmVzdEFwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvcmVzdC1hcGknKTtcblxudmFyIF9weWRpbzIgPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvMik7XG5cbnZhciBfcHlkaW9IdHRwQXBpID0gcmVxdWlyZSgncHlkaW8vaHR0cC9hcGknKTtcblxudmFyIF9weWRpb0h0dHBBcGkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9IdHRwQXBpKTtcblxudmFyIF91c2Vyc1VzZXJzQ29tcGxldGVyID0gcmVxdWlyZSgnLi4vdXNlcnMvVXNlcnNDb21wbGV0ZXInKTtcblxudmFyIF91c2Vyc1VzZXJzQ29tcGxldGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3VzZXJzVXNlcnNDb21wbGV0ZXIpO1xuXG52YXIgUmVzb3VyY2VQb2xpY2llc1BhbmVsID0gKGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKFJlc291cmNlUG9saWNpZXNQYW5lbCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBSZXNvdXJjZVBvbGljaWVzUGFuZWwocHJvcHMpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlc291cmNlUG9saWNpZXNQYW5lbCk7XG5cbiAgICAgICAgaWYgKCFwcm9wcy5zdWJqZWN0c0Rpc2FibGVkKSB7XG4gICAgICAgICAgICBwcm9wcy5zdWJqZWN0c0Rpc2FibGVkID0geyAnUkVBRCc6IHt9LCAnV1JJVEUnOiB7fSB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9wcy5jZWxsQWNscykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocHJvcHMuY2VsbEFjbHMpLm1hcChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgICAgIGlmIChwcm9wcy5jZWxsQWNsc1trXS5Sb2xlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuc3ViamVjdHNEaXNhYmxlZFsnUkVBRCddW1wicm9sZTpcIiArIHByb3BzLmNlbGxBY2xzW2tdLlJvbGVJZF0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgcG9saWNpZXM6IFtdLFxuICAgICAgICAgICAgZGlmZlBvbGljaWVzOiB7IGFkZDoge30sIHJlbW92ZToge30gfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIFJlc291cmNlUG9saWNpZXNQYW5lbC5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgIHRoaXMucmVsb2FkKCk7XG4gICAgfTtcblxuICAgIFJlc291cmNlUG9saWNpZXNQYW5lbC5wcm90b3R5cGUucmVsb2FkID0gZnVuY3Rpb24gcmVsb2FkKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgcmVzb3VyY2VUeXBlID0gX3Byb3BzLnJlc291cmNlVHlwZTtcbiAgICAgICAgdmFyIHJlc291cmNlSWQgPSBfcHJvcHMucmVzb3VyY2VJZDtcbiAgICAgICAgdmFyIF9weWRpbyA9IHB5ZGlvO1xuICAgICAgICB2YXIgdXNlciA9IF9weWRpby51c2VyO1xuXG4gICAgICAgIHZhciBwcm9tcyA9IFtfcHlkaW9IdHRwUG9saWNpZXMyWydkZWZhdWx0J10ubG9hZFBvbGljaWVzKHJlc291cmNlVHlwZSwgcmVzb3VyY2VJZCksIHVzZXIuZ2V0SWRtVXNlcigpXTtcbiAgICAgICAgaWYgKHJlc291cmNlVHlwZSAhPT0gJ3RlYW0nKSB7XG4gICAgICAgICAgICBwcm9tcy5wdXNoKF9weWRpb0h0dHBBcGkyWydkZWZhdWx0J10uZ2V0UmVzdENsaWVudCgpLmdldElkbUFwaSgpLmxpc3RUZWFtcygpKTtcbiAgICAgICAgfVxuICAgICAgICBQcm9taXNlLmFsbChwcm9tcykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICB2YXIgcG9saWNpZXMgPSByZXN1bHRbMF07XG4gICAgICAgICAgICB2YXIgcmVzb3VyY2VVdWlkID0gcG9saWNpZXNbMF0uUmVzb3VyY2U7XG4gICAgICAgICAgICB2YXIgaWRtVXNlciA9IHJlc3VsdFsxXTtcbiAgICAgICAgICAgIHZhciB0ZWFtcyA9IFtdO1xuICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZSAhPT0gJ3RlYW0nICYmIHJlc3VsdFsyXSkge1xuICAgICAgICAgICAgICAgIHRlYW1zID0gcmVzdWx0WzJdLlRlYW1zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHBvbGljaWVzOiBwb2xpY2llcyxcbiAgICAgICAgICAgICAgICBpZG1Vc2VyOiBpZG1Vc2VyLFxuICAgICAgICAgICAgICAgIHVzZXJUZWFtczogdGVhbXMsXG4gICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VVdWlkOiByZXNvdXJjZVV1aWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UsIGxvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgUmVzb3VyY2VQb2xpY2llc1BhbmVsLnByb3RvdHlwZS5yZXZlcnQgPSBmdW5jdGlvbiByZXZlcnQoKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBkaXJ0eVBvbGljaWVzOiBudWxsLCBkaWZmUG9saWNpZXM6IHsgYWRkOiB7fSwgcmVtb3ZlOiB7fSB9IH0pO1xuICAgIH07XG5cbiAgICBSZXNvdXJjZVBvbGljaWVzUGFuZWwucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiBzYXZlKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgX3N0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdmFyIGRpcnR5UG9saWNpZXMgPSBfc3RhdGUuZGlydHlQb2xpY2llcztcbiAgICAgICAgdmFyIGRpZmZQb2xpY2llcyA9IF9zdGF0ZS5kaWZmUG9saWNpZXM7XG4gICAgICAgIHZhciBfcHJvcHMyID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHJlc291cmNlVHlwZSA9IF9wcm9wczIucmVzb3VyY2VUeXBlO1xuICAgICAgICB2YXIgcmVzb3VyY2VJZCA9IF9wcm9wczIucmVzb3VyY2VJZDtcbiAgICAgICAgdmFyIG9uU2F2ZVBvbGljaWVzID0gX3Byb3BzMi5vblNhdmVQb2xpY2llcztcblxuICAgICAgICBfcHlkaW9IdHRwUG9saWNpZXMyWydkZWZhdWx0J10uc2F2ZVBvbGljaWVzKHJlc291cmNlVHlwZSwgcmVzb3VyY2VJZCwgZGlydHlQb2xpY2llcykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBwb2xpY2llczogcmVzdWx0LCBkaXJ0eVBvbGljaWVzOiBudWxsLCBkaWZmUG9saWNpZXM6IHsgYWRkOiB7fSwgcmVtb3ZlOiB7fSB9IH0pO1xuICAgICAgICAgICAgaWYgKG9uU2F2ZVBvbGljaWVzKSB7XG4gICAgICAgICAgICAgICAgb25TYXZlUG9saWNpZXMoZGlmZlBvbGljaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgZXJyb3I6IHJlYXNvbi5tZXNzYWdlIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhkaXJ0eVBvbGljaWVzLCBkaWZmUG9saWNpZXMpO1xuICAgIH07XG5cbiAgICBSZXNvdXJjZVBvbGljaWVzUGFuZWwucHJvdG90eXBlLnJlbW92ZVBvbGljeSA9IGZ1bmN0aW9uIHJlbW92ZVBvbGljeShhY3Rpb24sIHN1YmplY3QpIHtcbiAgICAgICAgdmFyIF9zdGF0ZTIgPSB0aGlzLnN0YXRlO1xuICAgICAgICB2YXIgcG9saWNpZXMgPSBfc3RhdGUyLnBvbGljaWVzO1xuICAgICAgICB2YXIgZGlydHlQb2xpY2llcyA9IF9zdGF0ZTIuZGlydHlQb2xpY2llcztcbiAgICAgICAgdmFyIGRpZmZQb2xpY2llcyA9IF9zdGF0ZTIuZGlmZlBvbGljaWVzO1xuXG4gICAgICAgIGlmIChkaXJ0eVBvbGljaWVzKSB7XG4gICAgICAgICAgICBwb2xpY2llcyA9IGRpcnR5UG9saWNpZXM7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5ld1BvbGljaWVzID0gW107XG4gICAgICAgIHBvbGljaWVzLm1hcChmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgaWYgKHAuQWN0aW9uICE9PSBhY3Rpb24gfHwgcC5TdWJqZWN0ICE9PSBzdWJqZWN0KSB7XG4gICAgICAgICAgICAgICAgbmV3UG9saWNpZXMucHVzaChwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRpZmZQb2xpY2llcy5yZW1vdmVbYWN0aW9uICsgJy8vLycgKyBzdWJqZWN0XSA9IHRydWU7XG4gICAgICAgIGlmIChkaWZmUG9saWNpZXMuYWRkW2FjdGlvbiArICcvLy8nICsgc3ViamVjdF0pIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkaWZmUG9saWNpZXMuYWRkW2FjdGlvbiArICcvLy8nICsgc3ViamVjdF07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRpcnR5UG9saWNpZXM6IG5ld1BvbGljaWVzLCBkaWZmUG9saWNpZXM6IGRpZmZQb2xpY2llcyB9KTtcbiAgICB9O1xuXG4gICAgUmVzb3VyY2VQb2xpY2llc1BhbmVsLnByb3RvdHlwZS5hZGRQb2xpY3kgPSBmdW5jdGlvbiBhZGRQb2xpY3koYWN0aW9uLCBzdWJqZWN0KSB7XG4gICAgICAgIHZhciBpc1BpY2tlZFVzZXIgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1syXTtcbiAgICAgICAgdmFyIF9zdGF0ZTMgPSB0aGlzLnN0YXRlO1xuICAgICAgICB2YXIgcG9saWNpZXMgPSBfc3RhdGUzLnBvbGljaWVzO1xuICAgICAgICB2YXIgZGlydHlQb2xpY2llcyA9IF9zdGF0ZTMuZGlydHlQb2xpY2llcztcbiAgICAgICAgdmFyIHJlc291cmNlVXVpZCA9IF9zdGF0ZTMucmVzb3VyY2VVdWlkO1xuICAgICAgICB2YXIgZGlmZlBvbGljaWVzID0gX3N0YXRlMy5kaWZmUG9saWNpZXM7XG5cbiAgICAgICAgdmFyIG5ld1BvbGljaWVzID0gZGlydHlQb2xpY2llcyA/IFtdLmNvbmNhdChkaXJ0eVBvbGljaWVzKSA6IFtdLmNvbmNhdChwb2xpY2llcyk7XG4gICAgICAgIHZhciBuZXdQb2wgPSBuZXcgX3B5ZGlvSHR0cFJlc3RBcGkuU2VydmljZVJlc291cmNlUG9saWN5KCk7XG4gICAgICAgIG5ld1BvbC5SZXNvdXJjZSA9IHJlc291cmNlVXVpZDtcbiAgICAgICAgbmV3UG9sLkVmZmVjdCA9ICdhbGxvdyc7XG4gICAgICAgIG5ld1BvbC5TdWJqZWN0ID0gc3ViamVjdDtcbiAgICAgICAgbmV3UG9sLkFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgbmV3UG9saWNpZXMucHVzaChuZXdQb2wpO1xuXG4gICAgICAgIGRpZmZQb2xpY2llcy5hZGRbYWN0aW9uICsgJy8vLycgKyBzdWJqZWN0XSA9IHRydWU7XG4gICAgICAgIGlmIChkaWZmUG9saWNpZXMucmVtb3ZlW2FjdGlvbiArICcvLy8nICsgc3ViamVjdF0pIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkaWZmUG9saWNpZXMucmVtb3ZlW2FjdGlvbiArICcvLy8nICsgc3ViamVjdF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUGlja2VkVXNlcikge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRpcnR5UG9saWNpZXM6IG5ld1BvbGljaWVzLCBkaWZmUG9saWNpZXM6IGRpZmZQb2xpY2llcywgcGlja2VkVXNlcjogbnVsbCwgcGlja2VkTGFiZWw6IG51bGwgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZGlydHlQb2xpY2llczogbmV3UG9saWNpZXMsIGRpZmZQb2xpY2llczogZGlmZlBvbGljaWVzIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJTdWJqZWN0c1xuICAgICAqIEBwYXJhbSBwb2xpY2llc1xuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAgICovXG5cbiAgICBSZXNvdXJjZVBvbGljaWVzUGFuZWwucHJvdG90eXBlLmhhc09uZVdyaXRlID0gZnVuY3Rpb24gaGFzT25lV3JpdGUodXNlclN1YmplY3RzLCBwb2xpY2llcykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVzZXJTdWJqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwb2xpY2llcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChwb2xpY2llc1tqXS5TdWJqZWN0ID09PSB1c2VyU3ViamVjdHNbaV0gJiYgcG9saWNpZXNbal0uQWN0aW9uID09PSAnV1JJVEUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGlkbVVzZXJcbiAgICAgKiBAcGFyYW0gcG9saWNpZXNcbiAgICAgKiBAcmV0dXJuIHt7Z3JvdXBCbG9ja3M6IEFycmF5LCBoYXNXcml0ZTogYm9vbGVhbn19XG4gICAgICovXG5cbiAgICBSZXNvdXJjZVBvbGljaWVzUGFuZWwucHJvdG90eXBlLmxpc3RVc2VyUm9sZXMgPSBmdW5jdGlvbiBsaXN0VXNlclJvbGVzKGlkbVVzZXIsIHBvbGljaWVzKSB7XG4gICAgICAgIHZhciBjcnRVc2VyU3ViamVjdCA9ICd1c2VyOicgKyBpZG1Vc2VyLkxvZ2luO1xuICAgICAgICB2YXIgdmFsdWVzID0ge307XG4gICAgICAgIGlkbVVzZXIuUm9sZXMubWFwKGZ1bmN0aW9uIChyb2xlKSB7XG4gICAgICAgICAgICBpZiAoIXJvbGUuR3JvdXBSb2xlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWVzWydyb2xlOicgKyByb2xlLlV1aWRdID0gcm9sZS5MYWJlbDtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhbHVlc1tjcnRVc2VyU3ViamVjdF0gPSAnWW91JztcbiAgICAgICAgdmFyIGhhc1dyaXRlID0gdGhpcy5oYXNPbmVXcml0ZShPYmplY3Qua2V5cyh2YWx1ZXMpLCBwb2xpY2llcyk7XG4gICAgICAgIC8vIEFkZCBvdGhlciBzdWJqZWN0c1xuICAgICAgICB2YWx1ZXMgPSBfZXh0ZW5kcyh7fSwgdGhpcy5saXN0T3RoZXJVc2Vyc1N1YmplY3RzKHBvbGljaWVzLCBjcnRVc2VyU3ViamVjdCksIHZhbHVlcyk7XG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModmFsdWVzKTtcbiAgICAgICAgLy8gQnVpbGQgTGluZXNcbiAgICAgICAgdmFyIGdyb3VwQmxvY2tzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSBrZXlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICB2YXIgbmV3S2V5ID0ga2V5c1tpXTtcbiAgICAgICAgICAgIHZhciBuZXdWYWwgPSB2YWx1ZXNbbmV3S2V5XTtcbiAgICAgICAgICAgIGdyb3VwQmxvY2tzLnB1c2godGhpcy5yZW5kZXJMaW5lKG5ld0tleSwgbmV3VmFsLCBwb2xpY2llcywgIWhhc1dyaXRlIHx8IG5ld0tleSA9PT0gY3J0VXNlclN1YmplY3QpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBncm91cEJsb2NrczogZ3JvdXBCbG9ja3MsIGhhc1dyaXRlOiBoYXNXcml0ZSB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyVGVhbXNcbiAgICAgKiBAcGFyYW0gcG9saWNpZXNcbiAgICAgKiBAcGFyYW0gZGlzYWJsZWRcbiAgICAgKiBAcmV0dXJuIHtYTUx9W11cbiAgICAgKi9cblxuICAgIFJlc291cmNlUG9saWNpZXNQYW5lbC5wcm90b3R5cGUubGlzdFVzZXJUZWFtcyA9IGZ1bmN0aW9uIGxpc3RVc2VyVGVhbXModXNlclRlYW1zLCBwb2xpY2llcywgZGlzYWJsZWQpIHtcbiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIHVzZXJUZWFtcy5tYXAoZnVuY3Rpb24gKHJvbGUpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpczMucmVuZGVyTGluZSgncm9sZTonICsgcm9sZS5VdWlkLCByb2xlLkxhYmVsLCBwb2xpY2llcywgZGlzYWJsZWQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgUmVzb3VyY2VQb2xpY2llc1BhbmVsLnByb3RvdHlwZS5saXN0T3RoZXJVc2Vyc1N1YmplY3RzID0gZnVuY3Rpb24gbGlzdE90aGVyVXNlcnNTdWJqZWN0cyhwb2xpY2llcywgY3VycmVudFVzZXJTdWJqZWN0KSB7XG4gICAgICAgIHZhciBfcHJvcHMzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHJlc291cmNlSWQgPSBfcHJvcHMzLnJlc291cmNlSWQ7XG4gICAgICAgIHZhciBjZWxsQWNscyA9IF9wcm9wczMuY2VsbEFjbHM7XG5cbiAgICAgICAgdmFyIHN1YnMgPSB7fTtcbiAgICAgICAgcG9saWNpZXMubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICBpZiAocC5TdWJqZWN0LmluZGV4T2YoJ3VzZXI6JykgPT09IDAgJiYgcC5TdWJqZWN0ICE9PSBjdXJyZW50VXNlclN1YmplY3QgJiYgcC5TdWJqZWN0ICE9PSAndXNlcjonICsgcmVzb3VyY2VJZCkge1xuICAgICAgICAgICAgICAgIHN1YnNbcC5TdWJqZWN0XSA9IHAuU3ViamVjdC5zdWJzdHIoJ3VzZXI6Jy5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNlbGxBY2xzICYmIHAuU3ViamVjdC5pbmRleE9mKCdyb2xlOicpID09PSAwICYmIGNlbGxBY2xzW3AuU3ViamVjdC5zdWJzdHIoJ3JvbGU6Jy5sZW5ndGgpXSkge1xuICAgICAgICAgICAgICAgIHZhciByb2xlSWQgPSBwLlN1YmplY3Quc3Vic3RyKCdyb2xlOicubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbEFjbHNbcm9sZUlkXS5Vc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB1c3IgPSBjZWxsQWNsc1tyb2xlSWRdLlVzZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VXNlclN1YmplY3QgIT09ICd1c2VyOicgKyB1c3IuTG9naW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNbcC5TdWJqZWN0XSA9IHVzci5BdHRyaWJ1dGVzICYmIHVzci5BdHRyaWJ1dGVzWydkaXNwbGF5TmFtZSddID8gdXNyLkF0dHJpYnV0ZXNbJ2Rpc3BsYXlOYW1lJ10gOiB1c3IuTG9naW47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNlbGxBY2xzW3JvbGVJZF0uR3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdycCA9IGNlbGxBY2xzW3JvbGVJZF0uR3JvdXA7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNbcC5TdWJqZWN0XSA9IGdycC5BdHRyaWJ1dGVzICYmIGdycC5BdHRyaWJ1dGVzWydkaXNwbGF5TmFtZSddID8gZ3JwLkF0dHJpYnV0ZXNbJ2Rpc3BsYXlOYW1lJ10gOiBncnAuR3JvdXBMYWJlbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3VicztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlck9yUm9sZSB7e0lkbVVzZXIsSWRtUm9sZX19XG4gICAgICovXG5cbiAgICBSZXNvdXJjZVBvbGljaWVzUGFuZWwucHJvdG90eXBlLnBpY2tVc2VyID0gZnVuY3Rpb24gcGlja1VzZXIodXNlck9yUm9sZSkge1xuICAgICAgICB2YXIgc3ViamVjdCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodXNlck9yUm9sZS5JZG1Vc2VyKSB7XG4gICAgICAgICAgICB2YXIgSWRtVXNlciA9IHVzZXJPclJvbGUuSWRtVXNlcjtcblxuICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBJZG1Vc2VyLkF0dHJpYnV0ZXMgfHwge307XG4gICAgICAgICAgICBpZiAoSWRtVXNlci5Jc0dyb3VwKSB7XG4gICAgICAgICAgICAgICAgc3ViamVjdCA9ICdyb2xlOicgKyBJZG1Vc2VyLlV1aWQ7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSBhdHRyaWJ1dGVzWydkaXNwbGF5TmFtZSddIHx8IElkbVVzZXIuR3JvdXBMYWJlbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3ViamVjdCA9ICd1c2VyOicgKyBJZG1Vc2VyLkxvZ2luO1xuICAgICAgICAgICAgICAgIGxhYmVsID0gYXR0cmlidXRlc1snZGlzcGxheU5hbWUnXSB8fCBJZG1Vc2VyLkxvZ2luO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIElkbVJvbGUgPSB1c2VyT3JSb2xlLklkbVJvbGU7XG5cbiAgICAgICAgICAgIHN1YmplY3QgPSAncm9sZTonICsgSWRtUm9sZS5VdWlkO1xuICAgICAgICAgICAgbGFiZWwgPSBJZG1Sb2xlLkxhYmVsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwaWNrZWRVc2VyOiBzdWJqZWN0LCBwaWNrZWRMYWJlbDogbGFiZWwgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHN1YmplY3RcbiAgICAgKiBAcGFyYW0gbGFiZWxcbiAgICAgKiBAcGFyYW0gcG9saWNpZXNcbiAgICAgKiBAcGFyYW0gZGlzYWJsZWRcbiAgICAgKiBAcGFyYW0gaXNQaWNrZWRVc2VyXG4gICAgICogQHJldHVybiB7WE1MfVxuICAgICAqL1xuXG4gICAgUmVzb3VyY2VQb2xpY2llc1BhbmVsLnByb3RvdHlwZS5yZW5kZXJMaW5lID0gZnVuY3Rpb24gcmVuZGVyTGluZShzdWJqZWN0LCBsYWJlbCwgcG9saWNpZXMsIGRpc2FibGVkKSB7XG4gICAgICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgICAgIHZhciBpc1BpY2tlZFVzZXIgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDQgfHwgYXJndW1lbnRzWzRdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1s0XTtcbiAgICAgICAgdmFyIF9wcm9wczQgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgc3ViamVjdHNEaXNhYmxlZCA9IF9wcm9wczQuc3ViamVjdHNEaXNhYmxlZDtcbiAgICAgICAgdmFyIHN1YmplY3RzSGlkZGVuID0gX3Byb3BzNC5zdWJqZWN0c0hpZGRlbjtcbiAgICAgICAgdmFyIHJlYWRvbmx5ID0gX3Byb3BzNC5yZWFkb25seTtcblxuICAgICAgICBpZiAoc3ViamVjdHNIaWRkZW4gJiYgc3ViamVjdHNIaWRkZW5bc3ViamVjdF0pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlYWQgPSBmYWxzZSxcbiAgICAgICAgICAgIHdyaXRlID0gZmFsc2U7XG4gICAgICAgIHZhciByZWFkQ2hhbmdlID0gZnVuY3Rpb24gcmVhZENoYW5nZSgpIHtcbiAgICAgICAgICAgIF90aGlzNC5hZGRQb2xpY3koJ1JFQUQnLCBzdWJqZWN0LCBpc1BpY2tlZFVzZXIpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgd3JpdGVDaGFuZ2UgPSBmdW5jdGlvbiB3cml0ZUNoYW5nZSgpIHtcbiAgICAgICAgICAgIF90aGlzNC5hZGRQb2xpY3koJ1dSSVRFJywgc3ViamVjdCwgaXNQaWNrZWRVc2VyKTtcbiAgICAgICAgfTtcbiAgICAgICAgcG9saWNpZXMubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICBpZiAocC5TdWJqZWN0ICE9PSBzdWJqZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHAuQWN0aW9uID09PSAnV1JJVEUnKSB7XG4gICAgICAgICAgICAgICAgd3JpdGUgPSBwLkFjdGlvbiA9PT0gJ1dSSVRFJztcbiAgICAgICAgICAgICAgICB3cml0ZUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXM0LnJlbW92ZVBvbGljeSgnV1JJVEUnLCBzdWJqZWN0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwLkFjdGlvbiA9PT0gJ1JFQUQnKSB7XG4gICAgICAgICAgICAgICAgcmVhZCA9IHAuQWN0aW9uID09PSAnUkVBRCc7XG4gICAgICAgICAgICAgICAgcmVhZENoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXM0LnJlbW92ZVBvbGljeSgnUkVBRCcsIHN1YmplY3QpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgZGlzYWJsZVdyaXRlID0gZGlzYWJsZWQ7XG4gICAgICAgIHZhciBkaXNhYmxlUmVhZCA9IGRpc2FibGVkO1xuICAgICAgICBpZiAocmVhZG9ubHkpIHtcbiAgICAgICAgICAgIGRpc2FibGVSZWFkID0gdHJ1ZTtcbiAgICAgICAgICAgIGRpc2FibGVXcml0ZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoc3ViamVjdHNEaXNhYmxlZCAmJiBzdWJqZWN0c0Rpc2FibGVkWydSRUFEJ10gJiYgc3ViamVjdHNEaXNhYmxlZFsnUkVBRCddW3N1YmplY3RdKSB7XG4gICAgICAgICAgICAgICAgZGlzYWJsZVJlYWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YmplY3RzRGlzYWJsZWQgJiYgc3ViamVjdHNEaXNhYmxlZFsnV1JJVEUnXSAmJiBzdWJqZWN0c0Rpc2FibGVkWydXUklURSddW3N1YmplY3RdKSB7XG4gICAgICAgICAgICAgICAgZGlzYWJsZVdyaXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgc3R5bGU6IHsgZGlzcGxheTogJ2ZsZXgnLCBtYXJnaW46IDEwLCBtYXJnaW5SaWdodDogMCB9IH0sXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGZsZXg6IDEgfSB9LFxuICAgICAgICAgICAgICAgIGxhYmVsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuQ2hlY2tib3gsIHsgY2hlY2tlZDogcmVhZCwgZGlzYWJsZWQ6IGRpc2FibGVSZWFkLCBzdHlsZTogeyB3aWR0aDogNDAgfSwgb25DaGVjazogcmVhZENoYW5nZSB9KSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkNoZWNrYm94LCB7IGNoZWNrZWQ6IHdyaXRlLCBkaXNhYmxlZDogZGlzYWJsZVdyaXRlLCBzdHlsZTogeyB3aWR0aDogNDAgfSwgb25DaGVjazogd3JpdGVDaGFuZ2UgfSlcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgUmVzb3VyY2VQb2xpY2llc1BhbmVsLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICAgIHZhciBhcHBCYXIgPSB0aGlzLnByb3BzLm11aVRoZW1lLmFwcEJhcjtcblxuICAgICAgICB2YXIgc3R5bGVzID0ge1xuICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICBwYWRkaW5nTGVmdDogMTAsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBhcHBCYXIuY29sb3IsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICAgICAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgICAgICBjb2xvcjogYXBwQmFyLnRleHRDb2xvclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1YmhlYWRlcjoge1xuICAgICAgICAgICAgICAgIG1hcmdpbjogMTAsXG4gICAgICAgICAgICAgICAgZm9udFdlaWdodDogNTAwLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAnIzlFOUU5RScsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ2ZsZXgnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3ViamVjdDoge1xuICAgICAgICAgICAgICAgIG1hcmdpbjogMTBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoZWFkOiB7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDQwLFxuICAgICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDEwXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBfc3RhdGU0ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdmFyIHBvbGljaWVzID0gX3N0YXRlNC5wb2xpY2llcztcbiAgICAgICAgdmFyIGRpcnR5UG9saWNpZXMgPSBfc3RhdGU0LmRpcnR5UG9saWNpZXM7XG4gICAgICAgIHZhciBlcnJvciA9IF9zdGF0ZTQuZXJyb3I7XG4gICAgICAgIHZhciBpZG1Vc2VyID0gX3N0YXRlNC5pZG1Vc2VyO1xuICAgICAgICB2YXIgdXNlclRlYW1zID0gX3N0YXRlNC51c2VyVGVhbXM7XG4gICAgICAgIHZhciBsb2FkaW5nID0gX3N0YXRlNC5sb2FkaW5nO1xuICAgICAgICB2YXIgcGlja2VkVXNlciA9IF9zdGF0ZTQucGlja2VkVXNlcjtcbiAgICAgICAgdmFyIHBpY2tlZExhYmVsID0gX3N0YXRlNC5waWNrZWRMYWJlbDtcbiAgICAgICAgdmFyIF9wcm9wczUgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgb25EaXNtaXNzID0gX3Byb3BzNS5vbkRpc21pc3M7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wczUuc3R5bGU7XG4gICAgICAgIHZhciBza2lwVGl0bGUgPSBfcHJvcHM1LnNraXBUaXRsZTtcbiAgICAgICAgdmFyIHJlc291cmNlSWQgPSBfcHJvcHM1LnJlc291cmNlSWQ7XG4gICAgICAgIHZhciBweWRpbyA9IF9wcm9wczUucHlkaW87XG4gICAgICAgIHZhciB1c2VyTGlzdEV4Y2x1ZGVzID0gX3Byb3BzNS51c2VyTGlzdEV4Y2x1ZGVzO1xuICAgICAgICB2YXIgcmVhZG9ubHkgPSBfcHJvcHM1LnJlYWRvbmx5O1xuXG4gICAgICAgIHZhciBibG9ja3MgPSBbXTtcbiAgICAgICAgaWYgKCFsb2FkaW5nICYmICFlcnJvcikge1xuICAgICAgICAgICAgdmFyIF9saXN0VXNlclJvbGVzID0gdGhpcy5saXN0VXNlclJvbGVzKGlkbVVzZXIsIGRpcnR5UG9saWNpZXMgPyBkaXJ0eVBvbGljaWVzIDogcG9saWNpZXMpO1xuXG4gICAgICAgICAgICB2YXIgZ3JvdXBCbG9ja3MgPSBfbGlzdFVzZXJSb2xlcy5ncm91cEJsb2NrcztcbiAgICAgICAgICAgIHZhciBoYXNXcml0ZSA9IF9saXN0VXNlclJvbGVzLmhhc1dyaXRlO1xuXG4gICAgICAgICAgICB2YXIgdGVhbUJsb2NrcyA9IHRoaXMubGlzdFVzZXJUZWFtcyh1c2VyVGVhbXMsIGRpcnR5UG9saWNpZXMgPyBkaXJ0eVBvbGljaWVzIDogcG9saWNpZXMsICFoYXNXcml0ZSk7XG4gICAgICAgICAgICB2YXIgaGVhZHMgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5oZWFkIH0sXG4gICAgICAgICAgICAgICAgICAgICdWaWV3J1xuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLmhlYWQgfSxcbiAgICAgICAgICAgICAgICAgICAgJ0VkaXQnXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChncm91cEJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5zdWJoZWFkZXIgfSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGZsZXg6IDEgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXJzJ1xuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICBoZWFkc1xuICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgICAgIGJsb2Nrcy5wdXNoKGdyb3VwQmxvY2tzKTtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5EaXZpZGVyLCBudWxsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGVhbUJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5zdWJoZWFkZXIgfSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGZsZXg6IDEgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1lvdXIgVGVhbXMnXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIGhlYWRzXG4gICAgICAgICAgICAgICAgKSk7XG4gICAgICAgICAgICAgICAgYmxvY2tzLnB1c2godGVhbUJsb2Nrcyk7XG4gICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRGl2aWRlciwgbnVsbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBpY2tlZFVzZXIpIHtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5zdWJoZWFkZXIgfSxcbiAgICAgICAgICAgICAgICAgICAgJ1NldCB2aXNpYmxlIHRvLi4uJ1xuICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgICAgIGJsb2Nrcy5wdXNoKHRoaXMucmVuZGVyTGluZShwaWNrZWRVc2VyLCBwaWNrZWRMYWJlbCwgcG9saWNpZXMsIGZhbHNlLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IHRleHRBbGlnbjogJ3JpZ2h0JyB9IH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZsYXRCdXR0b24sIHsgbGFiZWw6IFwiQ2FuY2VsXCIsIG9uVG91Y2hUYXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczUuc2V0U3RhdGUoeyBwaWNrZWRVc2VyOiBudWxsLCBwaWNrZWRMYWJlbDogbnVsbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gfSlcbiAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5EaXZpZGVyLCBudWxsKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFyZWFkb25seSkge1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjcnRVc2VyU3ViamVjdCA9ICd1c2VyOicgKyBpZG1Vc2VyLkxvZ2luO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXNlclN1YmplY3RzID0gX3RoaXM1Lmxpc3RPdGhlclVzZXJzU3ViamVjdHMoZGlydHlQb2xpY2llcyA/IGRpcnR5UG9saWNpZXMgOiBwb2xpY2llcywgY3J0VXNlclN1YmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXhsdWRlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh1c2VyU3ViamVjdHMpLm1hcChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhsdWRlcy5wdXNoKHVzZXJTdWJqZWN0c1trXSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNlbGVjdCBhbiBhcmJpdHJhcnkgcmVzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5zdWJoZWFkZXIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTZXQgdmlzaWJsZSB0byAuLi4nXG4gICAgICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBtYXJnaW46ICctMzBweCAxMHB4IDAnIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF91c2Vyc1VzZXJzQ29tcGxldGVyMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnc2hhcmUtZm9ybS11c2VycycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRMYWJlbDogJ1NlbGVjdCB1c2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJTdWdnZXN0aW9uOiBmdW5jdGlvbiAodXNlck9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgZm9udFNpemU6IDEzIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJPYmplY3QuZ2V0RXh0ZW5kZWRMYWJlbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlU2VsZWN0ZWQ6IF90aGlzNS5waWNrVXNlci5iaW5kKF90aGlzNSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnNPbmx5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nT25seTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlczogW3Jlc291cmNlSWRdLmNvbmNhdCh1c2VyTGlzdEV4Y2x1ZGVzLCBleGx1ZGVzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweWRpbzogcHlkaW8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0FkZHJlc3NCb29rOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc0Zyb206ICdsb2NhbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5EaXZpZGVyLCBudWxsKSk7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYmxvY2tzLnBvcCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBzdHlsZSB9LFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogc3R5bGVzLnRpdGxlIH0sXG4gICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBmbGV4OiAxIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgc2tpcFRpdGxlID8gJycgOiAnVmlzaWJpbGl0eSdcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGRpcnR5UG9saWNpZXMgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuSWNvbkJ1dHRvbiwgeyBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktdW5kby12YXJpYW50XCIsIHRvb2x0aXA6IFwiUmV2ZXJ0IGNoYW5nZXNcIiwgb25Ub3VjaFRhcDogdGhpcy5yZXZlcnQuYmluZCh0aGlzKSwgaWNvblN0eWxlOiB7IGNvbG9yOiBhcHBCYXIudGV4dENvbG9yIH0gfSksXG4gICAgICAgICAgICAgICAgZGlydHlQb2xpY2llcyAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IGljb25DbGFzc05hbWU6IFwibWRpIG1kaS1jb250ZW50LXNhdmVcIiwgdG9vbHRpcDogXCJTYXZlIGNoYW5nZXNcIiwgb25Ub3VjaFRhcDogdGhpcy5zYXZlLmJpbmQodGhpcyksIGljb25TdHlsZTogeyBjb2xvcjogYXBwQmFyLnRleHRDb2xvciB9IH0pLFxuICAgICAgICAgICAgICAgICFkaXJ0eVBvbGljaWVzICYmIG9uRGlzbWlzcyAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IGljb25DbGFzc05hbWU6IFwibWRpIG1kaS1jbG9zZVwiLCBvblRvdWNoVGFwOiBvbkRpc21pc3MsIGljb25TdHlsZTogeyBjb2xvcjogYXBwQmFyLnRleHRDb2xvciB9IH0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgZXJyb3IgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAnRXJyb3I6ICcsXG4gICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIGJsb2Nrc1xuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gUmVzb3VyY2VQb2xpY2llc1BhbmVsO1xufSkoX3JlYWN0MlsnZGVmYXVsdCddLkNvbXBvbmVudCk7XG5cblJlc291cmNlUG9saWNpZXNQYW5lbC5Qcm9wVHlwZXMgPSB7XG4gICAgcHlkaW86IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihfcHlkaW8zWydkZWZhdWx0J10pLFxuICAgIHJlc291cmNlVHlwZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICByZXNvdXJjZUlkOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIG9uU2F2ZVBvbGljaWVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgdXNlckxpc3RFeGNsdWRlczogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5hcnJheSxcbiAgICBzdWJqZWN0c0Rpc2FibGVkOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgIHN1YmplY3RzSGlkZGVuOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICByZWFkb25seTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgIGNlbGxBY2xzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIG9uRGlzbWlzczogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgIHN0eWxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICBza2lwVGl0bGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbFxuXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBSZXNvdXJjZVBvbGljaWVzUGFuZWwgPSBfbWF0ZXJpYWxVaVN0eWxlcy5tdWlUaGVtZWFibGUoKShSZXNvdXJjZVBvbGljaWVzUGFuZWwpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBSZXNvdXJjZVBvbGljaWVzUGFuZWw7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3B5ZGlvSHR0cEFwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvYXBpJyk7XG5cbnZhciBfcHlkaW9IdHRwQXBpMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvSHR0cEFwaSk7XG5cbi8qKlxuICogU2ltcGxlIGZvcm0gZm9yIGNyZWF0aW5nIGEgdGVhbVxuICovXG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBDb21wb25lbnQgPSBfcmVxdWlyZS5Db21wb25lbnQ7XG52YXIgUHJvcFR5cGVzID0gX3JlcXVpcmUuUHJvcFR5cGVzO1xuXG52YXIgX3JlcXVpcmUyID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIFRleHRGaWVsZCA9IF9yZXF1aXJlMi5UZXh0RmllbGQ7XG52YXIgRmxhdEJ1dHRvbiA9IF9yZXF1aXJlMi5GbGF0QnV0dG9uO1xuXG52YXIgX3JlcXVpcmUkcmVxdWlyZUxpYiA9IHJlcXVpcmUoJ3B5ZGlvJykucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfcmVxdWlyZSRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xuXG52YXIgVGVhbUNyZWF0aW9uRm9ybSA9IChmdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhUZWFtQ3JlYXRpb25Gb3JtLCBfQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIFRlYW1DcmVhdGlvbkZvcm0ocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRlYW1DcmVhdGlvbkZvcm0pO1xuXG4gICAgICAgIF9Db21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IHZhbHVlOiAnJyB9O1xuICAgIH1cblxuICAgIFRlYW1DcmVhdGlvbkZvcm0ucHJvdG90eXBlLm9uQ2hhbmdlID0gZnVuY3Rpb24gb25DaGFuZ2UoZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiB2YWx1ZSB9KTtcbiAgICB9O1xuXG4gICAgVGVhbUNyZWF0aW9uRm9ybS5wcm90b3R5cGUuc3VibWl0Q3JlYXRpb25Gb3JtID0gZnVuY3Rpb24gc3VibWl0Q3JlYXRpb25Gb3JtKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICBfcHlkaW9IdHRwQXBpMlsnZGVmYXVsdCddLmdldFJlc3RDbGllbnQoKS5nZXRJZG1BcGkoKS5zYXZlU2VsZWN0aW9uQXNUZWFtKHZhbHVlLCBbXSwgdGhpcy5wcm9wcy5vblRlYW1DcmVhdGVkKTtcbiAgICB9O1xuXG4gICAgVGVhbUNyZWF0aW9uRm9ybS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgZ2V0TWVzc2FnZSA9IHRoaXMucHJvcHMuZ2V0TWVzc2FnZTtcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogeyBwYWRkaW5nOiAyMCB9IH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGdldE1lc3NhZ2UoNTkxKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUZXh0RmllbGQsIHsgZmxvYXRpbmdMYWJlbFRleHQ6IGdldE1lc3NhZ2UoNTc4KSwgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUsIG9uQ2hhbmdlOiB0aGlzLm9uQ2hhbmdlLmJpbmQodGhpcyksIGZ1bGxXaWR0aDogdHJ1ZSB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyB0ZXh0QWxpZ246ICdyaWdodCcsIHBhZGRpbmc6IDggfSB9LFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEZsYXRCdXR0b24sIHsgbGFiZWw6IGdldE1lc3NhZ2UoNDkpLCBvblRvdWNoVGFwOiB0aGlzLnByb3BzLm9uQ2FuY2VsLmJpbmQodGhpcykgfSksXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRmxhdEJ1dHRvbiwgeyBsYWJlbDogZ2V0TWVzc2FnZSg1NzkpLCBwcmltYXJ5OiB0cnVlLCBvblRvdWNoVGFwOiB0aGlzLnN1Ym1pdENyZWF0aW9uRm9ybS5iaW5kKHRoaXMpIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVGVhbUNyZWF0aW9uRm9ybTtcbn0pKENvbXBvbmVudCk7XG5cblRlYW1DcmVhdGlvbkZvcm0ucHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIHRyaWdnZXJlZCBhZnRlciB0ZWFtIGNyZWF0aW9uIHN1Y2NlZWRlZFxuICAgICAqL1xuICAgIG9uVGVhbUNyZWF0ZWQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgLyoqXG4gICAgICogUmVxdWVzdCBtb2RhbCBjbG9zZVxuICAgICAqL1xuICAgIG9uQ2FuY2VsOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBUZWFtQ3JlYXRpb25Gb3JtID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoVGVhbUNyZWF0aW9uRm9ybSk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFRlYW1DcmVhdGlvbkZvcm07XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvKTtcblxudmFyIF9weWRpb0h0dHBBcGkgPSByZXF1aXJlKCdweWRpby9odHRwL2FwaScpO1xuXG52YXIgX3B5ZGlvSHR0cEFwaTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb0h0dHBBcGkpO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgX3B5ZGlvSHR0cFVzZXJzQXBpID0gcmVxdWlyZSgncHlkaW8vaHR0cC91c2Vycy1hcGknKTtcblxudmFyIF9QeWRpbyRyZXF1aXJlTGliID0gX3B5ZGlvMlsnZGVmYXVsdCddLnJlcXVpcmVMaWIoJ2Zvcm0nKTtcblxudmFyIE1hbmFnZXIgPSBfUHlkaW8kcmVxdWlyZUxpYi5NYW5hZ2VyO1xudmFyIEZvcm1QYW5lbCA9IF9QeWRpbyRyZXF1aXJlTGliLkZvcm1QYW5lbDtcblxudmFyIFVzZXJDcmVhdGlvbkZvcm0gPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoVXNlckNyZWF0aW9uRm9ybSwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBVc2VyQ3JlYXRpb25Gb3JtLnByb3RvdHlwZS5nZXRDcmVhdGVVc2VyUGFyYW1ldGVycyA9IGZ1bmN0aW9uIGdldENyZWF0ZVVzZXJQYXJhbWV0ZXJzKCkge1xuICAgICAgICB2YXIgZWRpdE1vZGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1swXTtcblxuICAgICAgICB2YXIgYmFzaWNQYXJhbWV0ZXJzID0gW107XG4gICAgICAgIHZhciBweWRpbyA9IHRoaXMucHJvcHMucHlkaW87XG4gICAgICAgIHZhciBNZXNzYWdlSGFzaCA9IHB5ZGlvLk1lc3NhZ2VIYXNoO1xuXG4gICAgICAgIHZhciBwcmVmaXggPSBweWRpby5nZXRQbHVnaW5Db25maWdzKCdhY3Rpb24uc2hhcmUnKS5nZXQoJ1NIQVJFRF9VU0VSU19UTVBfUFJFRklYJyk7XG4gICAgICAgIGJhc2ljUGFyYW1ldGVycy5wdXNoKHtcbiAgICAgICAgICAgIElkbVVzZXJGaWVsZDogJ0xvZ2luJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNZXNzYWdlSGFzaFsnNTMzJ10sXG4gICAgICAgICAgICByZWFkb25seTogZWRpdE1vZGUsXG4gICAgICAgICAgICBleHBvc2U6IFwidHJ1ZVwiLFxuICAgICAgICAgICAgbGFiZWw6IE1lc3NhZ2VIYXNoWyc1MjInXSxcbiAgICAgICAgICAgIG5hbWU6IGVkaXRNb2RlID8gXCJleGlzdGluZ191c2VyX2lkXCIgOiBcIm5ld191c2VyX2lkXCIsXG4gICAgICAgICAgICBzY29wZTogXCJ1c2VyXCIsXG4gICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgbWFuZGF0b3J5OiB0cnVlLFxuICAgICAgICAgICAgXCJkZWZhdWx0XCI6IHByZWZpeCA/IHByZWZpeCA6ICcnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIElkbVVzZXJGaWVsZDogJ1Bhc3N3b3JkJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNZXNzYWdlSGFzaFsnNTM0J10sXG4gICAgICAgICAgICBlZGl0YWJsZTogXCJ0cnVlXCIsXG4gICAgICAgICAgICBleHBvc2U6IFwidHJ1ZVwiLFxuICAgICAgICAgICAgbGFiZWw6IE1lc3NhZ2VIYXNoWyc1MjMnXSxcbiAgICAgICAgICAgIG5hbWU6IFwibmV3X3Bhc3N3b3JkXCIsXG4gICAgICAgICAgICBzY29wZTogXCJ1c2VyXCIsXG4gICAgICAgICAgICB0eXBlOiBcInZhbGlkLXBhc3N3b3JkXCIsXG4gICAgICAgICAgICBtYW5kYXRvcnk6IHRydWVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHBhcmFtcyA9IGdsb2JhbC5weWRpby5nZXRQbHVnaW5Db25maWdzKCdhdXRoJykuZ2V0KCdORVdVU0VSU19FRElUX1BBUkFNRVRFUlMnKS5zcGxpdCgnLCcpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcGFyYW1zW2ldID0gXCJ1c2VyL3ByZWZlcmVuY2VzL3ByZWZbQGV4cG9zZWRdfC8vcGFyYW1bQG5hbWU9J1wiICsgcGFyYW1zW2ldICsgXCInXVwiO1xuICAgICAgICB9XG4gICAgICAgIHZhciB4UGF0aCA9IHBhcmFtcy5qb2luKCd8Jyk7XG4gICAgICAgIE1hbmFnZXIucGFyc2VQYXJhbWV0ZXJzKHRoaXMucHJvcHMucHlkaW8uZ2V0WG1sUmVnaXN0cnkoKSwgeFBhdGgpLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIGJhc2ljUGFyYW1ldGVycy5wdXNoKGVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghZWRpdE1vZGUpIHtcbiAgICAgICAgICAgIGJhc2ljUGFyYW1ldGVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTWVzc2FnZUhhc2hbJzUzNiddLFxuICAgICAgICAgICAgICAgIGVkaXRhYmxlOiBcInRydWVcIixcbiAgICAgICAgICAgICAgICBleHBvc2U6IFwidHJ1ZVwiLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBNZXNzYWdlSGFzaFsnNTM1J10sXG4gICAgICAgICAgICAgICAgbmFtZTogXCJzZW5kX2VtYWlsXCIsXG4gICAgICAgICAgICAgICAgc2NvcGU6IFwidXNlclwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgIG1hbmRhdG9yeTogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhc2ljUGFyYW1ldGVycztcbiAgICB9O1xuXG4gICAgVXNlckNyZWF0aW9uRm9ybS5wcm90b3R5cGUuZ2V0RGVmYXVsdFByb3BzID0gZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgICAgICByZXR1cm4geyBlZGl0TW9kZTogZmFsc2UgfTtcbiAgICB9O1xuXG4gICAgVXNlckNyZWF0aW9uRm9ybS5wcm90b3R5cGUuZ2V0UGFyYW1ldGVycyA9IGZ1bmN0aW9uIGdldFBhcmFtZXRlcnMoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcGFyc2VkUGFyYW1ldGVycykge1xuICAgICAgICAgICAgdGhpcy5fcGFyc2VkUGFyYW1ldGVycyA9IHRoaXMuZ2V0Q3JlYXRlVXNlclBhcmFtZXRlcnModGhpcy5wcm9wcy5lZGl0TW9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnNlZFBhcmFtZXRlcnM7XG4gICAgfTtcblxuICAgIFVzZXJDcmVhdGlvbkZvcm0ucHJvdG90eXBlLmdldFZhbHVlc0ZvclBvc3QgPSBmdW5jdGlvbiBnZXRWYWx1ZXNGb3JQb3N0KHByZWZpeCkge1xuICAgICAgICByZXR1cm4gTWFuYWdlci5nZXRWYWx1ZXNGb3JQT1NUKHRoaXMuZ2V0UGFyYW1ldGVycygpLCB0aGlzLnN0YXRlLnZhbHVlcywgcHJlZml4KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gVXNlckNyZWF0aW9uRm9ybShwcm9wcywgY29udGV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VyQ3JlYXRpb25Gb3JtKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgcHlkaW8gPSBfcHJvcHMucHlkaW87XG4gICAgICAgIHZhciBuZXdVc2VyTmFtZSA9IF9wcm9wcy5uZXdVc2VyTmFtZTtcbiAgICAgICAgdmFyIGVkaXRNb2RlID0gX3Byb3BzLmVkaXRNb2RlO1xuICAgICAgICB2YXIgdXNlckRhdGEgPSBfcHJvcHMudXNlckRhdGE7XG5cbiAgICAgICAgdmFyIHVzZXJQcmVmaXggPSBweWRpby5nZXRQbHVnaW5Db25maWdzKCdhY3Rpb24uc2hhcmUnKS5nZXQoJ1NIQVJFRF9VU0VSU19UTVBfUFJFRklYJyk7XG4gICAgICAgIGlmICghdXNlclByZWZpeCB8fCBuZXdVc2VyTmFtZS5zdGFydHNXaXRoKHVzZXJQcmVmaXgpKSB1c2VyUHJlZml4ID0gJyc7XG4gICAgICAgIHZhciB2YWx1ZXMgPSB7XG4gICAgICAgICAgICBuZXdfcGFzc3dvcmQ6ICcnLFxuICAgICAgICAgICAgc2VuZF9lbWFpbDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZWRpdE1vZGUgJiYgdXNlckRhdGEgJiYgdXNlckRhdGEuSWRtVXNlcikge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgSWRtVXNlciA9IHVzZXJEYXRhLklkbVVzZXI7XG5cbiAgICAgICAgICAgICAgICBfdGhpcy5nZXRQYXJhbWV0ZXJzKCkuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBwYXJhbS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB2YXIgSWRtVXNlckZpZWxkID0gcGFyYW0uSWRtVXNlckZpZWxkO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBwYXJhbS5zY29wZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsdWdpbklkID0gcGFyYW0ucGx1Z2luSWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoSWRtVXNlckZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IElkbVVzZXJbSWRtVXNlckZpZWxkXTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZSA9PT0gJ3VzZXInICYmIElkbVVzZXIuQXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBJZG1Vc2VyLkF0dHJpYnV0ZXNbbmFtZV07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGx1Z2luSWQgJiYgSWRtVXNlci5BdHRyaWJ1dGVzW1wicGFyYW1ldGVyOlwiICsgcGx1Z2luSWQgKyBcIjpcIiArIG5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04ucGFyc2UoSWRtVXNlci5BdHRyaWJ1dGVzW1wicGFyYW1ldGVyOlwiICsgcGx1Z2luSWQgKyBcIjpcIiArIG5hbWVdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZXNbJ25ld191c2VyX2lkJ10gPSB1c2VyUHJlZml4ICsgbmV3VXNlck5hbWU7XG4gICAgICAgICAgICB2YWx1ZXNbJ2xhbmcnXSA9IHB5ZGlvLmN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlID0geyB2YWx1ZXM6IHZhbHVlcyB9O1xuICAgIH1cblxuICAgIFVzZXJDcmVhdGlvbkZvcm0ucHJvdG90eXBlLm9uVmFsdWVzQ2hhbmdlID0gZnVuY3Rpb24gb25WYWx1ZXNDaGFuZ2UobmV3VmFsdWVzKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZXM6IG5ld1ZhbHVlcyB9KTtcbiAgICB9O1xuXG4gICAgVXNlckNyZWF0aW9uRm9ybS5wcm90b3R5cGUuY2hhbmdlVmFsaWRTdGF0dXMgPSBmdW5jdGlvbiBjaGFuZ2VWYWxpZFN0YXR1cyhzdGF0dXMpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbGlkOiBzdGF0dXMgfSk7XG4gICAgfTtcblxuICAgIFVzZXJDcmVhdGlvbkZvcm0ucHJvdG90eXBlLnN1Ym1pdENyZWF0aW9uRm9ybSA9IGZ1bmN0aW9uIHN1Ym1pdENyZWF0aW9uRm9ybSgpIHtcbiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgdmFyIGV4aXN0aW5nVXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIF9wcm9wczIgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgZWRpdE1vZGUgPSBfcHJvcHMyLmVkaXRNb2RlO1xuICAgICAgICB2YXIgdXNlckRhdGEgPSBfcHJvcHMyLnVzZXJEYXRhO1xuXG4gICAgICAgIGlmIChlZGl0TW9kZSkge1xuICAgICAgICAgICAgZXhpc3RpbmdVc2VyID0gdXNlckRhdGEuSWRtVXNlcjtcbiAgICAgICAgfVxuICAgICAgICBfcHlkaW9IdHRwQXBpMlsnZGVmYXVsdCddLmdldFJlc3RDbGllbnQoKS5nZXRJZG1BcGkoKS5wdXRFeHRlcm5hbFVzZXIodGhpcy5zdGF0ZS52YWx1ZXMsIHRoaXMuZ2V0UGFyYW1ldGVycygpLCBleGlzdGluZ1VzZXIpLnRoZW4oZnVuY3Rpb24gKGlkbVVzZXIpIHtcbiAgICAgICAgICAgIF90aGlzMi5wcm9wcy5vblVzZXJDcmVhdGVkKF9weWRpb0h0dHBVc2Vyc0FwaS5Vc2VyLmZyb21JZG1Vc2VyKGlkbVVzZXIpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIFVzZXJDcmVhdGlvbkZvcm0ucHJvdG90eXBlLmNhbmNlbENyZWF0aW9uRm9ybSA9IGZ1bmN0aW9uIGNhbmNlbENyZWF0aW9uRm9ybSgpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkNhbmNlbCgpO1xuICAgIH07XG5cbiAgICBVc2VyQ3JlYXRpb25Gb3JtLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfcHJvcHMzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHB5ZGlvID0gX3Byb3BzMy5weWRpbztcbiAgICAgICAgdmFyIGVkaXRNb2RlID0gX3Byb3BzMy5lZGl0TW9kZTtcbiAgICAgICAgdmFyIG5ld1VzZXJOYW1lID0gX3Byb3BzMy5uZXdVc2VyTmFtZTtcblxuICAgICAgICB2YXIgc3RhdHVzID0gdGhpcy5zdGF0ZS52YWxpZDtcbiAgICAgICAgaWYgKCFzdGF0dXMgJiYgZWRpdE1vZGUgJiYgIXRoaXMuc3RhdGUudmFsdWVzWyduZXdfcGFzc3dvcmQnXSkge1xuICAgICAgICAgICAgc3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIF9tYXRlcmlhbFVpLlBhcGVyLFxuICAgICAgICAgICAgeyB6RGVwdGg6IHRoaXMucHJvcHMuekRlcHRoICE9PSB1bmRlZmluZWQgPyB0aGlzLnByb3BzLnpEZXB0aCA6IDIsIHN0eWxlOiBfZXh0ZW5kcyh7IG1pbkhlaWdodDogMjUwLCBkaXNwbGF5OiAnZmxleCcsIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nIH0sIHRoaXMucHJvcHMuc3R5bGUpIH0sXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChGb3JtUGFuZWwsIHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdyZXNldC1weWRpby1mb3JtcycsXG4gICAgICAgICAgICAgICAgZGVwdGg6IC0xLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHRoaXMuZ2V0UGFyYW1ldGVycygpLFxuICAgICAgICAgICAgICAgIHZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMub25WYWx1ZXNDaGFuZ2UuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvblZhbGlkU3RhdHVzQ2hhbmdlOiB0aGlzLmNoYW5nZVZhbGlkU3RhdHVzLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgc3R5bGU6IHsgb3ZlcmZsb3dZOiAnYXV0bycsIGZsZXg6IDEgfVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5EaXZpZGVyLCB7IHN0eWxlOiB7IGZsZXhTaHJpbms6IDAgfSB9KSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcGFkZGluZzogOCwgdGV4dEFsaWduOiAncmlnaHQnIH0gfSxcbiAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5GbGF0QnV0dG9uLCB7IGxhYmVsOiBweWRpby5NZXNzYWdlSGFzaFs0OV0sIG9uVG91Y2hUYXA6IHRoaXMuY2FuY2VsQ3JlYXRpb25Gb3JtLmJpbmQodGhpcykgfSksXG4gICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRmxhdEJ1dHRvbiwgeyBsYWJlbDogdGhpcy5wcm9wcy5lZGl0TW9kZSA/IHB5ZGlvLk1lc3NhZ2VIYXNoWzUxOV0gOiBweWRpby5NZXNzYWdlSGFzaFs0ODRdLCBwcmltYXJ5OiB0cnVlLCBvblRvdWNoVGFwOiB0aGlzLnN1Ym1pdENyZWF0aW9uRm9ybS5iaW5kKHRoaXMpLCBkaXNhYmxlZDogIXN0YXR1cyB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVXNlckNyZWF0aW9uRm9ybTtcbn0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXG5Vc2VyQ3JlYXRpb25Gb3JtLnByb3BUeXBlcyA9IHtcbiAgICBuZXdVc2VyTmFtZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25Vc2VyQ3JlYXRlZDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25DYW5jZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRNb2RlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgdXNlckRhdGE6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0XG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBVc2VyQ3JlYXRpb25Gb3JtO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX3B5ZGlvSHR0cEFwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvYXBpJyk7XG5cbnZhciBfcHlkaW9IdHRwQXBpMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvSHR0cEFwaSk7XG5cbnZhciBfcHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvKTtcblxudmFyIF9hZGRyZXNzYm9va0FkZHJlc3NCb29rID0gcmVxdWlyZSgnLi9hZGRyZXNzYm9vay9BZGRyZXNzQm9vaycpO1xuXG52YXIgX2FkZHJlc3Nib29rQWRkcmVzc0Jvb2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYWRkcmVzc2Jvb2tBZGRyZXNzQm9vayk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfcHlkaW9VdGlsRnVuYyA9IHJlcXVpcmUoJ3B5ZGlvL3V0aWwvZnVuYycpO1xuXG52YXIgX3B5ZGlvVXRpbEZ1bmMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9VdGlsRnVuYyk7XG5cbnZhciBfVXNlckNyZWF0aW9uRm9ybSA9IHJlcXVpcmUoJy4vVXNlckNyZWF0aW9uRm9ybScpO1xuXG52YXIgX1VzZXJDcmVhdGlvbkZvcm0yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfVXNlckNyZWF0aW9uRm9ybSk7XG5cbi8qKlxuICogUmVhZHkgdG8gdXNlIGF1dG9jb21wbGV0ZSBmaWVsZCB0aGF0IHdpbGwgbG9hZCB1c2Vycy9ncm91cHMvcm9sZXMgZnJvbVxuICogdGhlIHNlcnZlciAodXNpbmcgdXNlcl9saXN0X2F1dGhvcml6ZWRfdXNlcnMgQVBJKS5cbiAqIFVzZWQgZm9yIHNoYXJpbmcsIGFkZHJlc3Nib29rcywgc2VuZCBlbWFpbCwgZXRjLlxuICpcbiAqIENhbiBhbHNvIG9wZW4gYSBcInNlbGVjdG9yLXN0eWxlXCIgYWRyZXNzIGJvb2suXG4gKi9cbnZhciBVc2Vyc0xvYWRlciA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdVc2Vyc0xvYWRlcicsXG5cbiAgICBwcm9wVHlwZXM6IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWV0aG9kIGNhbGxlZCB0byByZW5kZXIgYSBjb21tcG9uZW50LCB0YWtpbmcgYSBVc2VyT2JqZWN0IGFzIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICByZW5kZXJTdWdnZXN0aW9uOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxiYWNrIHdoZW4gYSB2YWx1ZSBpcyBmaW5hbGx5IHNlbGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBvblZhbHVlU2VsZWN0ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgICAvKipcbiAgICAgICAgICogRmxvYXRpbmcgTGFiZWwgVGV4dCBkaXNwbGF5ZWQgb24gdGhlIGZpZWxkXG4gICAgICAgICAqL1xuICAgICAgICBmaWVsZExhYmVsOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXJyYXkgb2YgdmFsdWVzIHRvIGlnbm9yZVxuICAgICAgICAgKi9cbiAgICAgICAgZXhjbHVkZXM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpc3BsYXkgb25seSB1c2Vycywgbm8gZ3JvdXBzIG5vciByb2xlc1xuICAgICAgICAgKi9cbiAgICAgICAgdXNlcnNPbmx5OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNwbGF5IHVzZXJzIGZyb20gbG9jYWwgZGlyZWN0b3J5IGFuZC9vciBmcm9tIHJlbW90ZS5cbiAgICAgICAgICovXG4gICAgICAgIHVzZXJzRnJvbTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vbmVPZihbJ2xvY2FsJywgJ3JlbW90ZScsICdhbnknXSksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEbyBub3QgcHJvcG9zZSBhIFwiQ3JlYXRlIHVzZXJcIiBvcHRpb25cbiAgICAgICAgICovXG4gICAgICAgIGV4aXN0aW5nT25seTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWxsb3cgZnJlZSB0eXBpbmdcbiAgICAgICAgICovXG4gICAgICAgIGZyZWVWYWx1ZUFsbG93ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdpbGwgYmUgcGFzc2VkIHRvIHRoZSByb290IGNvbXBvbmVudFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGFTb3VyY2U6IFtdLFxuICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBzZWFyY2hUZXh0OiAnJyxcbiAgICAgICAgICAgIG1pbkNoYXJzOiBwYXJzZUludChnbG9iYWwucHlkaW8uZ2V0UGx1Z2luQ29uZmlncyhcImNvcmUuYXV0aFwiKS5nZXQoXCJVU0VSU19MSVNUX0NPTVBMRVRFX01JTl9DSEFSU1wiKSlcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgdmFsdWVzIGZyb20gc2VydmVyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IEN1cnJlbnRseSBzZWFyY2hlZCB0ZXh0XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGVkIHdpdGggdGhlIHZhbHVlc1xuICAgICAqL1xuICAgIHN1Z2dlc3Rpb25Mb2FkZXI6IGZ1bmN0aW9uIHN1Z2dlc3Rpb25Mb2FkZXIoaW5wdXQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIGV4Y2x1ZGVzID0gdGhpcy5wcm9wcy5leGNsdWRlcztcbiAgICAgICAgLy9jb25zdCBkaXNhbGxvd1RlbXBvcmFyeSA9IHRoaXMucHJvcHMuZXhpc3RpbmdPbmx5ICYmICF0aGlzLnByb3BzLmZyZWVWYWx1ZUFsbG93ZWQ7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsb2FkaW5nOiB0aGlzLnN0YXRlLmxvYWRpbmcgKyAxIH0pO1xuICAgICAgICB2YXIgYXBpID0gX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRSZXN0Q2xpZW50KCkuZ2V0SWRtQXBpKCk7XG4gICAgICAgIHZhciB1UHJvbWlzZSA9IGFwaS5saXN0VXNlcnMoJy8nLCBpbnB1dCwgdHJ1ZSwgMCwgMjApO1xuICAgICAgICB2YXIgZ1Byb21pc2UgPSBhcGkubGlzdEdyb3VwcygnLycsIGlucHV0LCB0cnVlLCAwLCAyMCk7XG4gICAgICAgIHZhciB0UHJvbWlzZSA9IGFwaS5saXN0VGVhbXMoaW5wdXQsIDAsIDIwKTtcbiAgICAgICAgUHJvbWlzZS5hbGwoW3VQcm9taXNlLCBnUHJvbWlzZSwgdFByb21pc2VdKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IF90aGlzLnN0YXRlLmxvYWRpbmcgLSAxIH0pO1xuICAgICAgICAgICAgdmFyIHVzZXJzID0gcmVzdWx0c1swXTtcbiAgICAgICAgICAgIHZhciBncm91cHMgPSByZXN1bHRzWzFdO1xuICAgICAgICAgICAgdmFyIHRlYW1zID0gcmVzdWx0c1syXTtcblxuICAgICAgICAgICAgdXNlcnMgPSB1c2Vycy5Vc2VycztcbiAgICAgICAgICAgIGdyb3VwcyA9IGdyb3Vwcy5Hcm91cHM7XG4gICAgICAgICAgICB0ZWFtcyA9IHRlYW1zLlRlYW1zO1xuICAgICAgICAgICAgaWYgKGV4Y2x1ZGVzICYmIGV4Y2x1ZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHVzZXJzID0gdXNlcnMuZmlsdGVyKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleGNsdWRlcy5pbmRleE9mKHVzZXIuTG9naW4pID09PSAtMTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBncm91cHMgPSBncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhjbHVkZXMuaW5kZXhPZihncm91cC5Hcm91cExhYmVsKSA9PT0gLTE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGVhbXMgPSB0ZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHRlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4Y2x1ZGVzLmluZGV4T2YodGVhbS5MYWJlbCA9PT0gLTEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2soW10uY29uY2F0KGdyb3Vwcy5tYXAoZnVuY3Rpb24gKHUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBJZG1Vc2VyOiB1IH07XG4gICAgICAgICAgICB9KSwgdGVhbXMubWFwKGZ1bmN0aW9uICh1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgSWRtUm9sZTogdSB9O1xuICAgICAgICAgICAgfSksIHVzZXJzLm1hcChmdW5jdGlvbiAodSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IElkbVVzZXI6IHUgfTtcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgZmllbGQgaXMgdXBkYXRlZFxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqL1xuICAgIHRleHRGaWVsZFVwZGF0ZTogZnVuY3Rpb24gdGV4dEZpZWxkVXBkYXRlKHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaFRleHQ6IHZhbHVlIH0pO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5taW5DaGFycyAmJiB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPCB0aGlzLnN0YXRlLm1pbkNoYXJzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2FkQnVmZmVyZWQodmFsdWUsIDM1MCk7XG4gICAgfSxcblxuICAgIGdldFBlbmRpbmdTZWFyY2hUZXh0OiBmdW5jdGlvbiBnZXRQZW5kaW5nU2VhcmNoVGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc2VhcmNoVGV4dCB8fCBmYWxzZTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wczogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcygpIHtcbiAgICAgICAgdGhpcy5fZW1wdHlWYWx1ZUxpc3QgPSBudWxsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZWJvdW5jZWQgY2FsbCBmb3IgcmVuZGVyaW5nIHNlYXJjaFxuICAgICAqIEBwYXJhbSB2YWx1ZSB7c3RyaW5nfVxuICAgICAqIEBwYXJhbSB0aW1lb3V0IHtpbnR9XG4gICAgICovXG4gICAgbG9hZEJ1ZmZlcmVkOiBmdW5jdGlvbiBsb2FkQnVmZmVyZWQodmFsdWUsIHRpbWVvdXQpIHtcblxuICAgICAgICBpZiAoIXZhbHVlICYmIHRoaXMuX2VtcHR5VmFsdWVMaXN0KSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZGF0YVNvdXJjZTogdGhpcy5fZW1wdHlWYWx1ZUxpc3QgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBleGlzdGluZ09ubHkgPSBfcHJvcHMuZXhpc3RpbmdPbmx5O1xuICAgICAgICB2YXIgZnJlZVZhbHVlQWxsb3dlZCA9IF9wcm9wcy5mcmVlVmFsdWVBbGxvd2VkO1xuICAgICAgICB2YXIgZXhjbHVkZXMgPSBfcHJvcHMuZXhjbHVkZXM7XG5cbiAgICAgICAgX3B5ZGlvVXRpbEZ1bmMyWydkZWZhdWx0J10uYnVmZmVyQ2FsbGJhY2soJ3JlbW90ZV91c2Vyc19zZWFyY2gnLCB0aW1lb3V0LCAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgICAgICB2YXIgZXhjbHVkZWQgPSBbX3B5ZGlvMlsnZGVmYXVsdCddLmdldEluc3RhbmNlKCkudXNlci5pZCwgJ3B5ZGlvLmFub24udXNlciddO1xuICAgICAgICAgICAgdGhpcy5zdWdnZXN0aW9uTG9hZGVyKHZhbHVlLCAoZnVuY3Rpb24gKHVzZXJzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlRXhpc3RzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHVzZXJzLmZpbHRlcihmdW5jdGlvbiAodXNlck9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISh1c2VyT2JqZWN0LklkbVVzZXIgJiYgIXVzZXJPYmplY3QuSWRtVXNlci5Jc0dyb3VwICYmIGV4Y2x1ZGVkLmluZGV4T2YodXNlck9iamVjdC5JZG1Vc2VyLkxvZ2luKSA+IC0xKTtcbiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKHVzZXJPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGNsdWRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJPYmplY3QuSWRtVXNlciAmJiB1c2VyT2JqZWN0LklkbVVzZXIuSXNHcm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4Y2x1ZGVzLmZpbHRlcihmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLkdyb3VwICYmIGUuR3JvdXAuVXVpZCA9PT0gdXNlck9iamVjdC5JZG1Vc2VyLlV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlck9iamVjdC5JZG1Vc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhjbHVkZXMuZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuVXNlciAmJiBlLlVzZXIuVXVpZCA9PT0gdXNlck9iamVjdC5JZG1Vc2VyLlV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhjbHVkZXMuZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuUm9sZSAmJiBlLlJvbGUuVXVpZCA9PT0gdXNlck9iamVjdC5JZG1Sb2xlLlV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHVzZXJPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkZW50aWZpZXIgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VyT2JqZWN0LklkbVVzZXIgJiYgdXNlck9iamVjdC5JZG1Vc2VyLklzR3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIgPSB1c2VyT2JqZWN0LklkbVVzZXIuR3JvdXBMYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gdXNlck9iamVjdC5JZG1Vc2VyLkF0dHJpYnV0ZXMgJiYgdXNlck9iamVjdC5JZG1Vc2VyLkF0dHJpYnV0ZXNbXCJkaXNwbGF5TmFtZVwiXSA/IHVzZXJPYmplY3QuSWRtVXNlci5BdHRyaWJ1dGVzW1wiZGlzcGxheU5hbWVcIl0gOiBpZGVudGlmaWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiA9IFwibWRpIG1kaS1mb2xkZXItYWNjb3VudFwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJPYmplY3QuSWRtVXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllciA9IHVzZXJPYmplY3QuSWRtVXNlci5Mb2dpbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gdXNlck9iamVjdC5JZG1Vc2VyLkF0dHJpYnV0ZXMgJiYgdXNlck9iamVjdC5JZG1Vc2VyLkF0dHJpYnV0ZXNbXCJkaXNwbGF5TmFtZVwiXSA/IHVzZXJPYmplY3QuSWRtVXNlci5BdHRyaWJ1dGVzW1wiZGlzcGxheU5hbWVcIl0gOiBpZGVudGlmaWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNoYXJlZCA9IHVzZXJPYmplY3QuSWRtVXNlci5BdHRyaWJ1dGVzICYmIHVzZXJPYmplY3QuSWRtVXNlci5BdHRyaWJ1dGVzW1wicHJvZmlsZVwiXSA9PT0gXCJzaGFyZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uID0gXCJtZGkgbWRpLWFjY291bnRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiA9IFwibWRpIG1kaS1hY2NvdW50LWJveC1vdXRsaW5lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyID0gdXNlck9iamVjdC5JZG1Sb2xlLlV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IHVzZXJPYmplY3QuSWRtUm9sZS5MYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSBcIm1kaSBtZGktYWNjb3VudC1tdWx0aXBsZS1vdXRsaW5lXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWVFeGlzdHMgfD0gbGFiZWwgPT09IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTWVudUl0ZW0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlUZXh0OiBsYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRJY29uOiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5Gb250SWNvbiwgeyBjbGFzc05hbWU6IGljb24sIHN0eWxlOiB7IG1hcmdpbjogJzAgMTJweCcgfSB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJPYmplY3Q6IHVzZXJPYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpZGVudGlmaWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZW1wdHlWYWx1ZUxpc3QgPSB2YWx1ZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFwcGVuZCB0ZW1wb3JhcnkgY3JlYXRlIHVzZXJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgIXZhbHVlRXhpc3RzICYmICghZXhpc3RpbmdPbmx5IHx8IGZyZWVWYWx1ZUFsbG93ZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtID0gX3B5ZGlvMlsnZGVmYXVsdCddLmdldE1lc3NhZ2VzKClbXCI0NDhcIl0gfHwgXCJjcmVhdGVcIjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyZWF0ZUl0ZW0gPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5NZW51SXRlbSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeVRleHQ6IHZhbHVlICsgKGZyZWVWYWx1ZUFsbG93ZWQgPyAnJyA6ICcgKCcgKyBtICsgJyknKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRJY29uOiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5Gb250SWNvbiwgeyBjbGFzc05hbWU6IFwibWRpIG1kaS1hY2NvdW50LXBsdXNcIiwgc3R5bGU6IHsgbWFyZ2luOiAnMCAxMnB4JyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBbeyB0ZXh0OiB2YWx1ZSwgdmFsdWU6IGNyZWF0ZUl0ZW0gfV0uY29uY2F0KHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBkYXRhU291cmNlOiB2YWx1ZXMsIGxvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB1c2VyIHNlbGVjdHMgYSB2YWx1ZSBmcm9tIHRoZSBsaXN0XG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHBhcmFtIGluZGV4XG4gICAgICovXG4gICAgb25Db21wbGV0ZXJSZXF1ZXN0OiBmdW5jdGlvbiBvbkNvbXBsZXRlclJlcXVlc3QodmFsdWUsIGluZGV4KSB7XG4gICAgICAgIHZhciBmcmVlVmFsdWVBbGxvd2VkID0gdGhpcy5wcm9wcy5mcmVlVmFsdWVBbGxvd2VkO1xuXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuZGF0YVNvdXJjZS5tYXAoZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LnRleHQgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZW50cnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodmFsdWUgJiYgIXZhbHVlLnVzZXJPYmplY3QgJiYgdGhpcy5wcm9wcy5mcmVlVmFsdWVBbGxvd2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vblZhbHVlU2VsZWN0ZWQoeyBGcmVlVmFsdWU6IHZhbHVlLnRleHQgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaFRleHQ6ICcnLCBkYXRhU291cmNlOiBbXSB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUudXNlck9iamVjdCkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMub25WYWx1ZVNlbGVjdGVkKHZhbHVlLnVzZXJPYmplY3QpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmcmVlVmFsdWVBbGxvd2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vblZhbHVlU2VsZWN0ZWQoeyBGcmVlVmFsdWU6IHZhbHVlLnRleHQgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjcmVhdGVVc2VyOiB2YWx1ZS50ZXh0IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaFRleHQ6ICcnLCBkYXRhU291cmNlOiBbXSB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyBvblZhbHVlU2VsZWN0ZWQgcHJvcHMgY2FsbGJhY2tcbiAgICAgKiBAcGFyYW0ge1B5ZGlvLlVzZXJ9IG5ld1VzZXJcbiAgICAgKi9cbiAgICBvblVzZXJDcmVhdGVkOiBmdW5jdGlvbiBvblVzZXJDcmVhdGVkKG5ld1VzZXIpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblZhbHVlU2VsZWN0ZWQobmV3VXNlcik7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjcmVhdGVVc2VyOiBudWxsIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB1c2VyIGNyZWF0aW9uIGZvcm1cbiAgICAgKi9cbiAgICBvbkNyZWF0aW9uQ2FuY2VsbGVkOiBmdW5jdGlvbiBvbkNyZWF0aW9uQ2FuY2VsbGVkKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgY3JlYXRlVXNlcjogbnVsbCB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogT3BlbiBhZGRyZXNzIGJvb2sgaW5zaWRlIGEgUG9wb3ZlclxuICAgICAqIEBwYXJhbSBldmVudFxuICAgICAqL1xuICAgIG9wZW5BZGRyZXNzQm9vazogZnVuY3Rpb24gb3BlbkFkZHJlc3NCb29rKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYWRkcmVzc0Jvb2tPcGVuOiB0cnVlLFxuICAgICAgICAgICAgYWRkcmVzc0Jvb2tBbmNob3I6IGV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENsb3NlIGFkZHJlc3MgYm9vayBwb3BvdmVyXG4gICAgICovXG4gICAgY2xvc2VBZGRyZXNzQm9vazogZnVuY3Rpb24gY2xvc2VBZGRyZXNzQm9vaygpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGFkZHJlc3NCb29rT3BlbjogZmFsc2UgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIHVzZXIgY2xpY2tzIG9uIGFuIGVudHJ5IGZyb20gYWRyZXNzIGJvb2suXG4gICAgICogQHBhcmFtIGl0ZW1cbiAgICAgKi9cbiAgICBvbkFkZHJlc3NCb29rSXRlbVNlbGVjdGVkOiBmdW5jdGlvbiBvbkFkZHJlc3NCb29rSXRlbVNlbGVjdGVkKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblZhbHVlU2VsZWN0ZWQoaXRlbSk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgX3N0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdmFyIGRhdGFTb3VyY2UgPSBfc3RhdGUuZGF0YVNvdXJjZTtcbiAgICAgICAgdmFyIGNyZWF0ZVVzZXIgPSBfc3RhdGUuY3JlYXRlVXNlcjtcblxuICAgICAgICB2YXIgY29udGFpbmVyU3R5bGUgPSB7IHBvc2l0aW9uOiAncmVsYXRpdmUnLCBvdmVyZmxvdzogJ3Zpc2libGUnIH07XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBjb250YWluZXJTdHlsZSwgcmVmOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9wb3BvdmVyQW5jaG9yID0gZWw7XG4gICAgICAgICAgICAgICAgfSB9LFxuICAgICAgICAgICAgIWNyZWF0ZVVzZXIgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuQXV0b0NvbXBsZXRlLCB7XG4gICAgICAgICAgICAgICAgZmlsdGVyOiBfbWF0ZXJpYWxVaS5BdXRvQ29tcGxldGUubm9GaWx0ZXIsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogZGF0YVNvdXJjZSxcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXh0OiB0aGlzLnN0YXRlLnNlYXJjaFRleHQsXG4gICAgICAgICAgICAgICAgb25VcGRhdGVJbnB1dDogdGhpcy50ZXh0RmllbGRVcGRhdGUsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICBvcGVuT25Gb2N1czogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmbG9hdGluZ0xhYmVsVGV4dDogdGhpcy5wcm9wcy5maWVsZExhYmVsLFxuICAgICAgICAgICAgICAgIHVuZGVybGluZVNob3c6ICF0aGlzLnByb3BzLnVuZGVybGluZUhpZGUsXG4gICAgICAgICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgIG9uTmV3UmVxdWVzdDogdGhpcy5vbkNvbXBsZXRlclJlcXVlc3QsXG4gICAgICAgICAgICAgICAgbGlzdFN0eWxlOiB7IG1heEhlaWdodDogMzUwLCBvdmVyZmxvd1k6ICdhdXRvJyB9LFxuICAgICAgICAgICAgICAgIG9uRm9jdXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLmxvYWRCdWZmZXJlZChfdGhpczIuc3RhdGUuc2VhcmNoVGV4dCwgMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNyZWF0ZVVzZXIgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuVGV4dEZpZWxkLCB7XG4gICAgICAgICAgICAgICAgZmxvYXRpbmdMYWJlbFRleHQ6IHRoaXMucHJvcHMuZmllbGRMYWJlbCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogZ2xvYmFsLnB5ZGlvLk1lc3NhZ2VIYXNoWzQ4NV0gKyAnICgnICsgdGhpcy5zdGF0ZS5jcmVhdGVVc2VyICsgJyknLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1bmRlcmxpbmVTaG93OiAhdGhpcy5wcm9wcy51bmRlcmxpbmVIaWRlXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICFjcmVhdGVVc2VyICYmIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcG9zaXRpb246ICdhYnNvbHV0ZScsIHJpZ2h0OiA0LCBib3R0b206IDE0LCBoZWlnaHQ6IDIwLCB3aWR0aDogMjAgfSB9LFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLlJlZnJlc2hJbmRpY2F0b3IsIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogMjAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLnN0YXRlLmxvYWRpbmcgPyAnbG9hZGluZycgOiAnaGlkZSdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMucHJvcHMuc2hvd0FkZHJlc3NCb29rICYmICFjcmVhdGVVc2VyICYmIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9hZGRyZXNzYm9va0FkZHJlc3NCb29rMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgbW9kZTogJ3BvcG92ZXInLFxuICAgICAgICAgICAgICAgIHB5ZGlvOiB0aGlzLnByb3BzLnB5ZGlvLFxuICAgICAgICAgICAgICAgIGxvYWRlclN0eWxlOiB7IHdpZHRoOiAzMjAsIGhlaWdodDogNDIwIH0sXG4gICAgICAgICAgICAgICAgb25JdGVtU2VsZWN0ZWQ6IHRoaXMub25BZGRyZXNzQm9va0l0ZW1TZWxlY3RlZCxcbiAgICAgICAgICAgICAgICB1c2Vyc0Zyb206IHRoaXMucHJvcHMudXNlcnNGcm9tLFxuICAgICAgICAgICAgICAgIGRpc2FibGVTZWFyY2g6IHRydWVcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuUG9wb3ZlcixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9wZW46IGNyZWF0ZVVzZXIsXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvckVsOiB0aGlzLl9wb3BvdmVyQW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JPcmlnaW46IHsgaG9yaXpvbnRhbDogJ2xlZnQnLCB2ZXJ0aWNhbDogJ2JvdHRvbScgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6ICdsZWZ0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlOiB0aGlzLm9uQ3JlYXRpb25DYW5jZWxsZWQsXG4gICAgICAgICAgICAgICAgICAgIGNhbkF1dG9Qb3NpdGlvbjogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNyZWF0ZVVzZXIgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX1VzZXJDcmVhdGlvbkZvcm0yWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICAgICAgb25Vc2VyQ3JlYXRlZDogdGhpcy5vblVzZXJDcmVhdGVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiB0aGlzLm9uQ3JlYXRpb25DYW5jZWxsZWQuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgd2lkdGg6IDM1MCwgaGVpZ2h0OiAzMjAgfSxcbiAgICAgICAgICAgICAgICAgICAgbmV3VXNlck5hbWU6IHRoaXMuc3RhdGUuY3JlYXRlVXNlcixcbiAgICAgICAgICAgICAgICAgICAgcHlkaW86IHRoaXMucHJvcHMucHlkaW9cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxufSk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFVzZXJzTG9hZGVyO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX05lc3RlZExpc3RJdGVtID0gcmVxdWlyZSgnLi9OZXN0ZWRMaXN0SXRlbScpO1xuXG52YXIgX05lc3RlZExpc3RJdGVtMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX05lc3RlZExpc3RJdGVtKTtcblxudmFyIF9Vc2Vyc0xpc3QgPSByZXF1aXJlKCcuL1VzZXJzTGlzdCcpO1xuXG52YXIgX1VzZXJzTGlzdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Vc2Vyc0xpc3QpO1xuXG52YXIgX1JpZ2h0UGFuZWxDYXJkID0gcmVxdWlyZSgnLi9SaWdodFBhbmVsQ2FyZCcpO1xuXG52YXIgX1JpZ2h0UGFuZWxDYXJkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1JpZ2h0UGFuZWxDYXJkKTtcblxudmFyIF9TZWFyY2hQYW5lbCA9IHJlcXVpcmUoJy4vU2VhcmNoUGFuZWwnKTtcblxudmFyIF9TZWFyY2hQYW5lbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TZWFyY2hQYW5lbCk7XG5cbnZhciBfTG9hZGVycyA9IHJlcXVpcmUoJy4vTG9hZGVycycpO1xuXG52YXIgX0xvYWRlcnMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTG9hZGVycyk7XG5cbnZhciBfVGVhbUNyZWF0aW9uRm9ybSA9IHJlcXVpcmUoJy4uL1RlYW1DcmVhdGlvbkZvcm0nKTtcblxudmFyIF9UZWFtQ3JlYXRpb25Gb3JtMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1RlYW1DcmVhdGlvbkZvcm0pO1xuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvKTtcblxudmFyIF9tYXRlcmlhbFVpID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIF9tYXRlcmlhbFVpU3R5bGVzID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWkvc3R5bGVzJyk7XG5cbnZhciBfYXZhdGFyQWN0aW9uc1BhbmVsID0gcmVxdWlyZSgnLi4vYXZhdGFyL0FjdGlvbnNQYW5lbCcpO1xuXG52YXIgX2F2YXRhckFjdGlvbnNQYW5lbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hdmF0YXJBY3Rpb25zUGFuZWwpO1xuXG52YXIgX1VzZXJDcmVhdGlvbkZvcm0gPSByZXF1aXJlKCcuLi9Vc2VyQ3JlYXRpb25Gb3JtJyk7XG5cbnZhciBfVXNlckNyZWF0aW9uRm9ybTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Vc2VyQ3JlYXRpb25Gb3JtKTtcblxudmFyIF9weWRpb0h0dHBBcGkgPSByZXF1aXJlKCdweWRpby9odHRwL2FwaScpO1xuXG52YXIgX3B5ZGlvSHR0cEFwaTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb0h0dHBBcGkpO1xuXG4vKipcbiAqIEhpZ2ggbGV2ZWwgY29tcG9uZW50IHRvIGJyb3dzZSB1c2VycywgZ3JvdXBzIGFuZCB0ZWFtcywgZWl0aGVyIGluIGEgbGFyZ2UgZm9ybWF0IChtb2RlPSdib29rJykgb3IgYSBtb3JlIGNvbXBhY3RcbiAqIGZvcm1hdCAobW9kZT0nc2VsZWN0b3InfCdwb3BvdmVyJykuXG4gKiBBZGRyZXNzIGJvb2sgYWxsb3dzIHRvIGNyZWF0ZSBleHRlcm5hbCB1c2VycywgdGVhbXMsIGFuZCBhbHNvIHRvIGJyb3dzZSB0cnVzdGVkIHNlcnZlciBkaXJlY3RvcmllcyBpZiBGZWRlcmF0ZWQgU2hhcmluZ1xuICogaXMgYWN0aXZlLlxuICovXG5cbnZhciBfUHlkaW8kcmVxdWlyZUxpYiA9IF9weWRpbzJbJ2RlZmF1bHQnXS5yZXF1aXJlTGliKCdib290Jyk7XG5cbnZhciBQeWRpb0NvbnRleHRDb25zdW1lciA9IF9QeWRpbyRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xudmFyIEFkZHJlc3NCb29rID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0FkZHJlc3NCb29rJyxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICAvKipcbiAgICAgICAgICogTWFpbiBpbnN0YW5jZSBvZiBweWRpb1xuICAgICAgICAgKi9cbiAgICAgICAgcHlkaW86IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihfcHlkaW8yWydkZWZhdWx0J10pLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzcGxheSBtb2RlLCBlaXRoZXIgbGFyZ2UgKGJvb2spIG9yIHNtYWxsIHBpY2tlciAoJ3NlbGVjdG9yJywgJ3BvcG92ZXInKS5cbiAgICAgICAgICovXG4gICAgICAgIG1vZGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub25lT2YoWydib29rJywgJ3NlbGVjdG9yJywgJ3BvcG92ZXInXSkuaXNSZXF1aXJlZCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzZSBib29rIG1vZGUgYnV0IGRpc3BsYXkgYXMgY29sdW1uXG4gICAgICAgICAqL1xuICAgICAgICBib29rQ29sdW1uOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsYmFjayB0cmlnZ2VyZWQgaW4gJ3NlbGVjdG9yJyBtb2RlIHdoZW5ldmVyIGFuIGl0ZW0gaXMgY2xpY2tlZC5cbiAgICAgICAgICovXG4gICAgICAgIG9uSXRlbVNlbGVjdGVkOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNwbGF5IHVzZXJzIG9ubHksIG5vIHRlYW1zIG9yIGdyb3Vwc1xuICAgICAgICAgKi9cbiAgICAgICAgdXNlcnNPbmx5OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaG9vc2UgdmFyaW91cyB1c2VyIHNvdXJjZXMsIGVpdGhlciB0aGUgbG9jYWwgZGlyZWN0b3J5IG9yIHJlbW90ZSAoID0gdHJ1c3RlZCApIHNlcnZlcnMuXG4gICAgICAgICAqL1xuICAgICAgICB1c2Vyc0Zyb206IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub25lT2YoWydsb2NhbCcsICdyZW1vdGUnLCAnYW55J10pLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzYWJsZSB0aGUgc2VhcmNoIGVuZ2luZVxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYWJsZVNlYXJjaDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlbWUgb2JqZWN0IHBhc3NlZCBieSBtdWlUaGVtZWFibGUoKSB3cmFwcGVyXG4gICAgICAgICAqL1xuICAgICAgICBtdWlUaGVtZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaWxsIGJlIHBhc3NlZCB0byB0aGUgUG9wb3ZlciBvYmplY3RcbiAgICAgICAgICovXG4gICAgICAgIHBvcG92ZXJTdHlsZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VkIGFzIGEgYnV0dG9uIHRvIG9wZW4gdGhlIHNlbGVjdG9yIGluIGEgcG9wb3ZlclxuICAgICAgICAgKi9cbiAgICAgICAgcG9wb3ZlckJ1dHRvbjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaWxsIGJlIHBhc3NlZCB0byB0aGUgUG9wb3ZlciBjb250YWluZXIgb2JqZWN0XG4gICAgICAgICAqL1xuICAgICAgICBwb3BvdmVyQ29udGFpbmVyU3R5bGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICAvKipcbiAgICAgICAgICogV2lsbCBiZSBwYXNzZWQgdG8gdGhlIFBvcG92ZXIgSWNvbiBCdXR0b24uXG4gICAgICAgICAqL1xuICAgICAgICBwb3BvdmVySWNvbkJ1dHRvblN0eWxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdFxuICAgIH0sXG5cbiAgICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vZGU6ICdib29rJyxcbiAgICAgICAgICAgIHVzZXJzT25seTogZmFsc2UsXG4gICAgICAgICAgICB1c2Vyc0Zyb206ICdhbnknLFxuICAgICAgICAgICAgdGVhbXNPbmx5OiBmYWxzZSxcbiAgICAgICAgICAgIGRpc2FibGVTZWFyY2g6IGZhbHNlXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgcHlkaW8gPSBfcHJvcHMucHlkaW87XG4gICAgICAgIHZhciBtb2RlID0gX3Byb3BzLm1vZGU7XG4gICAgICAgIHZhciB1c2Vyc09ubHkgPSBfcHJvcHMudXNlcnNPbmx5O1xuICAgICAgICB2YXIgdXNlcnNGcm9tID0gX3Byb3BzLnVzZXJzRnJvbTtcbiAgICAgICAgdmFyIHRlYW1zT25seSA9IF9wcm9wcy50ZWFtc09ubHk7XG4gICAgICAgIHZhciBkaXNhYmxlU2VhcmNoID0gX3Byb3BzLmRpc2FibGVTZWFyY2g7XG5cbiAgICAgICAgdmFyIGdldE1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRNZXNzYWdlKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvcHMuZ2V0TWVzc2FnZShpZCwgJycpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgYXV0aENvbmZpZ3MgPSBweWRpby5nZXRQbHVnaW5Db25maWdzKCdjb3JlLmF1dGgnKTtcblxuICAgICAgICB2YXIgcm9vdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHRlYW1zT25seSkge1xuICAgICAgICAgICAgcm9vdCA9IHtcbiAgICAgICAgICAgICAgICBpZDogJ3RlYW1zJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogZ2V0TWVzc2FnZSg1NjgpLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuTG9hZGVyOiBfTG9hZGVyczJbJ2RlZmF1bHQnXS5sb2FkVGVhbXMsXG4gICAgICAgICAgICAgICAgX3BhcmVudDogbnVsbCxcbiAgICAgICAgICAgICAgICBfbm90U2VsZWN0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZWFtcycsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogJysgJyArIGdldE1lc3NhZ2UoNTY5KSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBnZXRNZXNzYWdlKDU3MCksXG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcm9vdDogcm9vdCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW06IHJvb3QsXG4gICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmlnaHRQYW5lSXRlbTogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJvb3QgPSB7XG4gICAgICAgICAgICBpZDogJ3Jvb3QnLFxuICAgICAgICAgICAgbGFiZWw6IGdldE1lc3NhZ2UoNTkyKSxcbiAgICAgICAgICAgIHR5cGU6ICdyb290JyxcbiAgICAgICAgICAgIGNvbGxlY3Rpb25zOiBbXVxuICAgICAgICB9O1xuICAgICAgICBpZiAodXNlcnNGcm9tICE9PSAncmVtb3RlJykge1xuICAgICAgICAgICAgaWYgKGF1dGhDb25maWdzLmdldCgnVVNFUl9DUkVBVEVfVVNFUlMnKSkge1xuICAgICAgICAgICAgICAgIHJvb3QuY29sbGVjdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnZXh0JyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGdldE1lc3NhZ2UoNTkzKSxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ21kaSBtZGktYWNjb3VudC1uZXR3b3JrJyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNMb2FkZXI6IF9Mb2FkZXJzMlsnZGVmYXVsdCddLmxvYWRFeHRlcm5hbFVzZXJzLFxuICAgICAgICAgICAgICAgICAgICBfcGFyZW50OiByb290LFxuICAgICAgICAgICAgICAgICAgICBfbm90U2VsZWN0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VzZXJzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogJysgJyArIGdldE1lc3NhZ2UoNDg0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZ2V0TWVzc2FnZSg1ODIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF1c2Vyc09ubHkpIHtcbiAgICAgICAgICAgICAgICByb290LmNvbGxlY3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3RlYW1zJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGdldE1lc3NhZ2UoNTY4KSxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ21kaSBtZGktYWNjb3VudC1tdWx0aXBsZScsXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuTG9hZGVyOiBfTG9hZGVyczJbJ2RlZmF1bHQnXS5sb2FkVGVhbXMsXG4gICAgICAgICAgICAgICAgICAgIF9wYXJlbnQ6IHJvb3QsXG4gICAgICAgICAgICAgICAgICAgIF9ub3RTZWxlY3RhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGVhbXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiAnKyAnICsgZ2V0TWVzc2FnZSg1NjkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBnZXRNZXNzYWdlKDU3MCksXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByb290LmNvbGxlY3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiAnUFlESU9fR1JQXy8nLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBnZXRNZXNzYWdlKDU4NCksXG4gICAgICAgICAgICAgICAgaWNvbjogJ21kaSBtZGktYWNjb3VudC1ib3gnLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuTG9hZGVyOiBfTG9hZGVyczJbJ2RlZmF1bHQnXS5sb2FkR3JvdXBzLFxuICAgICAgICAgICAgICAgIGl0ZW1zTG9hZGVyOiBfTG9hZGVyczJbJ2RlZmF1bHQnXS5sb2FkR3JvdXBVc2VycyxcbiAgICAgICAgICAgICAgICBfcGFyZW50OiByb290LFxuICAgICAgICAgICAgICAgIF9ub3RTZWxlY3RhYmxlOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvY3NSZW1vdGVzID0gcHlkaW8uZ2V0UGx1Z2luQ29uZmlncygnY29yZS5vY3MnKS5nZXQoJ1RSVVNURURfU0VSVkVSUycpO1xuICAgICAgICBpZiAob2NzUmVtb3RlcyAmJiAhdXNlcnNPbmx5ICYmIHVzZXJzRnJvbSAhPT0gJ2xvY2FsJykge1xuICAgICAgICAgICAgdmFyIHJlbW90ZXMgPSBKU09OLnBhcnNlKG9jc1JlbW90ZXMpO1xuICAgICAgICAgICAgdmFyIHJlbW90ZXNOb2RlcyA9IHtcbiAgICAgICAgICAgICAgICBpZDogJ3JlbW90ZXMnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBnZXRNZXNzYWdlKDU5NCksXG4gICAgICAgICAgICAgICAgLy9pY29uOidtZGkgbWRpLXNlcnZlcicsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbnM6IFtdLFxuICAgICAgICAgICAgICAgIF9wYXJlbnQ6IHJvb3QsXG4gICAgICAgICAgICAgICAgX25vdFNlbGVjdGFibGU6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKHZhciBrIGluIHJlbW90ZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlbW90ZXMuaGFzT3duUHJvcGVydHkoaykpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIHJlbW90ZXNOb2Rlcy5jb2xsZWN0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGssXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiByZW1vdGVzW2tdLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnbWRpIG1kaS1zZXJ2ZXItbmV0d29yaycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZW1vdGUnLFxuICAgICAgICAgICAgICAgICAgICBfcGFyZW50OiByZW1vdGVzTm9kZXMsXG4gICAgICAgICAgICAgICAgICAgIF9ub3RTZWxlY3RhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVtb3Rlc05vZGVzLmNvbGxlY3Rpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJvb3QuY29sbGVjdGlvbnMucHVzaChyZW1vdGVzTm9kZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJvb3Q6IHJvb3QsXG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW06IG1vZGUgPT09ICdzZWxlY3RvcicgPyByb290IDogcm9vdC5jb2xsZWN0aW9uc1swXSxcbiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgcmlnaHRQYW5lSXRlbTogbnVsbFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtICYmIHRoaXMub25Gb2xkZXJDbGlja2VkKHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtKTtcbiAgICB9LFxuXG4gICAgb25Gb2xkZXJDbGlja2VkOiBmdW5jdGlvbiBvbkZvbGRlckNsaWNrZWQoaXRlbSkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciB0ZWFtc1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5tb2RlID09PSAnc2VsZWN0b3InICYmIGl0ZW0uSWRtUm9sZSAmJiBpdGVtLklkbVJvbGUuSXNUZWFtKSB7XG4gICAgICAgICAgICB0aGlzLm9uVXNlckxpc3RJdGVtQ2xpY2tlZChpdGVtKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogdHJ1ZSB9KTtcblxuICAgICAgICBfTG9hZGVyczJbJ2RlZmF1bHQnXS5jaGlsZHJlbkFzUHJvbWlzZShpdGVtLCBmYWxzZSkudGhlbihmdW5jdGlvbiAoY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIF9Mb2FkZXJzMlsnZGVmYXVsdCddLmNoaWxkcmVuQXNQcm9taXNlKGl0ZW0sIHRydWUpLnRoZW4oZnVuY3Rpb24gKGNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2VsZWN0ZWRJdGVtOiBpdGVtLCBsb2FkaW5nOiBmYWxzZSB9LCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uVXNlckxpc3RJdGVtQ2xpY2tlZDogZnVuY3Rpb24gb25Vc2VyTGlzdEl0ZW1DbGlja2VkKGl0ZW0pIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25JdGVtU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHZhciB1T2JqZWN0ID0gbmV3IFB5ZGlvVXNlcnMuVXNlcihpdGVtLmlkLCBpdGVtLmxhYmVsLCBpdGVtLnR5cGUsIGl0ZW0uZ3JvdXAsIGl0ZW0uYXZhdGFyLCBpdGVtLnRlbXBvcmFyeSwgaXRlbS5leHRlcm5hbCk7XG4gICAgICAgICAgICBpZiAoaXRlbS50cnVzdGVkX3NlcnZlcl9pZCkge1xuICAgICAgICAgICAgICAgIHVPYmplY3QudHJ1c3RlZFNlcnZlcklkID0gaXRlbS50cnVzdGVkX3NlcnZlcl9pZDtcbiAgICAgICAgICAgICAgICB1T2JqZWN0LnRydXN0ZWRTZXJ2ZXJMYWJlbCA9IGl0ZW0udHJ1c3RlZF9zZXJ2ZXJfbGFiZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1T2JqZWN0Ll91dWlkID0gaXRlbS51dWlkO1xuICAgICAgICAgICAgaWYgKGl0ZW0uSWRtVXNlcikgdU9iamVjdC5JZG1Vc2VyID0gaXRlbS5JZG1Vc2VyO1xuICAgICAgICAgICAgaWYgKGl0ZW0uSWRtUm9sZSkgdU9iamVjdC5JZG1Sb2xlID0gaXRlbS5JZG1Sb2xlO1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkl0ZW1TZWxlY3RlZCh1T2JqZWN0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyByaWdodFBhbmVJdGVtOiBpdGVtIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uQ3JlYXRlQWN0aW9uOiBmdW5jdGlvbiBvbkNyZWF0ZUFjdGlvbihpdGVtKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjcmVhdGVEaWFsb2dJdGVtOiBpdGVtIH0pO1xuICAgIH0sXG5cbiAgICBjbG9zZUNyZWF0ZURpYWxvZ0FuZFJlbG9hZDogZnVuY3Rpb24gY2xvc2VDcmVhdGVEaWFsb2dBbmRSZWxvYWQoKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjcmVhdGVEaWFsb2dJdGVtOiBudWxsIH0pO1xuICAgICAgICB0aGlzLnJlbG9hZEN1cnJlbnROb2RlKCk7XG4gICAgfSxcblxuICAgIG9uQ2FyZFVwZGF0ZUFjdGlvbjogZnVuY3Rpb24gb25DYXJkVXBkYXRlQWN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaWYgKGl0ZW0uX3BhcmVudCAmJiBpdGVtLl9wYXJlbnQgPT09IHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLnJlbG9hZEN1cnJlbnROb2RlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25EZWxldGVBY3Rpb246IGZ1bmN0aW9uIG9uRGVsZXRlQWN0aW9uKHBhcmVudEl0ZW0sIHNlbGVjdGlvbikge1xuICAgICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgICB2YXIgc2tpcENvbmZpcm0gPSBhcmd1bWVudHMubGVuZ3RoIDw9IDIgfHwgYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1syXTtcblxuICAgICAgICBpZiAoIXNraXBDb25maXJtICYmICFjb25maXJtKHRoaXMucHJvcHMuZ2V0TWVzc2FnZSgyNzgpKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAocGFyZW50SXRlbS5hY3Rpb25zLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3VzZXJzJzpcbiAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChzZWxlY3Rpb24ubWFwKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczMuc3RhdGUucmlnaHRQYW5lSXRlbSA9PT0gdXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnNldFN0YXRlKHsgcmlnaHRQYW5lSXRlbTogbnVsbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRSZXN0Q2xpZW50KCkuZ2V0SWRtQXBpKCkuZGVsZXRlSWRtVXNlcih1c2VyLklkbVVzZXIpO1xuICAgICAgICAgICAgICAgIH0pKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnJlbG9hZEN1cnJlbnROb2RlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZWFtcyc6XG4gICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoc2VsZWN0aW9uLm1hcChmdW5jdGlvbiAodGVhbSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMzLnN0YXRlLnJpZ2h0UGFuZUl0ZW0gPT09IHRlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7IHJpZ2h0UGFuZUl0ZW06IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9weWRpb0h0dHBBcGkyWydkZWZhdWx0J10uZ2V0UmVzdENsaWVudCgpLmdldElkbUFwaSgpLmRlbGV0ZVJvbGUodGVhbS5JZG1Sb2xlLlV1aWQpO1xuICAgICAgICAgICAgICAgIH0pKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnJlbG9hZEN1cnJlbnROb2RlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZWFtJzpcbiAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChzZWxlY3Rpb24ubWFwKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfcHlkaW9IdHRwQXBpMlsnZGVmYXVsdCddLmdldFJlc3RDbGllbnQoKS5nZXRJZG1BcGkoKS5yZW1vdmVVc2VyRnJvbVRlYW0ocGFyZW50SXRlbS5JZG1Sb2xlLlV1aWQsIHVzZXIuSWRtVXNlci5Mb2dpbik7XG4gICAgICAgICAgICAgICAgfSkpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpczMucmVsb2FkQ3VycmVudE5vZGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb3BlblBvcG92ZXI6IGZ1bmN0aW9uIG9wZW5Qb3BvdmVyKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcG9wb3Zlck9wZW46IHRydWUsXG4gICAgICAgICAgICBwb3BvdmVyQW5jaG9yOiBldmVudC5jdXJyZW50VGFyZ2V0XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjbG9zZVBvcG92ZXI6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBvcG92ZXJPcGVuOiBmYWxzZSB9KTtcbiAgICB9LFxuXG4gICAgcmVsb2FkQ3VycmVudE5vZGU6IGZ1bmN0aW9uIHJlbG9hZEN1cnJlbnROb2RlKCkge1xuICAgICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5sZWFmTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtLmNvbGxlY3Rpb25zTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25Gb2xkZXJDbGlja2VkKHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXM0LnN0YXRlLnJpZ2h0UGFuZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgclBhbmVJZCA9IF90aGlzNC5zdGF0ZS5yaWdodFBhbmVJdGVtLmlkO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmRJdGVtID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlYWZzID0gX3RoaXM0LnN0YXRlLnNlbGVjdGVkSXRlbS5sZWFmcyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb25zID0gX3RoaXM0LnN0YXRlLnNlbGVjdGVkSXRlbS5jb2xsZWN0aW9ucyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgW10uY29uY2F0KGxlYWZzLCBjb2xsZWN0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAobGVhZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlYWYuaWQgPT09IHJQYW5lSWQpIGZvdW5kSXRlbSA9IGxlYWY7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBfdGhpczQuc2V0U3RhdGUoeyByaWdodFBhbmVJdGVtOiBmb3VuZEl0ZW0gfSk7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHJlbG9hZEN1cnJlbnRBdFBhZ2U6IGZ1bmN0aW9uIHJlbG9hZEN1cnJlbnRBdFBhZ2UobGV0dGVyT3JSYW5nZSkge1xuICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5sZWFmTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtLmNvbGxlY3Rpb25zTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIGlmIChsZXR0ZXJPclJhbmdlID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZEl0ZW0uY3VycmVudFBhcmFtcyA9IG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAobGV0dGVyT3JSYW5nZS5pbmRleE9mKCctJykgIT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5yYW5nZSA9IGxldHRlck9yUmFuZ2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5yYW5nZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5jdXJyZW50UGFyYW1zID0geyBhbHBoYV9wYWdlczogJ3RydWUnLCB2YWx1ZTogbGV0dGVyT3JSYW5nZSB9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25Gb2xkZXJDbGlja2VkKHRoaXMuc3RhdGUuc2VsZWN0ZWRJdGVtKTtcbiAgICB9LFxuXG4gICAgcmVsb2FkQ3VycmVudFdpdGhTZWFyY2g6IGZ1bmN0aW9uIHJlbG9hZEN1cnJlbnRXaXRoU2VhcmNoKHZhbHVlKSB7XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMucmVsb2FkQ3VycmVudEF0UGFnZSgtMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZEl0ZW0ubGVhZkxvYWRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5jb2xsZWN0aW9uc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkSXRlbS5jdXJyZW50UGFyYW1zID0geyBoYXNfc2VhcmNoOiB0cnVlLCB2YWx1ZTogdmFsdWUsIGV4aXN0aW5nX29ubHk6IHRydWUgfTtcbiAgICAgICAgdGhpcy5vbkZvbGRlckNsaWNrZWQodGhpcy5zdGF0ZS5zZWxlY3RlZEl0ZW0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzNSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIF9wcm9wczIgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgbW9kZSA9IF9wcm9wczIubW9kZTtcbiAgICAgICAgdmFyIGdldE1lc3NhZ2UgPSBfcHJvcHMyLmdldE1lc3NhZ2U7XG4gICAgICAgIHZhciBib29rQ29sdW1uID0gX3Byb3BzMi5ib29rQ29sdW1uO1xuXG4gICAgICAgIGlmIChtb2RlID09PSAncG9wb3ZlcicpIHtcblxuICAgICAgICAgICAgdmFyIHBvcG92ZXJTdHlsZSA9IHRoaXMucHJvcHMucG9wb3ZlclN0eWxlIHx8IHt9O1xuICAgICAgICAgICAgdmFyIHBvcG92ZXJDb250YWluZXJTdHlsZSA9IHRoaXMucHJvcHMucG9wb3ZlckNvbnRhaW5lclN0eWxlIHx8IHt9O1xuICAgICAgICAgICAgdmFyIGljb25CdXR0b25TdHlsZSA9IHRoaXMucHJvcHMucG9wb3Zlckljb25CdXR0b25TdHlsZSB8fCB7fTtcbiAgICAgICAgICAgIHZhciBpY29uQnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuSWNvbkJ1dHRvbiwge1xuICAgICAgICAgICAgICAgIHN0eWxlOiBfZXh0ZW5kcyh7IHBvc2l0aW9uOiAnYWJzb2x1dGUnLCBwYWRkaW5nOiAxNSwgekluZGV4OiAxMDAsIHJpZ2h0OiAwLCB0b3A6IDI1LCBkaXNwbGF5OiB0aGlzLnN0YXRlLmxvYWRpbmcgPyAnbm9uZScgOiAnaW5pdGlhbCcgfSwgaWNvbkJ1dHRvblN0eWxlKSxcbiAgICAgICAgICAgICAgICBpY29uU3R5bGU6IHsgZm9udFNpemU6IDE5LCBjb2xvcjogJ3JnYmEoMCwwLDAsMC42KScgfSxcbiAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiAnbWRpIG1kaS1ib29rLW9wZW4tdmFyaWFudCcsXG4gICAgICAgICAgICAgICAgb25Ub3VjaFRhcDogdGhpcy5vcGVuUG9wb3ZlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5wb3BvdmVyQnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgaWNvbkJ1dHRvbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KHRoaXMucHJvcHMucG9wb3ZlckJ1dHRvbi50eXBlLCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcy5wb3BvdmVyQnV0dG9uLnByb3BzLCB7IG9uVG91Y2hUYXA6IHRoaXMub3BlblBvcG92ZXIgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIGljb25CdXR0b24sXG4gICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlBvcG92ZXIsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW46IHRoaXMuc3RhdGUucG9wb3Zlck9wZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogdGhpcy5zdGF0ZS5wb3BvdmVyQW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yT3JpZ2luOiB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6ICdsZWZ0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvblJlcXVlc3RDbG9zZTogdGhpcy5jbG9zZVBvcG92ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogX2V4dGVuZHMoeyBtYXJnaW5MZWZ0OiAyMCB9LCBwb3BvdmVyU3R5bGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgekRlcHRoOiAyXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiBfZXh0ZW5kcyh7IHdpZHRoOiAzMjAsIGhlaWdodDogNDIwIH0sIHBvcG92ZXJDb250YWluZXJTdHlsZSkgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KEFkZHJlc3NCb29rLCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywgeyBtb2RlOiAnc2VsZWN0b3InIH0pKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBfc3RhdGUgPSB0aGlzLnN0YXRlO1xuICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gX3N0YXRlLnNlbGVjdGVkSXRlbTtcbiAgICAgICAgdmFyIHJvb3QgPSBfc3RhdGUucm9vdDtcbiAgICAgICAgdmFyIHJpZ2h0UGFuZUl0ZW0gPSBfc3RhdGUucmlnaHRQYW5lSXRlbTtcbiAgICAgICAgdmFyIGNyZWF0ZURpYWxvZ0l0ZW0gPSBfc3RhdGUuY3JlYXRlRGlhbG9nSXRlbTtcblxuICAgICAgICB2YXIgbGVmdENvbHVtblN0eWxlID0ge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBfbWF0ZXJpYWxVaVN0eWxlcy5jb2xvcnMuZ3JleTEwMCxcbiAgICAgICAgICAgIHdpZHRoOiAyNTYsXG4gICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgICAgICAgIG92ZXJmbG93WDogJ2hpZGRlbidcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGNlbnRlckNvbXBvbmVudCA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHJpZ2h0UGFuZWwgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBsZWZ0UGFuZWwgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICB0b3BBY3Rpb25zUGFuZWwgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBvbkVkaXRMYWJlbCA9IHVuZGVmaW5lZDtcblxuICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtLmlkID09PSAnc2VhcmNoJykge1xuXG4gICAgICAgICAgICBjZW50ZXJDb21wb25lbnQgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfU2VhcmNoUGFuZWwyWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICBpdGVtOiBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldE1lc3NhZ2UoNTgzLCAnJyksXG4gICAgICAgICAgICAgICAgc2VhcmNoTGFiZWw6IGdldE1lc3NhZ2UoNTk1LCAnJyksXG4gICAgICAgICAgICAgICAgb25JdGVtQ2xpY2tlZDogdGhpcy5vblVzZXJMaXN0SXRlbUNsaWNrZWQsXG4gICAgICAgICAgICAgICAgb25Gb2xkZXJDbGlja2VkOiB0aGlzLm9uRm9sZGVyQ2xpY2tlZCxcbiAgICAgICAgICAgICAgICBtb2RlOiBtb2RlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RlZEl0ZW0udHlwZSA9PT0gJ3JlbW90ZScpIHtcblxuICAgICAgICAgICAgY2VudGVyQ29tcG9uZW50ID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX1NlYXJjaFBhbmVsMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgaXRlbTogc2VsZWN0ZWRJdGVtLFxuICAgICAgICAgICAgICAgIHBhcmFtczogeyB0cnVzdGVkX3NlcnZlcl9pZDogc2VsZWN0ZWRJdGVtLmlkIH0sXG4gICAgICAgICAgICAgICAgc2VhcmNoTGFiZWw6IGdldE1lc3NhZ2UoNTk1LCAnJyksXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldE1lc3NhZ2UoNTk2LCAnJykucmVwbGFjZSgnJXMnLCBzZWxlY3RlZEl0ZW0ubGFiZWwpLFxuICAgICAgICAgICAgICAgIG9uSXRlbUNsaWNrZWQ6IHRoaXMub25Vc2VyTGlzdEl0ZW1DbGlja2VkLFxuICAgICAgICAgICAgICAgIG9uRm9sZGVyQ2xpY2tlZDogdGhpcy5vbkZvbGRlckNsaWNrZWQsXG4gICAgICAgICAgICAgICAgbW9kZTogbW9kZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHZhciBlbXB0eVN0YXRlUHJpbWFyeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHZhciBlbXB0eVN0YXRlU2Vjb25kYXJ5ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIG90aGVyUHJvcHMgPSB7fTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0uaWQgPT09ICd0ZWFtcycpIHtcbiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlUHJpbWFyeSA9IGdldE1lc3NhZ2UoNTcxLCAnJyk7XG4gICAgICAgICAgICAgICAgZW1wdHlTdGF0ZVNlY29uZGFyeSA9IGdldE1lc3NhZ2UoNTcyLCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkSXRlbS5pZCA9PT0gJ2V4dCcpIHtcbiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlUHJpbWFyeSA9IGdldE1lc3NhZ2UoNTg1LCAnJyk7XG4gICAgICAgICAgICAgICAgZW1wdHlTdGF0ZVNlY29uZGFyeSA9IGdldE1lc3NhZ2UoNTg2LCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkSXRlbS5JZG1Vc2VyICYmIHNlbGVjdGVkSXRlbS5JZG1Vc2VyLklzR3JvdXAgfHwgc2VsZWN0ZWRJdGVtLmlkID09PSAnUFlESU9fR1JQXy8nKSB7XG4gICAgICAgICAgICAgICAgb3RoZXJQcm9wcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc2hvd1N1YmhlYWRlcnM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRvclR5cGU6ICEoc2VsZWN0ZWRJdGVtLmN1cnJlbnRQYXJhbXMgJiYgc2VsZWN0ZWRJdGVtLmN1cnJlbnRQYXJhbXMuaGFzX3NlYXJjaCkgJiYgJ2FscGhhJyxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdG9yQ2FsbGJhY2s6IHRoaXMucmVsb2FkQ3VycmVudEF0UGFnZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVTZWFyY2g6ICF0aGlzLnByb3BzLmRpc2FibGVTZWFyY2gsXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaExhYmVsOiBnZXRNZXNzYWdlKDU5NSwgJycpLFxuICAgICAgICAgICAgICAgICAgICBvblNlYXJjaDogdGhpcy5yZWxvYWRDdXJyZW50V2l0aFNlYXJjaC5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKChtb2RlID09PSAnYm9vaycgfHwgYm9va0NvbHVtbikgJiYgc2VsZWN0ZWRJdGVtLklkbVJvbGUgJiYgc2VsZWN0ZWRJdGVtLklkbVJvbGUuSXNUZWFtKSB7XG4gICAgICAgICAgICAgICAgdG9wQWN0aW9uc1BhbmVsID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX2F2YXRhckFjdGlvbnNQYW5lbDJbJ2RlZmF1bHQnXSwgX2V4dGVuZHMoe30sIHRoaXMucHJvcHMsIHtcbiAgICAgICAgICAgICAgICAgICAgdGVhbTogc2VsZWN0ZWRJdGVtLFxuICAgICAgICAgICAgICAgICAgICB1c2VyRWRpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZEFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LnJlbG9hZEN1cnJlbnROb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybShfdGhpczUucHJvcHMuZ2V0TWVzc2FnZSgyNzgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBzZWxlY3RlZEl0ZW0uX3BhcmVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsgc2VsZWN0ZWRJdGVtOiBwYXJlbnQgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1Lm9uRGVsZXRlQWN0aW9uKHBhcmVudCwgW3NlbGVjdGVkSXRlbV0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsIGJvcmRlclRvcDogMCwgYm9yZGVyQm90dG9tOiAwIH1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgb25FZGl0TGFiZWwgPSBmdW5jdGlvbiAoaXRlbSwgbmV3TGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRSZXN0Q2xpZW50KCkuZ2V0SWRtQXBpKCkudXBkYXRlVGVhbUxhYmVsKGl0ZW0uSWRtUm9sZS5VdWlkLCBuZXdMYWJlbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHNlbGVjdGVkSXRlbS5fcGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsgc2VsZWN0ZWRJdGVtOiBwYXJlbnQgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS5yZWxvYWRDdXJyZW50Tm9kZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNlbnRlckNvbXBvbmVudCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9Vc2Vyc0xpc3QyWydkZWZhdWx0J10sIF9leHRlbmRzKHtcbiAgICAgICAgICAgICAgICBpdGVtOiBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICAgICAgb25JdGVtQ2xpY2tlZDogdGhpcy5vblVzZXJMaXN0SXRlbUNsaWNrZWQsXG4gICAgICAgICAgICAgICAgb25Gb2xkZXJDbGlja2VkOiB0aGlzLm9uRm9sZGVyQ2xpY2tlZCxcbiAgICAgICAgICAgICAgICBvbkNyZWF0ZUFjdGlvbjogdGhpcy5vbkNyZWF0ZUFjdGlvbixcbiAgICAgICAgICAgICAgICBvbkRlbGV0ZUFjdGlvbjogdGhpcy5vbkRlbGV0ZUFjdGlvbixcbiAgICAgICAgICAgICAgICByZWxvYWRBY3Rpb246IHRoaXMucmVsb2FkQ3VycmVudE5vZGUuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkVkaXRMYWJlbDogb25FZGl0TGFiZWwsXG4gICAgICAgICAgICAgICAgbG9hZGluZzogdGhpcy5zdGF0ZS5sb2FkaW5nLFxuICAgICAgICAgICAgICAgIG1vZGU6IG1vZGUsXG4gICAgICAgICAgICAgICAgYm9va0NvbHVtbjogYm9va0NvbHVtbixcbiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlUHJpbWFyeVRleHQ6IGVtcHR5U3RhdGVQcmltYXJ5LFxuICAgICAgICAgICAgICAgIGVtcHR5U3RhdGVTZWNvbmRhcnlUZXh0OiBlbXB0eVN0YXRlU2Vjb25kYXJ5LFxuICAgICAgICAgICAgICAgIG9uVG91Y2hUYXA6IHRoaXMuc3RhdGUucmlnaHRQYW5lSXRlbSA/IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsgcmlnaHRQYW5lSXRlbTogbnVsbCB9KTtcbiAgICAgICAgICAgICAgICB9IDogbnVsbCxcbiAgICAgICAgICAgICAgICBhY3Rpb25zUGFuZWw6IHRvcEFjdGlvbnNQYW5lbCxcbiAgICAgICAgICAgICAgICBhY3Rpb25zRm9yQ2VsbDogdGhpcy5wcm9wcy5hY3Rpb25zRm9yQ2VsbFxuICAgICAgICAgICAgfSwgb3RoZXJQcm9wcykpO1xuICAgICAgICB9XG4gICAgICAgIHZhciByaWdodFBhbmVsU3R5bGUgPSBfZXh0ZW5kcyh7fSwgbGVmdENvbHVtblN0eWxlLCB7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJ3JpZ2h0JyxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3doaXRlJyxcbiAgICAgICAgICAgIHJpZ2h0OiA4LFxuICAgICAgICAgICAgYm90dG9tOiA4LFxuICAgICAgICAgICAgdG9wOiAxMjAsXG4gICAgICAgICAgICB6SW5kZXg6IDJcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghcmlnaHRQYW5lSXRlbSkge1xuICAgICAgICAgICAgcmlnaHRQYW5lbFN0eWxlID0gX2V4dGVuZHMoe30sIHJpZ2h0UGFuZWxTdHlsZSwge1xuICAgICAgICAgICAgICAgIC8vdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgyNTZweCknLFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlKDApJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgd2lkdGg6IDBcbiAgICAgICAgcmlnaHRQYW5lbCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9SaWdodFBhbmVsQ2FyZDJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgcHlkaW86IHRoaXMucHJvcHMucHlkaW8sXG4gICAgICAgICAgICBvblJlcXVlc3RDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7IHJpZ2h0UGFuZUl0ZW06IG51bGwgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3R5bGU6IHJpZ2h0UGFuZWxTdHlsZSxcbiAgICAgICAgICAgIG9uQ3JlYXRlQWN0aW9uOiB0aGlzLm9uQ3JlYXRlQWN0aW9uLFxuICAgICAgICAgICAgb25EZWxldGVBY3Rpb246IHRoaXMub25EZWxldGVBY3Rpb24sXG4gICAgICAgICAgICBvblVwZGF0ZUFjdGlvbjogdGhpcy5vbkNhcmRVcGRhdGVBY3Rpb24sXG4gICAgICAgICAgICBpdGVtOiByaWdodFBhbmVJdGVtIH0pO1xuICAgICAgICBpZiAobW9kZSA9PT0gJ2Jvb2snKSB7XG4gICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXN0ZWRSb290cyA9IFtdO1xuICAgICAgICAgICAgICAgIHJvb3QuY29sbGVjdGlvbnMubWFwKChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBuZXN0ZWRSb290cy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9OZXN0ZWRMaXN0SXRlbTJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHNlbGVjdGVkSXRlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RlZExldmVsOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW50cnk6IGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiB0aGlzLm9uRm9sZGVyQ2xpY2tlZFxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIG5lc3RlZFJvb3RzLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRGl2aWRlciwgeyBrZXk6IGUuaWQgKyAnLWRpdmlkZXInIH0pKTtcbiAgICAgICAgICAgICAgICB9KS5iaW5kKF90aGlzNSkpO1xuICAgICAgICAgICAgICAgIG5lc3RlZFJvb3RzLnBvcCgpO1xuICAgICAgICAgICAgICAgIGxlZnRQYW5lbCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICBNYXRlcmlhbFVJLlBhcGVyLFxuICAgICAgICAgICAgICAgICAgICB7IHpEZXB0aDogMSwgc3R5bGU6IF9leHRlbmRzKHt9LCBsZWZ0Q29sdW1uU3R5bGUsIHsgekluZGV4OiAyIH0pIH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0ZXJpYWxVSS5MaXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RlZFJvb3RzXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkaWFsb2dUaXRsZSA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRpYWxvZ0NvbnRlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChjcmVhdGVEaWFsb2dJdGVtKSB7XG4gICAgICAgICAgICBpZiAoY3JlYXRlRGlhbG9nSXRlbS5hY3Rpb25zLnR5cGUgPT09ICd1c2VycycpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dUaXRsZSA9IGdldE1lc3NhZ2UoNDg0LCAnJyk7XG4gICAgICAgICAgICAgICAgZGlhbG9nQ29udGVudCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBoZWlnaHQ6IDUwMCB9IH0sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9Vc2VyQ3JlYXRpb25Gb3JtMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB6RGVwdGg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogeyBoZWlnaHQ6IDUwMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlck5hbWU6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvblVzZXJDcmVhdGVkOiB0aGlzLmNsb3NlQ3JlYXRlRGlhbG9nQW5kUmVsb2FkLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7IGNyZWF0ZURpYWxvZ0l0ZW06IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHlkaW86IHRoaXMucHJvcHMucHlkaW9cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjcmVhdGVEaWFsb2dJdGVtLmFjdGlvbnMudHlwZSA9PT0gJ3RlYW1zJykge1xuICAgICAgICAgICAgICAgIGRpYWxvZ1RpdGxlID0gZ2V0TWVzc2FnZSg1NjksICcnKTtcbiAgICAgICAgICAgICAgICBkaWFsb2dDb250ZW50ID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX1RlYW1DcmVhdGlvbkZvcm0yWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICAgICAgb25UZWFtQ3JlYXRlZDogdGhpcy5jbG9zZUNyZWF0ZURpYWxvZ0FuZFJlbG9hZCxcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7IGNyZWF0ZURpYWxvZ0l0ZW06IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3JlYXRlRGlhbG9nSXRlbS5hY3Rpb25zLnR5cGUgPT09ICd0ZWFtJykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RVc2VyID0gZnVuY3Rpb24gc2VsZWN0VXNlcihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIF9weWRpb0h0dHBBcGkyWydkZWZhdWx0J10uZ2V0UmVzdENsaWVudCgpLmdldElkbUFwaSgpLmFkZFVzZXJUb1RlYW0oY3JlYXRlRGlhbG9nSXRlbS5JZG1Sb2xlLlV1aWQsIGl0ZW0uSWRtVXNlci5Mb2dpbikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpczUucmVsb2FkQ3VycmVudE5vZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkaWFsb2dUaXRsZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZGlhbG9nQ29udGVudCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KEFkZHJlc3NCb29rLCB7XG4gICAgICAgICAgICAgICAgICAgIHB5ZGlvOiB0aGlzLnByb3BzLnB5ZGlvLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnc2VsZWN0b3InLFxuICAgICAgICAgICAgICAgICAgICB1c2Vyc09ubHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVTZWFyY2g6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9uSXRlbVNlbGVjdGVkOiBzZWxlY3RVc2VyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc3R5bGUgPSB0aGlzLnByb3BzLnN0eWxlIHx8IHt9O1xuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgc3R5bGU6IF9leHRlbmRzKHsgZGlzcGxheTogJ2ZsZXgnLCBoZWlnaHQ6IG1vZGUgPT09ICdzZWxlY3RvcicgPyA0MjAgOiA0NTAgfSwgc3R5bGUpIH0sXG4gICAgICAgICAgICBsZWZ0UGFuZWwsXG4gICAgICAgICAgICBjZW50ZXJDb21wb25lbnQsXG4gICAgICAgICAgICByaWdodFBhbmVsLFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxVSS5EaWFsb2csXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50U3R5bGU6IHsgd2lkdGg6IDM4MCwgbWluV2lkdGg6IDM4MCwgbWF4V2lkdGg6IDM4MCwgcGFkZGluZzogMCB9LFxuICAgICAgICAgICAgICAgICAgICBib2R5U3R5bGU6IHsgcGFkZGluZzogMCB9LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcGFkZGluZzogMjAgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nVGl0bGVcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uczogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBvcGVuOiBjcmVhdGVEaWFsb2dJdGVtID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBvblJlcXVlc3RDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsgY3JlYXRlRGlhbG9nSXRlbTogbnVsbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlhbG9nQ29udGVudFxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxufSk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEFkZHJlc3NCb29rID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoQWRkcmVzc0Jvb2spO1xuZXhwb3J0c1snZGVmYXVsdCddID0gQWRkcmVzc0Jvb2sgPSBfbWF0ZXJpYWxVaVN0eWxlcy5tdWlUaGVtZWFibGUoKShBZGRyZXNzQm9vayk7XG5leHBvcnRzWydkZWZhdWx0J10gPSBBZGRyZXNzQm9vaztcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgX21hdGVyaWFsVWlTdHlsZXMgPSByZXF1aXJlKCdtYXRlcmlhbC11aS9zdHlsZXMnKTtcblxudmFyIF9weWRpbyA9IHJlcXVpcmUoJ3B5ZGlvJyk7XG5cbnZhciBfcHlkaW8yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW8pO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG4vKipcbiAqIEFscGhhYmV0IGFuZCBwYWdlcyBnZW5lcmF0b3IgdG8gZ2l2ZSBhIGZpcnN0LWxldHRlci1iYXNlZCBwYWdpbmF0aW9uXG4gKi9cblxudmFyIF9QeWRpbyRyZXF1aXJlTGliID0gX3B5ZGlvMlsnZGVmYXVsdCddLnJlcXVpcmVMaWIoJ2Jvb3QnKTtcblxudmFyIFB5ZGlvQ29udGV4dENvbnN1bWVyID0gX1B5ZGlvJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG5cbnZhciBBbHBoYVBhZ2luYXRvciA9IChmdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhBbHBoYVBhZ2luYXRvciwgX0NvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBBbHBoYVBhZ2luYXRvcigpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFscGhhUGFnaW5hdG9yKTtcblxuICAgICAgICBfQ29tcG9uZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgQWxwaGFQYWdpbmF0b3IucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgICAgICB2YXIgbGV0dGVycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknLnNwbGl0KCcnKTtcbiAgICAgICAgbGV0dGVycyA9IFstMV0uY29uY2F0KGxldHRlcnMpO1xuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIGl0ZW0gPSBfcHJvcHMuaXRlbTtcbiAgICAgICAgdmFyIHBhZ2luYXRvckNhbGxiYWNrID0gX3Byb3BzLnBhZ2luYXRvckNhbGxiYWNrO1xuICAgICAgICB2YXIgc3R5bGUgPSBfcHJvcHMuc3R5bGU7XG4gICAgICAgIHZhciBnZXRNZXNzYWdlID0gX3Byb3BzLmdldE1lc3NhZ2U7XG5cbiAgICAgICAgdmFyIHBhZ2luYXRvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGl0ZW0ucGFnaW5hdGlvbikge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2l0ZW0kcGFnaW5hdGlvbiA9IGl0ZW0ucGFnaW5hdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSBfaXRlbSRwYWdpbmF0aW9uLnN0YXJ0O1xuICAgICAgICAgICAgICAgIHZhciBlbmQgPSBfaXRlbSRwYWdpbmF0aW9uLmVuZDtcbiAgICAgICAgICAgICAgICB2YXIgbWF4ID0gX2l0ZW0kcGFnaW5hdGlvbi5tYXg7XG4gICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gX2l0ZW0kcGFnaW5hdGlvbi5pbnRlcnZhbDtcblxuICAgICAgICAgICAgICAgIHZhciB0b3RhbF9wYWdlcyA9IE1hdGguY2VpbChtYXggLyBpbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBNYXRoLmNlaWwoc3RhcnQgLyBpbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VzID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3RhbF9wYWdlczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgfXBhZ2luYXRvciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlNlbGVjdEZpZWxkLFxuICAgICAgICAgICAgICAgICAgICB7IGZsb2F0aW5nTGFiZWxUZXh0OiBnZXRNZXNzYWdlKDMzMSksIHN0eWxlOiB7IHdpZHRoOiA2MCB9LCBmdWxsV2lkdGg6IHRydWUsIHZhbHVlOiBjdXJyZW50LCBvbkNoYW5nZTogZnVuY3Rpb24gKGUsIGksIHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0b3JDYWxsYmFjayh2ICogaW50ZXJ2YWwgKyAnLScgKyAodiArIDEpICogaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSB9LFxuICAgICAgICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLk1lbnVJdGVtLCB7IHZhbHVlOiBwLCBrZXk6IHAsIHByaW1hcnlUZXh0OiBwICsgMSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjdXJyZW50UGFnZSA9IGl0ZW0uY3VycmVudFBhcmFtcyAmJiBpdGVtLmN1cnJlbnRQYXJhbXMuYWxwaGFfcGFnZXMgJiYgaXRlbS5jdXJyZW50UGFyYW1zLnZhbHVlIHx8IC0xO1xuXG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBfZXh0ZW5kcyh7fSwgc3R5bGUsIHsgZGlzcGxheTogJ2ZsZXgnLCBwYWRkaW5nUmlnaHQ6IDgsIGFsaWduSXRlbXM6ICdjZW50ZXInIH0pIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgZmxleDogMSB9IH0sXG4gICAgICAgICAgICAgICAgZ2V0TWVzc2FnZSgyNDksICcnKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHBhZ2luYXRvcixcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuU2VsZWN0RmllbGQsXG4gICAgICAgICAgICAgICAgeyBmbG9hdGluZ0xhYmVsVGV4dDogZ2V0TWVzc2FnZSg2MjUpLCBzdHlsZTogeyB3aWR0aDogNjAsIG1hcmdpbkxlZnQ6IDIwIH0sIGZ1bGxXaWR0aDogdHJ1ZSwgdmFsdWU6IGN1cnJlbnRQYWdlLCBvbkNoYW5nZTogZnVuY3Rpb24gKGUsIGksIHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRvckNhbGxiYWNrKHYpO1xuICAgICAgICAgICAgICAgICAgICB9IH0sXG4gICAgICAgICAgICAgICAgbGV0dGVycy5tYXAoZnVuY3Rpb24gKGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTWVudUl0ZW0sIHsgdmFsdWU6IGwsIGtleTogbCwgcHJpbWFyeVRleHQ6IGwgPT09IC0xID8gZ2V0TWVzc2FnZSg1OTcsICcnKSA6IGwgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEFscGhhUGFnaW5hdG9yO1xufSkoX3JlYWN0LkNvbXBvbmVudCk7XG5cbkFscGhhUGFnaW5hdG9yLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBDdXJyZW50bHkgc2VsZWN0ZWQgSXRlbVxuICAgICAqL1xuICAgIGl0ZW06IF9yZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIFdoZW4gYSBsZXR0ZXIgaXMgY2xpY2tlZCwgZnVuY3Rpb24obGV0dGVyKVxuICAgICAqL1xuICAgIHBhZ2luYXRvckNhbGxiYWNrOiBfcmVhY3QuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAvKipcbiAgICAgKiBNYWluIGluc3RhbmNlIG9mIHB5ZGlvXG4gICAgICovXG4gICAgcHlkaW86IF9yZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihfcHlkaW8yWydkZWZhdWx0J10pLFxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgbW9kZSwgZWl0aGVyIGxhcmdlIChib29rKSBvciBzbWFsbCBwaWNrZXIgKCdzZWxlY3RvcicsICdwb3BvdmVyJykuXG4gICAgICovXG4gICAgbW9kZTogX3JlYWN0LlByb3BUeXBlcy5vbmVPZihbJ2Jvb2snLCAnc2VsZWN0b3InLCAncG9wb3ZlciddKS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBBbHBoYVBhZ2luYXRvciA9IFB5ZGlvQ29udGV4dENvbnN1bWVyKEFscGhhUGFnaW5hdG9yKTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEFscGhhUGFnaW5hdG9yID0gX21hdGVyaWFsVWlTdHlsZXMubXVpVGhlbWVhYmxlKCkoQWxwaGFQYWdpbmF0b3IpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBBbHBoYVBhZ2luYXRvcjtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG52YXIgX3B5ZGlvSHR0cEFwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvYXBpJyk7XG5cbnZhciBfcHlkaW9IdHRwQXBpMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvSHR0cEFwaSk7XG5cbnZhciBfcHlkaW9VdGlsTGFuZyA9IHJlcXVpcmUoJ3B5ZGlvL3V0aWwvbGFuZycpO1xuXG52YXIgX3B5ZGlvVXRpbExhbmcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9VdGlsTGFuZyk7XG5cbnZhciBJZG1BcGkgPSBfcHlkaW9IdHRwQXBpMlsnZGVmYXVsdCddLmdldFJlc3RDbGllbnQoKS5nZXRJZG1BcGkoKTtcblxudmFyIExvYWRlcnMgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIExvYWRlcnMoKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMb2FkZXJzKTtcbiAgICB9XG5cbiAgICBMb2FkZXJzLmNoaWxkcmVuQXNQcm9taXNlID0gZnVuY3Rpb24gY2hpbGRyZW5Bc1Byb21pc2UoaXRlbSkge1xuICAgICAgICB2YXIgbGVhZiA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzFdO1xuICAgICAgICB2YXIgY2hpbGRyZW5Mb2FkZXIgPSBpdGVtLmNoaWxkcmVuTG9hZGVyO1xuICAgICAgICB2YXIgaXRlbXNMb2FkZXIgPSBpdGVtLml0ZW1zTG9hZGVyO1xuICAgICAgICB2YXIgbGVhZkxvYWRlZCA9IGl0ZW0ubGVhZkxvYWRlZDtcbiAgICAgICAgdmFyIGNvbGxlY3Rpb25zTG9hZGVkID0gaXRlbS5jb2xsZWN0aW9uc0xvYWRlZDtcbiAgICAgICAgdmFyIGxlYWZzID0gaXRlbS5sZWFmcztcbiAgICAgICAgdmFyIGNvbGxlY3Rpb25zID0gaXRlbS5jb2xsZWN0aW9ucztcblxuICAgICAgICB2YXIgbG9hZGVyID0gbGVhZiA/IGl0ZW1zTG9hZGVyIDogY2hpbGRyZW5Mb2FkZXI7XG4gICAgICAgIHZhciBsb2FkZWQgPSBsZWFmID8gbGVhZkxvYWRlZCA6IGNvbGxlY3Rpb25zTG9hZGVkO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgaWYgKCFsb2FkZWQgJiYgbG9hZGVyKSB7XG4gICAgICAgICAgICAgICAgbG9hZGVyKGl0ZW0sIGZ1bmN0aW9uIChuZXdDaGlsZHJlbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobGVhZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5sZWFmcyA9IG5ld0NoaWxkcmVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5sZWFmTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29sbGVjdGlvbnMgPSBuZXdDaGlsZHJlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29sbGVjdGlvbnNMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobmV3Q2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gKGxlYWYgPyBsZWFmcyA6IGNvbGxlY3Rpb25zKSB8fCBbXTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBMb2FkZXJzLmNvbXB1dGVQYWdpbmF0aW9uID0gZnVuY3Rpb24gY29tcHV0ZVBhZ2luYXRpb24ocmVzdWx0KSB7XG4gICAgICAgIHZhciBjb3VudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHJlc3VsdC5Vc2Vycykge1xuICAgICAgICAgICAgY291bnQgPSByZXN1bHQuVXNlcnMubGVuZ3RoO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5Hcm91cHMpIHtcbiAgICAgICAgICAgIGNvdW50ID0gcmVzdWx0Lkdyb3Vwcy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LlRlYW1zKSB7XG4gICAgICAgICAgICBjb3VudCA9IHJlc3VsdC5UZWFtcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5Ub3RhbCA+IGNvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiByZXN1bHQuT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGVuZDogcmVzdWx0Lk9mZnNldCArIHJlc3VsdC5MaW1pdCxcbiAgICAgICAgICAgICAgICBtYXg6IHJlc3VsdC5Ub3RhbCxcbiAgICAgICAgICAgICAgICBpbnRlcnZhbDogcmVzdWx0LkxpbWl0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgTG9hZGVycy5sb2FkVGVhbXMgPSBmdW5jdGlvbiBsb2FkVGVhbXMoZW50cnksIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSAwLFxuICAgICAgICAgICAgbGltaXQgPSA1MDtcbiAgICAgICAgaWYgKGVudHJ5LnJhbmdlKSB7XG4gICAgICAgICAgICB2YXIgX2VudHJ5JHJhbmdlJHNwbGl0ID0gZW50cnkucmFuZ2Uuc3BsaXQoJy0nKTtcblxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gX2VudHJ5JHJhbmdlJHNwbGl0WzBdO1xuICAgICAgICAgICAgdmFyIGVuZCA9IF9lbnRyeSRyYW5nZSRzcGxpdFsxXTtcblxuICAgICAgICAgICAgb2Zmc2V0ID0gcGFyc2VJbnQoc3RhcnQpO1xuICAgICAgICAgICAgZW5kID0gcGFyc2VJbnQoZW5kKTtcbiAgICAgICAgICAgIGxpbWl0ID0gZW5kIC0gb2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIElkbUFwaS5saXN0VGVhbXMoJycsIG9mZnNldCwgbGltaXQpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIGVudHJ5LnBhZ2luYXRpb24gPSBMb2FkZXJzLmNvbXB1dGVQYWdpbmF0aW9uKGNvbGxlY3Rpb24pO1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gY29sbGVjdGlvbi5UZWFtcy5tYXAoZnVuY3Rpb24gKHRlYW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBfcGFyZW50OiBlbnRyeSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRlYW0uVXVpZCxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW0uTGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZWFtJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ21kaSBtZGktYWNjb3VudC1tdWx0aXBsZS1vdXRsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNMb2FkZXI6IExvYWRlcnMubG9hZFRlYW1Vc2VycyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RlYW0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiAnNTc0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF9ub3RTZWxlY3RhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBJZG1Sb2xlOiB0ZWFtXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soaXRlbXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgTG9hZGVycy5sb2FkR3JvdXBzID0gZnVuY3Rpb24gbG9hZEdyb3VwcyhlbnRyeSwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHBhdGggPSAnLycsXG4gICAgICAgICAgICBmaWx0ZXIgPSAnJztcbiAgICAgICAgaWYgKGVudHJ5LklkbVVzZXIpIHtcbiAgICAgICAgICAgIHBhdGggPSBfcHlkaW9VdGlsTGFuZzJbJ2RlZmF1bHQnXS50cmltUmlnaHQoZW50cnkuSWRtVXNlci5Hcm91cFBhdGgsICcvJykgKyAnLycgKyBlbnRyeS5JZG1Vc2VyLkdyb3VwTGFiZWw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVudHJ5LmN1cnJlbnRQYXJhbXMgJiYgZW50cnkuY3VycmVudFBhcmFtcy5oYXNfc2VhcmNoKSB7XG4gICAgICAgICAgICBmaWx0ZXIgPSBlbnRyeS5jdXJyZW50UGFyYW1zLnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgSWRtQXBpLmxpc3RHcm91cHMocGF0aCwgZmlsdGVyLCBmYWxzZSwgMCwgMTAwMCkudGhlbihmdW5jdGlvbiAoZ3JvdXBzKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBncm91cHMuR3JvdXBzLm1hcChmdW5jdGlvbiAoaWRtVXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIF9wYXJlbnQ6IGVudHJ5LFxuICAgICAgICAgICAgICAgICAgICBpZDogaWRtVXNlci5VdWlkLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogaWRtVXNlci5Hcm91cExhYmVsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JvdXAnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnbWRpIG1kaS1hY2NvdW50LW11bHRpcGxlJyxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5Mb2FkZXI6IGVudHJ5LmNoaWxkcmVuTG9hZGVyID8gTG9hZGVycy5sb2FkR3JvdXBzIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNMb2FkZXI6IGVudHJ5Lml0ZW1zTG9hZGVyID8gTG9hZGVycy5sb2FkR3JvdXBVc2VycyA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJhbXM6IGVudHJ5LmN1cnJlbnRQYXJhbXMgJiYgZW50cnkuY3VycmVudFBhcmFtcy5hbHBoYV9wYWdlcyA/IF9leHRlbmRzKHt9LCBlbnRyeS5jdXJyZW50UGFyYW1zKSA6IHt9LFxuICAgICAgICAgICAgICAgICAgICBJZG1Vc2VyOiBpZG1Vc2VyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soaXRlbXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgTG9hZGVycy5sb2FkRXh0ZXJuYWxVc2VycyA9IGZ1bmN0aW9uIGxvYWRFeHRlcm5hbFVzZXJzKGVudHJ5LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZmlsdGVyID0gJycsXG4gICAgICAgICAgICBvZmZzZXQgPSAwLFxuICAgICAgICAgICAgbGltaXQgPSA1MDtcbiAgICAgICAgaWYgKGVudHJ5LmN1cnJlbnRQYXJhbXMgJiYgZW50cnkuY3VycmVudFBhcmFtcy5hbHBoYV9wYWdlcykge1xuICAgICAgICAgICAgZmlsdGVyID0gZW50cnkuY3VycmVudFBhcmFtcy52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW50cnkucmFuZ2UpIHtcbiAgICAgICAgICAgIHZhciBfZW50cnkkcmFuZ2Ukc3BsaXQyID0gZW50cnkucmFuZ2Uuc3BsaXQoJy0nKTtcblxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gX2VudHJ5JHJhbmdlJHNwbGl0MlswXTtcbiAgICAgICAgICAgIHZhciBlbmQgPSBfZW50cnkkcmFuZ2Ukc3BsaXQyWzFdO1xuXG4gICAgICAgICAgICBvZmZzZXQgPSBwYXJzZUludChzdGFydCk7XG4gICAgICAgICAgICBlbmQgPSBwYXJzZUludChlbmQpO1xuICAgICAgICAgICAgbGltaXQgPSBlbmQgLSBvZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHB5ZGlvID0gX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRDbGllbnQoKS5nZXRQeWRpb09iamVjdCgpO1xuICAgICAgICBJZG1BcGkubGlzdFVzZXJzKCcvJywgZmlsdGVyLCB0cnVlLCBvZmZzZXQsIGxpbWl0LCAnc2hhcmVkJykudGhlbihmdW5jdGlvbiAodXNlcnMpIHtcbiAgICAgICAgICAgIGVudHJ5LnBhZ2luYXRpb24gPSBMb2FkZXJzLmNvbXB1dGVQYWdpbmF0aW9uKHVzZXJzKTtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHVzZXJzLlVzZXJzLmZpbHRlcihmdW5jdGlvbiAoaWRtVXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpZG1Vc2VyLkxvZ2luICE9PSBweWRpby51c2VyLmlkO1xuICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChpZG1Vc2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgX3BhcmVudDogZW50cnksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZG1Vc2VyLkxvZ2luLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogaWRtVXNlci5BdHRyaWJ1dGVzICYmIGlkbVVzZXIuQXR0cmlidXRlc1tcImRpc3BsYXlOYW1lXCJdID8gaWRtVXNlci5BdHRyaWJ1dGVzW1wiZGlzcGxheU5hbWVcIl0gOiBpZG1Vc2VyLkxvZ2luLFxuICAgICAgICAgICAgICAgICAgICBhdmF0YXI6IGlkbVVzZXIuQXR0cmlidXRlcyAmJiBpZG1Vc2VyLkF0dHJpYnV0ZXNbXCJhdmF0YXJcIl0gPyBpZG1Vc2VyLkF0dHJpYnV0ZXNbXCJhdmF0YXJcIl0gOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd1c2VyJyxcbiAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIElkbVVzZXI6IGlkbVVzZXJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhpdGVtcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBMb2FkZXJzLmxvYWRHcm91cFVzZXJzID0gZnVuY3Rpb24gbG9hZEdyb3VwVXNlcnMoZW50cnksIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBwYXRoID0gJy8nLFxuICAgICAgICAgICAgZmlsdGVyID0gJycsXG4gICAgICAgICAgICBvZmZzZXQgPSAwLFxuICAgICAgICAgICAgbGltaXQgPSA1MDtcbiAgICAgICAgaWYgKGVudHJ5LklkbVVzZXIpIHtcbiAgICAgICAgICAgIHBhdGggPSBfcHlkaW9VdGlsTGFuZzJbJ2RlZmF1bHQnXS50cmltUmlnaHQoZW50cnkuSWRtVXNlci5Hcm91cFBhdGgsICcvJykgKyAnLycgKyBlbnRyeS5JZG1Vc2VyLkdyb3VwTGFiZWw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVudHJ5LmN1cnJlbnRQYXJhbXMgJiYgKGVudHJ5LmN1cnJlbnRQYXJhbXMuYWxwaGFfcGFnZXMgfHwgZW50cnkuY3VycmVudFBhcmFtcy5oYXNfc2VhcmNoKSkge1xuICAgICAgICAgICAgZmlsdGVyID0gZW50cnkuY3VycmVudFBhcmFtcy52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW50cnkucmFuZ2UpIHtcbiAgICAgICAgICAgIHZhciBfZW50cnkkcmFuZ2Ukc3BsaXQzID0gZW50cnkucmFuZ2Uuc3BsaXQoJy0nKTtcblxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gX2VudHJ5JHJhbmdlJHNwbGl0M1swXTtcbiAgICAgICAgICAgIHZhciBlbmQgPSBfZW50cnkkcmFuZ2Ukc3BsaXQzWzFdO1xuXG4gICAgICAgICAgICBvZmZzZXQgPSBwYXJzZUludChzdGFydCk7XG4gICAgICAgICAgICBlbmQgPSBwYXJzZUludChlbmQpO1xuICAgICAgICAgICAgbGltaXQgPSBlbmQgLSBvZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHB5ZGlvID0gX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRDbGllbnQoKS5nZXRQeWRpb09iamVjdCgpO1xuICAgICAgICBJZG1BcGkubGlzdFVzZXJzKHBhdGgsIGZpbHRlciwgZmFsc2UsIG9mZnNldCwgbGltaXQsICchc2hhcmVkJykudGhlbihmdW5jdGlvbiAodXNlcnMpIHtcbiAgICAgICAgICAgIGVudHJ5LnBhZ2luYXRpb24gPSBMb2FkZXJzLmNvbXB1dGVQYWdpbmF0aW9uKHVzZXJzKTtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHVzZXJzLlVzZXJzLmZpbHRlcihmdW5jdGlvbiAoaWRtVXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpZG1Vc2VyLkxvZ2luICE9PSBweWRpby51c2VyLmlkICYmIGlkbVVzZXIuTG9naW4gIT09IFwicHlkaW8uYW5vbi51c2VyXCI7XG4gICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGlkbVVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBfcGFyZW50OiBlbnRyeSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkbVVzZXIuTG9naW4sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpZG1Vc2VyLkF0dHJpYnV0ZXMgJiYgaWRtVXNlci5BdHRyaWJ1dGVzW1wiZGlzcGxheU5hbWVcIl0gPyBpZG1Vc2VyLkF0dHJpYnV0ZXNbXCJkaXNwbGF5TmFtZVwiXSA6IGlkbVVzZXIuTG9naW4sXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcjogaWRtVXNlci5BdHRyaWJ1dGVzICYmIGlkbVVzZXIuQXR0cmlidXRlc1tcImF2YXRhclwiXSA/IGlkbVVzZXIuQXR0cmlidXRlc1tcImF2YXRhclwiXSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VzZXInLFxuICAgICAgICAgICAgICAgICAgICBJZG1Vc2VyOiBpZG1Vc2VyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soaXRlbXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgTG9hZGVycy5sb2FkVGVhbVVzZXJzID0gZnVuY3Rpb24gbG9hZFRlYW1Vc2VycyhlbnRyeSwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IDAsXG4gICAgICAgICAgICBsaW1pdCA9IDUwO1xuICAgICAgICBpZiAoZW50cnkucmFuZ2UpIHtcbiAgICAgICAgICAgIHZhciBfZW50cnkkcmFuZ2Ukc3BsaXQ0ID0gZW50cnkucmFuZ2Uuc3BsaXQoJy0nKTtcblxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gX2VudHJ5JHJhbmdlJHNwbGl0NFswXTtcbiAgICAgICAgICAgIHZhciBlbmQgPSBfZW50cnkkcmFuZ2Ukc3BsaXQ0WzFdO1xuXG4gICAgICAgICAgICBvZmZzZXQgPSBwYXJzZUludChzdGFydCk7XG4gICAgICAgICAgICBlbmQgPSBwYXJzZUludChlbmQpO1xuICAgICAgICAgICAgbGltaXQgPSBlbmQgLSBvZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgSWRtQXBpLmxpc3RVc2Vyc1dpdGhSb2xlKGVudHJ5LklkbVJvbGUuVXVpZCwgb2Zmc2V0LCBsaW1pdCkudGhlbihmdW5jdGlvbiAodXNlcnMpIHtcbiAgICAgICAgICAgIGVudHJ5LnBhZ2luYXRpb24gPSBMb2FkZXJzLmNvbXB1dGVQYWdpbmF0aW9uKHVzZXJzKTtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHVzZXJzLlVzZXJzLm1hcChmdW5jdGlvbiAoaWRtVXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIF9wYXJlbnQ6IGVudHJ5LFxuICAgICAgICAgICAgICAgICAgICBpZDogaWRtVXNlci5Mb2dpbixcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGlkbVVzZXIuQXR0cmlidXRlcyAmJiBpZG1Vc2VyLkF0dHJpYnV0ZXNbXCJkaXNwbGF5TmFtZVwiXSA/IGlkbVVzZXIuQXR0cmlidXRlc1tcImRpc3BsYXlOYW1lXCJdIDogaWRtVXNlci5Mb2dpbixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VzZXInLFxuICAgICAgICAgICAgICAgICAgICBJZG1Vc2VyOiBpZG1Vc2VyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2soaXRlbXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIExvYWRlcnM7XG59KSgpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBMb2FkZXJzO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG4vKipcbiAqIExlZnQgcGFuZWwgb2YgdGhlIGFkZHJlc3MgYm9va1xuICogRGlzcGxheSB0cmVldmlldyBoaWVyYXJjaHkgb2YgdXNlcnMsIHRlYW1zLCBncm91cHMuXG4gKi9cblxudmFyIE5lc3RlZExpc3RJdGVtID0gKGZ1bmN0aW9uIChfQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKE5lc3RlZExpc3RJdGVtLCBfQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIE5lc3RlZExpc3RJdGVtKCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTmVzdGVkTGlzdEl0ZW0pO1xuXG4gICAgICAgIF9Db21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyB0aGlzLnByb3BzLm9uVG91Y2hUYXBcbiAgICAgKi9cblxuICAgIE5lc3RlZExpc3RJdGVtLnByb3RvdHlwZS5vblRvdWNoVGFwID0gZnVuY3Rpb24gb25Ub3VjaFRhcCgpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblRvdWNoVGFwKHRoaXMucHJvcHMuZW50cnkpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZWN1cnNpdmVseSBidWlsZCBvdGhlciBOZXN0ZWRMaXN0SXRlbVxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICovXG5cbiAgICBOZXN0ZWRMaXN0SXRlbS5wcm90b3R5cGUuYnVpbGROZXN0ZWRJdGVtcyA9IGZ1bmN0aW9uIGJ1aWxkTmVzdGVkSXRlbXMoZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YS5tYXAoKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTmVzdGVkTGlzdEl0ZW0sIHtcbiAgICAgICAgICAgICAgICBuZXN0ZWRMZXZlbDogdGhpcy5wcm9wcy5uZXN0ZWRMZXZlbCArIDEsXG4gICAgICAgICAgICAgICAgZW50cnk6IGVudHJ5LFxuICAgICAgICAgICAgICAgIG9uVG91Y2hUYXA6IHRoaXMucHJvcHMub25Ub3VjaFRhcCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhpcy5wcm9wcy5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICBzaG93SWNvbnM6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgTmVzdGVkTGlzdEl0ZW0ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBzaG93SWNvbnMgPSBfcHJvcHMuc2hvd0ljb25zO1xuICAgICAgICB2YXIgZW50cnkgPSBfcHJvcHMuZW50cnk7XG4gICAgICAgIHZhciBzZWxlY3RlZCA9IF9wcm9wcy5zZWxlY3RlZDtcbiAgICAgICAgdmFyIGlkID0gZW50cnkuaWQ7XG4gICAgICAgIHZhciBsYWJlbCA9IGVudHJ5LmxhYmVsO1xuICAgICAgICB2YXIgaWNvbiA9IGVudHJ5Lmljb247XG5cbiAgICAgICAgdmFyIGNoaWxkcmVuID0gZW50cnkuY29sbGVjdGlvbnMgfHwgW107XG4gICAgICAgIHZhciBuZXN0ZWQgPSB0aGlzLmJ1aWxkTmVzdGVkSXRlbXMoY2hpbGRyZW4pO1xuICAgICAgICB2YXIgZm9udEljb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChpY29uICYmIHNob3dJY29ucykge1xuICAgICAgICAgICAgZm9udEljb24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkZvbnRJY29uLCB7IGNsYXNzTmFtZTogaWNvbiB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5MaXN0SXRlbSwge1xuICAgICAgICAgICAgbmVzdGVkTGV2ZWw6IHRoaXMucHJvcHMubmVzdGVkTGV2ZWwsXG4gICAgICAgICAgICBrZXk6IGlkLFxuICAgICAgICAgICAgcHJpbWFyeVRleHQ6IGxhYmVsLFxuICAgICAgICAgICAgb25Ub3VjaFRhcDogdGhpcy5vblRvdWNoVGFwLmJpbmQodGhpcyksXG4gICAgICAgICAgICBuZXN0ZWRJdGVtczogbmVzdGVkLFxuICAgICAgICAgICAgaW5pdGlhbGx5T3BlbjogdHJ1ZSxcbiAgICAgICAgICAgIGxlZnRJY29uOiBmb250SWNvbixcbiAgICAgICAgICAgIGlubmVyRGl2U3R5bGU6IHsgZm9udFdlaWdodDogc2VsZWN0ZWQgPT09IGVudHJ5LmlkID8gNTAwIDogNDAwIH0sXG4gICAgICAgICAgICBzdHlsZTogc2VsZWN0ZWQgPT09IGVudHJ5LmlkID8geyBiYWNrZ3JvdW5kQ29sb3I6IFwiI2VmZWZlZlwiIH0gOiB7fVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE5lc3RlZExpc3RJdGVtO1xufSkoX3JlYWN0LkNvbXBvbmVudCk7XG5cbk5lc3RlZExpc3RJdGVtLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgY3VycmVudCBkZXB0aCBsZXZlbFxuICAgICAqL1xuICAgIG5lc3RlZExldmVsOiBfcmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICAvKipcbiAgICAgKiBDdXJyZW50bHkgc2VsZWN0ZWQgbm9kZSBpZFxuICAgICAqL1xuICAgIHNlbGVjdGVkOiBfcmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayB0cmlnZ2VyZWQgd2hlbiBhbiBlbnRyeSBpcyBzZWxlY3RlZFxuICAgICAqL1xuICAgIG9uVG91Y2hUYXA6IF9yZWFjdC5Qcm9wVHlwZXMuZnVuY1xufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gTmVzdGVkTGlzdEl0ZW07XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX1RlYW1DYXJkID0gcmVxdWlyZSgnLi9UZWFtQ2FyZCcpO1xuXG52YXIgX1RlYW1DYXJkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1RlYW1DYXJkKTtcblxudmFyIF9Vc2VyQ2FyZCA9IHJlcXVpcmUoJy4vVXNlckNhcmQnKTtcblxudmFyIF9Vc2VyQ2FyZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Vc2VyQ2FyZCk7XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBQYXBlciA9IF9yZXF1aXJlLlBhcGVyO1xudmFyIEljb25CdXR0b24gPSBfcmVxdWlyZS5JY29uQnV0dG9uO1xuXG4vKipcbiAqIENvbnRhaW5lciBmb3IgVXNlckNhcmQgb3IgVGVhbUNhcmRcbiAqL1xuXG52YXIgUmlnaHRQYW5lbENhcmQgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgX2luaGVyaXRzKFJpZ2h0UGFuZWxDYXJkLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICBmdW5jdGlvbiBSaWdodFBhbmVsQ2FyZCgpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmlnaHRQYW5lbENhcmQpO1xuXG4gICAgX1JlYWN0JENvbXBvbmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgUmlnaHRQYW5lbENhcmQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgIHZhciBjb250ZW50ID0gdW5kZWZpbmVkO1xuICAgIHZhciBpdGVtID0gdGhpcy5wcm9wcy5pdGVtIHx8IHt9O1xuICAgIGlmIChpdGVtLnR5cGUgPT09ICd1c2VyJykge1xuICAgICAgY29udGVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoX1VzZXJDYXJkMlsnZGVmYXVsdCddLCB0aGlzLnByb3BzKTtcbiAgICB9IGVsc2UgaWYgKGl0ZW0uSWRtUm9sZSAmJiBpdGVtLklkbVJvbGUuSXNUZWFtKSB7XG4gICAgICBjb250ZW50ID0gUmVhY3QuY3JlYXRlRWxlbWVudChfVGVhbUNhcmQyWydkZWZhdWx0J10sIHRoaXMucHJvcHMpO1xuICAgIH1cblxuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgUGFwZXIsXG4gICAgICB7IHpEZXB0aDogMiwgc3R5bGU6IF9leHRlbmRzKHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSwgdGhpcy5wcm9wcy5zdHlsZSkgfSxcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbkJ1dHRvbiwgeyBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktY2xvc2VcIiwgc3R5bGU6IHsgcG9zaXRpb246ICdhYnNvbHV0ZScsIHRvcDogMCwgcmlnaHQ6IDAgfSwgaWNvblN0eWxlOiB7IGNvbG9yOiAnI2UwZTBlMCcgfSwgb25Ub3VjaFRhcDogdGhpcy5wcm9wcy5vblJlcXVlc3RDbG9zZSB9KSxcbiAgICAgIGNvbnRlbnRcbiAgICApO1xuICB9O1xuXG4gIHJldHVybiBSaWdodFBhbmVsQ2FyZDtcbn0pKFJlYWN0LkNvbXBvbmVudCk7XG5cblJpZ2h0UGFuZWxDYXJkLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFB5ZGlvIGluc3RhbmNlXG4gICAqL1xuICBweWRpbzogUmVhY3QuUHJvcFR5cGVzLmluc3RhbmNlT2YoUHlkaW8pLFxuICAvKipcbiAgICogU2VsZWN0ZWQgaXRlbVxuICAgKi9cbiAgaXRlbTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgLyoqXG4gICAqIEFwcGxpZXMgdG8gcm9vdCBjb250YWluZXJcbiAgICovXG4gIHN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAvKipcbiAgICogRm9yd2FyZGVkIHRvIGNoaWxkXG4gICAqL1xuICBvblJlcXVlc3RDbG9zZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gIC8qKlxuICAgKiBGb3J3YXJkZWQgdG8gY2hpbGRcbiAgICovXG4gIG9uRGVsZXRlQWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIEZvcndhcmRlZCB0byBjaGlsZFxuICAgKi9cbiAgb25VcGRhdGVBY3Rpb246IFJlYWN0LlByb3BUeXBlcy5mdW5jXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBSaWdodFBhbmVsQ2FyZDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgX21hdGVyaWFsVWkgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgX2xvZGFzaERlYm91bmNlID0gcmVxdWlyZSgnbG9kYXNoLmRlYm91bmNlJyk7XG5cbnZhciBfbG9kYXNoRGVib3VuY2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbG9kYXNoRGVib3VuY2UpO1xuXG4vKipcbiAqIFJlYWR5IHRvIHVzZSBGb3JtICsgUmVzdWx0IExpc3QgZm9yIHNlYXJjaCB1c2Vyc1xuICovXG5cbnZhciBTZWFyY2hGb3JtID0gKGZ1bmN0aW9uIChfQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKFNlYXJjaEZvcm0sIF9Db21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gU2VhcmNoRm9ybShwcm9wcywgY29udGV4dCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2VhcmNoRm9ybSk7XG5cbiAgICAgICAgX0NvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzLCBjb250ZXh0KTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgdmFsdWU6ICcnIH07XG4gICAgICAgIHRoaXMuc2VhcmNoID0gX2xvZGFzaERlYm91bmNlMlsnZGVmYXVsdCddKHRoaXMuc2VhcmNoLmJpbmQodGhpcyksIDMwMCk7XG4gICAgfVxuXG4gICAgU2VhcmNoRm9ybS5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gc2VhcmNoKCkge1xuICAgICAgICB0aGlzLnByb3BzLm9uU2VhcmNoKHRoaXMuc3RhdGUudmFsdWUpO1xuICAgIH07XG5cbiAgICBTZWFyY2hGb3JtLnByb3RvdHlwZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIG9uQ2hhbmdlKGV2ZW50LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICB0aGlzLnNlYXJjaCgpO1xuICAgIH07XG5cbiAgICBTZWFyY2hGb3JtLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgdW5kZXJsaW5lU2hvdyA9IF9wcm9wcy51bmRlcmxpbmVTaG93O1xuICAgICAgICB2YXIgc2VhcmNoTGFiZWwgPSBfcHJvcHMuc2VhcmNoTGFiZWw7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wcy5zdHlsZTtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBzdHlsZTogX2V4dGVuZHMoeyBtaW5XaWR0aDogMzIwIH0sIHN0eWxlKSB9LFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5UZXh0RmllbGQsIHtcbiAgICAgICAgICAgICAgICBmdWxsV2lkdGg6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uQ2hhbmdlLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgaGludFRleHQ6IHNlYXJjaExhYmVsLFxuICAgICAgICAgICAgICAgIHVuZGVybGluZVNob3c6IHVuZGVybGluZVNob3cgPT09IHVuZGVmaW5lZCA/IHRydWUgOiB1bmRlcmxpbmVTaG93XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2VhcmNoRm9ybTtcbn0pKF9yZWFjdC5Db21wb25lbnQpO1xuXG5TZWFyY2hGb3JtLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBMYWJlbCBkaXNwbGF5ZWQgaW4gdGhlIHNlYXJjaCBmaWVsZFxuICAgICAqL1xuICAgIHNlYXJjaExhYmVsOiBfcmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIHRyaWdnZXJlZCB0byBzZWFyY2hcbiAgICAgKi9cbiAgICBvblNlYXJjaDogX3JlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgLyoqXG4gICAgICogV2lsbCBiZSBhcHBlbmRlZCB0byB0aGUgcm9vdCBlbGVtZW50XG4gICAgICovXG4gICAgc3R5bGU6IF9yZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIFRvIGJlIGFwcGxpZWQgb24gVGV4dEZpZWxkXG4gICAgICovXG4gICAgdW5kZXJsaW5lU2hvdzogX3JlYWN0LlByb3BUeXBlcy5ib29sXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBTZWFyY2hGb3JtO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9TZWFyY2hGb3JtID0gcmVxdWlyZSgnLi9TZWFyY2hGb3JtJyk7XG5cbnZhciBfU2VhcmNoRm9ybTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9TZWFyY2hGb3JtKTtcblxudmFyIF9Vc2Vyc0xpc3QgPSByZXF1aXJlKCcuL1VzZXJzTGlzdCcpO1xuXG52YXIgX1VzZXJzTGlzdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Vc2Vyc0xpc3QpO1xuXG52YXIgX0xvYWRlcnMgPSByZXF1aXJlKCcuL0xvYWRlcnMnKTtcblxudmFyIF9Mb2FkZXJzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0xvYWRlcnMpO1xuXG4vKipcbiAqIFJlYWR5IHRvIHVzZSBGb3JtICsgUmVzdWx0IExpc3QgZm9yIHNlYXJjaCB1c2Vyc1xuICovXG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBDb21wb25lbnQgPSBfcmVxdWlyZS5Db21wb25lbnQ7XG52YXIgUHJvcFR5cGVzID0gX3JlcXVpcmUuUHJvcFR5cGVzO1xuXG52YXIgX3JlcXVpcmUkcmVxdWlyZUxpYiA9IHJlcXVpcmUoJ3B5ZGlvJykucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfcmVxdWlyZSRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xuXG52YXIgU2VhcmNoUGFuZWwgPSAoZnVuY3Rpb24gKF9Db21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoU2VhcmNoUGFuZWwsIF9Db21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gU2VhcmNoUGFuZWwocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNlYXJjaFBhbmVsKTtcblxuICAgICAgICBfQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMuY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IGl0ZW1zOiBbXSB9O1xuICAgIH1cblxuICAgIFNlYXJjaFBhbmVsLnByb3RvdHlwZS5vblNlYXJjaCA9IGZ1bmN0aW9uIG9uU2VhcmNoKHZhbHVlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zOiBbXSB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGFyYW1zID0geyB2YWx1ZTogdmFsdWUsIGV4aXN0aW5nX29ubHk6ICd0cnVlJyB9O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5wYXJhbXMpIHtcbiAgICAgICAgICAgIHBhcmFtcyA9IF9leHRlbmRzKHt9LCBwYXJhbXMsIHRoaXMucHJvcHMucGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBfTG9hZGVyczJbJ2RlZmF1bHQnXS5saXN0VXNlcnMocGFyYW1zLCBmdW5jdGlvbiAoY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgaXRlbXM6IGNoaWxkcmVuIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgU2VhcmNoUGFuZWwucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBtb2RlID0gX3Byb3BzLm1vZGU7XG4gICAgICAgIHZhciBpdGVtID0gX3Byb3BzLml0ZW07XG4gICAgICAgIHZhciBnZXRNZXNzYWdlID0gX3Byb3BzLmdldE1lc3NhZ2U7XG5cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgc3R5bGU6IHsgZmxleDogMSwgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyB9IH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgcGFkZGluZzogMTAsIGhlaWdodDogNTYsIGJhY2tncm91bmRDb2xvcjogdGhpcy5zdGF0ZS5zZWxlY3QgPyBhY3RpdmVUYmFyQ29sb3IgOiAnI2ZhZmFmYScsIGRpc3BsYXk6ICdmbGV4JywgYWxpZ25JdGVtczogJ2NlbnRlcicsIHRyYW5zaXRpb246IERPTVV0aWxzLmdldEJlemllcnNUcmFuc2l0aW9uKCkgfSB9LFxuICAgICAgICAgICAgICAgIG1vZGUgPT09IFwic2VsZWN0b3JcIiAmJiBpdGVtLl9wYXJlbnQgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChNYXRlcmlhbFVJLkljb25CdXR0b24sIHsgaWNvbkNsYXNzTmFtZTogJ21kaSBtZGktY2hldnJvbi1sZWZ0Jywgb25Ub3VjaFRhcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnByb3BzLm9uRm9sZGVyQ2xpY2tlZChpdGVtLl9wYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9IH0pLFxuICAgICAgICAgICAgICAgIG1vZGUgPT09ICdib29rJyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBmb250U2l6ZTogMjAsIGNvbG9yOiAncmdiYSgwLDAsMCwwLjg3KScsIGZsZXg6IDEgfSB9LFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLnRpdGxlXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KF9TZWFyY2hGb3JtMlsnZGVmYXVsdCddLCB7IHN0eWxlOiBtb2RlID09PSAnYm9vaycgPyB7IG1pbldpZHRoOiAzMjAgfSA6IHsgZmxleDogMSB9LCBzZWFyY2hMYWJlbDogdGhpcy5wcm9wcy5zZWFyY2hMYWJlbCwgb25TZWFyY2g6IHRoaXMub25TZWFyY2guYmluZCh0aGlzKSB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX1VzZXJzTGlzdDJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgIG1vZGU6IHRoaXMucHJvcHMubW9kZSxcbiAgICAgICAgICAgICAgICBvbkl0ZW1DbGlja2VkOiB0aGlzLnByb3BzLm9uSXRlbUNsaWNrZWQsXG4gICAgICAgICAgICAgICAgaXRlbTogeyBsZWFmczogdGhpcy5zdGF0ZS5pdGVtcyB9LFxuICAgICAgICAgICAgICAgIG5vVG9vbGJhcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlUHJpbWFyeVRleHQ6IGdldE1lc3NhZ2UoNTg3LCAnJyksXG4gICAgICAgICAgICAgICAgZW1wdHlTdGF0ZVNlY29uZGFyeVRleHQ6IGdldE1lc3NhZ2UoNTg4LCAnJylcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiBTZWFyY2hQYW5lbDtcbn0pKENvbXBvbmVudCk7XG5cblNlYXJjaFBhbmVsLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCBwYXJhbWV0ZXJzIGFkZGVkIHRvIGxpc3RVc2VycygpIHJlcXVlc3RcbiAgICAgKi9cbiAgICBwYXJhbXM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgLyoqXG4gICAgICogTGFiZWwgZGlzcGxheWVkIGluIHRoZSB0b29sYmFyXG4gICAgICovXG4gICAgc2VhcmNoTGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgdHJpZ2dlcmVkIHdoZW4gYSBzZWFyY2ggcmVzdWx0IGlzIGNsaWNrZWRcbiAgICAgKi9cbiAgICBvbkl0ZW1DbGlja2VkOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAvKipcbiAgICAgKiBDdXJyZW50bHkgc2VsZWN0ZWQgaXRlbSwgcmVxdWlyZWQgZm9yIG5hdmlnYXRpb25cbiAgICAgKi9cbiAgICBpdGVtOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIHRyaWdnZXJlZCBpZiB0aGUgcmVzdWx0IGlzIGEgY29sbGVjdGlvblxuICAgICAqL1xuICAgIG9uRm9sZGVyQ2xpY2tlZDogUHJvcFR5cGVzLmZ1bmNcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFNlYXJjaFBhbmVsID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoU2VhcmNoUGFuZWwpO1xuZXhwb3J0c1snZGVmYXVsdCddID0gU2VhcmNoUGFuZWw7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhvYmosIGtleXMpIHsgdmFyIHRhcmdldCA9IHt9OyBmb3IgKHZhciBpIGluIG9iaikgeyBpZiAoa2V5cy5pbmRleE9mKGkpID49IDApIGNvbnRpbnVlOyBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGkpKSBjb250aW51ZTsgdGFyZ2V0W2ldID0gb2JqW2ldOyB9IHJldHVybiB0YXJnZXQ7IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfVXNlcnNMaXN0ID0gcmVxdWlyZSgnLi9Vc2Vyc0xpc3QnKTtcblxudmFyIF9Vc2Vyc0xpc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfVXNlcnNMaXN0KTtcblxudmFyIF9Mb2FkZXJzID0gcmVxdWlyZSgnLi9Mb2FkZXJzJyk7XG5cbnZhciBfTG9hZGVyczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Mb2FkZXJzKTtcblxudmFyIF9hdmF0YXJBY3Rpb25zUGFuZWwgPSByZXF1aXJlKCcuLi9hdmF0YXIvQWN0aW9uc1BhbmVsJyk7XG5cbnZhciBfYXZhdGFyQWN0aW9uc1BhbmVsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2F2YXRhckFjdGlvbnNQYW5lbCk7XG5cbnZhciBfcHlkaW9IdHRwQXBpID0gcmVxdWlyZSgncHlkaW8vaHR0cC9hcGknKTtcblxudmFyIF9weWRpb0h0dHBBcGkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9IdHRwQXBpKTtcblxudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZXF1aXJlID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIFRleHRGaWVsZCA9IF9yZXF1aXJlLlRleHRGaWVsZDtcbnZhciBGbGF0QnV0dG9uID0gX3JlcXVpcmUuRmxhdEJ1dHRvbjtcbnZhciBDYXJkVGl0bGUgPSBfcmVxdWlyZS5DYXJkVGl0bGU7XG52YXIgRGl2aWRlciA9IF9yZXF1aXJlLkRpdmlkZXI7XG5cbnZhciBfcmVxdWlyZSRyZXF1aXJlTGliID0gcmVxdWlyZSgncHlkaW8nKS5yZXF1aXJlTGliKCdib290Jyk7XG5cbnZhciBQeWRpb0NvbnRleHRDb25zdW1lciA9IF9yZXF1aXJlJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG5cbi8qKlxuICogRGlzcGxheSBpbmZvIGFib3V0IGEgVGVhbSBpbnNpZGUgYSBwb3BvdmVyLWFibGUgY2FyZFxuICovXG5cbnZhciBUZWFtQ2FyZCA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhUZWFtQ2FyZCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBUZWFtQ2FyZChwcm9wcywgY29udGV4dCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGVhbUNhcmQpO1xuXG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IGxhYmVsOiB0aGlzLnByb3BzLml0ZW0ubGFiZWwgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2UgbG9hZGVyIHRvIGdldCB0ZWFtIHBhcnRpY2lwYW50c1xuICAgICAqIEBwYXJhbSBpdGVtXG4gICAgICovXG5cbiAgICBUZWFtQ2FyZC5wcm90b3R5cGUubG9hZE1lbWJlcnMgPSBmdW5jdGlvbiBsb2FkTWVtYmVycyhpdGVtKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgIF9Mb2FkZXJzMlsnZGVmYXVsdCddLmNoaWxkcmVuQXNQcm9taXNlKGl0ZW0sIGZhbHNlKS50aGVuKGZ1bmN0aW9uIChjaGlsZHJlbikge1xuICAgICAgICAgICAgX0xvYWRlcnMyWydkZWZhdWx0J10uY2hpbGRyZW5Bc1Byb21pc2UoaXRlbSwgdHJ1ZSkudGhlbihmdW5jdGlvbiAoY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IG1lbWJlcnM6IGl0ZW0ubGVhZnMsIGxvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBUZWFtQ2FyZC5wcm90b3R5cGUuY29tcG9uZW50V2lsbE1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgICAgICB0aGlzLmxvYWRNZW1iZXJzKHRoaXMucHJvcHMuaXRlbSk7XG4gICAgfTtcblxuICAgIFRlYW1DYXJkLnByb3RvdHlwZS5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgICAgdGhpcy5sb2FkTWVtYmVycyhuZXh0UHJvcHMuaXRlbSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYWJlbDogbmV4dFByb3BzLml0ZW0ubGFiZWwgfSk7XG4gICAgfTtcblxuICAgIFRlYW1DYXJkLnByb3RvdHlwZS5vbkxhYmVsQ2hhbmdlID0gZnVuY3Rpb24gb25MYWJlbENoYW5nZShlLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbGFiZWw6IHZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBUZWFtQ2FyZC5wcm90b3R5cGUudXBkYXRlTGFiZWwgPSBmdW5jdGlvbiB1cGRhdGVMYWJlbCgpIHtcbiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUubGFiZWwgIT09IHRoaXMucHJvcHMuaXRlbS5sYWJlbCkge1xuICAgICAgICAgICAgX3B5ZGlvSHR0cEFwaTJbJ2RlZmF1bHQnXS5nZXRSZXN0Q2xpZW50KCkuZ2V0SWRtQXBpKCkudXBkYXRlVGVhbUxhYmVsKHRoaXMucHJvcHMuaXRlbS5JZG1Sb2xlLlV1aWQsIHRoaXMuc3RhdGUubGFiZWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpczIucHJvcHMub25VcGRhdGVBY3Rpb24oX3RoaXMyLnByb3BzLml0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVkaXRNb2RlOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgVGVhbUNhcmQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBpdGVtID0gX3Byb3BzLml0ZW07XG4gICAgICAgIHZhciBvbkRlbGV0ZUFjdGlvbiA9IF9wcm9wcy5vbkRlbGV0ZUFjdGlvbjtcbiAgICAgICAgdmFyIG9uQ3JlYXRlQWN0aW9uID0gX3Byb3BzLm9uQ3JlYXRlQWN0aW9uO1xuICAgICAgICB2YXIgZ2V0TWVzc2FnZSA9IF9wcm9wcy5nZXRNZXNzYWdlO1xuXG4gICAgICAgIHZhciBlZGl0UHJvcHMgPSB7XG4gICAgICAgICAgICB0ZWFtOiBpdGVtLFxuICAgICAgICAgICAgdXNlckVkaXRhYmxlOiB0aGlzLnByb3BzLml0ZW0uSWRtUm9sZS5Qb2xpY2llc0NvbnRleHRFZGl0YWJsZSxcbiAgICAgICAgICAgIG9uRGVsZXRlQWN0aW9uOiBmdW5jdGlvbiBvbkRlbGV0ZUFjdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfdGhpczMucHJvcHMub25EZWxldGVBY3Rpb24oaXRlbS5fcGFyZW50LCBbaXRlbV0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRWRpdEFjdGlvbjogZnVuY3Rpb24gb25FZGl0QWN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7IGVkaXRNb2RlOiAhX3RoaXMzLnN0YXRlLmVkaXRNb2RlIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbG9hZEFjdGlvbjogZnVuY3Rpb24gcmVsb2FkQWN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF90aGlzMy5wcm9wcy5vblVwZGF0ZUFjdGlvbihpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdGl0bGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmVkaXRNb2RlKSB7XG4gICAgICAgICAgICB0aXRsZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogeyBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBtYXJnaW46IDE2IH0gfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRGaWVsZCwgeyBzdHlsZTogeyBmbGV4OiAxLCBmb250U2l6ZTogMjQgfSwgZnVsbFdpZHRoOiB0cnVlLCBkaXNhYmxlZDogZmFsc2UsIHVuZGVybGluZVNob3c6IGZhbHNlLCB2YWx1ZTogdGhpcy5zdGF0ZS5sYWJlbCwgb25DaGFuZ2U6IHRoaXMub25MYWJlbENoYW5nZS5iaW5kKHRoaXMpIH0pLFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRmxhdEJ1dHRvbiwgeyBzZWNvbmRhcnk6IHRydWUsIGxhYmVsOiBnZXRNZXNzYWdlKDQ4KSwgb25Ub3VjaFRhcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnVwZGF0ZUxhYmVsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aXRsZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2FyZFRpdGxlLCB7IHRpdGxlOiB0aGlzLnN0YXRlLmxhYmVsLCBzdWJ0aXRsZTogaXRlbS5sZWFmcyAmJiBpdGVtLmxlYWZzLmxlbmd0aCA/IGdldE1lc3NhZ2UoNTc2KS5yZXBsYWNlKCclcycsIGl0ZW0ubGVhZnMubGVuZ3RoKSA6IGdldE1lc3NhZ2UoNTc3KSB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX3Byb3BzMiA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wczIuc3R5bGU7XG5cbiAgICAgICAgdmFyIG90aGVyUHJvcHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX3Byb3BzMiwgWydzdHlsZSddKTtcblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfYXZhdGFyQWN0aW9uc1BhbmVsMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7fSwgb3RoZXJQcm9wcywgZWRpdFByb3BzKSksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KERpdmlkZXIsIG51bGwpLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfVXNlcnNMaXN0MlsnZGVmYXVsdCddLCB7IHN1YkhlYWRlcjogZ2V0TWVzc2FnZSg1NzUpLCBvbkl0ZW1DbGlja2VkOiBmdW5jdGlvbiAoKSB7fSwgaXRlbTogaXRlbSwgbW9kZTogJ2lubmVyJywgb25EZWxldGVBY3Rpb246IG9uRGVsZXRlQWN0aW9uIH0pXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiBUZWFtQ2FyZDtcbn0pKFJlYWN0LkNvbXBvbmVudCk7XG5cblRlYW1DYXJkLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBQeWRpbyBpbnN0YW5jZVxuICAgICAqL1xuICAgIHB5ZGlvOiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihQeWRpbyksXG4gICAgLyoqXG4gICAgICogVGVhbSBkYXRhIG9iamVjdFxuICAgICAqL1xuICAgIGl0ZW06IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgLyoqXG4gICAgICogQXBwbGllZCB0byByb290IGNvbnRhaW5lclxuICAgICAqL1xuICAgIHN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIENhbGxlZCB0byBkaXNtaXNzIHRoZSBwb3BvdmVyXG4gICAgICovXG4gICAgb25SZXF1ZXN0Q2xvc2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBjdXJyZW50IHRlYW1cbiAgICAgKi9cbiAgICBvbkRlbGV0ZUFjdGlvbjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGN1cnJlbnQgdGVhbVxuICAgICAqL1xuICAgIG9uVXBkYXRlQWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMuZnVuY1xufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gVGVhbUNhcmQgPSBQeWRpb0NvbnRleHRDb25zdW1lcihUZWFtQ2FyZCk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFRlYW1DYXJkO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVhY3QpO1xuXG52YXIgX2F2YXRhclVzZXJBdmF0YXIgPSByZXF1aXJlKCcuLi9hdmF0YXIvVXNlckF2YXRhcicpO1xuXG52YXIgX2F2YXRhclVzZXJBdmF0YXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYXZhdGFyVXNlckF2YXRhcik7XG5cbnZhciBfVXNlckNyZWF0aW9uRm9ybSA9IHJlcXVpcmUoJy4uL1VzZXJDcmVhdGlvbkZvcm0nKTtcblxudmFyIF9Vc2VyQ3JlYXRpb25Gb3JtMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1VzZXJDcmVhdGlvbkZvcm0pO1xuXG4vKipcbiAqIENhcmQgcHJlc2VudGF0aW9uIG9mIGEgdXNlci4gUmVsaWVzIG9uIHRoZSBVc2VyQXZhdGFyIG9iamVjdCxcbiAqIHBsdXMgdGhlIFB5ZGlvRm9ybS5Vc2VyQ3JlYXRpb25Gb3JtIHdoZW4gaW4gZWRpdCBtb2RlLlxuICovXG5cbnZhciBVc2VyQ2FyZCA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhVc2VyQ2FyZCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBVc2VyQ2FyZChwcm9wcywgY29udGV4dCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXNlckNhcmQpO1xuXG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IGVkaXRGb3JtOiBmYWxzZSB9O1xuICAgIH1cblxuICAgIFVzZXJDYXJkLnByb3RvdHlwZS5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgICAgaWYgKG5leHRQcm9wcy5pdGVtICE9PSB0aGlzLnByb3BzLml0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlZGl0Rm9ybTogZmFsc2UgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgVXNlckNhcmQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgaXRlbSA9IHRoaXMucHJvcHMuaXRlbTtcblxuICAgICAgICB2YXIgZWRpdGFibGVQcm9wcyA9IHt9LFxuICAgICAgICAgICAgZWRpdEZvcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChpdGVtLl9wYXJlbnQgJiYgaXRlbS5fcGFyZW50LmlkID09PSAnZXh0Jykge1xuICAgICAgICAgICAgZWRpdGFibGVQcm9wcyA9IHtcbiAgICAgICAgICAgICAgICB1c2VyRWRpdGFibGU6IGl0ZW0uSWRtVXNlci5Qb2xpY2llc0NvbnRleHRFZGl0YWJsZSxcbiAgICAgICAgICAgICAgICBvbkRlbGV0ZUFjdGlvbjogZnVuY3Rpb24gb25EZWxldGVBY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uRGVsZXRlQWN0aW9uKGl0ZW0uX3BhcmVudCwgW2l0ZW1dKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRWRpdEFjdGlvbjogZnVuY3Rpb24gb25FZGl0QWN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGVkaXRGb3JtOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVsb2FkQWN0aW9uOiBmdW5jdGlvbiByZWxvYWRBY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uVXBkYXRlQWN0aW9uKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5lZGl0Rm9ybSkge1xuICAgICAgICAgICAgZWRpdEZvcm0gPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfVXNlckNyZWF0aW9uRm9ybTJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgIHB5ZGlvOiB0aGlzLnByb3BzLnB5ZGlvLFxuICAgICAgICAgICAgICAgIHpEZXB0aDogMCxcbiAgICAgICAgICAgICAgICBzdHlsZTogeyBmbGV4OiAxIH0sXG4gICAgICAgICAgICAgICAgbmV3VXNlck5hbWU6IGl0ZW0uaWQsXG4gICAgICAgICAgICAgICAgZWRpdE1vZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgdXNlckRhdGE6IGl0ZW0sXG4gICAgICAgICAgICAgICAgb25Vc2VyQ3JlYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vblVwZGF0ZUFjdGlvbihpdGVtKTtfdGhpcy5zZXRTdGF0ZSh7IGVkaXRGb3JtOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZWRpdEZvcm06IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWRpdGFibGVQcm9wcyA9IF9leHRlbmRzKHt9LCBlZGl0YWJsZVByb3BzLCB7XG4gICAgICAgICAgICAgICAgZGlzcGxheUxhYmVsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlBdmF0YXI6IHRydWUsXG4gICAgICAgICAgICAgICAgdXNlRGVmYXVsdEF2YXRhcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzdHlsZTogeyB0ZXh0QWxpZ246ICdjZW50ZXInLCBib3JkZXJCb3R0b206ICcxcHggc29saWQgI2UwZTBlMCcsIHBhZGRpbmc6IDEwLCBiYWNrZ3JvdW5kQ29sb3I6ICcjZmFmYWZhJyB9LFxuICAgICAgICAgICAgICAgIGF2YXRhclN0eWxlOiB7IG1hcmdpbkJvdHRvbTogMTYgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgc3R5bGU6IGVkaXRGb3JtID8geyBoZWlnaHQ6ICcxMDAlJywgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyB9IDoge30gfSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9hdmF0YXJVc2VyQXZhdGFyMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7XG4gICAgICAgICAgICAgICAgdXNlcklkOiB0aGlzLnByb3BzLml0ZW0uaWQsXG4gICAgICAgICAgICAgICAgcmljaENhcmQ6ICFlZGl0Rm9ybSxcbiAgICAgICAgICAgICAgICBweWRpbzogdGhpcy5wcm9wcy5weWRpbyxcbiAgICAgICAgICAgICAgICBjYXJkU2l6ZTogdGhpcy5wcm9wcy5zdHlsZS53aWR0aFxuICAgICAgICAgICAgfSwgZWRpdGFibGVQcm9wcykpLFxuICAgICAgICAgICAgZWRpdEZvcm1cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFVzZXJDYXJkO1xufSkoX3JlYWN0MlsnZGVmYXVsdCddLkNvbXBvbmVudCk7XG5cblVzZXJDYXJkLnByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBQeWRpbyBpbnN0YW5jZVxuICAgICAqL1xuICAgIHB5ZGlvOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmluc3RhbmNlT2YoUHlkaW8pLFxuICAgIC8qKlxuICAgICAqIFRlYW0gZGF0YSBvYmplY3RcbiAgICAgKi9cbiAgICBpdGVtOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICAvKipcbiAgICAgKiBBcHBsaWVkIHRvIHJvb3QgY29udGFpbmVyXG4gICAgICovXG4gICAgc3R5bGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIENhbGxlZCB0byBkaXNtaXNzIHRoZSBwb3BvdmVyXG4gICAgICovXG4gICAgb25SZXF1ZXN0Q2xvc2U6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAvKipcbiAgICAgKiBEZWxldGUgY3VycmVudCB0ZWFtXG4gICAgICovXG4gICAgb25EZWxldGVBY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAvKipcbiAgICAgKiBVcGRhdGUgY3VycmVudCB0ZWFtXG4gICAgICovXG4gICAgb25VcGRhdGVBY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuY1xufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gVXNlckNhcmQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9O1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfYXZhdGFyVXNlckF2YXRhciA9IHJlcXVpcmUoJy4uL2F2YXRhci9Vc2VyQXZhdGFyJyk7XG5cbnZhciBfYXZhdGFyVXNlckF2YXRhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hdmF0YXJVc2VyQXZhdGFyKTtcblxudmFyIF9tYXRlcmlhbFVpID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIF9tYXRlcmlhbFVpU3R5bGVzID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWkvc3R5bGVzJyk7XG5cbnZhciBfdmlld3NFbXB0eVN0YXRlVmlldyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL0VtcHR5U3RhdGVWaWV3Jyk7XG5cbnZhciBfdmlld3NFbXB0eVN0YXRlVmlldzIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF92aWV3c0VtcHR5U3RhdGVWaWV3KTtcblxudmFyIF9BbHBoYVBhZ2luYXRvciA9IHJlcXVpcmUoJy4vQWxwaGFQYWdpbmF0b3InKTtcblxudmFyIF9BbHBoYVBhZ2luYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9BbHBoYVBhZ2luYXRvcik7XG5cbnZhciBfU2VhcmNoRm9ybSA9IHJlcXVpcmUoJy4vU2VhcmNoRm9ybScpO1xuXG52YXIgX1NlYXJjaEZvcm0yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfU2VhcmNoRm9ybSk7XG5cbnZhciBfcHlkaW9VdGlsRG9tID0gcmVxdWlyZSgncHlkaW8vdXRpbC9kb20nKTtcblxudmFyIF9weWRpb1V0aWxEb20yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcHlkaW9VdGlsRG9tKTtcblxudmFyIF9hdmF0YXJDZWxsQWN0aW9uc1JlbmRlcmVyID0gcmVxdWlyZSgnLi4vYXZhdGFyL0NlbGxBY3Rpb25zUmVuZGVyZXInKTtcblxudmFyIF9hdmF0YXJDZWxsQWN0aW9uc1JlbmRlcmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2F2YXRhckNlbGxBY3Rpb25zUmVuZGVyZXIpO1xuXG52YXIgX3JlcXVpcmUkcmVxdWlyZUxpYiA9IHJlcXVpcmUoJ3B5ZGlvJykucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgTG9hZGVyID0gX3JlcXVpcmUkcmVxdWlyZUxpYi5Mb2FkZXI7XG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfcmVxdWlyZSRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xuXG52YXIgVXNlcnNMaXN0ID0gKGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKFVzZXJzTGlzdCwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBVc2Vyc0xpc3QocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFVzZXJzTGlzdCk7XG5cbiAgICAgICAgX1JlYWN0JENvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzLCBjb250ZXh0KTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgc2VsZWN0OiBmYWxzZSwgc2VsZWN0aW9uOiBbXSwgZWRpdExhYmVsOiBmYWxzZSB9O1xuICAgIH1cblxuICAgIFVzZXJzTGlzdC5wcm90b3R5cGUub25MYWJlbEtleUVudGVyID0gZnVuY3Rpb24gb25MYWJlbEtleUVudGVyKGUpIHtcbiAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxhYmVsKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgVXNlcnNMaXN0LnByb3RvdHlwZS5vbkxhYmVsQ2hhbmdlID0gZnVuY3Rpb24gb25MYWJlbENoYW5nZShlLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbGFiZWw6IHZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBVc2Vyc0xpc3QucHJvdG90eXBlLnVwZGF0ZUxhYmVsID0gZnVuY3Rpb24gdXBkYXRlTGFiZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmxhYmVsICE9PSB0aGlzLnByb3BzLml0ZW0ubGFiZWwpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25FZGl0TGFiZWwodGhpcy5wcm9wcy5pdGVtLCB0aGlzLnN0YXRlLmxhYmVsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZWRpdExhYmVsOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgVXNlcnNMaXN0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBpdGVtID0gX3Byb3BzLml0ZW07XG4gICAgICAgIHZhciBtb2RlID0gX3Byb3BzLm1vZGU7XG4gICAgICAgIHZhciBwYWdpbmF0b3JUeXBlID0gX3Byb3BzLnBhZ2luYXRvclR5cGU7XG4gICAgICAgIHZhciBsb2FkaW5nID0gX3Byb3BzLmxvYWRpbmc7XG4gICAgICAgIHZhciBlbmFibGVTZWFyY2ggPSBfcHJvcHMuZW5hYmxlU2VhcmNoO1xuICAgICAgICB2YXIgc2hvd1N1YmhlYWRlcnMgPSBfcHJvcHMuc2hvd1N1YmhlYWRlcnM7XG4gICAgICAgIHZhciBnZXRNZXNzYWdlID0gX3Byb3BzLmdldE1lc3NhZ2U7XG4gICAgICAgIHZhciBhY3Rpb25zUGFuZWwgPSBfcHJvcHMuYWN0aW9uc1BhbmVsO1xuICAgICAgICB2YXIgbXVpVGhlbWUgPSBfcHJvcHMubXVpVGhlbWU7XG4gICAgICAgIHZhciBib29rQ29sdW1uID0gX3Byb3BzLmJvb2tDb2x1bW47XG4gICAgICAgIHZhciBweWRpbyA9IF9wcm9wcy5weWRpbztcbiAgICAgICAgdmFyIHJlbG9hZEFjdGlvbiA9IF9wcm9wcy5yZWxvYWRBY3Rpb247XG5cbiAgICAgICAgdmFyIGZvbGRlcnMgPSBpdGVtLmNvbGxlY3Rpb25zIHx8IFtdO1xuICAgICAgICB2YXIgbGVhZnMgPSBpdGVtLmxlYWZzIHx8IFtdO1xuICAgICAgICB2YXIgZm9sZGVyc1N1YkhlYWRlciA9IGZvbGRlcnMubGVuZ3RoICYmIChsZWFmcy5sZW5ndGggfHwgc2hvd1N1YmhlYWRlcnMpID8gW3sgc3ViaGVhZGVyOiBnZXRNZXNzYWdlKCc1MzInKSB9XSA6IFtdO1xuICAgICAgICB2YXIgdXNlcnNTdWJIZWFkZXIgPSBbXTtcbiAgICAgICAgaWYgKHNob3dTdWJoZWFkZXJzIHx8IHBhZ2luYXRvclR5cGUpIHtcbiAgICAgICAgICAgIHVzZXJzU3ViSGVhZGVyID0gW3sgc3ViaGVhZGVyOiBwYWdpbmF0b3JUeXBlID8gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX0FscGhhUGFnaW5hdG9yMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywgeyBzdHlsZTogeyBsaW5lSGVpZ2h0OiAnMjBweCcsIHBhZGRpbmc6ICcxNHB4IDAnIH0gfSkpIDogZ2V0TWVzc2FnZSgnMjQ5JykgfV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGl0ZW1zID0gW10uY29uY2F0KGZvbGRlcnNTdWJIZWFkZXIsIGZvbGRlcnMsIHVzZXJzU3ViSGVhZGVyLCBsZWFmcyk7XG4gICAgICAgIHZhciB0b3RhbCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gW107XG4gICAgICAgIHZhciB0b2dnbGVTZWxlY3QgPSBmdW5jdGlvbiB0b2dnbGVTZWxlY3QoKSB7XG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdDogIV90aGlzLnN0YXRlLnNlbGVjdCwgc2VsZWN0aW9uOiBbXSB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGNyZWF0ZUFjdGlvbiA9IGZ1bmN0aW9uIGNyZWF0ZUFjdGlvbigpIHtcbiAgICAgICAgICAgIF90aGlzLnByb3BzLm9uQ3JlYXRlQWN0aW9uKGl0ZW0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZGVsZXRlQWN0aW9uID0gZnVuY3Rpb24gZGVsZXRlQWN0aW9uKCkge1xuICAgICAgICAgICAgX3RoaXMucHJvcHMub25EZWxldGVBY3Rpb24oaXRlbSwgX3RoaXMuc3RhdGUuc2VsZWN0aW9uKTtfdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdDogZmFsc2UsIHNlbGVjdGlvbjogW10gfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGFjY2VudENvbG9yID0gbXVpVGhlbWUucGFsZXR0ZS5hY2NlbnQyQ29sb3I7XG4gICAgICAgIHZhciBhcHBCYXIgPSBtdWlUaGVtZS5hcHBCYXI7XG4gICAgICAgIHZhciBzdHlsZXNQcm9wcyA9IHtcbiAgICAgICAgICAgIHRvb2xiYXJIZWlnaHQ6IG1vZGUgPT09ICdib29rJyA/IDU2IDogNDgsXG4gICAgICAgICAgICB0b29sYmFyQmdDb2xvcjogbW9kZSA9PT0gJ2Jvb2snID8gdGhpcy5zdGF0ZS5zZWxlY3QgPyBhY2NlbnRDb2xvciA6ICcjZmFmYWZhJyA6IGFwcEJhci5jb2xvcixcbiAgICAgICAgICAgIHRpdGxlRm9udHNpemU6IG1vZGUgPT09ICdib29rJyA/IDIwIDogMTYsXG4gICAgICAgICAgICB0aXRsZUZvbnRXZWlnaHQ6IDQwMCxcbiAgICAgICAgICAgIHRpdGxlQ29sb3I6IG1vZGUgPT09ICdib29rJyA/IHRoaXMuc3RhdGUuc2VsZWN0ID8gJ3doaXRlJyA6ICdyZ2JhKDAsMCwwLDAuODcpJyA6IGFwcEJhci50ZXh0Q29sb3IsXG4gICAgICAgICAgICB0aXRsZVBhZGRpbmc6IDEwLFxuICAgICAgICAgICAgYnV0dG9uOiB7XG4gICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICcgKyBhY2NlbnRDb2xvcixcbiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1MCUnLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogJzAgNHB4JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMzYsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAzNixcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiA2XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWNvbjoge1xuICAgICAgICAgICAgICAgIGZvbnRTaXplOiAyMixcbiAgICAgICAgICAgICAgICBjb2xvcjogYWNjZW50Q29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGJvb2tDb2x1bW4pIHtcbiAgICAgICAgICAgIHN0eWxlc1Byb3BzLnRvb2xiYXJCZ0NvbG9yID0gJ3RyYW5zcGFyZW50JztcbiAgICAgICAgICAgIHN0eWxlc1Byb3BzLnRpdGxlQ29sb3IgPSAncmdiYSgwLDAsMCwwLjU0KSc7XG4gICAgICAgICAgICBzdHlsZXNQcm9wcy50aXRsZUZvbnRzaXplID0gMTQ7XG4gICAgICAgICAgICBzdHlsZXNQcm9wcy50aXRsZUZvbnRXZWlnaHQgPSA1MDA7XG4gICAgICAgICAgICBzdHlsZXNQcm9wcy50aXRsZVBhZGRpbmcgPSAnMTBweCAxNnB4JztcbiAgICAgICAgICAgIHN0eWxlc1Byb3BzLmJ1dHRvbi5ib3JkZXIgPSAnMCc7XG4gICAgICAgICAgICBzdHlsZXNQcm9wcy5pY29uLmNvbG9yID0gbXVpVGhlbWUucGFsZXR0ZS5wcmltYXJ5MUNvbG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxhYmVsID0gaXRlbS5sYWJlbDtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25FZGl0TGFiZWwgJiYgIXRoaXMuc3RhdGUuc2VsZWN0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5lZGl0TGFiZWwpIHtcbiAgICAgICAgICAgICAgICBsYWJlbCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBmbGV4OiAxIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuVGV4dEZpZWxkLCB7IHN0eWxlOiB7IGZvbnRTaXplOiAyMCB9LCB2YWx1ZTogdGhpcy5zdGF0ZS5sYWJlbCwgb25DaGFuZ2U6IHRoaXMub25MYWJlbENoYW5nZS5iaW5kKHRoaXMpLCBvbktleURvd246IHRoaXMub25MYWJlbEtleUVudGVyLmJpbmQodGhpcykgfSksXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkljb25CdXR0b24sIHsgaWNvblN0eWxlOiB7IGNvbG9yOiAnI2UwZTBlMCcgfSwgc2Vjb25kYXJ5OiB0cnVlLCBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktY29udGVudC1zYXZlXCIsIHRvb2x0aXA6IGdldE1lc3NhZ2UoNDgpLCBvblRvdWNoVGFwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlTGFiZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYWJlbCA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBmbGV4OiAxIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkljb25CdXR0b24sIHsgaWNvblN0eWxlOiB7IGNvbG9yOiAnI2UwZTBlMCcgfSwgaWNvbkNsYXNzTmFtZTogXCJtZGkgbWRpLXBlbmNpbFwiLCB0b29sdGlwOiBnZXRNZXNzYWdlKDQ4KSwgb25Ub3VjaFRhcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZWRpdExhYmVsOiB0cnVlLCBsYWJlbDogaXRlbS5sYWJlbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBjcmVhdGVJY29uID0gJ21kaSBtZGktYWNjb3VudC1wbHVzJztcbiAgICAgICAgaWYgKGl0ZW0uYWN0aW9ucyAmJiBpdGVtLmFjdGlvbnMudHlwZSA9PT0gJ3RlYW1zJykge1xuICAgICAgICAgICAgY3JlYXRlSWNvbiA9ICdtZGkgbWRpLWFjY291bnQtbXVsdGlwbGUtcGx1cyc7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvb2xiYXIgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBzdHlsZTogeyBwYWRkaW5nOiBzdHlsZXNQcm9wcy50aXRsZVBhZGRpbmcsIGhlaWdodDogc3R5bGVzUHJvcHMudG9vbGJhckhlaWdodCwgYmFja2dyb3VuZENvbG9yOiBzdHlsZXNQcm9wcy50b29sYmFyQmdDb2xvciwgYm9yZGVyUmFkaXVzOiAnMnB4IDJweCAwIDAnLCBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCB0cmFuc2l0aW9uOiBfcHlkaW9VdGlsRG9tMlsnZGVmYXVsdCddLmdldEJlemllcnNUcmFuc2l0aW9uKCkgfSB9LFxuICAgICAgICAgICAgbW9kZSA9PT0gXCJzZWxlY3RvclwiICYmIGl0ZW0uX3BhcmVudCAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IHN0eWxlOiB7IG1hcmdpbkxlZnQ6IC0xMCB9LCBpY29uQ2xhc3NOYW1lOiAnbWRpIG1kaS1jaGV2cm9uLWxlZnQnLCBvblRvdWNoVGFwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uRm9sZGVyQ2xpY2tlZChpdGVtLl9wYXJlbnQpO1xuICAgICAgICAgICAgICAgIH0gfSksXG4gICAgICAgICAgICBtb2RlID09PSAnYm9vaycgJiYgdG90YWwgPiAwICYmIGl0ZW0uYWN0aW9ucyAmJiBpdGVtLmFjdGlvbnMubXVsdGlwbGUgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuQ2hlY2tib3gsIHsgc3R5bGU6IHsgd2lkdGg6ICdpbml0aWFsJywgbWFyZ2luTGVmdDogdGhpcy5zdGF0ZS5zZWxlY3QgPyA3IDogMTQgfSwgY2hlY2tlZDogdGhpcy5zdGF0ZS5zZWxlY3QsIG9uQ2hlY2s6IHRvZ2dsZVNlbGVjdCB9KSxcbiAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgZmxleDogMiwgZm9udFNpemU6IHN0eWxlc1Byb3BzLnRpdGxlRm9udHNpemUsIGNvbG9yOiBzdHlsZXNQcm9wcy50aXRsZUNvbG9yLCBmb250V2VpZ2h0OiBzdHlsZXNQcm9wcy50aXRsZUZvbnRXZWlnaHQgfSB9LFxuICAgICAgICAgICAgICAgIGxhYmVsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgKG1vZGUgPT09ICdib29rJyB8fCBtb2RlID09PSAnc2VsZWN0b3InICYmIGJvb2tDb2x1bW4pICYmIGl0ZW0uYWN0aW9ucyAmJiBpdGVtLmFjdGlvbnMuY3JlYXRlICYmICF0aGlzLnN0YXRlLnNlbGVjdCAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IHN0eWxlOiBzdHlsZXNQcm9wcy5idXR0b24sIGljb25TdHlsZTogc3R5bGVzUHJvcHMuaWNvbiwgaWNvbkNsYXNzTmFtZTogY3JlYXRlSWNvbiwgdG9vbHRpcFBvc2l0aW9uOiBcImJvdHRvbS1sZWZ0XCIsIHRvb2x0aXA6IGdldE1lc3NhZ2UoaXRlbS5hY3Rpb25zLmNyZWF0ZSksIG9uVG91Y2hUYXA6IGNyZWF0ZUFjdGlvbiB9KSxcbiAgICAgICAgICAgIGJvb2tDb2x1bW4gJiYgIWl0ZW0uX3BhcmVudCAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IHN0eWxlOiBzdHlsZXNQcm9wcy5idXR0b24sIGljb25TdHlsZTogc3R5bGVzUHJvcHMuaWNvbiwgaWNvbkNsYXNzTmFtZTogXCJtZGkgbWRpLXdpbmRvdy1yZXN0b3JlXCIsIHRvb2x0aXBQb3NpdGlvbjogXCJib3R0b20tbGVmdFwiLCB0b29sdGlwOiBweWRpby5NZXNzYWdlSGFzaFsnNDExJ10sIG9uVG91Y2hUYXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcHlkaW8uQ29udHJvbGxlci5maXJlQWN0aW9uKCdvcGVuX2FkZHJlc3NfYm9vaycpO1xuICAgICAgICAgICAgICAgIH0gfSksXG4gICAgICAgICAgICBtb2RlID09PSAnYm9vaycgJiYgaXRlbS5hY3Rpb25zICYmIGl0ZW0uYWN0aW9ucy5yZW1vdmUgJiYgdGhpcy5zdGF0ZS5zZWxlY3QgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuUmFpc2VkQnV0dG9uLCB7IHNlY29uZGFyeTogdHJ1ZSwgbGFiZWw6IGdldE1lc3NhZ2UoaXRlbS5hY3Rpb25zLnJlbW92ZSksIGRpc2FibGVkOiAhdGhpcy5zdGF0ZS5zZWxlY3Rpb24ubGVuZ3RoLCBvblRvdWNoVGFwOiBkZWxldGVBY3Rpb24gfSksXG4gICAgICAgICAgICAhdGhpcy5zdGF0ZS5zZWxlY3QgJiYgYWN0aW9uc1BhbmVsLFxuICAgICAgICAgICAgZW5hYmxlU2VhcmNoICYmICFib29rQ29sdW1uICYmIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9TZWFyY2hGb3JtMlsnZGVmYXVsdCddLCB7IHNlYXJjaExhYmVsOiB0aGlzLnByb3BzLnNlYXJjaExhYmVsLCBvblNlYXJjaDogdGhpcy5wcm9wcy5vblNlYXJjaCwgc3R5bGU6IHsgZmxleDogMSwgbWluV2lkdGg6IDIwMCB9IH0pLFxuICAgICAgICAgICAgcmVsb2FkQWN0aW9uICYmIChtb2RlID09PSAnYm9vaycgfHwgbW9kZSA9PT0gJ3NlbGVjdG9yJyAmJiBib29rQ29sdW1uKSAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7IHN0eWxlOiBzdHlsZXNQcm9wcy5idXR0b24sIGljb25TdHlsZTogc3R5bGVzUHJvcHMuaWNvbiwgaWNvbkNsYXNzTmFtZTogXCJtZGkgbWRpLXJlZnJlc2hcIiwgdG9vbHRpcFBvc2l0aW9uOiBcImJvdHRvbS1sZWZ0XCIsIHRvb2x0aXA6IHB5ZGlvLk1lc3NhZ2VIYXNoWycxNDknXSwgb25Ub3VjaFRhcDogcmVsb2FkQWN0aW9uLCBkaXNhYmxlZDogbG9hZGluZyB9KVxuICAgICAgICApO1xuICAgICAgICAvLyBQQVJFTlQgTk9ERVxuICAgICAgICBpZiAoaXRlbS5fcGFyZW50ICYmIG1vZGUgPT09ICdib29rJyAmJiBpdGVtLl9wYXJlbnQuX3BhcmVudCAmJiBpdGVtLl9wYXJlbnQuaWQgIT09ICd0ZWFtcycpIHtcbiAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTGlzdEl0ZW0sIHtcbiAgICAgICAgICAgICAgICBrZXk6ICdfX3BhcmVudF9fJyxcbiAgICAgICAgICAgICAgICBwcmltYXJ5VGV4dDogXCIuLlwiLFxuICAgICAgICAgICAgICAgIG9uVG91Y2hUYXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7X3RoaXMucHJvcHMub25Gb2xkZXJDbGlja2VkKGl0ZW0uX3BhcmVudCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsZWZ0QXZhdGFyOiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5BdmF0YXIsIHsgaWNvbjogX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRm9udEljb24sIHsgY2xhc3NOYW1lOiAnbWRpIG1kaS1hcnJvdy11cCcgfSksIHNpemU6IDM2IH0pXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpZiAodG90YWwpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkRpdmlkZXIsIHsgaW5zZXQ6IHRydWUsIGtleTogJ3BhcmVudC1kaXZpZGVyJyB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSVRFTVNcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKGl0ZW0uc3ViaGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuU3ViaGVhZGVyLFxuICAgICAgICAgICAgICAgICAgICB7IGtleTogaXRlbS5zdWJoZWFkZXIgfSxcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdWJoZWFkZXJcbiAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZm9udEljb24gPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfYXZhdGFyVXNlckF2YXRhcjJbJ2RlZmF1bHQnXSwgeyBhdmF0YXJTaXplOiAzNiwgcHlkaW86IHRoaXMucHJvcHMucHlkaW8gfHwgcHlkaW8sXG4gICAgICAgICAgICAgICAgdXNlcklkOiBpdGVtLmlkLFxuICAgICAgICAgICAgICAgIHVzZXJMYWJlbDogaXRlbS5sYWJlbCxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGl0ZW0uYXZhdGFyLFxuICAgICAgICAgICAgICAgIGljb246IGl0ZW0uaWNvbixcbiAgICAgICAgICAgICAgICBpZG1Vc2VyOiBpdGVtLklkbVVzZXIsXG4gICAgICAgICAgICAgICAgdXNlclR5cGU6IGl0ZW0udHlwZSB8fCAnZ3JvdXAnLFxuICAgICAgICAgICAgICAgIGF2YXRhck9ubHk6IHRydWUsXG4gICAgICAgICAgICAgICAgdXNlRGVmYXVsdEF2YXRhcjogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgcmlnaHRJY29uQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIHRvdWNoVGFwID0gZnVuY3Rpb24gdG91Y2hUYXAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7X3RoaXMyLnByb3BzLm9uSXRlbUNsaWNrZWQoaXRlbSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGZvbGRlcnMuaW5kZXhPZihpdGVtKSA+IC0xICYmIHRoaXMucHJvcHMub25Gb2xkZXJDbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgdG91Y2hUYXAgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO190aGlzMi5wcm9wcy5vbkZvbGRlckNsaWNrZWQoaXRlbSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ3NlbGVjdG9yJyAmJiAhaXRlbS5fbm90U2VsZWN0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICByaWdodEljb25CdXR0b24gPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5JY29uQnV0dG9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktYWNjb3VudC1tdWx0aXBsZS1wbHVzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBcIlNlbGVjdCB0aGlzIGdyb3VwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwUG9zaXRpb246ICdib3R0b20tbGVmdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnByb3BzLm9uSXRlbUNsaWNrZWQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2lubmVyJyAmJiB0aGlzLnByb3BzLm9uRGVsZXRlQWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmlnaHRJY29uQnV0dG9uID0gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuSWNvbkJ1dHRvbiwge1xuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktZGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IGdldE1lc3NhZ2UoMjU3KSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcFBvc2l0aW9uOiAnYm90dG9tLWxlZnQnLFxuICAgICAgICAgICAgICAgICAgICBpY29uU3R5bGU6IHsgY29sb3I6ICdyZ2JhKDAsMCwwLDAuMTMpJywgaG92ZXJDb2xvcjogJ3JnYmEoMCwwLDAsMC41MyknIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uVG91Y2hUYXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5wcm9wcy5vbkRlbGV0ZUFjdGlvbihfdGhpczIucHJvcHMuaXRlbSwgW2l0ZW1dKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJvb2tDb2x1bW4gJiYgdGhpcy5wcm9wcy5hY3Rpb25zRm9yQ2VsbCAmJiBpdGVtLnR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVudUl0ZW1zID0gbmV3IF9hdmF0YXJDZWxsQWN0aW9uc1JlbmRlcmVyMlsnZGVmYXVsdCddKHB5ZGlvLCB0aGlzLnByb3BzLmFjdGlvbnNGb3JDZWxsLCBudWxsLCBpdGVtKS5yZW5kZXJJdGVtcygpO1xuICAgICAgICAgICAgICAgIGlmIChtZW51SXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0SWNvbkJ1dHRvbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuSWNvbk1lbnUsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkJ1dHRvbkVsZW1lbnQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkljb25CdXR0b24sIHsgaWNvbkNsYXNzTmFtZTogJ21kaSBtZGktZG90cy12ZXJ0aWNhbCcsIGljb25TdHlsZTogeyBjb2xvcjogJ3JnYmEoMCwwLDAsLjMzKScgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRPcmlnaW46IHsgaG9yaXpvbnRhbDogJ3JpZ2h0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yT3JpZ2luOiB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudUl0ZW1zXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNlbGVjdCA9IGZ1bmN0aW9uIHNlbGVjdChlLCBjaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2VsZWN0aW9uOiBbXS5jb25jYXQoX3RoaXMyLnN0YXRlLnNlbGVjdGlvbiwgW2l0ZW1dKSB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdGVTZWwgPSBfdGhpczIuc3RhdGUuc2VsZWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0aW9uID0gW10uY29uY2F0KHN0YXRlU2VsLnNsaWNlKDAsIHN0YXRlU2VsLmluZGV4T2YoaXRlbSkpLCBzdGF0ZVNlbC5zbGljZShzdGF0ZVNlbC5pbmRleE9mKGl0ZW0pICsgMSkpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzZWxlY3Rpb246IHNlbGVjdGlvbiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZWxlbWVudHMucHVzaChfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5MaXN0SXRlbSwge1xuICAgICAgICAgICAgICAgIGtleTogaXRlbS5pZCxcbiAgICAgICAgICAgICAgICBwcmltYXJ5VGV4dDogaXRlbS5sYWJlbCxcbiAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiB0b3VjaFRhcCxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogbW9kZSA9PT0gJ2lubmVyJyxcbiAgICAgICAgICAgICAgICBsZWZ0QXZhdGFyOiAhdGhpcy5zdGF0ZS5zZWxlY3QgJiYgZm9udEljb24sXG4gICAgICAgICAgICAgICAgcmlnaHRJY29uQnV0dG9uOiByaWdodEljb25CdXR0b24sXG4gICAgICAgICAgICAgICAgbGVmdENoZWNrYm94OiB0aGlzLnN0YXRlLnNlbGVjdCAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5DaGVja2JveCwgeyBjaGVja2VkOiB0aGlzLnN0YXRlLnNlbGVjdGlvbi5pbmRleE9mKGl0ZW0pID4gLTEsIG9uQ2hlY2s6IHNlbGVjdCB9KVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKG1vZGUgIT09ICdpbm5lcicgJiYgaW5kZXggPCB0b3RhbCAtIDEpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9tYXRlcmlhbFVpLkRpdmlkZXIsIHsgaW5zZXQ6IHRydWUsIGtleTogaXRlbS5pZCArICctZGl2aWRlcicgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB2YXIgZW1wdHlTdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCFlbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBlbXB0eVN0YXRlUHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgc3R5bGU6IHsgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLCBtaW5IZWlnaHQ6IDMwMCB9LFxuICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU6ICdtZGkgbWRpLWFjY291bnQtb2ZmJyxcbiAgICAgICAgICAgICAgICBwcmltYXJ5VGV4dElkOiB0aGlzLnByb3BzLmVtcHR5U3RhdGVQcmltYXJ5VGV4dCB8fCBnZXRNZXNzYWdlKDYyOSksXG4gICAgICAgICAgICAgICAgc2Vjb25kYXJ5VGV4dElkOiBtb2RlID09PSAnYm9vaycgPyB0aGlzLnByb3BzLmVtcHR5U3RhdGVTZWNvbmRhcnlUZXh0IHx8IG51bGwgOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKG1vZGUgPT09ICdib29rJyAmJiBpdGVtLmFjdGlvbnMgJiYgaXRlbS5hY3Rpb25zLmNyZWF0ZSkge1xuICAgICAgICAgICAgICAgIGVtcHR5U3RhdGVQcm9wcyA9IF9leHRlbmRzKHt9LCBlbXB0eVN0YXRlUHJvcHMsIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uTGFiZWxJZDogZ2V0TWVzc2FnZShpdGVtLmFjdGlvbnMuY3JlYXRlKSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQ2FsbGJhY2s6IGNyZWF0ZUFjdGlvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZW1wdHlTdGF0ZSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF92aWV3c0VtcHR5U3RhdGVWaWV3MlsnZGVmYXVsdCddLCBlbXB0eVN0YXRlUHJvcHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiB7IGZsZXg6IDEsIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLCBkaXNwbGF5OiAnZmxleCcgfSwgb25Ub3VjaFRhcDogdGhpcy5wcm9wcy5vblRvdWNoVGFwIH0sXG4gICAgICAgICAgICBtb2RlICE9PSAnaW5uZXInICYmICF0aGlzLnByb3BzLm5vVG9vbGJhciAmJiB0b29sYmFyLFxuICAgICAgICAgICAgIWVtcHR5U3RhdGUgJiYgIWxvYWRpbmcgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgX21hdGVyaWFsVWkuTGlzdCxcbiAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IGZsZXg6IDEsIG92ZXJmbG93WTogbW9kZSAhPT0gJ2lubmVyJyA/ICdhdXRvJyA6ICdpbml0aWFsJyB9IH0sXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5zdWJIZWFkZXIgJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIF9tYXRlcmlhbFVpLlN1YmhlYWRlcixcbiAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5zdWJIZWFkZXJcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRzXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbG9hZGluZyAmJiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChMb2FkZXIsIHsgc3R5bGU6IHsgZmxleDogMSB9IH0pLFxuICAgICAgICAgICAgIWxvYWRpbmcgJiYgZW1wdHlTdGF0ZSxcbiAgICAgICAgICAgIG1vZGUgPT09ICdzZWxlY3RvcicgJiYgZW5hYmxlU2VhcmNoICYmIGJvb2tDb2x1bW4gJiYgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX1NlYXJjaEZvcm0yWydkZWZhdWx0J10sIHtcbiAgICAgICAgICAgICAgICBzZWFyY2hMYWJlbDogdGhpcy5wcm9wcy5zZWFyY2hMYWJlbCxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogdGhpcy5wcm9wcy5vblNlYXJjaCxcbiAgICAgICAgICAgICAgICBzdHlsZTogeyBwYWRkaW5nOiAnMCAyMHB4JywgbWluV2lkdGg6IG51bGwsIGJvcmRlclRvcDogJzFweCBzb2xpZCAjZTBlMGUwJyB9LFxuICAgICAgICAgICAgICAgIHVuZGVybGluZVNob3c6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVXNlcnNMaXN0O1xufSkoX3JlYWN0MlsnZGVmYXVsdCddLkNvbXBvbmVudCk7XG5cblVzZXJzTGlzdC5wcm9wVHlwZXMgPSB7XG4gICAgaXRlbTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5vYmplY3QsXG4gICAgb25DcmVhdGVBY3Rpb246IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICBvbkRlbGV0ZUFjdGlvbjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgIG9uSXRlbUNsaWNrZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICBvbkZvbGRlckNsaWNrZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICBvbkVkaXRMYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgIG1vZGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMub25lT2YoWydib29rJywgJ3NlbGVjdG9yJywgJ2lubmVyJ10pLFxuICAgIGJvb2tDb2x1bW46IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbFxufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gVXNlcnNMaXN0ID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoVXNlcnNMaXN0KTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFVzZXJzTGlzdCA9IF9tYXRlcmlhbFVpU3R5bGVzLm11aVRoZW1lYWJsZSgpKFVzZXJzTGlzdCk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFVzZXJzTGlzdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfYWRkcmVzc2Jvb2tBZGRyZXNzQm9vayA9IHJlcXVpcmUoJy4uL2FkZHJlc3Nib29rL0FkZHJlc3NCb29rJyk7XG5cbnZhciBfYWRkcmVzc2Jvb2tBZGRyZXNzQm9vazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hZGRyZXNzYm9va0FkZHJlc3NCb29rKTtcblxudmFyIF9wb2xpY2llc1Jlc291cmNlUG9saWNpZXNQYW5lbCA9IHJlcXVpcmUoJy4uLy4uL3BvbGljaWVzL1Jlc291cmNlUG9saWNpZXNQYW5lbCcpO1xuXG52YXIgX3BvbGljaWVzUmVzb3VyY2VQb2xpY2llc1BhbmVsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3BvbGljaWVzUmVzb3VyY2VQb2xpY2llc1BhbmVsKTtcblxudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbnZhciBQeWRpb0FwaSA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvYXBpJyk7XG52YXIgUmVzb3VyY2VzTWFuYWdlciA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvcmVzb3VyY2VzLW1hbmFnZXInKTtcblxudmFyIF9yZXF1aXJlID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIEljb25CdXR0b24gPSBfcmVxdWlyZS5JY29uQnV0dG9uO1xudmFyIFBvcG92ZXIgPSBfcmVxdWlyZS5Qb3BvdmVyO1xuXG52YXIgX3JlcXVpcmUyID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWkvc3R5bGVzJyk7XG5cbnZhciBtdWlUaGVtZWFibGUgPSBfcmVxdWlyZTIubXVpVGhlbWVhYmxlO1xuXG52YXIgX3JlcXVpcmUkcmVxdWlyZUxpYiA9IHJlcXVpcmUoJ3B5ZGlvJykucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfcmVxdWlyZSRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xudmFyIEFzeW5jQ29tcG9uZW50ID0gX3JlcXVpcmUkcmVxdWlyZUxpYi5Bc3luY0NvbXBvbmVudDtcblxudmFyIEFjdGlvbnNQYW5lbCA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhBY3Rpb25zUGFuZWwsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gQWN0aW9uc1BhbmVsKHByb3BzLCBjb250ZXh0KSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBY3Rpb25zUGFuZWwpO1xuXG4gICAgICAgIF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzaG93UGlja2VyOiBmYWxzZSwgcGlja2VyQW5jaG9yOiBudWxsLFxuICAgICAgICAgICAgc2hvd01haWxlcjogZmFsc2UsIG1haWxlckFuY2hvcjogbnVsbCxcbiAgICAgICAgICAgIHNob3dQb2xpY2llczogZmFsc2UsIHBvbGljaWVzQW5jaG9yOiBudWxsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgQWN0aW9uc1BhbmVsLnByb3RvdHlwZS5vblRlYW1TZWxlY3RlZCA9IGZ1bmN0aW9uIG9uVGVhbVNlbGVjdGVkKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dQaWNrZXI6IGZhbHNlIH0pO1xuICAgICAgICBpZiAoaXRlbS5JZG1Sb2xlICYmIGl0ZW0uSWRtUm9sZS5Jc1RlYW0pIHtcbiAgICAgICAgICAgIFB5ZGlvQXBpLmdldFJlc3RDbGllbnQoKS5nZXRJZG1BcGkoKS5hZGRVc2VyVG9UZWFtKGl0ZW0uSWRtUm9sZS5VdWlkLCB0aGlzLnByb3BzLnVzZXJJZCwgdGhpcy5wcm9wcy5yZWxvYWRBY3Rpb24pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEFjdGlvbnNQYW5lbC5wcm90b3R5cGUub25Vc2VyU2VsZWN0ZWQgPSBmdW5jdGlvbiBvblVzZXJTZWxlY3RlZChpdGVtKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93UGlja2VyOiBmYWxzZSB9KTtcbiAgICAgICAgUHlkaW9BcGkuZ2V0UmVzdENsaWVudCgpLmdldElkbUFwaSgpLmFkZFVzZXJUb1RlYW0odGhpcy5wcm9wcy50ZWFtLmlkLCBpdGVtLklkbVVzZXIuTG9naW4sIHRoaXMucHJvcHMucmVsb2FkQWN0aW9uKTtcbiAgICB9O1xuXG4gICAgQWN0aW9uc1BhbmVsLnByb3RvdHlwZS5vcGVuUGlja2VyID0gZnVuY3Rpb24gb3BlblBpY2tlcihldmVudCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1BpY2tlcjogdHJ1ZSwgcGlja2VyQW5jaG9yOiBldmVudC5jdXJyZW50VGFyZ2V0IH0pO1xuICAgIH07XG5cbiAgICBBY3Rpb25zUGFuZWwucHJvdG90eXBlLm9wZW5Qb2xpY2llcyA9IGZ1bmN0aW9uIG9wZW5Qb2xpY2llcyhldmVudCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1BvbGljaWVzOiB0cnVlLCBwb2xpY2llc0FuY2hvcjogZXZlbnQuY3VycmVudFRhcmdldCB9KTtcbiAgICB9O1xuXG4gICAgQWN0aW9uc1BhbmVsLnByb3RvdHlwZS5vcGVuTWFpbGVyID0gZnVuY3Rpb24gb3Blbk1haWxlcihldmVudCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICBSZXNvdXJjZXNNYW5hZ2VyLmxvYWRDbGFzc2VzQW5kQXBwbHkoWydQeWRpb01haWxlciddLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IG1haWxlckxpYkxvYWRlZDogdHJ1ZSB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaG93TWFpbGVyOiB0cnVlLCBtYWlsZXJBbmNob3I6IHRhcmdldCB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQWN0aW9uc1BhbmVsLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzLCBwcmV2U3RhdGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnByb3BzLmxvY2tPblN1YlBvcG92ZXJPcGVuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh0aGlzLnN0YXRlLnNob3dQaWNrZXIgfHwgdGhpcy5zdGF0ZS5zaG93TWFpbGVyKSAmJiAhKHByZXZTdGF0ZS5zaG93UGlja2VyIHx8IHByZXZTdGF0ZS5zaG93TWFpbGVyKSkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5sb2NrT25TdWJQb3BvdmVyT3Blbih0cnVlKTtcbiAgICAgICAgfSBlbHNlIGlmICghKHRoaXMuc3RhdGUuc2hvd1BpY2tlciB8fCB0aGlzLnN0YXRlLnNob3dNYWlsZXIpICYmIChwcmV2U3RhdGUuc2hvd1BpY2tlciB8fCBwcmV2U3RhdGUuc2hvd01haWxlcikpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMubG9ja09uU3ViUG9wb3Zlck9wZW4oZmFsc2UpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEFjdGlvbnNQYW5lbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIGdldE1lc3NhZ2UgPSBfcHJvcHMuZ2V0TWVzc2FnZTtcbiAgICAgICAgdmFyIG11aVRoZW1lID0gX3Byb3BzLm11aVRoZW1lO1xuICAgICAgICB2YXIgdGVhbSA9IF9wcm9wcy50ZWFtO1xuICAgICAgICB2YXIgdXNlciA9IF9wcm9wcy51c2VyO1xuICAgICAgICB2YXIgdXNlckVkaXRhYmxlID0gX3Byb3BzLnVzZXJFZGl0YWJsZTtcbiAgICAgICAgdmFyIHVzZXJJZCA9IF9wcm9wcy51c2VySWQ7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wcy5zdHlsZTtcbiAgICAgICAgdmFyIHpEZXB0aCA9IF9wcm9wcy56RGVwdGg7XG5cbiAgICAgICAgdmFyIHN0eWxlcyA9IHtcbiAgICAgICAgICAgIGJ1dHRvbjoge1xuICAgICAgICAgICAgICAgIC8vYmFja2dyb3VuZENvbG9yOiBtdWlUaGVtZS5wYWxldHRlLmFjY2VudDJDb2xvcixcbiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgJyArIG11aVRoZW1lLnBhbGV0dGUuYWNjZW50MkNvbG9yLFxuICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzUwJScsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiAnMCA0cHgnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAzNixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDM2LFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDZcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpY29uOiB7XG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDIyLFxuICAgICAgICAgICAgICAgIC8vY29sb3I6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICBjb2xvcjogbXVpVGhlbWUucGFsZXR0ZS5hY2NlbnQyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHVzZXJtYWlscyA9IHt9O1xuICAgICAgICB2YXIgYWN0aW9ucyA9IFtdO1xuICAgICAgICB2YXIgcmVzb3VyY2VUeXBlID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgcmVzb3VyY2VJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHVzZXIgJiYgdXNlci5oYXNFbWFpbCkge1xuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKHsga2V5OiAnbWVzc2FnZScsIGxhYmVsOiBnZXRNZXNzYWdlKDU5OCksIGljb246ICdlbWFpbCcsIGNhbGxiYWNrOiB0aGlzLm9wZW5NYWlsZXIuYmluZCh0aGlzKSB9KTtcbiAgICAgICAgICAgIHVzZXJtYWlsc1t1c2VyLmlkXSA9IFB5ZGlvVXNlcnMuVXNlci5mcm9tT2JqZWN0KHVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZWFtKSB7XG4gICAgICAgICAgICByZXNvdXJjZVR5cGUgPSAndGVhbSc7XG4gICAgICAgICAgICByZXNvdXJjZUlkID0gdGVhbS5pZDtcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaCh7IGtleTogJ3VzZXJzJywgbGFiZWw6IGdldE1lc3NhZ2UoNTk5KSwgaWNvbjogJ2FjY291bnQtbXVsdGlwbGUtcGx1cycsIGNhbGxiYWNrOiB0aGlzLm9wZW5QaWNrZXIuYmluZCh0aGlzKSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc291cmNlVHlwZSA9ICd1c2VyJztcbiAgICAgICAgICAgIHJlc291cmNlSWQgPSB1c2VySWQ7XG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goeyBrZXk6ICd0ZWFtcycsIGxhYmVsOiBnZXRNZXNzYWdlKDU3MyksIGljb246ICdhY2NvdW50LW11bHRpcGxlLXBsdXMnLCBjYWxsYmFjazogdGhpcy5vcGVuUGlja2VyLmJpbmQodGhpcykgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZXJFZGl0YWJsZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25FZGl0QWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKHsga2V5OiAnZWRpdCcsIGxhYmVsOiB0aGlzLnByb3BzLnRlYW0gPyBnZXRNZXNzYWdlKDU4MCkgOiBnZXRNZXNzYWdlKDYwMCksIGljb246ICdwZW5jaWwnLCBjYWxsYmFjazogdGhpcy5wcm9wcy5vbkVkaXRBY3Rpb24gfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goeyBrZXk6ICdwb2xpY2llcycsIGxhYmVsOiAnVmlzaWJpbGl0eScsIGljb246ICdzZWN1cml0eScsIGNhbGxiYWNrOiB0aGlzLm9wZW5Qb2xpY2llcy5iaW5kKHRoaXMpIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25EZWxldGVBY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goeyBrZXk6ICdkZWxldGUnLCBsYWJlbDogdGhpcy5wcm9wcy50ZWFtID8gZ2V0TWVzc2FnZSg1NzApIDogZ2V0TWVzc2FnZSg1ODIpLCBpY29uOiAnZGVsZXRlJywgY2FsbGJhY2s6IHRoaXMucHJvcHMub25EZWxldGVBY3Rpb24gfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgeyBzdHlsZTogX2V4dGVuZHMoeyB0ZXh0QWxpZ246ICdjZW50ZXInLCBwYWRkaW5nVG9wOiAxMCwgcGFkZGluZ0JvdHRvbTogMTAsIGJvcmRlclRvcDogJzFweCBzb2xpZCAjZTBlMGUwJywgYm9yZGVyQm90dG9tOiAnMXB4IHNvbGlkICNlMGUwZTAnIH0sIHN0eWxlKSB9LFxuICAgICAgICAgICAgYWN0aW9ucy5tYXAoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChJY29uQnV0dG9uLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleTogYS5rZXksXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiBzdHlsZXMuYnV0dG9uLFxuICAgICAgICAgICAgICAgICAgICBpY29uU3R5bGU6IHN0eWxlcy5pY29uLFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBhLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lOiBcIm1kaSBtZGktXCIgKyBhLmljb24sXG4gICAgICAgICAgICAgICAgICAgIG9uVG91Y2hUYXA6IGEuY2FsbGJhY2tcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBQb3BvdmVyLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdGhpcy5zdGF0ZS5zaG93UGlja2VyLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JFbDogdGhpcy5zdGF0ZS5waWNrZXJBbmNob3IsXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvck9yaWdpbjogeyBob3Jpem9udGFsOiAncmlnaHQnLCB2ZXJ0aWNhbDogJ3RvcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9LFxuICAgICAgICAgICAgICAgICAgICBvblJlcXVlc3RDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2hvd1BpY2tlcjogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZUxheWVyRm9yQ2xpY2tBd2F5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgekluZGV4OiAyMjAwIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IHdpZHRoOiAyNTYsIGhlaWdodDogMzIwIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfYWRkcmVzc2Jvb2tBZGRyZXNzQm9vazJbJ2RlZmF1bHQnXSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ3NlbGVjdG9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHB5ZGlvOiB0aGlzLnByb3BzLnB5ZGlvLFxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyU3R5bGU6IHsgd2lkdGg6IDMyMCwgaGVpZ2h0OiA0MjAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uSXRlbVNlbGVjdGVkOiB0aGlzLnByb3BzLnRlYW0gPyB0aGlzLm9uVXNlclNlbGVjdGVkLmJpbmQodGhpcykgOiB0aGlzLm9uVGVhbVNlbGVjdGVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtc09ubHk6ICF0aGlzLnByb3BzLnRlYW0sXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc09ubHk6ICEhdGhpcy5wcm9wcy50ZWFtXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgUG9wb3ZlcixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9wZW46IHRoaXMuc3RhdGUuc2hvd01haWxlcixcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yRWw6IHRoaXMuc3RhdGUubWFpbGVyQW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3JPcmlnaW46IHsgaG9yaXpvbnRhbDogJ3JpZ2h0JywgdmVydGljYWw6ICd0b3AnIH0sXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldE9yaWdpbjogeyBob3Jpem9udGFsOiAncmlnaHQnLCB2ZXJ0aWNhbDogJ3RvcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlTGF5ZXJGb3JDbGlja0F3YXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogeyB6SW5kZXg6IDIyMDAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgd2lkdGg6IDI1NiwgaGVpZ2h0OiAzMjAgfSB9LFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLm1haWxlckxpYkxvYWRlZCAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KEFzeW5jQ29tcG9uZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2U6ICdQeWRpb01haWxlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnROYW1lOiAnUGFuZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB6RGVwdGg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYW5lbFRpdGxlOiBnZXRNZXNzYWdlKDU5OCksXG4gICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVVc2VyU3R5bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyczogdXNlcm1haWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25EaXNtaXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2hvd01haWxlcjogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgb25GaWVsZEZvY3VzOiB0aGlzLnByb3BzLm90aGVyUG9wb3Zlck1vdXNlT3ZlclxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFBvcG92ZXIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBvcGVuOiB0aGlzLnN0YXRlLnNob3dQb2xpY2llcyxcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yRWw6IHRoaXMuc3RhdGUucG9saWNpZXNBbmNob3IsXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvck9yaWdpbjogeyBob3Jpem9udGFsOiAncmlnaHQnLCB2ZXJ0aWNhbDogJ3RvcCcgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T3JpZ2luOiB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VMYXllckZvckNsaWNrQXdheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7IHpJbmRleDogMjAwMCB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogeyB3aWR0aDogMjU2LCBoZWlnaHQ6IDMyMCB9IH0sXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX3BvbGljaWVzUmVzb3VyY2VQb2xpY2llc1BhbmVsMlsnZGVmYXVsdCddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBweWRpbzogdGhpcy5wcm9wcy5weWRpbyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogcmVzb3VyY2VUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VJZDogcmVzb3VyY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRGlzbWlzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IHNob3dQb2xpY2llczogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gQWN0aW9uc1BhbmVsO1xufSkoUmVhY3QuQ29tcG9uZW50KTtcblxuQWN0aW9uc1BhbmVsLnByb3BUeXBlcyA9IHtcblxuICAgIC8qKlxuICAgICAqIFVzZXIgZGF0YSwgcHJvcHMgbXVzdCBwYXNzIGF0IGxlYXN0IG9uZSBvZiAndXNlcicgb3IgJ3RlYW0nXG4gICAgICovXG4gICAgdXNlcjogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICAvKipcbiAgICAgKiBUZWFtIGRhdGEsIHByb3BzIG11c3QgcGFzcyBhdCBsZWFzdCBvbmUgb2YgJ3VzZXInIG9yICd0ZWFtJ1xuICAgICAqL1xuICAgIHRlYW06IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgLyoqXG4gICAgICogRm9yIHVzZXJzLCB3aGV0aGVyIGl0IGlzIGVkaXRhYmxlIG9yIG5vdFxuICAgICAqL1xuICAgIHVzZXJFZGl0YWJsZTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdFxuXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBBY3Rpb25zUGFuZWwgPSBQeWRpb0NvbnRleHRDb25zdW1lcihBY3Rpb25zUGFuZWwpO1xuZXhwb3J0c1snZGVmYXVsdCddID0gQWN0aW9uc1BhbmVsID0gbXVpVGhlbWVhYmxlKCkoQWN0aW9uc1BhbmVsKTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gQWN0aW9uc1BhbmVsO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBfcHlkaW9Nb2RlbElkbU9iamVjdEhlbHBlciA9IHJlcXVpcmUoJ3B5ZGlvL21vZGVsL2lkbS1vYmplY3QtaGVscGVyJyk7XG5cbnZhciBfcHlkaW9Nb2RlbElkbU9iamVjdEhlbHBlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb01vZGVsSWRtT2JqZWN0SGVscGVyKTtcblxudmFyIF9weWRpb01vZGVsQ2VsbCA9IHJlcXVpcmUoJ3B5ZGlvL21vZGVsL2NlbGwnKTtcblxudmFyIF9weWRpb01vZGVsQ2VsbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb01vZGVsQ2VsbCk7XG5cbnZhciBDZWxsQWN0aW9uc1JlbmRlcmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDZWxsQWN0aW9uc1JlbmRlcmVyKHB5ZGlvLCBjZWxsTW9kZWwsIGFjbCkge1xuICAgICAgICB2YXIgYWRkcmVzc0Jvb2tJdGVtID0gYXJndW1lbnRzLmxlbmd0aCA8PSAzIHx8IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGFyZ3VtZW50c1szXTtcblxuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2VsbEFjdGlvbnNSZW5kZXJlcik7XG5cbiAgICAgICAgdGhpcy5wcm9wcyA9IHsgcHlkaW86IHB5ZGlvLCBjZWxsTW9kZWw6IGNlbGxNb2RlbCwgYWNsOiBhY2wsIGFkZHJlc3NCb29rSXRlbTogYWRkcmVzc0Jvb2tJdGVtIH07XG4gICAgfVxuXG4gICAgQ2VsbEFjdGlvbnNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQ2VsbCA9IGZ1bmN0aW9uIGNyZWF0ZUNlbGwoKSB7XG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgYWRkcmVzc0Jvb2tJdGVtID0gX3Byb3BzLmFkZHJlc3NCb29rSXRlbTtcbiAgICAgICAgdmFyIHB5ZGlvID0gX3Byb3BzLnB5ZGlvO1xuXG4gICAgICAgIHZhciBtID0gcHlkaW8uTWVzc2FnZUhhc2g7XG5cbiAgICAgICAgdmFyIGlkbU9iamVjdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGFkZHJlc3NCb29rSXRlbS5JZG1Vc2VyKSB7XG4gICAgICAgICAgICBpZG1PYmplY3QgPSBhZGRyZXNzQm9va0l0ZW0uSWRtVXNlcjtcbiAgICAgICAgfSBlbHNlIGlmIChhZGRyZXNzQm9va0l0ZW0uSWRtUm9sZSkge1xuICAgICAgICAgICAgaWRtT2JqZWN0ID0gYWRkcmVzc0Jvb2tJdGVtLklkbVJvbGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlkbU9iamVjdCkge1xuICAgICAgICAgICAgcHlkaW8udXNlci5nZXRJZG1Vc2VyKCkudGhlbihmdW5jdGlvbiAobG9nZ2VkVXNlcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxvZ2dlZExhYmVsID0gX3B5ZGlvTW9kZWxJZG1PYmplY3RIZWxwZXIyWydkZWZhdWx0J10uZXh0cmFjdExhYmVsRnJvbUlkbU9iamVjdChsb2dnZWRVc2VyKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0TGFiZWwgPSBfcHlkaW9Nb2RlbElkbU9iamVjdEhlbHBlcjJbJ2RlZmF1bHQnXS5leHRyYWN0TGFiZWxGcm9tSWRtT2JqZWN0KGFkZHJlc3NCb29rSXRlbS5JZG1Vc2VyIHx8IGFkZHJlc3NCb29rSXRlbS5JZG1Sb2xlKTtcblxuICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBfcHlkaW9Nb2RlbENlbGwyWydkZWZhdWx0J10oKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5zZXRMYWJlbChsb2dnZWRMYWJlbCArIFwiLCBcIiArIHRhcmdldExhYmVsKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5zZXREZXNjcmlwdGlvbihcIkNyZWF0ZWQgYnkgXCIgKyBsb2dnZWRMYWJlbCk7XG4gICAgICAgICAgICAgICAgbW9kZWwuYWRkVXNlcihpZG1PYmplY3QpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnNhdmUoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcHlkaW8uVUkuZGlzcGxheU1lc3NhZ2UoJ1NVQ0NFU1MnLCBtWyc2NDMnXS5yZXBsYWNlKCclcycsIHRhcmdldExhYmVsKSk7XG4gICAgICAgICAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICBweWRpby5VSS5kaXNwbGF5TWVzc2FnZSgnRVJST1InLCBtWyc2NDQnXS5yZXBsYWNlKCclcycsIHJlYXNvbi5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBDZWxsQWN0aW9uc1JlbmRlcmVyLnByb3RvdHlwZS5hZGRUb0NlbGwgPSBmdW5jdGlvbiBhZGRUb0NlbGwoKSB7XG4gICAgICAgIHZhciBpZG1PYmplY3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBfcHJvcHMyID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIGFkZHJlc3NCb29rSXRlbSA9IF9wcm9wczIuYWRkcmVzc0Jvb2tJdGVtO1xuICAgICAgICB2YXIgY2VsbE1vZGVsID0gX3Byb3BzMi5jZWxsTW9kZWw7XG5cbiAgICAgICAgaWYgKGFkZHJlc3NCb29rSXRlbS5JZG1Vc2VyKSB7XG4gICAgICAgICAgICBpZG1PYmplY3QgPSBhZGRyZXNzQm9va0l0ZW0uSWRtVXNlcjtcbiAgICAgICAgfSBlbHNlIGlmIChhZGRyZXNzQm9va0l0ZW0uSWRtUm9sZSkge1xuICAgICAgICAgICAgaWRtT2JqZWN0ID0gYWRkcmVzc0Jvb2tJdGVtLklkbVJvbGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlkbU9iamVjdCkge1xuICAgICAgICAgICAgY2VsbE1vZGVsLmFkZFVzZXIoaWRtT2JqZWN0KTtcbiAgICAgICAgICAgIGNlbGxNb2RlbC5zYXZlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgQ2VsbEFjdGlvbnNSZW5kZXJlci5wcm90b3R5cGUucmVtb3ZlRnJvbUNlbGwgPSBmdW5jdGlvbiByZW1vdmVGcm9tQ2VsbCgpIHtcbiAgICAgICAgdmFyIF9wcm9wczMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgYWNsID0gX3Byb3BzMy5hY2w7XG4gICAgICAgIHZhciBjZWxsTW9kZWwgPSBfcHJvcHMzLmNlbGxNb2RlbDtcblxuICAgICAgICBjZWxsTW9kZWwucmVtb3ZlVXNlcihhY2wuUm9sZUlkKTtcbiAgICAgICAgY2VsbE1vZGVsLnNhdmUoKTtcbiAgICB9O1xuXG4gICAgQ2VsbEFjdGlvbnNSZW5kZXJlci5wcm90b3R5cGUucmVuZGVySXRlbXMgPSBmdW5jdGlvbiByZW5kZXJJdGVtcygpIHtcbiAgICAgICAgdmFyIF9wcm9wczQgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgcHlkaW8gPSBfcHJvcHM0LnB5ZGlvO1xuICAgICAgICB2YXIgY2VsbE1vZGVsID0gX3Byb3BzNC5jZWxsTW9kZWw7XG4gICAgICAgIHZhciBhY2wgPSBfcHJvcHM0LmFjbDtcbiAgICAgICAgdmFyIGFkZHJlc3NCb29rSXRlbSA9IF9wcm9wczQuYWRkcmVzc0Jvb2tJdGVtO1xuXG4gICAgICAgIHZhciBtID0gcHlkaW8uTWVzc2FnZUhhc2g7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgY3VycmVudCB1c2VyIGl0IHRoZSBsb2dnZWQgb25lXG4gICAgICAgIHZhciBpc0xvZ2dlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGFjbCkge1xuICAgICAgICAgICAgaXNMb2dnZWQgPSBhY2wuVXNlciAmJiBhY2wuVXNlci5Mb2dpbiA9PT0gcHlkaW8udXNlci5pZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlzTG9nZ2VkID0gdXNlclR5cGUgPT09ICd1c2VyJyAmJiBweWRpby51c2VyLmlkID09PSB1c2VySWQ7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIGlmIChpc0xvZ2dlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9XG4gICAgICAgIHZhciB1c2VySWQgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICB1c2VyVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGFkZHJlc3NCb29rSXRlbSkge1xuICAgICAgICAgICAgdXNlcklkID0gYWRkcmVzc0Jvb2tJdGVtLmlkO1xuICAgICAgICAgICAgdXNlclR5cGUgPSBhZGRyZXNzQm9va0l0ZW0udHlwZTtcbiAgICAgICAgICAgIGlmICh1c2VyVHlwZSA9PT0gJ2dyb3VwJyAmJiBhZGRyZXNzQm9va0l0ZW0uSWRtUm9sZSkge1xuICAgICAgICAgICAgICAgIHVzZXJJZCA9IGFkZHJlc3NCb29rSXRlbS5JZG1Sb2xlLlV1aWQ7dXNlclR5cGUgPSAndGVhbSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoYWNsKSB7XG4gICAgICAgICAgICBsYWJlbCA9IF9weWRpb01vZGVsSWRtT2JqZWN0SGVscGVyMlsnZGVmYXVsdCddLmV4dHJhY3RMYWJlbChweWRpbywgYWNsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxhYmVsID0gYWRkcmVzc0Jvb2tJdGVtLmxhYmVsO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZSBjZWxsTW9kZWwgaXMgXCJUUlVFXCIsIG5vdCBhIHJlYWwgY2VsbCBtb2RlbFxuICAgICAgICBpZiAoY2VsbE1vZGVsID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gW1JlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTWVudUl0ZW0sIHsgcHJpbWFyeVRleHQ6IG1bJzY0MCddLnJlcGxhY2UoJyVzJywgbGFiZWwpLCBvblRvdWNoVGFwOiB0aGlzLmNyZWF0ZUNlbGwuYmluZCh0aGlzKSB9KV07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2FuV3JpdGUgPSBjZWxsTW9kZWwuaXNFZGl0YWJsZSgpO1xuICAgICAgICAvLyBDaGVjayBpZiBjdXJyZW50IGFjbCBvciB1c2VySWQvdXNlclR5cGUgaXMgaW4gY2VsbFxuICAgICAgICB2YXIgYWNscyA9IGNlbGxNb2RlbC5nZXRBY2xzKCk7XG4gICAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWxyZWFkeSBpbiB0aGUgY3VycmVudCBjZWxsXG4gICAgICAgIHZhciBpc0luQ3VycmVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgT2JqZWN0LmtleXMoYWNscykubWFwKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgICAgICB2YXIgY2VsbEFjbCA9IGFjbHNba107XG4gICAgICAgICAgICB2YXIgY3J0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKGFjbCkge1xuICAgICAgICAgICAgICAgIGNydCA9IGFjbC5Sb2xlSWQgPT09IGNlbGxBY2wuUm9sZUlkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjcnQgPSB1c2VyVHlwZSA9PT0gJ3VzZXInICYmIGNlbGxBY2wuVXNlciAmJiBjZWxsQWNsLlVzZXIuTG9naW4gPT09IHVzZXJJZCB8fCB1c2VyVHlwZSA9PT0gJ2dyb3VwJyAmJiBjZWxsQWNsLkdyb3VwICYmIGNlbGxBY2wuR3JvdXAuVXVpZCA9PT0gdXNlcklkIHx8IHVzZXJUeXBlID09PSAndGVhbScgJiYgY2VsbEFjbC5Sb2xlICYmIGNlbGxBY2wuUm9sZS5VdWlkID09PSB1c2VySWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3J0KSB7XG4gICAgICAgICAgICAgICAgaXNJbkN1cnJlbnQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoaXNJbkN1cnJlbnQpIHtcbiAgICAgICAgICAgIGl0ZW1zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5NZW51SXRlbSwgeyBwcmltYXJ5VGV4dDogbVsnNjQxJ10sIGRpc2FibGVkOiAhY2FuV3JpdGUsIG9uVG91Y2hUYXA6IHRoaXMucmVtb3ZlRnJvbUNlbGwuYmluZCh0aGlzKSB9KSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTWVudUl0ZW0sIHsgcHJpbWFyeVRleHQ6IG1bJzY0MiddLCBkaXNhYmxlZDogIWNhbldyaXRlLCBvblRvdWNoVGFwOiB0aGlzLmFkZFRvQ2VsbC5iaW5kKHRoaXMpIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtcy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuRGl2aWRlciwgbnVsbCksIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX21hdGVyaWFsVWkuTWVudUl0ZW0sIHsgcHJpbWFyeVRleHQ6IG1bJzY0MCddLnJlcGxhY2UoJyVzJywgbGFiZWwpLCBvblRvdWNoVGFwOiB0aGlzLmNyZWF0ZUNlbGwuYmluZCh0aGlzKSB9KSk7XG5cbiAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ2VsbEFjdGlvbnNSZW5kZXJlcjtcbn0pKCk7XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IENlbGxBY3Rpb25zUmVuZGVyZXI7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX2FkZHJlc3Nib29rVXNlcnNMaXN0ID0gcmVxdWlyZSgnLi4vYWRkcmVzc2Jvb2svVXNlcnNMaXN0Jyk7XG5cbnZhciBfYWRkcmVzc2Jvb2tVc2Vyc0xpc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYWRkcmVzc2Jvb2tVc2Vyc0xpc3QpO1xuXG52YXIgX3JlcXVpcmUgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG52YXIgQ29tcG9uZW50ID0gX3JlcXVpcmUuQ29tcG9uZW50O1xuXG52YXIgX3JlcXVpcmUyID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIERpdmlkZXIgPSBfcmVxdWlyZTIuRGl2aWRlcjtcbnZhciBTdWJoZWFkZXIgPSBfcmVxdWlyZTIuU3ViaGVhZGVyO1xudmFyIExpc3QgPSBfcmVxdWlyZTIuTGlzdDtcbnZhciBMaXN0SXRlbSA9IF9yZXF1aXJlMi5MaXN0SXRlbTtcbnZhciBGb250SWNvbiA9IF9yZXF1aXJlMi5Gb250SWNvbjtcbnZhciBBdmF0YXIgPSBfcmVxdWlyZTIuQXZhdGFyO1xuXG52YXIgUHlkaW9BcGkgPSByZXF1aXJlKCdweWRpby9odHRwL2FwaScpO1xuXG52YXIgX3JlcXVpcmUkcmVxdWlyZUxpYiA9IHJlcXVpcmUoJ3B5ZGlvJykucmVxdWlyZUxpYignYm9vdCcpO1xuXG52YXIgUHlkaW9Db250ZXh0Q29uc3VtZXIgPSBfcmVxdWlyZSRyZXF1aXJlTGliLlB5ZGlvQ29udGV4dENvbnN1bWVyO1xuXG4vKipcbiAqIERpc3BsYXkgaW5mb3JtYXRpb24gYWJvdXQgdXNlciBvciB0ZWFtIHJlbGF0aW9uc1xuICovXG5cbnZhciBHcmFwaFBhbmVsID0gKGZ1bmN0aW9uIChfQ29tcG9uZW50KSB7XG4gICAgX2luaGVyaXRzKEdyYXBoUGFuZWwsIF9Db21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gR3JhcGhQYW5lbCgpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdyYXBoUGFuZWwpO1xuXG4gICAgICAgIF9Db21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBHcmFwaFBhbmVsLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgICB2YXIgZ3JhcGggPSBfcHJvcHMuZ3JhcGg7XG4gICAgICAgIHZhciB1c2VyTGFiZWwgPSBfcHJvcHMudXNlckxhYmVsO1xuICAgICAgICB2YXIgcHlkaW8gPSBfcHJvcHMucHlkaW87XG4gICAgICAgIHZhciBnZXRNZXNzYWdlID0gX3Byb3BzLmdldE1lc3NhZ2U7XG5cbiAgICAgICAgdmFyIGVsZW1lbnRzID0gW107XG4gICAgICAgIGlmIChncmFwaC50ZWFtcyAmJiBncmFwaC50ZWFtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBvbkRlbGV0ZUFjdGlvbiA9IChmdW5jdGlvbiAocGFyZW50SXRlbSwgdGVhbSkge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICBQeWRpb0FwaS5nZXRSZXN0Q2xpZW50KCkuZ2V0SWRtQXBpKCkucmVtb3ZlVXNlckZyb21UZWFtKHRlYW1bMF0uaWQsIHRoaXMucHJvcHMudXNlcklkLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHB5ZGlvLlVJLmRpc3BsYXlNZXNzYWdlKCdTVUNDRVNTJywgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMucmVsb2FkQWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgZWxlbWVudHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsga2V5OiAndGVhbXMnIH0sXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChfYWRkcmVzc2Jvb2tVc2Vyc0xpc3QyWydkZWZhdWx0J10sIHsgc3ViSGVhZGVyOiBnZXRNZXNzYWdlKDU4MSkucmVwbGFjZSgnJXMnLCBncmFwaC50ZWFtcy5sZW5ndGgpLCBvbkl0ZW1DbGlja2VkOiBmdW5jdGlvbiAoKSB7fSwgaXRlbTogeyBsZWFmczogZ3JhcGgudGVhbXMgfSwgbW9kZTogJ2lubmVyJywgb25EZWxldGVBY3Rpb246IG9uRGVsZXRlQWN0aW9uIH0pXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ3JhcGguY2VsbHMpIHtcbiAgICAgICAgICAgIHZhciBjZWxscyA9IE9iamVjdC52YWx1ZXMoZ3JhcGguY2VsbHMpLmZpbHRlcihmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjZWxsLlNjb3BlID09PSBcIlJPT01cIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNlbGxzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmxlbmd0aCA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoRGl2aWRlciwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgU3ViaGVhZGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxzLmxlbmd0aCA9PT0gMSA/IGdldE1lc3NhZ2UoJzYwMScpIDogZ2V0TWVzc2FnZSgnNjAyJykucmVwbGFjZSgnJTEnLCBjZWxscy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBMaXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxzLm1hcChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KExpc3RJdGVtLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRBdmF0YXI6IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQXZhdGFyLCB7IGljb246IFJlYWN0LmNyZWF0ZUVsZW1lbnQoRm9udEljb24sIHsgY2xhc3NOYW1lOiAnbWRpIG1kaS1zaGFyZS12YXJpYW50JyB9KSwgYmFja2dyb3VuZENvbG9yOiBcIiMwMDk2ODhcIiwgc2l6ZTogMzYgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlUZXh0OiBjZWxsLkxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblRvdWNoVGFwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweWRpby50cmlnZ2VyUmVwb3NpdG9yeUNoYW5nZShjZWxsLlVVSUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgZWxlbWVudHNcbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEdyYXBoUGFuZWw7XG59KShDb21wb25lbnQpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBHcmFwaFBhbmVsID0gUHlkaW9Db250ZXh0Q29uc3VtZXIoR3JhcGhQYW5lbCk7XG5leHBvcnRzWydkZWZhdWx0J10gPSBHcmFwaFBhbmVsO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMob2JqLCBrZXlzKSB7IHZhciB0YXJnZXQgPSB7fTsgZm9yICh2YXIgaSBpbiBvYmopIHsgaWYgKGtleXMuaW5kZXhPZihpKSA+PSAwKSBjb250aW51ZTsgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBpKSkgY29udGludWU7IHRhcmdldFtpXSA9IG9ialtpXTsgfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXG52YXIgX0dyYXBoUGFuZWwgPSByZXF1aXJlKCcuL0dyYXBoUGFuZWwnKTtcblxudmFyIF9HcmFwaFBhbmVsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0dyYXBoUGFuZWwpO1xuXG52YXIgX0FjdGlvbnNQYW5lbCA9IHJlcXVpcmUoJy4vQWN0aW9uc1BhbmVsJyk7XG5cbnZhciBfQWN0aW9uc1BhbmVsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0FjdGlvbnNQYW5lbCk7XG5cbnZhciBfcHlkaW9IdHRwQXBpID0gcmVxdWlyZShcInB5ZGlvL2h0dHAvYXBpXCIpO1xuXG52YXIgX3B5ZGlvSHR0cEFwaTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9weWRpb0h0dHBBcGkpO1xuXG4vKipcbiAqIEdlbmVyaWMgY29tcG9uZW50IGZvciBkaXNwbGF5IGEgdXNlciBhbmQgaGVyIGF2YXRhciAoZmlyc3QgbGV0dGVycyBvciBwaG90bylcbiAqL1xuXG52YXIgZGVib3VuY2UgPSByZXF1aXJlKCdsb2Rhc2guZGVib3VuY2UnKTtcbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgQ29sb3IgPSByZXF1aXJlKCdjb2xvcicpO1xuXG52YXIgX3JlcXVpcmUgPSByZXF1aXJlKCdtYXRlcmlhbC11aScpO1xuXG52YXIgRm9udEljb24gPSBfcmVxdWlyZS5Gb250SWNvbjtcbnZhciBQb3BvdmVyID0gX3JlcXVpcmUuUG9wb3ZlcjtcbnZhciBQYXBlciA9IF9yZXF1aXJlLlBhcGVyO1xudmFyIEF2YXRhciA9IF9yZXF1aXJlLkF2YXRhcjtcbnZhciBDYXJkVGl0bGUgPSBfcmVxdWlyZS5DYXJkVGl0bGU7XG52YXIgRGl2aWRlciA9IF9yZXF1aXJlLkRpdmlkZXI7XG5cbnZhciBfcmVxdWlyZTIgPSByZXF1aXJlKCdtYXRlcmlhbC11aS9zdHlsZXMnKTtcblxudmFyIG11aVRoZW1lYWJsZSA9IF9yZXF1aXJlMi5tdWlUaGVtZWFibGU7XG5cbnZhciBNZXRhQ2FjaGVTZXJ2aWNlID0gcmVxdWlyZSgncHlkaW8vaHR0cC9tZXRhLWNhY2hlLXNlcnZpY2UnKTtcblxudmFyIF9yZXF1aXJlMyA9IHJlcXVpcmUoJ3B5ZGlvL2h0dHAvdXNlcnMtYXBpJyk7XG5cbnZhciBVc2Vyc0FwaSA9IF9yZXF1aXJlMy5Vc2Vyc0FwaTtcblxudmFyIFVzZXJBdmF0YXIgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICBfaW5oZXJpdHMoVXNlckF2YXRhciwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBVc2VyQXZhdGFyKHByb3BzLCBjb250ZXh0KSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVc2VyQXZhdGFyKTtcblxuICAgICAgICBfUmVhY3QkQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMsIGNvbnRleHQpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdXNlcjogbnVsbCxcbiAgICAgICAgICAgIGF2YXRhcjogbnVsbCxcbiAgICAgICAgICAgIGdyYXBoOiBudWxsLFxuICAgICAgICAgICAgbG9jYWw6IGZhbHNlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgVXNlckF2YXRhci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5sb2FkUHVibGljRGF0YSh0aGlzLnByb3BzLnVzZXJJZCwgdGhpcy5wcm9wcy5pZG1Vc2VyKTtcbiAgICB9O1xuXG4gICAgVXNlckF2YXRhci5wcm90b3R5cGUuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICAgIGlmICghdGhpcy5wcm9wcy51c2VySWQgfHwgdGhpcy5wcm9wcy51c2VySWQgIT09IG5leHRQcm9wcy51c2VySWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYWJlbDogbmV4dFByb3BzLnVzZXJJZCB9KTtcbiAgICAgICAgICAgIHRoaXMubG9hZFB1YmxpY0RhdGEobmV4dFByb3BzLnVzZXJJZCwgbmV4dFByb3BzLmlkbVVzZXIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFVzZXJBdmF0YXIucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGlmICh0aGlzLl91c2VyTG9nZ2VkT2JzKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnB5ZGlvLnN0b3BPYnNlcnZpbmcoJ3VzZXJfbG9nZ2VkJywgdGhpcy5fdXNlckxvZ2dlZE9icyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlcklkIHN0cmluZ1xuICAgICAqIEBwYXJhbSBpZG1Vc2VyIHtJZG1Vc2VyfVxuICAgICAqL1xuXG4gICAgVXNlckF2YXRhci5wcm90b3R5cGUubG9hZFB1YmxpY0RhdGEgPSBmdW5jdGlvbiBsb2FkUHVibGljRGF0YSh1c2VySWQsIGlkbVVzZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHVzZXJUeXBlID0gX3Byb3BzLnVzZXJUeXBlO1xuICAgICAgICB2YXIgcmljaENhcmQgPSBfcHJvcHMucmljaENhcmQ7XG4gICAgICAgIHZhciBweWRpbyA9IF9wcm9wcy5weWRpbztcblxuICAgICAgICBpZiAodXNlclR5cGUgPT09IFwiZ3JvdXBcIiB8fCB1c2VyVHlwZSA9PT0gXCJ0ZWFtXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBVc2Vyc0FwaS5nZXRVc2VyUHJvbWlzZSh1c2VySWQsIGlkbVVzZXIpLnRoZW4oZnVuY3Rpb24gKHVzZXJPYmplY3QpIHtcbiAgICAgICAgICAgIGlmICh1c2VyT2JqZWN0LmlzTG9jYWwoKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLl91c2VyTG9nZ2VkT2JzID0gZnVuY3Rpb24gKGV2ZW50VXNlcikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fdXNlckxvZ2dlZE9icyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudFVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvYWRQdWJsaWNEYXRhKHVzZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHB5ZGlvLm9ic2VydmVPbmNlKCd1c2VyX2xvZ2dlZCcsIF90aGlzLl91c2VyTG9nZ2VkT2JzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB1c2VyOiB1c2VyT2JqZWN0LFxuICAgICAgICAgICAgICAgIGF2YXRhcjogdXNlck9iamVjdC5nZXRBdmF0YXIoKSxcbiAgICAgICAgICAgICAgICBsb2NhbDogdXNlck9iamVjdC5pc0xvY2FsKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gTG9hZCBncmFwaFxuICAgICAgICAgICAgaWYgKHJpY2hDYXJkICYmICF1c2VyT2JqZWN0LmlzTm90Rm91bmQoKSkge1xuICAgICAgICAgICAgICAgIF9weWRpb0h0dHBBcGkyWydkZWZhdWx0J10uZ2V0UmVzdENsaWVudCgpLmdldElkbUFwaSgpLmxvYWRVc2VyR3JhcGgodXNlcklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JhcGggPSB7IGNlbGxzOiB7fSwgdGVhbXM6IFtdIH07XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5TaGFyZWRDZWxscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuU2hhcmVkQ2VsbHMuZm9yRWFjaChmdW5jdGlvbiAod29ya3NwYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGguY2VsbHMgPSByZXNwb25zZS5TaGFyZWRDZWxscztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5CZWxvbmdzVG9UZWFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuQmVsb25nc1RvVGVhbXMuZm9yRWFjaChmdW5jdGlvbiAocm9sZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYXBoLnRlYW1zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcm9sZS5VdWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogcm9sZS5MYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RlYW0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZG1Sb2xlOiByb2xlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGdyYXBoOiBncmFwaCB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIC8vIFVzZXIgbWF5IGhhdmUgYmVlbiBkZWxldGVkXG4gICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGxvYWRFcnJvcjogdHJ1ZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIFVzZXJBdmF0YXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgdmFyIF9zdGF0ZSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHZhciB1c2VyID0gX3N0YXRlLnVzZXI7XG4gICAgICAgIHZhciBhdmF0YXIgPSBfc3RhdGUuYXZhdGFyO1xuICAgICAgICB2YXIgZ3JhcGggPSBfc3RhdGUuZ3JhcGg7XG4gICAgICAgIHZhciBsb2NhbCA9IF9zdGF0ZS5sb2NhbDtcbiAgICAgICAgdmFyIGxvYWRFcnJvciA9IF9zdGF0ZS5sb2FkRXJyb3I7XG4gICAgICAgIHZhciBfcHJvcHMyID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIHB5ZGlvID0gX3Byb3BzMi5weWRpbztcbiAgICAgICAgdmFyIHVzZXJJZCA9IF9wcm9wczIudXNlcklkO1xuICAgICAgICB2YXIgdXNlclR5cGUgPSBfcHJvcHMyLnVzZXJUeXBlO1xuICAgICAgICB2YXIgaWNvbiA9IF9wcm9wczIuaWNvbjtcbiAgICAgICAgdmFyIHN0eWxlID0gX3Byb3BzMi5zdHlsZTtcbiAgICAgICAgdmFyIGxhYmVsU3R5bGUgPSBfcHJvcHMyLmxhYmVsU3R5bGU7XG4gICAgICAgIHZhciBhdmF0YXJMZXR0ZXJzID0gX3Byb3BzMi5hdmF0YXJMZXR0ZXJzO1xuICAgICAgICB2YXIgYXZhdGFyU3R5bGUgPSBfcHJvcHMyLmF2YXRhclN0eWxlO1xuICAgICAgICB2YXIgYXZhdGFyU2l6ZSA9IF9wcm9wczIuYXZhdGFyU2l6ZTtcbiAgICAgICAgdmFyIGNsYXNzTmFtZSA9IF9wcm9wczIuY2xhc3NOYW1lO1xuICAgICAgICB2YXIgbGFiZWxDbGFzc05hbWUgPSBfcHJvcHMyLmxhYmVsQ2xhc3NOYW1lO1xuICAgICAgICB2YXIgZGlzcGxheUxhYmVsID0gX3Byb3BzMi5kaXNwbGF5TGFiZWw7XG4gICAgICAgIHZhciBkaXNwbGF5TG9jYWxMYWJlbCA9IF9wcm9wczIuZGlzcGxheUxvY2FsTGFiZWw7XG4gICAgICAgIHZhciBkaXNwbGF5QXZhdGFyID0gX3Byb3BzMi5kaXNwbGF5QXZhdGFyO1xuICAgICAgICB2YXIgdXNlRGVmYXVsdEF2YXRhciA9IF9wcm9wczIudXNlRGVmYXVsdEF2YXRhcjtcbiAgICAgICAgdmFyIHJpY2hDYXJkID0gX3Byb3BzMi5yaWNoQ2FyZDtcbiAgICAgICAgdmFyIGNhcmRTaXplID0gX3Byb3BzMi5jYXJkU2l6ZTtcbiAgICAgICAgdmFyIG11aVRoZW1lID0gX3Byb3BzMi5tdWlUaGVtZTtcbiAgICAgICAgdmFyIG5vQWN0aW9uc1BhbmVsID0gX3Byb3BzMi5ub0FjdGlvbnNQYW5lbDtcbiAgICAgICAgdmFyIGxhYmVsID0gdGhpcy5zdGF0ZS5sYWJlbDtcblxuICAgICAgICB2YXIgdXNlclR5cGVMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIHVzZXJOb3RGb3VuZCA9IGxvYWRFcnJvcjtcbiAgICAgICAgdmFyIHVzZXJJc1B1YmxpYyA9IGZhbHNlO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgbGFiZWwgPSB1c2VyLmdldExhYmVsKCk7XG4gICAgICAgICAgICB1c2VyTm90Rm91bmQgPSB1c2VyLmlzTm90Rm91bmQoKTtcbiAgICAgICAgICAgIHVzZXJJc1B1YmxpYyA9IHVzZXIuaXNQdWJsaWMoKTtcbiAgICAgICAgfSBlbHNlIGlmICghbGFiZWwpIHtcbiAgICAgICAgICAgIGxhYmVsID0gdGhpcy5wcm9wcy51c2VyTGFiZWwgfHwgdGhpcy5wcm9wcy51c2VySWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvY2FsICYmIGRpc3BsYXlMb2NhbExhYmVsKSB7XG4gICAgICAgICAgICBsYWJlbCA9IHB5ZGlvLk1lc3NhZ2VIYXNoWyc2MzQnXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhdmF0YXJDb250ZW50ID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXZhdGFyQ29sb3IgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBhdmF0YXJJY29uID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAocmljaENhcmQpIHtcbiAgICAgICAgICAgIGRpc3BsYXlBdmF0YXIgPSB0cnVlO1xuICAgICAgICAgICAgdXNlRGVmYXVsdEF2YXRhciA9IHRydWU7XG4gICAgICAgICAgICBkaXNwbGF5TGFiZWwgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkaXNwbGF5QXZhdGFyICYmICFhdmF0YXIgJiYgbGFiZWwgJiYgKCFkaXNwbGF5TGFiZWwgfHwgdXNlRGVmYXVsdEF2YXRhcikpIHtcbiAgICAgICAgICAgIHZhciBhdmF0YXJzQ29sb3IgPSBtdWlUaGVtZS5wYWxldHRlLmF2YXRhcnNDb2xvcjtcbiAgICAgICAgICAgIGlmICh1c2VyVHlwZSA9PT0gJ2dyb3VwJyB8fCB1c2VyVHlwZSA9PT0gJ3RlYW0nIHx8IHVzZXJJZC5pbmRleE9mKCdQWURJT19HUlBfLycpID09PSAwIHx8IHVzZXJJZC5pbmRleE9mKCcvVVNFUl9URUFNLycpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgYXZhdGFyc0NvbG9yID0gQ29sb3IoYXZhdGFyc0NvbG9yKS5kYXJrZW4oMC4yKS50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGljb25DbGFzc05hbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBzd2l0Y2ggKHVzZXJUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZ3JvdXAnOlxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lID0gJ21kaSBtZGktYWNjb3VudC1tdWx0aXBsZSc7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJUeXBlTGFiZWwgPSAnMjg5JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndGVhbSc6XG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWUgPSAnbWRpIG1kaS1hY2NvdW50LW11bHRpcGxlLW91dGxpbmUnO1xuICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzYwMyc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3JlbW90ZSc6XG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWUgPSAnbWRpIG1kaS1hY2NvdW50LW5ldHdvcmsnO1xuICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzYwNCc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWUgPSAnbWRpIG1kaS1hY2NvdW50JztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyLmdldEV4dGVybmFsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzU4OSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuaXNQdWJsaWMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzU4OSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gcHlkaW8uTWVzc2FnZUhhc2hbXCJwdWJsaWNfbGlua191c2VyXCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lID0gJ21kaSBtZGktbGluayc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzU5MCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gJzI4OCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaWNvbikge1xuICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWUgPSBpY29uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHVzZXJUeXBlTGFiZWwpIHtcbiAgICAgICAgICAgICAgICB1c2VyVHlwZUxhYmVsID0gcHlkaW8uTWVzc2FnZUhhc2hbdXNlclR5cGVMYWJlbF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmljaENhcmQpIHtcbiAgICAgICAgICAgICAgICBhdmF0YXJJY29uID0gUmVhY3QuY3JlYXRlRWxlbWVudChGb250SWNvbiwgeyBjbGFzc05hbWU6IGljb25DbGFzc05hbWUsIHN0eWxlOiB7IGNvbG9yOiBhdmF0YXJzQ29sb3IgfSB9KTtcbiAgICAgICAgICAgICAgICBhdmF0YXJDb2xvciA9ICcjZjVmNWY1JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXZhdGFyQ29sb3IgPSBhdmF0YXJzQ29sb3I7XG4gICAgICAgICAgICAgICAgaWYgKGljb25DbGFzc05hbWUgJiYgIWF2YXRhckxldHRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFySWNvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoRm9udEljb24sIHsgY2xhc3NOYW1lOiBpY29uQ2xhc3NOYW1lIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF2YXRhckNvbnRlbnQgPSBsYWJlbC5zcGxpdCgnICcpLm1hcChmdW5jdGlvbiAod29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmRbMF07XG4gICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpLnN1YnN0cmluZygwLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF2YXRhckNvbnRlbnQubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyQ29udGVudCA9IGxhYmVsLnN1YnN0cmluZygwLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVsb2FkQWN0aW9uID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgb25FZGl0QWN0aW9uID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgb25Nb3VzZU92ZXIgPSB1bmRlZmluZWQsXG4gICAgICAgICAgICBvbk1vdXNlT3V0ID0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgb25DbGljayA9IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHBvcG92ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChyaWNoQ2FyZCkge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIGRpc3BsYXlBdmF0YXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHN0eWxlID0gX2V4dGVuZHMoe30sIHN0eWxlLCB7IGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nIH0pO1xuICAgICAgICAgICAgICAgIC8vYXZhdGFyU2l6ZSA9IGNhcmRTaXplID8gY2FyZFNpemUgOiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgLy9hdmF0YXJTdHlsZSA9IHtib3JkZXJSYWRpdXM6IDB9O1xuICAgICAgICAgICAgICAgIGF2YXRhclNpemUgPSAxMDA7XG4gICAgICAgICAgICAgICAgYXZhdGFyU3R5bGUgPSB7IG1hcmdpblRvcDogMjAgfTtcbiAgICAgICAgICAgICAgICB2YXIgbG9jYWxSZWxvYWQgPSBmdW5jdGlvbiBsb2NhbFJlbG9hZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgTWV0YUNhY2hlU2VydmljZS5nZXRJbnN0YW5jZSgpLmRlbGV0ZUtleSgndXNlcl9wdWJsaWNfZGF0YS1ncmFwaCcsIF90aGlzMi5wcm9wcy51c2VySWQpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpczIubG9hZFB1YmxpY0RhdGEoX3RoaXMyLnByb3BzLnVzZXJJZCwgX3RoaXMyLnByb3BzLmlkbVVzZXIpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmVsb2FkQWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLnByb3BzLnJlbG9hZEFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnByb3BzLnJlbG9hZEFjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBvbkVkaXRBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsUmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczIucHJvcHMub25FZGl0QWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIucHJvcHMub25FZGl0QWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfSBlbHNlIGlmICghbG9jYWwgJiYgIXVzZXJOb3RGb3VuZCAmJiAhdXNlcklzUHVibGljICYmIHRoaXMucHJvcHMucmljaE9uSG92ZXIpIHtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBvbk1vdXNlT3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzMi5sb2NrZWRCeVN1YlBvcG92ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IHNob3dQb3BvdmVyOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgb25Nb3VzZU91dCA9IGRlYm91bmNlKG9uTW91c2VPdXQsIDM1MCk7XG4gICAgICAgICAgICAgICAgb25Nb3VzZU92ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzaG93UG9wb3ZlcjogdHJ1ZSwgcG9wb3ZlckFuY2hvcjogZS5jdXJyZW50VGFyZ2V0IH0pO1xuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlT3V0LmNhbmNlbCgpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIG9uTW91c2VPdmVySW5uZXIgPSBmdW5jdGlvbiBvbk1vdXNlT3ZlcklubmVyKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2hvd1BvcG92ZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIG9uTW91c2VPdXQuY2FuY2VsKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBsb2NrT25TdWJQb3BvdmVyT3BlbiA9IGZ1bmN0aW9uIGxvY2tPblN1YlBvcG92ZXJPcGVuKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBfdGhpczIubG9ja2VkQnlTdWJQb3BvdmVyID0gc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlT3ZlcklubmVyKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgX3Byb3BzMyA9IF90aGlzMi5wcm9wcztcbiAgICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBfcHJvcHMzLnN0eWxlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvcG92ZXJQcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfcHJvcHMzLCBbJ3N0eWxlJ10pO1xuXG4gICAgICAgICAgICAgICAgcG9wb3ZlciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIFBvcG92ZXIsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW46IF90aGlzMi5zdGF0ZS5zaG93UG9wb3ZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvckVsOiBfdGhpczIuc3RhdGUucG9wb3ZlckFuY2hvcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlOiBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiAhPT0gJ2NsaWNrQXdheScgfHwgIV90aGlzMi5sb2NrZWRCeVN1YlBvcG92ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsgc2hvd1BvcG92ZXI6IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3JPcmlnaW46IHsgaG9yaXpvbnRhbDogXCJsZWZ0XCIsIHZlcnRpY2FsOiBcImNlbnRlclwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRPcmlnaW46IHsgaG9yaXpvbnRhbDogXCJyaWdodFwiLCB2ZXJ0aWNhbDogXCJjZW50ZXJcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlTGF5ZXJGb3JDbGlja0F3YXk6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBQYXBlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgekRlcHRoOiAyLCBzdHlsZTogeyB3aWR0aDogMjIwLCBoZWlnaHQ6IDMyMCwgb3ZlcmZsb3dZOiAnYXV0bycgfSwgb25Nb3VzZU92ZXI6IG9uTW91c2VPdmVySW5uZXIsIG9uTW91c2VPdXQ6IG9uTW91c2VPdXQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXNlckF2YXRhciwgX2V4dGVuZHMoe30sIHBvcG92ZXJQcm9wcywgeyByaWNoQ2FyZDogdHJ1ZSwgcmljaE9uSG92ZXI6IGZhbHNlLCBjYXJkU2l6ZTogMjIwLCBsb2NrT25TdWJQb3BvdmVyT3BlbjogbG9ja09uU3ViUG9wb3Zlck9wZW4gfSkpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfSBlbHNlIGlmICghbG9jYWwgJiYgIXVzZXJOb3RGb3VuZCAmJiAhdXNlcklzUHVibGljICYmIHRoaXMucHJvcHMucmljaE9uQ2xpY2spIHtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBvbk1vdXNlT3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzMi5sb2NrZWRCeVN1YlBvcG92ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IHNob3dQb3BvdmVyOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgb25Nb3VzZU91dCA9IGRlYm91bmNlKG9uTW91c2VPdXQsIDM1MCk7XG4gICAgICAgICAgICAgICAgb25DbGljayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7IHNob3dQb3BvdmVyOiB0cnVlLCBwb3BvdmVyQW5jaG9yOiBlLmN1cnJlbnRUYXJnZXQgfSk7XG4gICAgICAgICAgICAgICAgICAgIG9uTW91c2VPdXQuY2FuY2VsKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgb25Nb3VzZU92ZXJJbm5lciA9IGZ1bmN0aW9uIG9uTW91c2VPdmVySW5uZXIoZSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzaG93UG9wb3ZlcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgb25Nb3VzZU91dC5jYW5jZWwoKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGxvY2tPblN1YlBvcG92ZXJPcGVuID0gZnVuY3Rpb24gbG9ja09uU3ViUG9wb3Zlck9wZW4oc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzMi5sb2NrZWRCeVN1YlBvcG92ZXIgPSBzdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgIG9uTW91c2VPdmVySW5uZXIoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciBfcHJvcHM0ID0gX3RoaXMyLnByb3BzO1xuICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IF9wcm9wczQuc3R5bGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9wb3ZlclByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9wcm9wczQsIFsnc3R5bGUnXSk7XG5cbiAgICAgICAgICAgICAgICBwb3BvdmVyID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgUG9wb3ZlcixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3BlbjogX3RoaXMyLnN0YXRlLnNob3dQb3BvdmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yRWw6IF90aGlzMi5zdGF0ZS5wb3BvdmVyQW5jaG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25SZXF1ZXN0Q2xvc2U6IGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uICE9PSAnY2xpY2tBd2F5JyB8fCAhX3RoaXMyLmxvY2tlZEJ5U3ViUG9wb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoeyBzaG93UG9wb3ZlcjogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvck9yaWdpbjogeyBob3Jpem9udGFsOiBcImxlZnRcIiwgdmVydGljYWw6IFwiYm90dG9tXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE9yaWdpbjogeyBob3Jpem9udGFsOiBcImxlZnRcIiwgdmVydGljYWw6IFwidG9wXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUxheWVyRm9yQ2xpY2tBd2F5OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgUGFwZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHpEZXB0aDogMiwgc3R5bGU6IHsgd2lkdGg6IDIyMCwgaGVpZ2h0OiAzMjAsIG92ZXJmbG93WTogJ2F1dG8nIH0sIG9uTW91c2VPdmVyOiBvbk1vdXNlT3ZlcklubmVyLCBvbk1vdXNlT3V0OiBvbk1vdXNlT3V0IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFVzZXJBdmF0YXIsIF9leHRlbmRzKHt9LCBwb3BvdmVyUHJvcHMsIHsgcmljaENhcmQ6IHRydWUsIHJpY2hPbkhvdmVyOiBmYWxzZSwgY2FyZFNpemU6IDIyMCwgbG9ja09uU3ViUG9wb3Zlck9wZW46IGxvY2tPblN1YlBvcG92ZXJPcGVuIH0pKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXZhdGFyKSB7XG4gICAgICAgICAgICBhdmF0YXJJY29uID0gUmVhY3QuY3JlYXRlRWxlbWVudChGb250SWNvbiwgeyBzdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFwidXJsKFwiICsgYXZhdGFyICsgXCI/ZGltPVwiICsgYXZhdGFyU2l6ZSArIFwiKVwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJ2NvdmVyJyxcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNTAlJyxcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAnY2VudGVyJ1xuICAgICAgICAgICAgICAgIH0gfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYXZhdGFyQ29tcG9uZW50ID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIEF2YXRhcixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpY29uOiBhdmF0YXJJY29uLFxuICAgICAgICAgICAgICAgIHNpemU6IGF2YXRhclNpemUsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHRoaXMucHJvcHMuYXZhdGFyT25seSA/IHRoaXMucHJvcHMuc3R5bGUgOiBhdmF0YXJTdHlsZSxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGF2YXRhckNvbG9yXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXZhdGFyQ29udGVudFxuICAgICAgICApO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmF2YXRhck9ubHkpIHtcbiAgICAgICAgICAgIHJldHVybiBhdmF0YXJDb21wb25lbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmljaENhcmQpIHtcbiAgICAgICAgICAgIGF2YXRhckNvbXBvbmVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgeyBzdHlsZTogeyB0ZXh0QWxpZ246ICdjZW50ZXInIH0gfSxcbiAgICAgICAgICAgICAgICBhdmF0YXJDb21wb25lbnRcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAodXNlck5vdEZvdW5kKSB7XG4gICAgICAgICAgICBsYWJlbFN0eWxlID0gX2V4dGVuZHMoe30sIGxhYmVsU3R5bGUsIHsgdGV4dERlY29yYXRpb246ICdsaW5lLXRocm91Z2gnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIHN0eWxlOiBzdHlsZSwgb25Nb3VzZU92ZXI6IG9uTW91c2VPdmVyLCBvbk1vdXNlT3V0OiBvbk1vdXNlT3V0LCBvbkNsaWNrOiBvbkNsaWNrIH0sXG4gICAgICAgICAgICBkaXNwbGF5QXZhdGFyICYmIChhdmF0YXIgfHwgYXZhdGFyQ29udGVudCB8fCBhdmF0YXJJY29uKSAmJiBhdmF0YXJDb21wb25lbnQsXG4gICAgICAgICAgICBkaXNwbGF5TGFiZWwgJiYgIXJpY2hDYXJkICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGxhYmVsQ2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogbGFiZWxTdHlsZSB9LFxuICAgICAgICAgICAgICAgIGxhYmVsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgZGlzcGxheUxhYmVsICYmIHJpY2hDYXJkICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2FyZFRpdGxlLCB7IHN0eWxlOiB7IHRleHRBbGlnbjogJ2NlbnRlcicgfSwgdGl0bGU6IGxhYmVsLCBzdWJ0aXRsZTogdXNlclR5cGVMYWJlbCB9KSxcbiAgICAgICAgICAgIHJpY2hDYXJkICYmIHVzZXIgJiYgIW5vQWN0aW9uc1BhbmVsICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoX0FjdGlvbnNQYW5lbDJbJ2RlZmF1bHQnXSwgX2V4dGVuZHMoe30sIHRoaXMuc3RhdGUsIHRoaXMucHJvcHMsIHsgcmVsb2FkQWN0aW9uOiByZWxvYWRBY3Rpb24sIG9uRWRpdEFjdGlvbjogb25FZGl0QWN0aW9uIH0pKSxcbiAgICAgICAgICAgIHJpY2hDYXJkICYmIGdyYXBoICYmICFub0FjdGlvbnNQYW5lbCAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KF9HcmFwaFBhbmVsMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7IGdyYXBoOiBncmFwaCB9LCB0aGlzLnByb3BzLCB7IHVzZXJMYWJlbDogbGFiZWwsIHJlbG9hZEFjdGlvbjogcmVsb2FkQWN0aW9uLCBvbkVkaXRBY3Rpb246IG9uRWRpdEFjdGlvbiB9KSksXG4gICAgICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuLFxuICAgICAgICAgICAgcG9wb3ZlclxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVXNlckF2YXRhcjtcbn0pKFJlYWN0LkNvbXBvbmVudCk7XG5cblVzZXJBdmF0YXIucHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIElkIG9mIHRoZSB1c2VyIHRvIGJlIGxvYWRlZFxuICAgICAqL1xuICAgIHVzZXJJZDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIC8qKlxuICAgICAqIFB5ZGlvIGluc3RhbmNlXG4gICAgICovXG4gICAgcHlkaW86IFJlYWN0LlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvKSxcbiAgICAvKipcbiAgICAgKiBMYWJlbCBvZiB0aGUgdXNlciwgaWYgd2UgYWxyZWFkeSBoYXZlIGl0IChvdGhlcndpc2Ugd2lsbCBiZSBsb2FkZWQpXG4gICAgICovXG4gICAgdXNlckxhYmVsOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIC8qKlxuICAgICAqIFR5cGUgb2YgdXNlclxuICAgICAqL1xuICAgIHVzZXJUeXBlOiBSZWFjdC5Qcm9wVHlwZXMub25lT2YoWyd1c2VyJywgJ2dyb3VwJywgJ3JlbW90ZScsICd0ZWFtJ10pLFxuICAgIC8qKlxuICAgICAqIEljb24gdG8gYmUgZGlzcGxheWVkIGluIGF2YXRhclxuICAgICAqL1xuICAgIGljb246IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgLyoqXG4gICAgICogRGlzcGxheSBhIHJpY2ggY2FyZCBvciBhIHNpbXBsZSBhdmF0YXIrbGFiZWwgY2hpcFxuICAgICAqL1xuICAgIHJpY2hDYXJkOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAvKipcbiAgICAgKiBJZiBub3QgcmljaCwgZGlzcGxheSBhIHJpY2ggY2FyZCBhcyBwb3BvdmVyIG9uIG1vdXNlb3ZlclxuICAgICAqL1xuICAgIHJpY2hPbkhvdmVyOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAvKipcbiAgICAgKiBJZiBub3QgcmljaCwgZGlzcGxheSBhIHJpY2ggY2FyZCBhcyBwb3BvdmVyIG9uIGNsaWNrXG4gICAgICovXG4gICAgcmljaE9uQ2xpY2s6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogQWRkIGVkaXQgYWN0aW9uIHRvIHRoZSBjYXJkXG4gICAgICovXG4gICAgdXNlckVkaXRhYmxlOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgc3VjY2Vzc2Z1bCBlZGl0aW9uXG4gICAgICovXG4gICAgb25FZGl0QWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgZGVsZXRpb25cbiAgICAgKi9cbiAgICBvbkRlbGV0ZUFjdGlvbjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGlmIGEgcmVsb2FkIGlzIHJlcXVpcmVkXG4gICAgICovXG4gICAgcmVsb2FkQWN0aW9uOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgbGFiZWwgZWxlbWVudCBvciBub3RcbiAgICAgKi9cbiAgICBkaXNwbGF5TGFiZWw6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgbGFiZWwgZWxlbWVudCBvciBub3RcbiAgICAgKi9cbiAgICBkaXNwbGF5TG9jYWxMYWJlbDogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgLyoqXG4gICAgICogRGlzcGxheSBhdmF0YXIgZWxlbWVudCBvciBub3RcbiAgICAgKi9cbiAgICBkaXNwbGF5QXZhdGFyOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IG9ubHkgYXZhdGFyXG4gICAgICovXG4gICAgYXZhdGFyT25seTogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgLyoqXG4gICAgICogVXNlIGRlZmF1bHQgYXZhdGFyXG4gICAgICovXG4gICAgdXNlRGVmYXVsdEF2YXRhcjogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgLyoqXG4gICAgICogQXZhdGFyIHNpemUsIDQwcHggYnkgZGVmYXVsdFxuICAgICAqL1xuICAgIGF2YXRhclNpemU6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG4gICAgLyoqXG4gICAgICogSWYgb25seSB0aGUgZGVmYXVsdCBpY29uIGlzIGF2YWlsYWJsZSwgd2lsbCBkaXNwbGF5XG4gICAgICogdGhlIGZpcnN0IGxldHRlcnMgb2YgdGhlIG5hbWUgaW5zdGVhZFxuICAgICAqL1xuICAgIGF2YXRhckxldHRlcnM6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIC8qKlxuICAgICAqIERvIG5vdCBkaXNwbGF5IEFjdGlvbnNQYW5lbCBpbiBSaWNoQ2FyZCBtb2RlXG4gICAgICovXG4gICAgbm9BY3Rpb25zUGFuZWw6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogQWRkIGNsYXNzIG5hbWUgdG8gcm9vdCBlbGVtZW50XG4gICAgICovXG4gICAgY2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIC8qKlxuICAgICAqIEFkZCBjbGFzcyBuYW1lIHRvIGxhYmVsIGVsZW1lbnRcbiAgICAgKi9cbiAgICBsYWJlbENsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAvKipcbiAgICAgKiBBZGQgY2xhc3MgbmFtZSB0byBhdmF0YXIgZWxlbWVudFxuICAgICAqL1xuICAgIGF2YXRhckNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAvKipcbiAgICAgKiBBZGQgc3R5bGUgdG8gcm9vdCBlbGVtZW50XG4gICAgICovXG4gICAgc3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgLyoqXG4gICAgICogQWRkIHN0eWxlIHRvIGxhYmVsIGVsZW1lbnRcbiAgICAgKi9cbiAgICBsYWJlbFN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIC8qKlxuICAgICAqIEFkZCBzdHlsZSB0byBhdmF0YXIgZWxlbWVudFxuICAgICAqL1xuICAgIGF2YXRhclN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0XG59O1xuXG5Vc2VyQXZhdGFyLmRlZmF1bHRQcm9wcyA9IHtcbiAgICBkaXNwbGF5TGFiZWw6IHRydWUsXG4gICAgZGlzcGxheUF2YXRhcjogdHJ1ZSxcbiAgICBhdmF0YXJTaXplOiA0MCxcbiAgICB1c2VyVHlwZTogJ3VzZXInLFxuICAgIGNsYXNzTmFtZTogJ3VzZXItYXZhdGFyLXdpZGdldCcsXG4gICAgYXZhdGFyQ2xhc3NOYW1lOiAndXNlci1hdmF0YXInLFxuICAgIGxhYmVsQ2xhc3NOYW1lOiAndXNlci1sYWJlbCdcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFVzZXJBdmF0YXIgPSBtdWlUaGVtZWFibGUoKShVc2VyQXZhdGFyKTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gVXNlckF2YXRhcjtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG5cInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxudmFyIEZ1bmNVdGlscyA9IHJlcXVpcmUoXCJweWRpby91dGlsL2Z1bmNcIik7XG52YXIgUmVzb3VyY2VzTWFuYWdlciA9IHJlcXVpcmUoXCJweWRpby9odHRwL3Jlc291cmNlcy1tYW5hZ2VyXCIpO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyogUkVBQ1QgRE5EIEdFTkVSSUMgQ09NUE9ORU5UU1xuIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG52YXIgVHlwZXMgPSB7XG4gICAgTk9ERV9QUk9WSURFUjogJ25vZGUnLFxuICAgIFNPUlRBQkxFX0xJU1RfSVRFTTogJ3NvcnRhYmxlLWxpc3QtaXRlbSdcbn07XG5cbi8qKlxuICogU3BlY2lmaWVzIHdoaWNoIHByb3BzIHRvIGluamVjdCBpbnRvIHlvdXIgY29tcG9uZW50LlxuICovXG5mdW5jdGlvbiBjb2xsZWN0KGNvbm5lY3QsIG1vbml0b3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBjb25uZWN0RHJhZ1NvdXJjZTogY29ubmVjdC5kcmFnU291cmNlKCksXG4gICAgICAgIGlzRHJhZ2dpbmc6IG1vbml0b3IuaXNEcmFnZ2luZygpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gY29sbGVjdERyb3AoY29ubmVjdCwgbW9uaXRvcikge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNvbm5lY3REcm9wVGFyZ2V0OiBjb25uZWN0LmRyb3BUYXJnZXQoKSxcbiAgICAgICAgY2FuRHJvcDogbW9uaXRvci5jYW5Ecm9wKCksXG4gICAgICAgIGlzT3ZlcjogbW9uaXRvci5pc092ZXIoKSxcbiAgICAgICAgaXNPdmVyQ3VycmVudDogbW9uaXRvci5pc092ZXIoeyBzaGFsbG93OiB0cnVlIH0pXG4gICAgfTtcbn1cblxudmFyIEROREFjdGlvblBhcmFtZXRlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRE5EQWN0aW9uUGFyYW1ldGVyKHNvdXJjZSwgdGFyZ2V0LCBzdGVwKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBETkRBY3Rpb25QYXJhbWV0ZXIpO1xuXG4gICAgICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICB0aGlzLl9zdGVwID0gc3RlcDtcbiAgICB9XG5cbiAgICBETkRBY3Rpb25QYXJhbWV0ZXIucHJvdG90eXBlLmdldFNvdXJjZSA9IGZ1bmN0aW9uIGdldFNvdXJjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZTtcbiAgICB9O1xuXG4gICAgRE5EQWN0aW9uUGFyYW1ldGVyLnByb3RvdHlwZS5nZXRUYXJnZXQgPSBmdW5jdGlvbiBnZXRUYXJnZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQ7XG4gICAgfTtcblxuICAgIEROREFjdGlvblBhcmFtZXRlci5wcm90b3R5cGUuZ2V0U3RlcCA9IGZ1bmN0aW9uIGdldFN0ZXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGVwO1xuICAgIH07XG5cbiAgICByZXR1cm4gRE5EQWN0aW9uUGFyYW1ldGVyO1xufSkoKTtcblxuRE5EQWN0aW9uUGFyYW1ldGVyLlNURVBfQkVHSU5fRFJBRyA9ICdiZWdpbkRyYWcnO1xuRE5EQWN0aW9uUGFyYW1ldGVyLlNURVBfRU5EX0RSQUcgPSAnZW5kRHJhZyc7XG5ETkRBY3Rpb25QYXJhbWV0ZXIuU1RFUF9DQU5fRFJPUCA9ICdjYW5Ecm9wJztcbkROREFjdGlvblBhcmFtZXRlci5TVEVQX0hPVkVSX0RST1AgPSAnaG92ZXInO1xuXG52YXIgYXBwbHlETkRBY3Rpb24gPSBmdW5jdGlvbiBhcHBseUROREFjdGlvbihzb3VyY2UsIHRhcmdldCwgc3RlcCkge1xuICAgIHZhciBDb250cm9sbGVyID0gd2luZG93LnB5ZGlvLkNvbnRyb2xsZXI7XG5cbiAgICB2YXIgZG5kID0gQ29udHJvbGxlci5kZWZhdWx0QWN0aW9ucy5nZXQoXCJkcmFnbmRyb3BcIik7XG4gICAgaWYgKGRuZCkge1xuICAgICAgICB2YXIgZG5kQWN0aW9uID0gQ29udHJvbGxlci5nZXRBY3Rpb25CeU5hbWUoZG5kKTtcbiAgICAgICAgZG5kQWN0aW9uLmVuYWJsZSgpO1xuICAgICAgICB2YXIgcGFyYW1zID0gbmV3IEROREFjdGlvblBhcmFtZXRlcihzb3VyY2UsIHRhcmdldCwgc3RlcCk7XG4gICAgICAgIHZhciBjaGVja01vZHVsZSA9IGRuZEFjdGlvbi5vcHRpb25zLmRyYWduZHJvcENoZWNrTW9kdWxlO1xuICAgICAgICBpZiAoc3RlcCA9PT0gRE5EQWN0aW9uUGFyYW1ldGVyLlNURVBfQ0FOX0RST1AgJiYgY2hlY2tNb2R1bGUpIHtcbiAgICAgICAgICAgIGlmICghRnVuY1V0aWxzLmdldEZ1bmN0aW9uQnlOYW1lKGNoZWNrTW9kdWxlLCB3aW5kb3cpKSB7XG4gICAgICAgICAgICAgICAgUmVzb3VyY2VzTWFuYWdlci5kZXRlY3RNb2R1bGVUb0xvYWRBbmRBcHBseShjaGVja01vZHVsZSwgZnVuY3Rpb24gKCkge30pO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGZpbmQgdGVzdCBtb2R1bGUsIHRyeWluZyB0byBsb2FkIGl0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBGdW5jVXRpbHMuZXhlY3V0ZUZ1bmN0aW9uQnlOYW1lKGRuZEFjdGlvbi5vcHRpb25zLmRyYWduZHJvcENoZWNrTW9kdWxlLCB3aW5kb3csIENvbnRyb2xsZXIsIHBhcmFtcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkbmRBY3Rpb24uYXBwbHkocGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gRE5EIEFjdGlvbnMgYXZhaWxhYmxlJyk7XG4gICAgfVxufTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiBSRUFDVCBETkQgRFJBRy9EUk9QIE5PREVTXG4gLyoqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxudmFyIG5vZGVEcmFnU291cmNlID0ge1xuICAgIGJlZ2luRHJhZzogZnVuY3Rpb24gYmVnaW5EcmFnKHByb3BzKSB7XG4gICAgICAgIC8vIFJldHVybiB0aGUgZGF0YSBkZXNjcmliaW5nIHRoZSBkcmFnZ2VkIGl0ZW1cbiAgICAgICAgcmV0dXJuIHsgbm9kZTogcHJvcHMubm9kZSB9O1xuICAgIH0sXG5cbiAgICBlbmREcmFnOiBmdW5jdGlvbiBlbmREcmFnKHByb3BzLCBtb25pdG9yLCBjb21wb25lbnQpIHtcbiAgICAgICAgaWYgKCFtb25pdG9yLmRpZERyb3AoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpdGVtID0gbW9uaXRvci5nZXRJdGVtKCk7XG4gICAgICAgIHZhciBkcm9wUmVzdWx0ID0gbW9uaXRvci5nZXREcm9wUmVzdWx0KCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhcHBseUROREFjdGlvbihpdGVtLm5vZGUsIGRyb3BSZXN1bHQubm9kZSwgRE5EQWN0aW9uUGFyYW1ldGVyLlNURVBfRU5EX0RSQUcpO1xuICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgIH1cbn07XG5cbnZhciBub2RlRHJvcFRhcmdldCA9IHtcblxuICAgIGhvdmVyOiBmdW5jdGlvbiBob3Zlcihwcm9wcywgbW9uaXRvcikge30sXG5cbiAgICBjYW5Ecm9wOiBmdW5jdGlvbiBjYW5Ecm9wKHByb3BzLCBtb25pdG9yKSB7XG5cbiAgICAgICAgdmFyIHNvdXJjZSA9IG1vbml0b3IuZ2V0SXRlbSgpLm5vZGU7XG4gICAgICAgIHZhciB0YXJnZXQgPSBwcm9wcy5ub2RlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhcHBseUROREFjdGlvbihzb3VyY2UsIHRhcmdldCwgRE5EQWN0aW9uUGFyYW1ldGVyLlNURVBfQ0FOX0RST1ApO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGRyb3A6IGZ1bmN0aW9uIGRyb3AocHJvcHMsIG1vbml0b3IpIHtcbiAgICAgICAgdmFyIGhhc0Ryb3BwZWRPbkNoaWxkID0gbW9uaXRvci5kaWREcm9wKCk7XG4gICAgICAgIGlmIChoYXNEcm9wcGVkT25DaGlsZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IG5vZGU6IHByb3BzLm5vZGUgfTtcbiAgICB9XG5cbn07XG5cbmV4cG9ydHMuVHlwZXMgPSBUeXBlcztcbmV4cG9ydHMuY29sbGVjdCA9IGNvbGxlY3Q7XG5leHBvcnRzLmNvbGxlY3REcm9wID0gY29sbGVjdERyb3A7XG5leHBvcnRzLm5vZGVEcmFnU291cmNlID0gbm9kZURyYWdTb3VyY2U7XG5leHBvcnRzLm5vZGVEcm9wVGFyZ2V0ID0gbm9kZURyb3BUYXJnZXQ7XG5leHBvcnRzLkROREFjdGlvblBhcmFtZXRlciA9IEROREFjdGlvblBhcmFtZXRlcjtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAwNy0yMDE3IENoYXJsZXMgZHUgSmV1IC0gQWJzdHJpdW0gU0FTIDx0ZWFtIChhdCkgcHlkLmlvPlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUHlkaW8uXG4gKlxuICogUHlkaW8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBQeWRpbyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogYWxvbmcgd2l0aCBQeWRpby4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqXG4gKiBUaGUgbGF0ZXN0IGNvZGUgY2FuIGJlIGZvdW5kIGF0IDxodHRwczovL3B5ZGlvLmNvbT4uXG4gKi9cblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IHtcbiAgICBjb250ZXh0VHlwZXM6IHtcbiAgICAgICAgbWVzc2FnZXM6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIGdldE1lc3NhZ2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jXG4gICAgfVxufTtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cbnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbnZhciBDb21wb25lbnQgPSBfcmVxdWlyZS5Db21wb25lbnQ7XG52YXIgUHJvcFR5cGVzID0gX3JlcXVpcmUuUHJvcFR5cGVzO1xuXG52YXIgX3JlcXVpcmUyID0gcmVxdWlyZSgnbWF0ZXJpYWwtdWknKTtcblxudmFyIEZsYXRCdXR0b24gPSBfcmVxdWlyZTIuRmxhdEJ1dHRvbjtcbnZhciBGb250SWNvbiA9IF9yZXF1aXJlMi5Gb250SWNvbjtcblxudmFyIF9yZXF1aXJlMyA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpL3N0eWxlcycpO1xuXG52YXIgbXVpVGhlbWVhYmxlID0gX3JlcXVpcmUzLm11aVRoZW1lYWJsZTtcblxudmFyIENvbG9yID0gcmVxdWlyZSgnY29sb3InKTtcbnZhciBQeWRpbyA9IHJlcXVpcmUoJ3B5ZGlvJyk7XG5cbnZhciBfUHlkaW8kcmVxdWlyZUxpYiA9IFB5ZGlvLnJlcXVpcmVMaWIoJ2Jvb3QnKTtcblxudmFyIFB5ZGlvQ29udGV4dENvbnN1bWVyID0gX1B5ZGlvJHJlcXVpcmVMaWIuUHlkaW9Db250ZXh0Q29uc3VtZXI7XG5cbnZhciBFbXB0eVN0YXRlVmlldyA9IChmdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgIF9pbmhlcml0cyhFbXB0eVN0YXRlVmlldywgX0NvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBFbXB0eVN0YXRlVmlldyhwcm9wcywgY29udGV4dCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRW1wdHlTdGF0ZVZpZXcpO1xuXG4gICAgICAgIF9Db21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcywgY29udGV4dCk7XG4gICAgfVxuXG4gICAgRW1wdHlTdGF0ZVZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9wcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciBzdHlsZSA9IF9wcm9wcy5zdHlsZTtcbiAgICAgICAgdmFyIGljb25DbGFzc05hbWUgPSBfcHJvcHMuaWNvbkNsYXNzTmFtZTtcbiAgICAgICAgdmFyIHByaW1hcnlUZXh0SWQgPSBfcHJvcHMucHJpbWFyeVRleHRJZDtcbiAgICAgICAgdmFyIHNlY29uZGFyeVRleHRJZCA9IF9wcm9wcy5zZWNvbmRhcnlUZXh0SWQ7XG4gICAgICAgIHZhciBhY3Rpb25MYWJlbElkID0gX3Byb3BzLmFjdGlvbkxhYmVsSWQ7XG4gICAgICAgIHZhciBhY3Rpb25DYWxsYmFjayA9IF9wcm9wcy5hY3Rpb25DYWxsYmFjaztcbiAgICAgICAgdmFyIGFjdGlvblN0eWxlID0gX3Byb3BzLmFjdGlvblN0eWxlO1xuICAgICAgICB2YXIgYWN0aW9uSWNvbkNsYXNzTmFtZSA9IF9wcm9wcy5hY3Rpb25JY29uQ2xhc3NOYW1lO1xuICAgICAgICB2YXIgZ2V0TWVzc2FnZSA9IF9wcm9wcy5nZXRNZXNzYWdlO1xuICAgICAgICB2YXIgaWNvblN0eWxlID0gX3Byb3BzLmljb25TdHlsZTtcbiAgICAgICAgdmFyIGxlZ2VuZFN0eWxlID0gX3Byb3BzLmxlZ2VuZFN0eWxlO1xuXG4gICAgICAgIHZhciBtYWluQ29sb3IgPSBDb2xvcih0aGlzLnByb3BzLm11aVRoZW1lLnBhbGV0dGUucHJpbWFyeTFDb2xvcik7XG5cbiAgICAgICAgdmFyIHN0eWxlcyA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogX2V4dGVuZHMoe1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICBmbGV4OiAxLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbWFpbkNvbG9yLmxpZ2h0bmVzcyg5NykucmdiKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgfSwgc3R5bGUpLFxuICAgICAgICAgICAgY2VudGVyZWQ6IHtcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogMjgwLFxuICAgICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgY29sb3I6IG1haW5Db2xvci5mYWRlKDAuNikudG9TdHJpbmcoKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGljb246IF9leHRlbmRzKHtcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTAwXG4gICAgICAgICAgICB9LCBpY29uU3R5bGUpLFxuICAgICAgICAgICAgcHJpbWFyeVRleHQ6IF9leHRlbmRzKHtcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICAgICAgZm9udFdlaWdodDogNTAwXG4gICAgICAgICAgICB9LCBsZWdlbmRTdHlsZSksXG4gICAgICAgICAgICBzZWNvbmRhcnlUZXh0OiB7XG4gICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAyMCxcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBidXR0b25Db250YWluZXI6IHtcbiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IDEwMCxcbiAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYnV0dG9uU3R5bGU6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5wcm9wcy5tdWlUaGVtZS5wYWxldHRlLmFjY2VudDJDb2xvclxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgYnV0dG9uSWNvbiA9IGFjdGlvbkljb25DbGFzc05hbWUgPyBSZWFjdC5jcmVhdGVFbGVtZW50KEZvbnRJY29uLCB7IGNsYXNzTmFtZTogYWN0aW9uSWNvbkNsYXNzTmFtZSB9KSA6IG51bGw7XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICB7IHN0eWxlOiBzdHlsZXMuY29udGFpbmVyIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5jZW50ZXJlZCB9LFxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiBpY29uQ2xhc3NOYW1lLCBzdHlsZTogc3R5bGVzLmljb24gfSksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5wcmltYXJ5VGV4dCB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRNZXNzYWdlKHByaW1hcnlUZXh0SWQpXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBzZWNvbmRhcnlUZXh0SWQgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHN0eWxlcy5zZWNvbmRhcnlUZXh0IH0sXG4gICAgICAgICAgICAgICAgICAgIGdldE1lc3NhZ2Uoc2Vjb25kYXJ5VGV4dElkKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgYWN0aW9uTGFiZWxJZCAmJiBhY3Rpb25DYWxsYmFjayAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzdHlsZTogX2V4dGVuZHMoe30sIHN0eWxlcy5idXR0b25Db250YWluZXIsIGFjdGlvblN0eWxlKSB9LFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEZsYXRCdXR0b24sIHsgc3R5bGU6IHN0eWxlcy5idXR0b25TdHlsZSwgbGFiZWw6IGdldE1lc3NhZ2UoYWN0aW9uTGFiZWxJZCksIG9uVG91Y2hUYXA6IGFjdGlvbkNhbGxiYWNrLCBpY29uOiBidXR0b25JY29uIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gRW1wdHlTdGF0ZVZpZXc7XG59KShDb21wb25lbnQpO1xuXG5FbXB0eVN0YXRlVmlldy5wcm9wVHlwZXMgPSB7XG5cbiAgICBweWRpbzogUHJvcFR5cGVzLmluc3RhbmNlT2YoUHlkaW8pLmlzUmVxdWlyZWQsXG4gICAgaWNvbkNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHByaW1hcnlUZXh0SWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblxuICAgIHNlY29uZGFyeVRleHRJZDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBhY3Rpb25MYWJlbElkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGFjdGlvbkNhbGxiYWNrOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBhY3Rpb25TdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGljb25TdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBsZWdlbmRTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBnZXRNZXNzYWdlOiBQcm9wVHlwZXMuZnVuY1xuXG59O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBFbXB0eVN0YXRlVmlldyA9IFB5ZGlvQ29udGV4dENvbnN1bWVyKEVtcHR5U3RhdGVWaWV3KTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEVtcHR5U3RhdGVWaWV3ID0gbXVpVGhlbWVhYmxlKCkoRW1wdHlTdGF0ZVZpZXcpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBFbXB0eVN0YXRlVmlldztcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKG9iaiwga2V5cykgeyB2YXIgdGFyZ2V0ID0ge307IGZvciAodmFyIGkgaW4gb2JqKSB7IGlmIChrZXlzLmluZGV4T2YoaSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgaSkpIGNvbnRpbnVlOyB0YXJnZXRbaV0gPSBvYmpbaV07IH0gcmV0dXJuIHRhcmdldDsgfVxuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfbWF0ZXJpYWxVaSA9IHJlcXVpcmUoJ21hdGVyaWFsLXVpJyk7XG5cbnZhciBNb2RhbEFwcEJhciA9IGZ1bmN0aW9uIE1vZGFsQXBwQmFyKHByb3BzKSB7XG4gICAgdmFyIHN0eWxlID0gcHJvcHMuc3R5bGU7XG4gICAgdmFyIHRpdGxlU3R5bGUgPSBwcm9wcy50aXRsZVN0eWxlO1xuICAgIHZhciBpY29uU3R5bGVSaWdodCA9IHByb3BzLmljb25TdHlsZVJpZ2h0O1xuICAgIHZhciBpY29uU3R5bGVMZWZ0ID0gcHJvcHMuaWNvblN0eWxlTGVmdDtcblxuICAgIHZhciBvdGhlclByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHByb3BzLCBbJ3N0eWxlJywgJ3RpdGxlU3R5bGUnLCAnaWNvblN0eWxlUmlnaHQnLCAnaWNvblN0eWxlTGVmdCddKTtcblxuICAgIHZhciBzdHlsZXMgPSB7XG4gICAgICAgIHN0eWxlOiBfZXh0ZW5kcyh7XG4gICAgICAgICAgICBmbGV4U2hyaW5rOiAwXG4gICAgICAgIH0sIHN0eWxlKSxcbiAgICAgICAgdGl0bGVTdHlsZTogX2V4dGVuZHMoe1xuICAgICAgICAgICAgbGluZUhlaWdodDogJzU2cHgnLFxuICAgICAgICAgICAgaGVpZ2h0OiA1NixcbiAgICAgICAgICAgIG1hcmdpbkxlZnQ6IC04XG4gICAgICAgIH0sIHRpdGxlU3R5bGUpLFxuICAgICAgICBpY29uU3R5bGVSaWdodDogX2V4dGVuZHMoe1xuICAgICAgICAgICAgbWFyZ2luVG9wOiA0XG4gICAgICAgIH0sIGljb25TdHlsZVJpZ2h0KSxcbiAgICAgICAgaWNvblN0eWxlTGVmdDogX2V4dGVuZHMoe1xuICAgICAgICAgICAgbWFyZ2luVG9wOiA0XG4gICAgICAgIH0sIGljb25TdHlsZUxlZnQpXG4gICAgfTtcblxuICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfbWF0ZXJpYWxVaS5BcHBCYXIsIF9leHRlbmRzKHt9LCBvdGhlclByb3BzLCBzdHlsZXMpKTtcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1vZGFsQXBwQmFyO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4vKmJvcmRlclJhZGl1czogJzJweCAycHggMCAwJywqL1xuIiwiLypcbiAqIENvcHlyaWdodCAyMDA3LTIwMTcgQ2hhcmxlcyBkdSBKZXUgLSBBYnN0cml1bSBTQVMgPHRlYW0gKGF0KSBweWQuaW8+XG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQeWRpby5cbiAqXG4gKiBQeWRpbyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFB5ZGlvIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIFB5ZGlvLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIFRoZSBsYXRlc3QgY29kZSBjYW4gYmUgZm91bmQgYXQgPGh0dHBzOi8vcHlkaW8uY29tPi5cbiAqL1xuXG4vKipcbiAqIEdldCBpbmZvIGZyb20gUHlkaW8gY29udHJvbGxlciBhbiBidWlsZCBhblxuICogYWN0aW9uIGJhciB3aXRoIGFjdGl2ZSBhY3Rpb25zLlxuICogVEJDXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ1NpbXBsZVJlYWN0QWN0aW9uQmFyJyxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBkYXRhTW9kZWw6IFJlYWN0LlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvRGF0YU1vZGVsKS5pc1JlcXVpcmVkLFxuICAgICAgICBub2RlOiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihBanhwTm9kZSkuaXNSZXF1aXJlZCxcbiAgICAgICAgYWN0aW9uczogUmVhY3QuUHJvcFR5cGVzLmFycmF5XG4gICAgfSxcblxuICAgIGNsaWNrQWN0aW9uOiBmdW5jdGlvbiBjbGlja0FjdGlvbihldmVudCkge1xuICAgICAgICB2YXIgYWN0aW9uTmFtZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1hY3Rpb25cIik7XG4gICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLnNldFNlbGVjdGVkTm9kZXMoW3RoaXMucHJvcHMubm9kZV0pO1xuICAgICAgICB2YXIgYSA9IHdpbmRvdy5weWRpby5Db250cm9sbGVyLmdldEFjdGlvbkJ5TmFtZShhY3Rpb25OYW1lKTtcbiAgICAgICAgYS5maXJlQ29udGV4dENoYW5nZSh0aGlzLnByb3BzLmRhdGFNb2RlbCwgdHJ1ZSwgd2luZG93LnB5ZGlvLnVzZXIpO1xuICAgICAgICAvL2EuZmlyZVNlbGVjdGlvbkNoYW5nZSh0aGlzLnByb3BzLmRhdGFNb2RlbCk7XG4gICAgICAgIGEuYXBwbHkoW3RoaXMucHJvcHMuZGF0YU1vZGVsXSk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIGFjdGlvbnMgPSB0aGlzLnByb3BzLmFjdGlvbnMubWFwKChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICAgICAgICBrZXk6IGEub3B0aW9ucy5uYW1lLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYS5vcHRpb25zLmljb25fY2xhc3MgKyAnIG1hdGVyaWFsLWxpc3QtYWN0aW9uLWlubGluZScgfHwgJycsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGEub3B0aW9ucy50aXRsZSxcbiAgICAgICAgICAgICAgICAnZGF0YS1hY3Rpb24nOiBhLm9wdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmNsaWNrQWN0aW9uIH0pO1xuICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgYWN0aW9uc1xuICAgICAgICApO1xuICAgIH1cbn0pO1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG4iLCIvKlxuICogQ29weXJpZ2h0IDIwMDctMjAxNyBDaGFybGVzIGR1IEpldSAtIEFic3RyaXVtIFNBUyA8dGVhbSAoYXQpIHB5ZC5pbz5cbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFB5ZGlvLlxuICpcbiAqIFB5ZGlvIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogUHlkaW8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggUHlkaW8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKlxuICogVGhlIGxhdGVzdCBjb2RlIGNhbiBiZSBmb3VuZCBhdCA8aHR0cHM6Ly9weWRpby5jb20+LlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG52YXIgX3V0aWxETkQgPSByZXF1aXJlKCcuLi91dGlsL0RORCcpO1xuXG52YXIgX3JlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cbnZhciBfcHlkaW8gPSByZXF1aXJlKCdweWRpbycpO1xuXG52YXIgX3B5ZGlvMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3B5ZGlvKTtcblxudmFyIF9QeWRpbyRyZXF1aXJlTGliID0gX3B5ZGlvMlsnZGVmYXVsdCddLnJlcXVpcmVMaWIoJ2hvYycpO1xuXG52YXIgd2l0aENvbnRleHRNZW51ID0gX1B5ZGlvJHJlcXVpcmVMaWIud2l0aENvbnRleHRNZW51O1xuXG52YXIgQ29udGV4dE1lbnVXcmFwcGVyID0gZnVuY3Rpb24gQ29udGV4dE1lbnVXcmFwcGVyKHByb3BzKSB7XG4gICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdkaXYnLCBwcm9wcyk7XG59O1xuQ29udGV4dE1lbnVXcmFwcGVyID0gd2l0aENvbnRleHRNZW51KENvbnRleHRNZW51V3JhcHBlcik7XG5cbi8qKlxuICogVHJlZSBOb2RlXG4gKi9cbnZhciBTaW1wbGVUcmVlTm9kZSA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVDbGFzcyh7XG4gICAgZGlzcGxheU5hbWU6ICdTaW1wbGVUcmVlTm9kZScsXG5cbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgY29sbGFwc2U6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgZm9yY2VFeHBhbmQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgY2hpbGRyZW5Pbmx5OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIGRlcHRoOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm51bWJlcixcbiAgICAgICAgb25Ob2RlU2VsZWN0OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIG5vZGU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihBanhwTm9kZSksXG4gICAgICAgIGRhdGFNb2RlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvRGF0YU1vZGVsKSxcbiAgICAgICAgZm9yY2VMYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIC8vIE9wdGlvbmFsIGN1cnJlbnRseSBzZWxlY3RlZCBkZXRlY3Rpb25cbiAgICAgICAgbm9kZUlzU2VsZWN0ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgLy8gT3B0aW9uYWwgY2hlY2tib3hlc1xuICAgICAgICBjaGVja2JveGVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBjaGVja2JveGVzVmFsdWVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgY2hlY2tib3hlc0NvbXB1dGVTdGF0dXM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgb25DaGVja2JveENoZWNrOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIHBhZGRpbmdPZmZzZXQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMubnVtYmVyXG4gICAgfSxcblxuICAgIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29sbGFwc2U6IGZhbHNlLFxuICAgICAgICAgICAgY2hpbGRyZW5Pbmx5OiBmYWxzZSxcbiAgICAgICAgICAgIGRlcHRoOiAwLFxuICAgICAgICAgICAgcGFkZGluZ09mZnNldDogMCxcbiAgICAgICAgICAgIG9uTm9kZVNlbGVjdDogZnVuY3Rpb24gb25Ob2RlU2VsZWN0KG5vZGUpIHt9XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGxpc3RlblRvTm9kZTogZnVuY3Rpb24gbGlzdGVuVG9Ob2RlKG5vZGUpIHtcbiAgICAgICAgdGhpcy5fY2hpbGRyZW5MaXN0ZW5lciA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjaGlsZHJlbjogdGhpcy5fbm9kZVRvQ2hpbGRyZW4obm9kZSkgfSk7XG4gICAgICAgIH0pLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX25vZGVMaXN0ZW5lciA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgfSkuYmluZCh0aGlzKTtcbiAgICAgICAgbm9kZS5vYnNlcnZlKFwiY2hpbGRfYWRkZWRcIiwgdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcik7XG4gICAgICAgIG5vZGUub2JzZXJ2ZShcImNoaWxkX3JlbW92ZWRcIiwgdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcik7XG4gICAgICAgIG5vZGUub2JzZXJ2ZShcIm5vZGVfcmVwbGFjZWRcIiwgdGhpcy5fbm9kZUxpc3RlbmVyKTtcbiAgICB9LFxuXG4gICAgc3RvcExpc3RlbmluZzogZnVuY3Rpb24gc3RvcExpc3RlbmluZyhub2RlKSB7XG4gICAgICAgIG5vZGUuc3RvcE9ic2VydmluZyhcImNoaWxkX2FkZGVkXCIsIHRoaXMuX2NoaWxkcmVuTGlzdGVuZXIpO1xuICAgICAgICBub2RlLnN0b3BPYnNlcnZpbmcoXCJjaGlsZF9yZW1vdmVkXCIsIHRoaXMuX2NoaWxkcmVuTGlzdGVuZXIpO1xuICAgICAgICBub2RlLnN0b3BPYnNlcnZpbmcoXCJub2RlX3JlcGxhY2VkXCIsIHRoaXMuX25vZGVMaXN0ZW5lcik7XG4gICAgfSxcblxuICAgIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5Ub05vZGUodGhpcy5wcm9wcy5ub2RlKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodGhpcy5wcm9wcy5ub2RlKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wczogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgICAgdmFyIG9sZE5vZGUgPSB0aGlzLnByb3BzLm5vZGU7XG4gICAgICAgIHZhciBuZXdOb2RlID0gbmV4dFByb3BzLm5vZGU7XG4gICAgICAgIGlmIChuZXdOb2RlID09IG9sZE5vZGUgJiYgbmV3Tm9kZS5nZXRNZXRhZGF0YSgpLmdldChcInBhZ2luYXRpb25EYXRhXCIpKSB7XG4gICAgICAgICAgICB2YXIgcmVtYXBlZENoaWxkcmVuID0gdGhpcy5zdGF0ZS5jaGlsZHJlbi5tYXAoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgICBjLnNldFBhcmVudChuZXdOb2RlKTtyZXR1cm4gYztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJlbWFwZWRQYXRoZXMgPSB0aGlzLnN0YXRlLmNoaWxkcmVuLm1hcChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjLmdldFBhdGgoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIG5ld0NoaWxkcmVuID0gdGhpcy5fbm9kZVRvQ2hpbGRyZW4obmV3Tm9kZSk7XG4gICAgICAgICAgICBuZXdDaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChuYykge1xuICAgICAgICAgICAgICAgIGlmIChyZW1hcGVkUGF0aGVzLmluZGV4T2YobmMuZ2V0UGF0aCgpKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtYXBlZENoaWxkcmVuLnB1c2gobmMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGNoaWxkcmVuOiByZW1hcGVkQ2hpbGRyZW4gfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgY2hpbGRyZW46IHRoaXMuX25vZGVUb0NoaWxkcmVuKG5ld05vZGUpIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdOb2RlICE9PSBvbGROb2RlKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcob2xkTm9kZSk7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvTm9kZShuZXdOb2RlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNob3dDaGlsZHJlbjogIXRoaXMucHJvcHMuY29sbGFwc2UgfHwgdGhpcy5wcm9wcy5mb3JjZUV4cGFuZCxcbiAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLl9ub2RlVG9DaGlsZHJlbih0aGlzLnByb3BzLm5vZGUpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIF9ub2RlVG9DaGlsZHJlbjogZnVuY3Rpb24gX25vZGVUb0NoaWxkcmVuKCkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5wcm9wcy5ub2RlLmdldENoaWxkcmVuKCkuZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgaWYgKCFjLmlzTGVhZigpIHx8IGMuZ2V0QWp4cE1pbWUoKSA9PT0gJ2FqeHBfYnJvd3NhYmxlX2FyY2hpdmUnKSBjaGlsZHJlbi5wdXNoKGMpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH0sXG5cbiAgICBvbk5vZGVTZWxlY3Q6IGZ1bmN0aW9uIG9uTm9kZVNlbGVjdChldikge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbk5vZGVTZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25Ob2RlU2VsZWN0KHRoaXMucHJvcHMubm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfSxcbiAgICBvbkNoaWxkRGlzcGxheVRvZ2dsZTogZnVuY3Rpb24gb25DaGlsZERpc3BsYXlUb2dnbGUoZXYpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMubm9kZS5nZXRDaGlsZHJlbigpLnNpemUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93Q2hpbGRyZW46ICF0aGlzLnN0YXRlLnNob3dDaGlsZHJlbiB9KTtcbiAgICAgICAgfVxuICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LFxuICAgIG5vZGVJc1NlbGVjdGVkOiBmdW5jdGlvbiBub2RlSXNTZWxlY3RlZChuKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm5vZGVJc1NlbGVjdGVkKSByZXR1cm4gdGhpcy5wcm9wcy5ub2RlSXNTZWxlY3RlZChuKTtlbHNlIHJldHVybiB0aGlzLnByb3BzLmRhdGFNb2RlbC5nZXRTZWxlY3RlZE5vZGVzKCkuaW5kZXhPZihuKSAhPT0gLTE7XG4gICAgfSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB2YXIgX3Byb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgdmFyIG5vZGUgPSBfcHJvcHMubm9kZTtcbiAgICAgICAgdmFyIGNoaWxkcmVuT25seSA9IF9wcm9wcy5jaGlsZHJlbk9ubHk7XG4gICAgICAgIHZhciBjYW5Ecm9wID0gX3Byb3BzLmNhbkRyb3A7XG4gICAgICAgIHZhciBpc092ZXJDdXJyZW50ID0gX3Byb3BzLmlzT3ZlckN1cnJlbnQ7XG4gICAgICAgIHZhciBjaGVja2JveGVzID0gX3Byb3BzLmNoZWNrYm94ZXM7XG4gICAgICAgIHZhciBjaGVja2JveGVzQ29tcHV0ZVN0YXR1cyA9IF9wcm9wcy5jaGVja2JveGVzQ29tcHV0ZVN0YXR1cztcbiAgICAgICAgdmFyIGNoZWNrYm94ZXNWYWx1ZXMgPSBfcHJvcHMuY2hlY2tib3hlc1ZhbHVlcztcbiAgICAgICAgdmFyIG9uQ2hlY2tib3hDaGVjayA9IF9wcm9wcy5vbkNoZWNrYm94Q2hlY2s7XG4gICAgICAgIHZhciBkZXB0aCA9IF9wcm9wcy5kZXB0aDtcbiAgICAgICAgdmFyIHBhZGRpbmdPZmZzZXQgPSBfcHJvcHMucGFkZGluZ09mZnNldDtcbiAgICAgICAgdmFyIGZvcmNlRXhwYW5kID0gX3Byb3BzLmZvcmNlRXhwYW5kO1xuICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtU3R5bGUgPSBfcHJvcHMuc2VsZWN0ZWRJdGVtU3R5bGU7XG4gICAgICAgIHZhciBnZXRJdGVtU3R5bGUgPSBfcHJvcHMuZ2V0SXRlbVN0eWxlO1xuICAgICAgICB2YXIgZm9yY2VMYWJlbCA9IF9wcm9wcy5mb3JjZUxhYmVsO1xuXG4gICAgICAgIHZhciBoYXNGb2xkZXJDaGlsZHJlbnMgPSB0aGlzLnN0YXRlLmNoaWxkcmVuLmxlbmd0aCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgdmFyIGhhc0NoaWxkcmVuO1xuICAgICAgICBpZiAoaGFzRm9sZGVyQ2hpbGRyZW5zKSB7XG4gICAgICAgICAgICBoYXNDaGlsZHJlbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAgICB7IG9uQ2xpY2s6IHRoaXMub25DaGlsZERpc3BsYXlUb2dnbGUgfSxcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnNob3dDaGlsZHJlbiB8fCBmb3JjZUV4cGFuZCA/IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICd0cmVlLWljb24gaWNvbi1hbmdsZS1kb3duJyB9KSA6IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICd0cmVlLWljb24gaWNvbi1hbmdsZS1yaWdodCcgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgY25hbWUgPSBcInRyZWUtaWNvbiBpY29uLWFuZ2xlLXJpZ2h0XCI7XG4gICAgICAgICAgICBpZiAobm9kZS5pc0xvYWRlZCgpKSB7XG4gICAgICAgICAgICAgICAgY25hbWUgKz0gXCIgbm8tZm9sZGVyLWNoaWxkcmVuXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoYXNDaGlsZHJlbiA9IF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGNuYW1lIH0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpc1NlbGVjdGVkID0gdGhpcy5ub2RlSXNTZWxlY3RlZChub2RlKSA/ICdtdWktbWVudS1pdGVtIG11aS1pcy1zZWxlY3RlZCcgOiAnbXVpLW1lbnUtaXRlbSc7XG4gICAgICAgIHZhciBzZWxmTGFiZWw7XG4gICAgICAgIGlmICghY2hpbGRyZW5Pbmx5KSB7XG4gICAgICAgICAgICBpZiAoY2FuRHJvcCAmJiBpc092ZXJDdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZCArPSAnIGRyb3BwYWJsZS1hY3RpdmUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGJveGVzO1xuICAgICAgICAgICAgaWYgKGNoZWNrYm94ZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWVzID0ge30sXG4gICAgICAgICAgICAgICAgICAgIGluaGVyaXRlZCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCA9IHt9LFxuICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsQ2xhc3NOYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrYm94ZXNDb21wdXRlU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBjaGVja2JveGVzQ29tcHV0ZVN0YXR1cyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gc3RhdHVzLlZBTFVFUztcbiAgICAgICAgICAgICAgICAgICAgaW5oZXJpdGVkID0gc3RhdHVzLklOSEVSSVRFRDtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQgPSBzdGF0dXMuRElTQUJMRUQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMuQ0xBU1NOQU1FKSBhZGRpdGlvbmFsQ2xhc3NOYW1lID0gJyAnICsgc3RhdHVzLkNMQVNTTkFNRTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoZWNrYm94ZXNWYWx1ZXMgJiYgY2hlY2tib3hlc1ZhbHVlc1tub2RlLmdldFBhdGgoKV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gY2hlY2tib3hlc1ZhbHVlc1tub2RlLmdldFBhdGgoKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZUNsYXNzZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBib3hlcyA9IGNoZWNrYm94ZXMubWFwKChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSB2YWx1ZXNbY10gIT09IHVuZGVmaW5lZCA/IHZhbHVlc1tjXSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2sgPSAoZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGVja2JveENoZWNrKG5vZGUsIGMsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuYmluZCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB2YWx1ZUNsYXNzZXMucHVzaChjKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFJlYWN0TVVJLkNoZWNrYm94LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBjICsgXCItXCIgKyAoc2VsZWN0ZWQgPyBcInRydWVcIiA6IFwiZmFsc2VcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiBzZWxlY3RlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hlY2s6IGNsaWNrLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkW2NdLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImNib3gtXCIgKyBjXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQgKz0gaW5oZXJpdGVkID8gXCIgaW5oZXJpdGVkIFwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkICs9IHZhbHVlQ2xhc3Nlcy5sZW5ndGggPyBcIiBjaGVja2JveC12YWx1ZXMtXCIgKyB2YWx1ZUNsYXNzZXMuam9pbignLScpIDogXCIgY2hlY2tib3gtdmFsdWVzLWVtcHR5XCI7XG4gICAgICAgICAgICAgICAgYm94ZXMgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcInRyZWUtY2hlY2tib3hlc1wiICsgYWRkaXRpb25hbENsYXNzTmFtZSB9LFxuICAgICAgICAgICAgICAgICAgICBib3hlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaXRlbVN0eWxlID0geyBwYWRkaW5nTGVmdDogcGFkZGluZ09mZnNldCArIGRlcHRoICogMjAgfTtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGVJc1NlbGVjdGVkKG5vZGUpICYmIHNlbGVjdGVkSXRlbVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgaXRlbVN0eWxlID0gX2V4dGVuZHMoe30sIGl0ZW1TdHlsZSwgc2VsZWN0ZWRJdGVtU3R5bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdldEl0ZW1TdHlsZSkge1xuICAgICAgICAgICAgICAgIGl0ZW1TdHlsZSA9IF9leHRlbmRzKHt9LCBpdGVtU3R5bGUsIGdldEl0ZW1TdHlsZShub2RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaWNvbiA9ICdtZGkgbWRpLWZvbGRlcic7XG4gICAgICAgICAgICB2YXIgYWp4cE1pbWUgPSBub2RlLmdldEFqeHBNaW1lKCk7XG4gICAgICAgICAgICBpZiAoYWp4cE1pbWUgPT09ICdhanhwX2Jyb3dzYWJsZV9hcmNoaXZlJykge1xuICAgICAgICAgICAgICAgIGljb24gPSAnbWRpIG1kaS1hcmNoaXZlJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWp4cE1pbWUgPT09ICdhanhwX3JlY3ljbGUnKSB7XG4gICAgICAgICAgICAgICAgaWNvbiA9ICdtZGkgbWRpLWRlbGV0ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmTGFiZWwgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBDb250ZXh0TWVudVdyYXBwZXIsXG4gICAgICAgICAgICAgICAgeyBub2RlOiBub2RlLCBjbGFzc05hbWU6ICd0cmVlLWl0ZW0gJyArIGlzU2VsZWN0ZWQgKyAoYm94ZXMgPyAnIGhhcy1jaGVja2JveGVzJyA6ICcnKSwgc3R5bGU6IGl0ZW1TdHlsZSB9LFxuICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICd0cmVlLWl0ZW0tbGFiZWwnLCBvbkNsaWNrOiB0aGlzLm9uTm9kZVNlbGVjdCwgdGl0bGU6IG5vZGUuZ2V0TGFiZWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLWlkJzogbm9kZS5nZXRQYXRoKCkgfSxcbiAgICAgICAgICAgICAgICAgICAgaGFzQ2hpbGRyZW4sXG4gICAgICAgICAgICAgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IFwidHJlZS1pY29uIFwiICsgaWNvbiB9KSxcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VMYWJlbCA/IGZvcmNlTGFiZWwgOiBub2RlLmdldExhYmVsKClcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGJveGVzXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNoaWxkcmVuID0gW107XG4gICAgICAgIHZhciBjb25uZWN0b3IgPSBmdW5jdGlvbiBjb25uZWN0b3IoaW5zdGFuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGRyYWdnYWJsZSA9IGZhbHNlO1xuICAgICAgICBpZiAod2luZG93LlJlYWN0RE5EICYmIHRoaXMucHJvcHMuY29ubmVjdERyb3BUYXJnZXQgJiYgdGhpcy5wcm9wcy5jb25uZWN0RHJhZ1NvdXJjZSkge1xuICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdERyYWdTb3VyY2UgPSBfdGhpcy5wcm9wcy5jb25uZWN0RHJhZ1NvdXJjZTtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdERyb3BUYXJnZXQgPSBfdGhpcy5wcm9wcy5jb25uZWN0RHJvcFRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25uZWN0b3IgPSBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdERyYWdTb3VyY2UoUmVhY3RET00uZmluZERPTU5vZGUoaW5zdGFuY2UpKTtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdERyb3BUYXJnZXQoUmVhY3RET00uZmluZERPTU5vZGUoaW5zdGFuY2UpKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGRyYWdnYWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2hvd0NoaWxkcmVuIHx8IGZvcmNlRXhwYW5kKSB7XG4gICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuc3RhdGUuY2hpbGRyZW4ubWFwKChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywge1xuICAgICAgICAgICAgICAgICAgICBmb3JjZUxhYmVsOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbk9ubHk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IGNoaWxkLmdldFBhdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgbm9kZTogY2hpbGQsXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoOiBkZXB0aCArIDFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoZHJhZ2dhYmxlID8gRHJhZ0Ryb3BUcmVlTm9kZSA6IFNpbXBsZVRyZWVOb2RlLCBwcm9wcyk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnbGknLFxuICAgICAgICAgICAgeyByZWY6IGNvbm5lY3RvciwgY2xhc3NOYW1lOiBcInRyZWVub2RlXCIgKyBub2RlLmdldFBhdGgoKS5yZXBsYWNlKC9cXC8vZywgJ18nKSB9LFxuICAgICAgICAgICAgc2VsZkxhYmVsLFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgJ3VsJyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxufSk7XG5cbnZhciBEcmFnRHJvcFRyZWVOb2RlO1xuaWYgKHdpbmRvdy5SZWFjdERORCkge1xuICAgIERyYWdEcm9wVHJlZU5vZGUgPSBSZWFjdERORC5mbG93KFJlYWN0RE5ELkRyYWdTb3VyY2UoX3V0aWxETkQuVHlwZXMuTk9ERV9QUk9WSURFUiwgX3V0aWxETkQubm9kZURyYWdTb3VyY2UsIF91dGlsRE5ELmNvbGxlY3QpLCBSZWFjdERORC5Ecm9wVGFyZ2V0KF91dGlsRE5ELlR5cGVzLk5PREVfUFJPVklERVIsIF91dGlsRE5ELm5vZGVEcm9wVGFyZ2V0LCBfdXRpbERORC5jb2xsZWN0RHJvcCkpKFNpbXBsZVRyZWVOb2RlKTtcbn0gZWxzZSB7XG4gICAgRHJhZ0Ryb3BUcmVlTm9kZSA9IFNpbXBsZVRyZWVOb2RlO1xufVxuXG4vKipcbiAqIFNpbXBsZSBvcGVuYWJsZSAvIGxvYWRhYmxlIHRyZWUgdGFraW5nIEFqeHBOb2RlIGFzIGlucHV0c1xuICovXG52YXIgRE5EVHJlZVZpZXcgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnRE5EVHJlZVZpZXcnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHNob3dSb290OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHJvb3RMYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIG9uTm9kZVNlbGVjdDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBub2RlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmluc3RhbmNlT2YoQWp4cE5vZGUpLmlzUmVxdWlyZWQsXG4gICAgICAgIGRhdGFNb2RlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvRGF0YU1vZGVsKS5pc1JlcXVpcmVkLFxuICAgICAgICBzZWxlY3RhYmxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHNlbGVjdGFibGVNdWx0aXBsZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICBpbml0aWFsU2VsZWN0aW9uTW9kZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYXJyYXksXG4gICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIGZvcmNlRXhwYW5kOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8vIE9wdGlvbmFsIGN1cnJlbnRseSBzZWxlY3RlZCBkZXRlY3Rpb25cbiAgICAgICAgbm9kZUlzU2VsZWN0ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgLy8gT3B0aW9uYWwgY2hlY2tib3hlc1xuICAgICAgICBjaGVja2JveGVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBjaGVja2JveGVzVmFsdWVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgY2hlY2tib3hlc0NvbXB1dGVTdGF0dXM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgb25DaGVja2JveENoZWNrOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIHBhZGRpbmdPZmZzZXQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMubnVtYmVyXG4gICAgfSxcblxuICAgIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2hvd1Jvb3Q6IHRydWUsXG4gICAgICAgICAgICBvbk5vZGVTZWxlY3Q6IHRoaXMub25Ob2RlU2VsZWN0XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIG9uTm9kZVNlbGVjdDogZnVuY3Rpb24gb25Ob2RlU2VsZWN0KG5vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Ob2RlU2VsZWN0KSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uTm9kZVNlbGVjdChub2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLnNldFNlbGVjdGVkTm9kZXMoW25vZGVdKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ3VsJyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSB9LFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoRHJhZ0Ryb3BUcmVlTm9kZSwge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuT25seTogIXRoaXMucHJvcHMuc2hvd1Jvb3QsXG4gICAgICAgICAgICAgICAgZm9yY2VFeHBhbmQ6IHRoaXMucHJvcHMuZm9yY2VFeHBhbmQsXG4gICAgICAgICAgICAgICAgbm9kZTogdGhpcy5wcm9wcy5ub2RlID8gdGhpcy5wcm9wcy5ub2RlIDogdGhpcy5wcm9wcy5kYXRhTW9kZWwuZ2V0Um9vdE5vZGUoKSxcbiAgICAgICAgICAgICAgICBkYXRhTW9kZWw6IHRoaXMucHJvcHMuZGF0YU1vZGVsLFxuICAgICAgICAgICAgICAgIG9uTm9kZVNlbGVjdDogdGhpcy5vbk5vZGVTZWxlY3QsXG4gICAgICAgICAgICAgICAgbm9kZUlzU2VsZWN0ZWQ6IHRoaXMucHJvcHMubm9kZUlzU2VsZWN0ZWQsXG4gICAgICAgICAgICAgICAgZm9yY2VMYWJlbDogdGhpcy5wcm9wcy5yb290TGFiZWwsXG4gICAgICAgICAgICAgICAgY2hlY2tib3hlczogdGhpcy5wcm9wcy5jaGVja2JveGVzLFxuICAgICAgICAgICAgICAgIGNoZWNrYm94ZXNWYWx1ZXM6IHRoaXMucHJvcHMuY2hlY2tib3hlc1ZhbHVlcyxcbiAgICAgICAgICAgICAgICBjaGVja2JveGVzQ29tcHV0ZVN0YXR1czogdGhpcy5wcm9wcy5jaGVja2JveGVzQ29tcHV0ZVN0YXR1cyxcbiAgICAgICAgICAgICAgICBvbkNoZWNrYm94Q2hlY2s6IHRoaXMucHJvcHMub25DaGVja2JveENoZWNrLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbVN0eWxlOiB0aGlzLnByb3BzLnNlbGVjdGVkSXRlbVN0eWxlLFxuICAgICAgICAgICAgICAgIGdldEl0ZW1TdHlsZTogdGhpcy5wcm9wcy5nZXRJdGVtU3R5bGUsXG4gICAgICAgICAgICAgICAgcGFkZGluZ09mZnNldDogdGhpcy5wcm9wcy5wYWRkaW5nT2Zmc2V0XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cbn0pO1xuXG52YXIgVHJlZVZpZXcgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnVHJlZVZpZXcnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHNob3dSb290OiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHJvb3RMYWJlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIG9uTm9kZVNlbGVjdDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5mdW5jLFxuICAgICAgICBub2RlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmluc3RhbmNlT2YoQWp4cE5vZGUpLmlzUmVxdWlyZWQsXG4gICAgICAgIGRhdGFNb2RlbDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5pbnN0YW5jZU9mKFB5ZGlvRGF0YU1vZGVsKS5pc1JlcXVpcmVkLFxuICAgICAgICBzZWxlY3RhYmxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHNlbGVjdGFibGVNdWx0aXBsZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5ib29sLFxuICAgICAgICBpbml0aWFsU2VsZWN0aW9uTW9kZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuYXJyYXksXG4gICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIGZvcmNlRXhwYW5kOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8vIE9wdGlvbmFsIGN1cnJlbnRseSBzZWxlY3RlZCBkZXRlY3Rpb25cbiAgICAgICAgbm9kZUlzU2VsZWN0ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgLy8gT3B0aW9uYWwgY2hlY2tib3hlc1xuICAgICAgICBjaGVja2JveGVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmFycmF5LFxuICAgICAgICBjaGVja2JveGVzVmFsdWVzOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgY2hlY2tib3hlc0NvbXB1dGVTdGF0dXM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgb25DaGVja2JveENoZWNrOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIHBhZGRpbmdPZmZzZXQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMubnVtYmVyXG4gICAgfSxcblxuICAgIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2hvd1Jvb3Q6IHRydWUsXG4gICAgICAgICAgICBvbk5vZGVTZWxlY3Q6IHRoaXMub25Ob2RlU2VsZWN0XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIG9uTm9kZVNlbGVjdDogZnVuY3Rpb24gb25Ob2RlU2VsZWN0KG5vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Ob2RlU2VsZWN0KSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uTm9kZVNlbGVjdChub2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLnNldFNlbGVjdGVkTm9kZXMoW25vZGVdKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ3VsJyxcbiAgICAgICAgICAgIHsgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSB9LFxuICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoU2ltcGxlVHJlZU5vZGUsIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbk9ubHk6ICF0aGlzLnByb3BzLnNob3dSb290LFxuICAgICAgICAgICAgICAgIGZvcmNlRXhwYW5kOiB0aGlzLnByb3BzLmZvcmNlRXhwYW5kLFxuICAgICAgICAgICAgICAgIG5vZGU6IHRoaXMucHJvcHMubm9kZSA/IHRoaXMucHJvcHMubm9kZSA6IHRoaXMucHJvcHMuZGF0YU1vZGVsLmdldFJvb3ROb2RlKCksXG4gICAgICAgICAgICAgICAgZGF0YU1vZGVsOiB0aGlzLnByb3BzLmRhdGFNb2RlbCxcbiAgICAgICAgICAgICAgICBvbk5vZGVTZWxlY3Q6IHRoaXMub25Ob2RlU2VsZWN0LFxuICAgICAgICAgICAgICAgIG5vZGVJc1NlbGVjdGVkOiB0aGlzLnByb3BzLm5vZGVJc1NlbGVjdGVkLFxuICAgICAgICAgICAgICAgIGZvcmNlTGFiZWw6IHRoaXMucHJvcHMucm9vdExhYmVsLFxuICAgICAgICAgICAgICAgIGNoZWNrYm94ZXM6IHRoaXMucHJvcHMuY2hlY2tib3hlcyxcbiAgICAgICAgICAgICAgICBjaGVja2JveGVzVmFsdWVzOiB0aGlzLnByb3BzLmNoZWNrYm94ZXNWYWx1ZXMsXG4gICAgICAgICAgICAgICAgY2hlY2tib3hlc0NvbXB1dGVTdGF0dXM6IHRoaXMucHJvcHMuY2hlY2tib3hlc0NvbXB1dGVTdGF0dXMsXG4gICAgICAgICAgICAgICAgb25DaGVja2JveENoZWNrOiB0aGlzLnByb3BzLm9uQ2hlY2tib3hDaGVjayxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1TdHlsZTogdGhpcy5wcm9wcy5zZWxlY3RlZEl0ZW1TdHlsZSxcbiAgICAgICAgICAgICAgICBnZXRJdGVtU3R5bGU6IHRoaXMucHJvcHMuZ2V0SXRlbVN0eWxlLFxuICAgICAgICAgICAgICAgIHBhZGRpbmdPZmZzZXQ6IHRoaXMucHJvcHMucGFkZGluZ09mZnNldFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbn0pO1xuXG52YXIgRm9sZGVyc1RyZWUgPSBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlQ2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnRm9sZGVyc1RyZWUnLFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHB5ZGlvOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmluc3RhbmNlT2YoX3B5ZGlvMlsnZGVmYXVsdCddKS5pc1JlcXVpcmVkLFxuICAgICAgICBkYXRhTW9kZWw6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuaW5zdGFuY2VPZihQeWRpb0RhdGFNb2RlbCkuaXNSZXF1aXJlZCxcbiAgICAgICAgY2xhc3NOYW1lOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgb25Ob2RlU2VsZWN0ZWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgZHJhZ2dhYmxlOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLmJvb2xcbiAgICB9LFxuXG4gICAgbm9kZU9ic2VydmVyOiBmdW5jdGlvbiBub2RlT2JzZXJ2ZXIoKSB7XG4gICAgICAgIHZhciByID0gdGhpcy5wcm9wcy5kYXRhTW9kZWwuZ2V0Um9vdE5vZGUoKTtcbiAgICAgICAgaWYgKCFyLmlzTG9hZGVkKCkpIHtcbiAgICAgICAgICAgIHIub2JzZXJ2ZU9uY2UoXCJsb2FkZWRcIiwgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHZhciBkbSA9IHRoaXMucHJvcHMuZGF0YU1vZGVsO1xuICAgICAgICB0aGlzLl9kbU9icyA9IHRoaXMubm9kZU9ic2VydmVyO1xuICAgICAgICBkbS5vYnNlcnZlKFwiY29udGV4dF9jaGFuZ2VkXCIsIHRoaXMuX2RtT2JzKTtcbiAgICAgICAgZG0ub2JzZXJ2ZShcInJvb3Rfbm9kZV9jaGFuZ2VkXCIsIHRoaXMuX2RtT2JzKTtcbiAgICAgICAgdGhpcy5ub2RlT2JzZXJ2ZXIoKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5fZG1PYnMpIHtcbiAgICAgICAgICAgIHZhciBkbSA9IHRoaXMucHJvcHMuZGF0YU1vZGVsO1xuICAgICAgICAgICAgZG0uc3RvcE9ic2VydmluZyhcImNvbnRleHRfY2hhbmdlZFwiLCB0aGlzLl9kbU9icyk7XG4gICAgICAgICAgICBkbS5zdG9wT2JzZXJ2aW5nKFwicm9vdF9ub2RlX2NoYW5nZWRcIiwgdGhpcy5fZG1PYnMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRyZWVOb2RlU2VsZWN0ZWQ6IGZ1bmN0aW9uIHRyZWVOb2RlU2VsZWN0ZWQobikge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbk5vZGVTZWxlY3RlZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbk5vZGVTZWxlY3RlZChuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZGF0YU1vZGVsLnJlcXVpcmVDb250ZXh0Q2hhbmdlKG4pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG5vZGVJc1NlbGVjdGVkOiBmdW5jdGlvbiBub2RlSXNTZWxlY3RlZChuKSB7XG4gICAgICAgIHJldHVybiBuID09PSB0aGlzLnByb3BzLmRhdGFNb2RlbC5nZXRDb250ZXh0Tm9kZSgpO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoUHlkaW9Db21wb25lbnRzLkRORFRyZWVWaWV3LCB7XG4gICAgICAgICAgICAgICAgb25Ob2RlU2VsZWN0OiB0aGlzLnRyZWVOb2RlU2VsZWN0ZWQsXG4gICAgICAgICAgICAgICAgbm9kZUlzU2VsZWN0ZWQ6IHRoaXMubm9kZUlzU2VsZWN0ZWQsXG4gICAgICAgICAgICAgICAgZGF0YU1vZGVsOiB0aGlzLnByb3BzLmRhdGFNb2RlbCxcbiAgICAgICAgICAgICAgICBub2RlOiB0aGlzLnByb3BzLmRhdGFNb2RlbC5nZXRSb290Tm9kZSgpLFxuICAgICAgICAgICAgICAgIHNob3dSb290OiB0aGlzLnByb3BzLnNob3dSb290ID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbVN0eWxlOiB0aGlzLnByb3BzLnNlbGVjdGVkSXRlbVN0eWxlLFxuICAgICAgICAgICAgICAgIGdldEl0ZW1TdHlsZTogdGhpcy5wcm9wcy5nZXRJdGVtU3R5bGUsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImZvbGRlcnMtdHJlZVwiICsgKHRoaXMucHJvcHMuY2xhc3NOYW1lID8gJyAnICsgdGhpcy5wcm9wcy5jbGFzc05hbWUgOiAnJylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFB5ZGlvQ29tcG9uZW50cy5UcmVlVmlldywge1xuICAgICAgICAgICAgICAgIG9uTm9kZVNlbGVjdDogdGhpcy50cmVlTm9kZVNlbGVjdGVkLFxuICAgICAgICAgICAgICAgIG5vZGVJc1NlbGVjdGVkOiB0aGlzLm5vZGVJc1NlbGVjdGVkLFxuICAgICAgICAgICAgICAgIGRhdGFNb2RlbDogdGhpcy5wcm9wcy5kYXRhTW9kZWwsXG4gICAgICAgICAgICAgICAgbm9kZTogdGhpcy5wcm9wcy5kYXRhTW9kZWwuZ2V0Um9vdE5vZGUoKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1TdHlsZTogdGhpcy5wcm9wcy5zZWxlY3RlZEl0ZW1TdHlsZSxcbiAgICAgICAgICAgICAgICBnZXRJdGVtU3R5bGU6IHRoaXMucHJvcHMuZ2V0SXRlbVN0eWxlLFxuICAgICAgICAgICAgICAgIHNob3dSb290OiB0aGlzLnByb3BzLnNob3dSb290ID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJmb2xkZXJzLXRyZWVcIiArICh0aGlzLnByb3BzLmNsYXNzTmFtZSA/ICcgJyArIHRoaXMucHJvcHMuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSk7XG5cbmV4cG9ydHMuVHJlZVZpZXcgPSBUcmVlVmlldztcbmV4cG9ydHMuRE5EVHJlZVZpZXcgPSBETkRUcmVlVmlldztcbmV4cG9ydHMuRm9sZGVyc1RyZWUgPSBGb2xkZXJzVHJlZTtcbiJdfQ==
